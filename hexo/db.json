{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/rebots.txt","path":"rebots.txt","modified":0,"renderable":0},{"_id":"source/images/zhifubao.png","path":"images/zhifubao.png","modified":0,"renderable":0},{"_id":"source/images/weixin.png","path":"images/weixin.png","modified":0,"renderable":0},{"_id":"source/images/git/gitbucket主页.png","path":"images/git/gitbucket主页.png","modified":0,"renderable":0},{"_id":"source/images/git/gitbucket效果图.png","path":"images/git/gitbucket效果图.png","modified":0,"renderable":0},{"_id":"source/images/git/gitbucket登录.png","path":"images/git/gitbucket登录.png","modified":0,"renderable":0},{"_id":"source/images/git/gitbucket创建仓库.png","path":"images/git/gitbucket创建仓库.png","modified":0,"renderable":0},{"_id":"source/images/git/gitlab登陆2.png","path":"images/git/gitlab登陆2.png","modified":0,"renderable":0},{"_id":"source/images/qiniu/七牛云key.png","path":"images/qiniu/七牛云key.png","modified":0,"renderable":0},{"_id":"source/images/qiniu/新建存储.png","path":"images/qiniu/新建存储.png","modified":0,"renderable":0},{"_id":"source/images/qiniu/绑定域名.png","path":"images/qiniu/绑定域名.png","modified":0,"renderable":0},{"_id":"source/images/web/实战1架构图.png","path":"images/web/实战1架构图.png","modified":0,"renderable":0},{"_id":"themes/next2/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next2/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next2/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next2/source/images/avatar.jpg","path":"images/avatar.jpg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/favicon-16x16-next.jpg","path":"images/favicon-16x16-next.jpg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next2/source/images/favicon-32x32-next.jpg","path":"images/favicon-32x32-next.jpg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next2/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next2/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next2/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next2/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"source/images/git/gitlab主页.png","path":"images/git/gitlab主页.png","modified":0,"renderable":0},{"_id":"source/images/git/gitlab修改密码.png","path":"images/git/gitlab修改密码.png","modified":0,"renderable":0},{"_id":"source/images/git/gitlab登陆.png","path":"images/git/gitlab登陆.png","modified":0,"renderable":0},{"_id":"source/images/git/gitlab禁止注册.png","path":"images/git/gitlab禁止注册.png","modified":0,"renderable":0},{"_id":"source/images/qiniu/查看cname.png","path":"images/qiniu/查看cname.png","modified":0,"renderable":0},{"_id":"source/images/qiniu/添加cname.png","path":"images/qiniu/添加cname.png","modified":0,"renderable":0},{"_id":"source/images/qiniu/设置默认域名.png","path":"images/qiniu/设置默认域名.png","modified":0,"renderable":0},{"_id":"themes/next2/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/love.js","path":"js/src/love.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/algolia-instant-search/LICENSE","path":"lib/algolia-instant-search/LICENSE","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/algolia-instant-search/README.md","path":"lib/algolia-instant-search/README.md","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/algolia-instant-search/instantsearch.min.css","path":"lib/algolia-instant-search/instantsearch.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/LICENSE","path":"lib/pace/LICENSE","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/README.md","path":"lib/pace/README.md","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next2/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/next2/source/lib/algolia-instant-search/instantsearch.min.js","path":"lib/algolia-instant-search/instantsearch.min.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/rebots.txt","hash":"3d65c08b8b60cc53db951696cab8aaec372227da","modified":1518100811541},{"_id":"themes/next2/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1518056510435},{"_id":"themes/next2/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1518056510436},{"_id":"themes/next2/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1518056510436},{"_id":"themes/next2/.gitignore","hash":"0378adb9c2dc4855b3198184df4863cb30e4059c","modified":1518056510438},{"_id":"themes/next2/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1518056510439},{"_id":"themes/next2/.javascript_ignore","hash":"cd250ad74ca22bd2c054476456a73d9687f05f87","modified":1518056510439},{"_id":"themes/next2/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1518056510439},{"_id":"themes/next2/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1518056510439},{"_id":"themes/next2/.travis.yml","hash":"6674fbdfe0d0c03b8a04527ffb8ab66a94253acd","modified":1518056510440},{"_id":"themes/next2/LICENSE.md","hash":"f0190c7d83a98464549a6b3a51bb206148d88e1b","modified":1518056510440},{"_id":"themes/next2/README.md","hash":"22f81fb0211cd2efab94ee3292c78da4932ff6d6","modified":1518056510440},{"_id":"themes/next2/bower.json","hash":"8dda3a0cf12ddd8b7541f530580bf22981a93698","modified":1518056510441},{"_id":"themes/next2/crowdin.yml","hash":"d8807bbc82be89d16bcaf08b1855008b3fe92cab","modified":1518056510442},{"_id":"themes/next2/_config.yml","hash":"e0784a67478f1ee1a42ea51a869cbd8c0042eaca","modified":1519622490260},{"_id":"themes/next2/gulpfile.coffee","hash":"67eaf2515100971f6195b60eeebbfe5e8de895ab","modified":1518056510449},{"_id":"themes/next2/package.json","hash":"1ea2c660a7d09ae5d289fd646789c1aecc2916ec","modified":1518056510589},{"_id":"source/_posts/aboutme.rst","hash":"a91a0d37f6095a357187e6cfa41f073c6b3bee36","modified":1519280850187},{"_id":"source/_posts/CA服务器的搭建.rst","hash":"1c7941867ad276db797b1b5f47795656df135ad6","modified":1518830145340},{"_id":"source/_posts/gitbucket本地部署.rst","hash":"ec7fbda7250a8a670aeae7e75e411ab22bbc30c7","modified":1519111085874},{"_id":"source/_posts/gitlab本地部署.rst","hash":"f6f089e1dab7a8c96d0c78792f78d33457729563","modified":1519111121588},{"_id":"source/_posts/lamp一键编译安装.rst","hash":"62a2b6e71d516bd29db8d1121a60c78ec90ffdfe","modified":1518941398956},{"_id":"source/_posts/lamp实战一.rst","hash":"41fe36688fee18b9fccf09e7a864ee31471ddc7b","modified":1518941414256},{"_id":"source/_posts/mariadb多实例的三种实现.rst","hash":"c7b7079d7bf359ddaaad21f184891b9d553e3832","modified":1519624664678},{"_id":"source/_posts/test.rst","hash":"51655c90bf914c6c7913c5132944b49107090095","modified":1517919000705},{"_id":"source/_posts/test_database.rst","hash":"820d09783b8e2261e2920623afcf9027d0730ff9","modified":1517919000705},{"_id":"source/_posts/test_essay.rst","hash":"ad880ae5bee09718ac2ddcf8e41df64ca33de2c8","modified":1517919000706},{"_id":"source/_posts/test_linux.rst","hash":"adb79fc5e8aa3c21532baac4076cdb2c9401d0c1","modified":1517919000706},{"_id":"source/_posts/test_python.rst","hash":"9c153ad6d1c0406990dffbd59f41bcfe8322dc6d","modified":1517919000706},{"_id":"source/_posts/test_spider.rst","hash":"99cc7b6112029bfa357eca286575f8c19689105a","modified":1517919000707},{"_id":"source/_posts/使用七牛云存储提供一个数据分发服务.rst","hash":"6dad0a48f400451aaf4fbd9987ea6c608404efd0","modified":1518940206246},{"_id":"source/categories/index.rst","hash":"a2ecb69a2fea3f5a1d47b5152077a23bc1051fc1","modified":1517919000709},{"_id":"source/about/index.rst","hash":"1bcd230c81cef6044d23d421c0721feeadd5c103","modified":1517919000708},{"_id":"source/database/index.rst","hash":"f168bf9d0980a5d9ca723b8f80c470635d6859c3","modified":1517919000709},{"_id":"source/donate/donate.rst","hash":"dbd18f5aad5bc37da76721b70b89ad7a1f8f3747","modified":1517919000710},{"_id":"source/donate/index.rst","hash":"e28eec19d2c64c5744acb2f5728903b5fac8acc5","modified":1518014148541},{"_id":"source/essay/index-1.rst","hash":"480be101173e2b3e0411c6815fc314d30d128181","modified":1517919000711},{"_id":"source/images/zhifubao.png","hash":"045f053993552b70de40937f9ed57baaf74facba","modified":1517919000716},{"_id":"source/essay/index.rst","hash":"c57ffc6d2302b0ab472c9cc5a9675f1300558be5","modified":1517919000712},{"_id":"source/linux/index.rst","hash":"d3f73f362c64111d6a0c060c0b0b389250e48ee5","modified":1517919000717},{"_id":"source/python/index.rst","hash":"60de897fd81db38e86b30976d343711b3cdbd33b","modified":1517919000718},{"_id":"source/spider/index.rst","hash":"401ec540592342830899569345b4627e2f9b88f7","modified":1517919000718},{"_id":"source/tags/index.rst","hash":"d79af470724817dda65309ad4e1c6ca77344dffa","modified":1517919000719},{"_id":"source/topic/index.rst","hash":"f69ef2bec61f50e6bd4b9f83b30c9572342b3ae2","modified":1518340880909},{"_id":"themes/next2/.github/CONTRIBUTING.md","hash":"e8400c762e5754baf439ab2b7c9e92acd2fc6fe9","modified":1518056510436},{"_id":"themes/next2/.github/ISSUE_TEMPLATE.md","hash":"d19c9b9d6360bbee4bb39a7a8527ec36924dd6b5","modified":1518056510437},{"_id":"themes/next2/.github/PULL_REQUEST_TEMPLATE.md","hash":"36201119490a04107c8179b10202548a9d0e5e60","modified":1518056510437},{"_id":"themes/next2/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1518056510437},{"_id":"themes/next2/.github/stale.yml","hash":"b9f7b394c0f3c00ac36168aa5f88c04cbb335911","modified":1518056510438},{"_id":"themes/next2/.git/COMMIT_EDITMSG","hash":"a93b9b845838d1a6d1b1e3d6d710cd3529a7cbc1","modified":1519520712161},{"_id":"themes/next2/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1518056510418},{"_id":"themes/next2/.git/config","hash":"4884dff90dd8edd7457abc7fd15993d9a4cd2503","modified":1518056510424},{"_id":"themes/next2/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1518056506290},{"_id":"themes/next2/.git/index","hash":"6d2e9fa41341d5ee9af5f67ca6b066e76b48225d","modified":1519520712156},{"_id":"themes/next2/.git/packed-refs","hash":"642c4668235fc3b3922b084c25168bcb5680af0a","modified":1518056510412},{"_id":"themes/next2/docs/ALGOLIA-SEARCH.md","hash":"d7487b9a82492e061717c261a38443ee80e1b3ae","modified":1518056510443},{"_id":"themes/next2/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1518056510442},{"_id":"themes/next2/docs/AUTHORS.md","hash":"51a0a13da55ff3d596970b2f9ab4531c6b2211f2","modified":1518056510443},{"_id":"themes/next2/docs/DATA-FILES.md","hash":"9a1895c0a0db705c4c48f512e86917f9af1ec3fb","modified":1518056510443},{"_id":"themes/next2/docs/INSTALLATION.md","hash":"b74ef6fedf76cdb156e2265759ee0a789ddd49cc","modified":1518056510444},{"_id":"themes/next2/docs/LICENSE","hash":"5b702310012d480b40529fd10cf1872f687277a0","modified":1518056510444},{"_id":"themes/next2/docs/MATH.md","hash":"bdbbcaf88f86de3d762fd1459fd5a0893cf4bce6","modified":1518056510445},{"_id":"themes/next2/docs/UPDATE-FROM-5.1.X.md","hash":"c9f2ed8e15c137b1885d9ca8b7197d9f457971e9","modified":1518056510445},{"_id":"themes/next2/languages/_en.yml","hash":"e97f2e1ed0aa29afe582b466081ebec1c4c604aa","modified":1518056510450},{"_id":"themes/next2/languages/ar.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510450},{"_id":"themes/next2/languages/bg.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510450},{"_id":"themes/next2/languages/bn.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510451},{"_id":"themes/next2/languages/cs.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510451},{"_id":"themes/next2/languages/da.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510451},{"_id":"themes/next2/languages/de.yml","hash":"a57f0621ee8356fda3611dcd59d9c85cd18eb303","modified":1518056510451},{"_id":"themes/next2/languages/el.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510452},{"_id":"themes/next2/languages/es.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510453},{"_id":"themes/next2/languages/et.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510453},{"_id":"themes/next2/languages/fa.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510454},{"_id":"themes/next2/languages/fi.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510454},{"_id":"themes/next2/languages/fr.yml","hash":"9eac452414e59cdd36a8c9cfdbf905c73d166ddd","modified":1518056510454},{"_id":"themes/next2/languages/he.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510455},{"_id":"themes/next2/languages/hi.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510455},{"_id":"themes/next2/languages/hr.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510455},{"_id":"themes/next2/languages/hu.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510456},{"_id":"themes/next2/languages/id.yml","hash":"bc005dad17388af8703c3894ad2b373bd1966d3c","modified":1518056510456},{"_id":"themes/next2/languages/it.yml","hash":"0bce625d94868531d76b9f356e7578d67560a988","modified":1518056510456},{"_id":"themes/next2/languages/ja.yml","hash":"0fb3c5cceb812665d7336817bb81304b15e1617e","modified":1518056510457},{"_id":"themes/next2/languages/jv.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510457},{"_id":"themes/next2/languages/ko.yml","hash":"4c74d99c2ef098a079b4dfd22bf62e6b42440781","modified":1518056510457},{"_id":"themes/next2/languages/lt.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510457},{"_id":"themes/next2/languages/lv.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510458},{"_id":"themes/next2/languages/ms.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510458},{"_id":"themes/next2/languages/nl.yml","hash":"632a2e31b4082fc54f92e6a98421da4d17741ac6","modified":1518056510458},{"_id":"themes/next2/languages/no.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510459},{"_id":"themes/next2/languages/pa.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510459},{"_id":"themes/next2/languages/pl.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510459},{"_id":"themes/next2/languages/pt-BR.yml","hash":"3aadfeb1fdbf06ab8c825a9c567414180e2820e4","modified":1518056510460},{"_id":"themes/next2/languages/pt.yml","hash":"ac65f488e04ff0d2f88c7895dc4373e37765f2c5","modified":1518056510460},{"_id":"themes/next2/languages/ro.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510481},{"_id":"themes/next2/languages/ru.yml","hash":"c68fae6532e649ffa997454a4dc8f8b8da905053","modified":1518056510529},{"_id":"themes/next2/languages/sl.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510529},{"_id":"themes/next2/languages/sr.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510530},{"_id":"themes/next2/languages/sv.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510531},{"_id":"themes/next2/languages/th.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510531},{"_id":"themes/next2/languages/tr.yml","hash":"43173357566be19da9d35b0cee44735f126629b0","modified":1518056510532},{"_id":"themes/next2/languages/uk.yml","hash":"767adef08fd2ce880228f89ec8d9966805ed5689","modified":1518056510532},{"_id":"themes/next2/languages/vi.yml","hash":"726a186b48b607b1873cf413f7734b04798322be","modified":1518056510533},{"_id":"themes/next2/languages/zh-HK.yml","hash":"f3ea5b1b79ef3c25527d56e10b3cf354c3542cff","modified":1518056510534},{"_id":"themes/next2/languages/zh-CN.yml","hash":"99873cf32c36da991c9ff77326de96cdcd3d5c39","modified":1518100151849},{"_id":"themes/next2/languages/zh-TW.yml","hash":"5705896235be368ed61781bcd9a219babb84e22a","modified":1518056510535},{"_id":"themes/next2/layout/_layout.swig","hash":"a67d8afb77331a319685014ec2e9ec3ac68f1ae6","modified":1518058336044},{"_id":"themes/next2/layout/archive.swig","hash":"e8e982f6d7f925ca02208b9005af32e56913330e","modified":1518069023625},{"_id":"themes/next2/layout/category.swig","hash":"3cbb3f72429647411f9e85f2544bdf0e3ad2e6b2","modified":1518056510585},{"_id":"themes/next2/layout/index.swig","hash":"555a357ecf17128db4e29346c92bb6298e66547a","modified":1518056510586},{"_id":"themes/next2/layout/page.swig","hash":"6f026bd43aa97a49b970cdd6032c8f905909eb91","modified":1518056510586},{"_id":"themes/next2/layout/post.swig","hash":"ceba7287574c429a235aa7a62bf7a3dc1efb265a","modified":1518056510587},{"_id":"themes/next2/layout/schedule.swig","hash":"87ad6055df01fa2e63e51887d34a2d8f0fbd2f5a","modified":1518056510587},{"_id":"themes/next2/layout/tag.swig","hash":"34e1c016cbdf94a31f9c5d494854ff46b2a182e9","modified":1518056510588},{"_id":"themes/next2/scripts/merge-configs.js","hash":"176952dfe3605c2ab57f3f7cdbac4f2487825c41","modified":1518056510590},{"_id":"themes/next2/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1518056510591},{"_id":"themes/next2/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1518056510679},{"_id":"themes/next2/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1518056510679},{"_id":"themes/next2/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1518056510680},{"_id":"source/images/weixin.png","hash":"66f6da43cbc17a5d6f7af4268e76f088d18870c6","modified":1517919000715},{"_id":"themes/next2/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510655},{"_id":"source/images/git/gitbucket主页.png","hash":"818e96538001c45b347cf556ad17ce05c01a1d97","modified":1519110207271},{"_id":"source/images/git/gitbucket效果图.png","hash":"fe6e2b8ea9f5c1c39a38e90a26cb3ae7d50b4333","modified":1519110341965},{"_id":"source/images/git/gitbucket登录.png","hash":"af0c6b5bc919fc8304d78fd4793736813b9928cd","modified":1519110457211},{"_id":"source/images/git/gitbucket创建仓库.png","hash":"df4558e160191b5029fb109dc869725390fe6d42","modified":1519110307871},{"_id":"source/images/git/gitlab登陆2.png","hash":"82a5ef90c84561d7f02db1e961a1faadce9164b3","modified":1519108641414},{"_id":"source/images/qiniu/七牛云key.png","hash":"55b37f703e6fb27aedbf25c61ee5b73612831977","modified":1518795974855},{"_id":"source/images/qiniu/新建存储.png","hash":"7d5b0ffd7b0fb90c18a588913d18d7d0965d274c","modified":1518790104815},{"_id":"source/images/qiniu/绑定域名.png","hash":"dfb0347feeef66007be244660965eba6848563fe","modified":1518790214958},{"_id":"source/images/web/实战1架构图.png","hash":"6bccbca753588100057521fcbe594d4a579840a8","modified":1518927005151},{"_id":"themes/next2/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1518056506291},{"_id":"themes/next2/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1518056506291},{"_id":"themes/next2/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1518056506292},{"_id":"themes/next2/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1518056506293},{"_id":"themes/next2/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1518056506293},{"_id":"themes/next2/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1518056506294},{"_id":"themes/next2/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1518056506294},{"_id":"themes/next2/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1518056506295},{"_id":"themes/next2/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1518056506296},{"_id":"themes/next2/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1518056506296},{"_id":"themes/next2/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1518056506297},{"_id":"themes/next2/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1518056506297},{"_id":"themes/next2/.git/logs/HEAD","hash":"eedbc2d3060cb92b0b3239360e523b2fe97b0203","modified":1519520712203},{"_id":"themes/next2/docs/ru/DATA-FILES.md","hash":"a51de08657f5946f4028b11373280ddc04639525","modified":1518056510446},{"_id":"themes/next2/docs/ru/INSTALLATION.md","hash":"7b2963daac19b0c14f98ebef375d5fbce8fc3f44","modified":1518056510446},{"_id":"themes/next2/docs/ru/README.md","hash":"c314fd4c147d881bd4158038fee4adf86841b848","modified":1518056510446},{"_id":"themes/next2/docs/ru/UPDATE-FROM-5.1.X.md","hash":"1a4e41adcf5831057f3f7b3025ed4a5ef7c442b4","modified":1518056510447},{"_id":"themes/next2/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"1acf075b0a5f87427b0916a95495a1a13241e8a1","modified":1518056510447},{"_id":"themes/next2/docs/zh-CN/DATA-FILES.md","hash":"67f4a987e7db0ab1ce1ea4c311f2961df07b6681","modified":1518056510447},{"_id":"themes/next2/docs/zh-CN/INSTALLATION.md","hash":"baca12cc24be082f1db28c7f283493569666321c","modified":1518056510448},{"_id":"themes/next2/docs/zh-CN/MATH.md","hash":"08c630dc7bd479e49d7d5aa813df628e7726bd7f","modified":1518056510448},{"_id":"themes/next2/docs/zh-CN/README.md","hash":"0b2b901dd14bd0df755d4bcb89b7bfc7afb30e66","modified":1518056510449},{"_id":"themes/next2/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"1ec7a0e9ac64b2c84aa1fd7ba2c662be1dbcb407","modified":1518056510449},{"_id":"themes/next2/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1518056510539},{"_id":"themes/next2/layout/_macro/post-copyright.swig","hash":"1201c26e92807b5af3129366e9c3588269d91cd9","modified":1518056510540},{"_id":"themes/next2/layout/_macro/post.swig","hash":"ec3eb8657d5f918778a3097f9626ee3fd522e8ee","modified":1518062068060},{"_id":"themes/next2/layout/_macro/reward.swig","hash":"8dc3b6ba76c389aaa0810cbd0df206f7096d76a0","modified":1518056510541},{"_id":"themes/next2/layout/_macro/sidebar.swig","hash":"d234fbb8b32dd53e55e492f64f92557c217aef7e","modified":1518056510542},{"_id":"themes/next2/layout/_macro/wechat-subscriber.swig","hash":"616ffee93e84958e72ee0f996808f866c4ccdbf7","modified":1518056510542},{"_id":"themes/next2/layout/_custom/head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1518056510537},{"_id":"themes/next2/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1518056510537},{"_id":"themes/next2/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1518056510538},{"_id":"themes/next2/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1518056510555},{"_id":"themes/next2/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1518056510555},{"_id":"themes/next2/layout/_scripts/noscript.swig","hash":"f8c7e729ad6e72b4c705a2c5d5041589c2b4cc52","modified":1518056510556},{"_id":"themes/next2/layout/_scripts/vendors.swig","hash":"f134aeb8d5bee351e5277edb92ac694af314b75f","modified":1518056510560},{"_id":"themes/next2/layout/_partials/comments.swig","hash":"2e8c3df265e9ae38003d1321fb80fb3b12cb6a97","modified":1518056510543},{"_id":"themes/next2/layout/_partials/footer.swig","hash":"2132dd17e0f8269f1f1c8d66df6684f2a6d1b90b","modified":1518056510544},{"_id":"themes/next2/layout/_partials/header.swig","hash":"eb02e881b317c590af49e224c4a534f0d7c87f9e","modified":1518069023625},{"_id":"themes/next2/layout/_partials/page-header.swig","hash":"77c61e0baea3544df361b7338c3cd13dc84dde22","modified":1518056510548},{"_id":"themes/next2/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1518056510548},{"_id":"themes/next2/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1518056510549},{"_id":"themes/next2/layout/_third-party/bookmark.swig","hash":"ed62ea83d3f2c9db2ea57bf23a7d765ed82504c2","modified":1518056510569},{"_id":"themes/next2/layout/_third-party/github-banner.swig","hash":"736cb278fa09d3b4ed6f305b56353941ea918793","modified":1518056510575},{"_id":"themes/next2/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1518056510575},{"_id":"themes/next2/layout/_third-party/needsharebutton.swig","hash":"debba9b7110f635204a15df148194d4c2fd2668b","modified":1518056510578},{"_id":"themes/next2/layout/_third-party/pangu.swig","hash":"ccf0035086e14dcefa24c2907301edf4c37d5448","modified":1518056510578},{"_id":"themes/next2/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1518056510579},{"_id":"themes/next2/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1518056510579},{"_id":"themes/next2/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1518056510580},{"_id":"themes/next2/scripts/tags/button.js","hash":"eddbb612c15ac27faf11c59c019ce188f33dec2c","modified":1518056510592},{"_id":"themes/next2/scripts/tags/center-quote.js","hash":"99b66949f18398689b904907af23c013be1b978f","modified":1518056510592},{"_id":"themes/next2/scripts/tags/exturl.js","hash":"85a592259fedaad38b09b7ba4431ad9a400fb492","modified":1518056510593},{"_id":"themes/next2/scripts/tags/full-image.js","hash":"c9f833158c66bd72f627a0559cf96550e867aa72","modified":1518056510594},{"_id":"themes/next2/scripts/tags/group-pictures.js","hash":"ac681b0d0d8d39ba3817336c0270c6787c2b6b70","modified":1518056510594},{"_id":"themes/next2/scripts/tags/label.js","hash":"6f00952d70aadece844ce7fd27adc52816cc7374","modified":1518056510595},{"_id":"themes/next2/scripts/tags/lazy-image.js","hash":"bcba2ff25cd7850ce6da322d8bd85a8dd00b5ceb","modified":1518056510595},{"_id":"themes/next2/scripts/tags/note.js","hash":"f7eae135f35cdab23728e9d0d88b76e00715faa0","modified":1518056510596},{"_id":"themes/next2/scripts/tags/tabs.js","hash":"aa7fc94a5ec27737458d9fe1a75c0db7593352fd","modified":1518056510597},{"_id":"themes/next2/source/css/main.styl","hash":"cc3bfa1086c2b6cb142a73fbc21a65cd0127ab81","modified":1519634666053},{"_id":"themes/next2/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1518056510655},{"_id":"themes/next2/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1518056510656},{"_id":"themes/next2/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1517925307129},{"_id":"themes/next2/source/images/avatar.jpg","hash":"0edb0edde16d7001ca01413978681e0db4d40238","modified":1517925307130},{"_id":"themes/next2/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1518056510656},{"_id":"themes/next2/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1518056510657},{"_id":"themes/next2/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1518056510657},{"_id":"themes/next2/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1518056510658},{"_id":"themes/next2/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1518056510658},{"_id":"themes/next2/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1518056510658},{"_id":"themes/next2/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1518056510659},{"_id":"themes/next2/source/images/favicon-16x16-next.jpg","hash":"68112d6c148e38f2798ca7bfc3fc15081b04fd50","modified":1517925307137},{"_id":"themes/next2/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1518056510659},{"_id":"themes/next2/source/images/favicon-32x32-next.jpg","hash":"8b67a3f1bfa8defee7555f70df39c71404426238","modified":1517925307139},{"_id":"themes/next2/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1518056510659},{"_id":"themes/next2/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1518056510660},{"_id":"themes/next2/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1518056510660},{"_id":"themes/next2/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1518056510660},{"_id":"themes/next2/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1518056510660},{"_id":"themes/next2/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1518056510661},{"_id":"themes/next2/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1518056510661},{"_id":"source/images/git/gitlab主页.png","hash":"1bb45d546ae1a0711c09b70ac0e2c61fff762f10","modified":1519109201495},{"_id":"source/images/git/gitlab修改密码.png","hash":"1e83c4fb616f2fe5aa050da8e75cad57513d1050","modified":1519108587727},{"_id":"source/images/git/gitlab登陆.png","hash":"b73952f1c20e4561967d260a1346196e9aed9aa4","modified":1519108475303},{"_id":"source/images/git/gitlab禁止注册.png","hash":"fbf012d01b9a0eaa4d97aa53de010ce4acecd146","modified":1519108912153},{"_id":"source/images/qiniu/查看cname.png","hash":"43542b440b42cc5bea645fe6a33f4d68e9fd8c27","modified":1518791274984},{"_id":"source/images/qiniu/添加cname.png","hash":"11021410afa7e3181b312814436e24ccc04d046e","modified":1518791324354},{"_id":"source/images/qiniu/设置默认域名.png","hash":"0c4448ef90efeadc812f065955b9784e999c3dee","modified":1518790318392},{"_id":"themes/next2/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510558},{"_id":"themes/next2/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510559},{"_id":"themes/next2/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510643},{"_id":"themes/next2/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510643},{"_id":"themes/next2/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510644},{"_id":"themes/next2/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510653},{"_id":"themes/next2/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1518056510654},{"_id":"themes/next2/.git/objects/0d/6badc76f93a2d08af83ffb56312f91e1b21769","hash":"830228dd92dfe0e8851fb53719e71fabf4cf210f","modified":1518100315427},{"_id":"themes/next2/.git/objects/01/609f121f13b840ea2cdad0fd76afaaa781de0c","hash":"8dc668934d7b83677d07dda822e1b1ee49042b2a","modified":1518505937200},{"_id":"themes/next2/.git/objects/1f/b36450a651b9871fd4df68aa0ad59c26283fa9","hash":"6806fa5ea2309fd047f0452d53750d38854833b1","modified":1518100339480},{"_id":"themes/next2/.git/objects/0e/cac8e584f5d58a6d2215e234a0150dc037d0e1","hash":"9342f0b49da12e14fb205e64fb4e0457ef67594a","modified":1518100315390},{"_id":"themes/next2/.git/objects/2f/92ffa8e80a235cf0f44eee35f7a3208838f4dc","hash":"5b0670988d7473b22b96cd0db789ba0a60a4969c","modified":1518100338932},{"_id":"themes/next2/.git/objects/31/5f29299b4cfae8535630be93aec99f5c1af939","hash":"3b811a0c743bdea4d12a3d0d568b3ff3407f4213","modified":1519520712067},{"_id":"themes/next2/.git/objects/20/bc2b23db6440225b904026c25a529475b53d48","hash":"47953cff6bbbe4d8a69ae3b9b87da0a90ca00e01","modified":1518505937166},{"_id":"themes/next2/.git/objects/31/c7d2e5d27c2fc0911666db44b6877cc0934aae","hash":"9c7459d9b696afbe1d344bc221b6d36d978be70f","modified":1518100315323},{"_id":"themes/next2/.git/objects/33/93f63064351b5edd84608fae8ea152a9b9d72a","hash":"85f555a56df2344570195ec9db1506e879bb6852","modified":1518100339346},{"_id":"themes/next2/.git/objects/48/301b1588eaa3aaa79bf7043e05a69aa63a316b","hash":"7ebf38c4b56f03710ac44350cf4e9aef40490017","modified":1518100315201},{"_id":"themes/next2/.git/objects/4a/ce20721cebe94c27aa79cf49fc7135fcdf2bde","hash":"ccd78b167cd5feb4f82d45b7b0b5fb36ffe7b69d","modified":1518242400111},{"_id":"themes/next2/.git/objects/4c/b6d8916e62bfc1fd3b4662e7fd6ee141ee0ac9","hash":"468396bdc59e63cb7eac6585f1f96773c55a44a5","modified":1518100339279},{"_id":"themes/next2/.git/objects/4d/94cc01722674f9dcd041e5ccf5d246bc946b1c","hash":"8b4deaf46e375fbe854664b368dad1e598e46357","modified":1518100315131},{"_id":"themes/next2/.git/objects/4f/8b2f76edf4faf2aecafa85bd9e0322e7c05406","hash":"db989ecdd43d5162bc6507bcb533a2b3524b7fcf","modified":1518505937133},{"_id":"themes/next2/.git/objects/4f/dcf73989997f93f36e77a0010bd0f15640847c","hash":"499833a05e5493695e5268272082e053a80f9b85","modified":1519520697436},{"_id":"themes/next2/.git/objects/51/6252e280101a6253d42ba75048b5227df6c9e4","hash":"b4a923df59c07b740feeac94e368487d3b083768","modified":1518100339246},{"_id":"themes/next2/.git/objects/55/8ea3dea3a58ce7d35970a2a3ae79bad5a410e8","hash":"c3fc10a176b0ee48287334532b9531abd2f425ce","modified":1518242416659},{"_id":"themes/next2/.git/objects/56/3c57700298a5f8ff699f31839893df64f77dd5","hash":"2207c4d7f7b33b72cfa7ae3a3d39c3769a8f1ee5","modified":1519520712124},{"_id":"themes/next2/.git/objects/59/1ca4bb42d6421cfbfc94c22c6bec1a14f138e8","hash":"7657bd3dd61caa7a50fc2416c0c648a7cd5c3080","modified":1518505937069},{"_id":"themes/next2/.git/objects/61/28daa60db5a93359ad73b9cd35e3fb9939cfad","hash":"c497f9445cf87917dc7036c91122d777fe726474","modified":1518100314968},{"_id":"themes/next2/.git/objects/6c/bacdca5bd57cedd41e538858332b48345fc41f","hash":"eb427564e29f3e9baffa4b0f898b64f2029415fc","modified":1518100339516},{"_id":"themes/next2/.git/objects/6e/ca04005e0458eaceaf1c66cc7a522b03801cfc","hash":"35fc39fb8ba90af02e4a5a2919eada2bdcb98a8e","modified":1518100339445},{"_id":"themes/next2/.git/objects/74/cbb54fb0590756a6a3d4bf5fa089163c990951","hash":"12f38d0bac34652718d330ceae4c6f8f5c6c4aab","modified":1518505937232},{"_id":"themes/next2/.git/objects/87/ee81c7e4aaf203a623851c4170e18c0412004d","hash":"61f91df5a0d773433386a7b5e919e5630032c0e1","modified":1518100315161},{"_id":"themes/next2/.git/objects/8c/20b0fb45bd00e3678859155ba90432e9113a40","hash":"48b33f4df6795118a699e8f71a1062a510e087d0","modified":1518505915387},{"_id":"themes/next2/.git/objects/98/cf292876ff02b396a6bb37d689cfe14c93f600","hash":"78a057610c6a0ec0c60532be9494236ce6526c2d","modified":1518242416827},{"_id":"themes/next2/.git/objects/9f/35d224ef8fa491a784ad9f0b7f761ee8d7ebac","hash":"01ab8ba5e6597e8ef28f163d44e29f16288f8b34","modified":1519520712163},{"_id":"themes/next2/.git/objects/a0/c03aa17a3bae906fb4222b5319600c178fdc53","hash":"ff0c52a6b5a24e06d4c9482b66c0b882669e1709","modified":1518100339412},{"_id":"themes/next2/.git/objects/a2/5901c88a1a10a22f932e8964d9d0011775ff37","hash":"a862cc5411e074cf6dcef30c290da4d6cabe0f6c","modified":1518100315357},{"_id":"themes/next2/.git/objects/a7/faf6188b95b307b4ac82ed1de4ce844fe15cb4","hash":"52cfc0b4d091bf5c4e2d59fc6610d4f592eb1787","modified":1518100339378},{"_id":"themes/next2/.git/objects/af/fbaf4fcac25b4722edbf2d2de4f7836a2e0309","hash":"c646501c1fd076c2e518edcc935762e6b3a1de96","modified":1518242416720},{"_id":"themes/next2/.git/objects/b9/d0802f096454fd0c77828f59f110bcbe7c7ecf","hash":"a774f7c8cd3b18d78bf2e23c10b7ed45ead3ba1a","modified":1518100315236},{"_id":"themes/next2/.git/objects/bb/cb817371943bbf194f0bd907b667f08be9faa7","hash":"d58cee1b3430e0c61a1013a22a3582a9a79b5420","modified":1518100315509},{"_id":"themes/next2/.git/objects/c0/80e4bf0a0a47907576bff6503c0bbfddd82d17","hash":"ab8e3699a0ee44e0f0171bc41f2b9d1dc073797b","modified":1519520711963},{"_id":"themes/next2/.git/objects/c2/03d938715eef3e4f831659ace8ba732367d335","hash":"120e6570741fc9a355cf0cb3157e22909127eae1","modified":1518100315072},{"_id":"themes/next2/.git/objects/c4/3f30f6a1ce42a248d9873f22fae042aaed89d1","hash":"1479effb15666940887ad6ecc6e3ce8d77dad8a1","modified":1518100339313},{"_id":"themes/next2/.git/objects/c4/dc1a2551ce73c48dc25b4e770a52719f6fb91b","hash":"49b172015b15ae2f9c2c662de381ce632038c579","modified":1518242400060},{"_id":"themes/next2/.git/objects/ca/9f96079de95db05a327430c6d6db43c1feb574","hash":"e05e196bb432247e42e000ce5a2b4c05964fcba8","modified":1518100315549},{"_id":"themes/next2/.git/objects/ca/c52c44df79a8c0059f5ed00313af2d081433b7","hash":"6cd7782ee1d455f528b4fc6914d0892e62475119","modified":1518242416788},{"_id":"themes/next2/.git/objects/d3/4cb1b103b30e7e920f15e2bf43b98e153a4ffc","hash":"ca9c1efd8fb445c1081eaeb8d8aa6abd6f933a96","modified":1518242416754},{"_id":"themes/next2/.git/objects/cd/d84164a4aef8beab7c1ec9c2e024e49b80f71a","hash":"ba733e762937922aab2ba5347860c734f557a19f","modified":1519520697516},{"_id":"themes/next2/.git/objects/e2/84555277ff4bb9211ece13e1573c4cfa154f4e","hash":"f36e55b92bed3d99c204d3542450879d4651f9a0","modified":1518100315460},{"_id":"themes/next2/.git/objects/fa/12f4b3d40848178b76f96c8493bb9e1033238d","hash":"c6d1ede644110a3c61da44726316ce864d18eabd","modified":1519520712001},{"_id":"themes/next2/.git/objects/ff/9936374783155c90b52daa43618165f1176165","hash":"1e1054a9bb0f67a69601a5ea5889407ddfd7f206","modified":1518100315280},{"_id":"themes/next2/.git/objects/pack/pack-4ea007b0aabc1a0b98240e4c471a0e657fde72d9.idx","hash":"2ae9cfc666720201260836b269a9d38c7c5bde69","modified":1518056510149},{"_id":"themes/next2/.git/refs/heads/master","hash":"c58ad6066ac4c70a78d01634671c085b3cff3344","modified":1519520712202},{"_id":"themes/next2/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1518056510557},{"_id":"themes/next2/layout/_scripts/schemes/gemini.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1518056510558},{"_id":"themes/next2/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1518056510559},{"_id":"themes/next2/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1518056510545},{"_id":"themes/next2/layout/_partials/head/head-unique.swig","hash":"fc4af87d8d882b24f31e12ccebd2499402b0be72","modified":1518056510546},{"_id":"themes/next2/layout/_partials/head/head.swig","hash":"e4c708ac8442fae6a0adccaf8a217824ca1bcca8","modified":1518056510546},{"_id":"themes/next2/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1518056510550},{"_id":"themes/next2/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1518056510551},{"_id":"themes/next2/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1518056510550},{"_id":"themes/next2/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1518056510552},{"_id":"themes/next2/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1518056510553},{"_id":"themes/next2/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1518056510553},{"_id":"themes/next2/layout/_partials/share/jiathis.swig","hash":"0a9cdd6958395fcdffc80ab60f0c6301b63664a5","modified":1518056510554},{"_id":"themes/next2/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1518056510561},{"_id":"themes/next2/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1518056510562},{"_id":"themes/next2/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1518056510563},{"_id":"themes/next2/layout/_third-party/analytics/busuanzi-counter.swig","hash":"7b11eac3a0685fa1ab2ab6ecff60afc4f15f0d16","modified":1518056510563},{"_id":"themes/next2/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1518056510564},{"_id":"themes/next2/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1518056510564},{"_id":"themes/next2/layout/_third-party/analytics/firestore.swig","hash":"ccc443b22bd4f8c7ac4145664686c756395b90e0","modified":1518056510565},{"_id":"themes/next2/layout/_third-party/analytics/google-analytics.swig","hash":"cfc932c5db04fef64cc56d3ba0b8ddf3a15a63bd","modified":1518056510566},{"_id":"themes/next2/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1518056510566},{"_id":"themes/next2/layout/_third-party/analytics/lean-analytics.swig","hash":"e6d10ee4fb70b3ae1cd37e9e36e000306734aa2e","modified":1518056510567},{"_id":"themes/next2/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1518056510567},{"_id":"themes/next2/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1518056510568},{"_id":"themes/next2/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1518056510568},{"_id":"themes/next2/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1518056510570},{"_id":"themes/next2/layout/_third-party/comments/disqus.swig","hash":"a693a2c00497471d06113443f548b676ee2e527d","modified":1518056510571},{"_id":"themes/next2/layout/_third-party/comments/gitment.swig","hash":"292cdd1059b76d3d10486b71c99d9afb3e59ea44","modified":1518056510571},{"_id":"themes/next2/layout/_third-party/comments/hypercomments.swig","hash":"787d482d797c38e77d69629ebb88d45f972216b7","modified":1518056510572},{"_id":"themes/next2/layout/_third-party/comments/index.swig","hash":"18a58db53f1eef50462ee0065d4445b7fbb04fb5","modified":1518056510572},{"_id":"themes/next2/layout/_third-party/comments/livere.swig","hash":"7cf0c589d95a2d1848266ffe2357e91c95d2e7f8","modified":1518056510573},{"_id":"themes/next2/layout/_third-party/comments/valine.swig","hash":"4050553d44ba1396174161c9a6bb0f89fa779eca","modified":1518056510574},{"_id":"themes/next2/layout/_third-party/comments/youyan.swig","hash":"ab181c036cda9656f87bb1a749e3e7cbc437f012","modified":1518056510574},{"_id":"themes/next2/layout/_third-party/math/index.swig","hash":"30e9e55d9af2ced6e6b156a042026a8b480f0ab0","modified":1518056510576},{"_id":"themes/next2/layout/_third-party/math/katex.swig","hash":"860de4ce6fccc516d2f779a4b600a4214d8c18e2","modified":1518056510577},{"_id":"themes/next2/layout/_third-party/math/mathjax.swig","hash":"9a865d013b6d273bbbfc3999e8657844b0c48752","modified":1518056510577},{"_id":"themes/next2/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1518056510582},{"_id":"themes/next2/layout/_third-party/search/localsearch.swig","hash":"71c897f9b107dd0de1b7f649633cf583c206a9db","modified":1518056510582},{"_id":"themes/next2/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1518056510583},{"_id":"themes/next2/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1518056510584},{"_id":"themes/next2/source/css/_custom/code.styl","hash":"17be705d2087163dd0e7c07bcff4df1ba28da5d3","modified":1519624903040},{"_id":"themes/next2/source/css/_custom/code2.css","hash":"b4005df08fc1e4387f9dab0f09102966a62a81b9","modified":1519623634969},{"_id":"themes/next2/source/css/_custom/codecolor.styl","hash":"be66840ae561b699acf1cb4484062259eb5e058e","modified":1519624929866},{"_id":"themes/next2/source/css/_custom/copyright.styl","hash":"0c1afa00d8c23d3b3f6322c57fdc8d75b8beebf0","modified":1517932241821},{"_id":"themes/next2/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1518056510642},{"_id":"themes/next2/source/css/_custom/slider.styl","hash":"c21e0fac29e564bf9a383edd64a377b02479daf1","modified":1517931778271},{"_id":"themes/next2/source/css/_custom/test2.styl","hash":"47b7ae3bf6342201a17dc1fba71a614a7c8c8271","modified":1519634326737},{"_id":"themes/next2/source/css/_custom/title.styl","hash":"727a6bf29fd896ddfa47ccdbbb2f5f377590b49d","modified":1519520530482},{"_id":"themes/next2/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1518056510642},{"_id":"themes/next2/source/css/_mixins/Pisces.styl","hash":"8aa98ae349908736ba43196c42498fd5bdeb780a","modified":1518056510643},{"_id":"themes/next2/source/css/_mixins/base.styl","hash":"0e55cbd93852dc3f8ccb44df74d35d9918f847e0","modified":1518056510643},{"_id":"themes/next2/source/css/_variables/Gemini.styl","hash":"58e7dd5947817d9fc30770712fc39b2f52230d1e","modified":1518056510653},{"_id":"themes/next2/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1518056510653},{"_id":"themes/next2/source/css/_variables/Pisces.styl","hash":"b89e68789e6dac24e00250528f4fc9ae8aa3599b","modified":1518056510653},{"_id":"themes/next2/source/css/_variables/base.styl","hash":"534b9dec93f3e235c217b97314d4bf513fa3e5ba","modified":1518056510654},{"_id":"themes/next2/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1518056510662},{"_id":"themes/next2/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1518056510662},{"_id":"themes/next2/source/js/src/bootstrap.js","hash":"6c30aab4822b189d1fe9b20ca5272fd8d3ebe998","modified":1518056510662},{"_id":"themes/next2/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1518056510663},{"_id":"themes/next2/source/js/src/love.js","hash":"9e8e79d69ad8338761272f86fe5cad0ad5e503cc","modified":1518241879173},{"_id":"themes/next2/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1518056510663},{"_id":"themes/next2/source/js/src/motion.js","hash":"bea49fc6392bd38fb6f80d041d95d23051423aa2","modified":1518056510663},{"_id":"themes/next2/source/js/src/post-details.js","hash":"02acfa1862d5e4345d6a7cee08841cc9e2fb0259","modified":1518056510664},{"_id":"themes/next2/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1518056510665},{"_id":"themes/next2/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1518056510665},{"_id":"themes/next2/source/js/src/utils.js","hash":"4b891af420efb2f457a4a6f643b5218682c2288d","modified":1518056510666},{"_id":"themes/next2/source/lib/algolia-instant-search/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1518242395317},{"_id":"themes/next2/source/lib/algolia-instant-search/README.md","hash":"ab4e4f86552ce0e630f45efe4abbcdd37d042c45","modified":1518242395318},{"_id":"themes/next2/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1518242395319},{"_id":"themes/next2/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1518056510666},{"_id":"themes/next2/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1518056510667},{"_id":"themes/next2/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1518056510667},{"_id":"themes/next2/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1518056510667},{"_id":"themes/next2/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1518056510667},{"_id":"themes/next2/source/lib/pace/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1518242255500},{"_id":"themes/next2/source/lib/pace/README.md","hash":"ddcd2834d847f37b8ee77858bd03d31f70f55fb7","modified":1518242255501},{"_id":"themes/next2/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1518242255502},{"_id":"themes/next2/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1518242255502},{"_id":"themes/next2/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1518242255503},{"_id":"themes/next2/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1518242255504},{"_id":"themes/next2/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1518242255505},{"_id":"themes/next2/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1518242255505},{"_id":"themes/next2/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1518242255506},{"_id":"themes/next2/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1518242255507},{"_id":"themes/next2/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1518242255507},{"_id":"themes/next2/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1518242255508},{"_id":"themes/next2/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1518242255509},{"_id":"themes/next2/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1518242255510},{"_id":"themes/next2/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1518242255510},{"_id":"themes/next2/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1518242255511},{"_id":"themes/next2/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1518056510678},{"_id":"themes/next2/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1518056510678},{"_id":"themes/next2/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1518056510679},{"_id":"themes/next2/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1518056510674},{"_id":"themes/next2/.git/logs/refs/heads/master","hash":"eedbc2d3060cb92b0b3239360e523b2fe97b0203","modified":1519520712204},{"_id":"themes/next2/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1518056510417},{"_id":"themes/next2/.git/refs/remotes/origin/master","hash":"c58ad6066ac4c70a78d01634671c085b3cff3344","modified":1519520724835},{"_id":"themes/next2/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1518056510581},{"_id":"themes/next2/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1518056510581},{"_id":"themes/next2/source/css/_common/components/back-to-top-sidebar.styl","hash":"8f86f694c0749a18ab3ad6f6df75466ca137a4bc","modified":1518056510599},{"_id":"themes/next2/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1518056510600},{"_id":"themes/next2/source/css/_common/components/buttons.styl","hash":"8b32928686c327151e13d3ab100157f9a03cd59f","modified":1518056510600},{"_id":"themes/next2/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1518056510601},{"_id":"themes/next2/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1519624348781},{"_id":"themes/next2/source/css/_common/components/pagination.styl","hash":"4f2801fc4cf3f31bf2069f41db8c6ce0e3da9e39","modified":1518056510614},{"_id":"themes/next2/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1518056510631},{"_id":"themes/next2/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1518056510639},{"_id":"themes/next2/source/css/_common/scaffolding/base.styl","hash":"24ee4b356ff55fc6e58f26a929fa07750002cf29","modified":1518056510639},{"_id":"themes/next2/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1518056510640},{"_id":"themes/next2/source/css/_common/scaffolding/mobile.styl","hash":"91ca75492cd51f2553f4d294ed2f48239fcd55eb","modified":1518056510640},{"_id":"themes/next2/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1518056510641},{"_id":"themes/next2/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1518056510641},{"_id":"themes/next2/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1518056510641},{"_id":"themes/next2/source/css/_schemes/Gemini/index.styl","hash":"af5f652a366a0fc2874eb9a8cc58885ab6b043fc","modified":1518056510644},{"_id":"themes/next2/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1518056510645},{"_id":"themes/next2/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1518056510645},{"_id":"themes/next2/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1518056510645},{"_id":"themes/next2/source/css/_schemes/Mist/_menu.styl","hash":"65b23000b74b935b2a26f1b4c67d5c8514fd9d34","modified":1518056510646},{"_id":"themes/next2/source/css/_schemes/Mist/_posts-expanded.styl","hash":"9c99034f8e00d47e978b3959f51eb4a9ded0fcc8","modified":1518056510646},{"_id":"themes/next2/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1518056510646},{"_id":"themes/next2/source/css/_schemes/Mist/index.styl","hash":"2ccb9bdc309b7c1ef183a3dbb0a4621bec54a328","modified":1518056510647},{"_id":"themes/next2/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1518056510648},{"_id":"themes/next2/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1518056510649},{"_id":"themes/next2/source/css/_schemes/Muse/_menu.styl","hash":"3cc7646583218d16925ced7b70865e63a901d4a7","modified":1518056510649},{"_id":"themes/next2/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1518056510649},{"_id":"themes/next2/source/css/_schemes/Muse/index.styl","hash":"b26f8a3394d8357a5bfd24d9f8bf62d7b4063ebb","modified":1518056510649},{"_id":"themes/next2/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1518056510650},{"_id":"themes/next2/source/css/_schemes/Pisces/_layout.styl","hash":"416988dca389e6e2fdfa51fa7f4ee07eb53f82fb","modified":1518056510651},{"_id":"themes/next2/source/css/_schemes/Pisces/_menu.styl","hash":"cc961108b12ab97d9216606ceb1cd1cd31ab20f0","modified":1518056510651},{"_id":"themes/next2/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1518056510651},{"_id":"themes/next2/source/css/_schemes/Pisces/_sidebar.styl","hash":"291f8f7e3b78639a9f4d7944fd63de5821beb0e1","modified":1518056510652},{"_id":"themes/next2/source/css/_schemes/Pisces/index.styl","hash":"86197902dfd3bededba10ba62b8f9f22e0420bde","modified":1518056510652},{"_id":"themes/next2/source/js/src/schemes/pisces.js","hash":"f1d0b5d7af32c423eaa8bb93ab6a0b45655645dc","modified":1518056510665},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1518242395295},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/config","hash":"6b9d0a36d665af7dc13b7b00969dd505ce623c8b","modified":1518242395305},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1518242392250},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/index","hash":"fa35b3e3c43efe66664c943791946a364de00e4f","modified":1518242395324},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/packed-refs","hash":"8fe6e29d5ddf85c177d75e81aa6999675fc4144c","modified":1518242395284},{"_id":"themes/next2/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1518056510669},{"_id":"themes/next2/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1518056510668},{"_id":"themes/next2/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1518056510669},{"_id":"themes/next2/source/lib/pace/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1518242255469},{"_id":"themes/next2/source/lib/pace/.git/config","hash":"48b8e34305ab1a3899705ec98de64390d70f2035","modified":1518242255483},{"_id":"themes/next2/source/lib/pace/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1518242252257},{"_id":"themes/next2/source/lib/pace/.git/index","hash":"37bccb8c4bbe8d0d7e4cd4385d51b418aab8900a","modified":1518242255511},{"_id":"themes/next2/source/lib/pace/.git/packed-refs","hash":"2423e57d7b82d584aa814481ceeff0055b991cda","modified":1518242255458},{"_id":"themes/next2/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1518056510675},{"_id":"themes/next2/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1518056510675},{"_id":"themes/next2/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1518056510672},{"_id":"themes/next2/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1518056510673},{"_id":"themes/next2/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1518056510677},{"_id":"themes/next2/.git/logs/refs/remotes/origin/HEAD","hash":"30fbf4b1db97a3731a63bb53abe1788992ff56b5","modified":1518056510417},{"_id":"themes/next2/.git/logs/refs/remotes/origin/master","hash":"fd6a1beb312682a86856e8cc5c29aaf4937bfaee","modified":1519520724837},{"_id":"themes/next2/source/css/_common/components/footer/footer.styl","hash":"9f73c4696f0907aa451a855444f88fc0698fa472","modified":1518056510603},{"_id":"themes/next2/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1518056510605},{"_id":"themes/next2/source/css/_common/components/header/header.styl","hash":"34f5ac3c1ed2dd31e9297cc4c0733e71bc2e252f","modified":1518056510605},{"_id":"themes/next2/source/css/_common/components/header/github-banner.styl","hash":"66f22eb57dda1084c86c54391b6e0465e6534ea4","modified":1518056510604},{"_id":"themes/next2/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1518056510606},{"_id":"themes/next2/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1518056510607},{"_id":"themes/next2/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1518056510607},{"_id":"themes/next2/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1518056510611},{"_id":"themes/next2/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1518056510612},{"_id":"themes/next2/source/css/_common/components/pages/pages.styl","hash":"f9760ecf186954cee3ba4a149be334e9ba296b89","modified":1518056510612},{"_id":"themes/next2/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1518056510614},{"_id":"themes/next2/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1518056510613},{"_id":"themes/next2/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1518056510609},{"_id":"themes/next2/source/css/_common/components/highlight/highlight.styl","hash":"50450d9fdc8a2b2be8cfca51e3e1a01ffd636c0b","modified":1518056510609},{"_id":"themes/next2/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1518056510610},{"_id":"themes/next2/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1518056510615},{"_id":"themes/next2/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1518056510616},{"_id":"themes/next2/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1518056510617},{"_id":"themes/next2/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1518056510617},{"_id":"themes/next2/source/css/_common/components/post/post-expand.styl","hash":"a6c6eb8adba0a090ad1f4b9124e866887f20d10d","modified":1518056510618},{"_id":"themes/next2/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1518056510619},{"_id":"themes/next2/source/css/_common/components/post/post-meta.styl","hash":"78d4d664b71cd1c8360f6dfb158457b03b8b0608","modified":1518056510619},{"_id":"themes/next2/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1518056510620},{"_id":"themes/next2/source/css/_common/components/post/post-reading_progress.styl","hash":"82bc7fa5d38d98e98cc25f9a73189024fda25e63","modified":1518056510620},{"_id":"themes/next2/source/css/_common/components/post/post-reward.styl","hash":"ca88ea6999a61fb905eb6e72eba5f92d4ee31e6e","modified":1518056510621},{"_id":"themes/next2/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1518056510622},{"_id":"themes/next2/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1518056510622},{"_id":"themes/next2/source/css/_common/components/post/post-title.styl","hash":"ccb34c52be8adba5996c6b94f9e723bd07d34c16","modified":1518056510623},{"_id":"themes/next2/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1518056510623},{"_id":"themes/next2/source/css/_common/components/post/post-widgets.styl","hash":"7968343e41f8b94b318c36289dff1196c3eb1791","modified":1518056510624},{"_id":"themes/next2/source/css/_common/components/post/post.styl","hash":"1faeb3fca899df9d033e4e6ad9a4867cdce7ef9d","modified":1518056510625},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"fa57ec9a6f1943c0558856dfba2d6b8faca0cd4d","modified":1518056510626},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1518056510626},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1518056510627},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1518056510627},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1518056510628},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1518056510629},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"c8fe49a4bc014c24dead05b782a7082411a4abc5","modified":1518056510629},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1518056510630},{"_id":"themes/next2/source/css/_common/components/sidebar/sidebar.styl","hash":"94d76e6da600a36d80e2470326ebb6b3be447ccb","modified":1518056510630},{"_id":"themes/next2/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1518056510631},{"_id":"themes/next2/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1518056510632},{"_id":"themes/next2/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1518829514650},{"_id":"themes/next2/source/css/_common/components/tags/full-image.styl","hash":"d79c051abb8ab7b5ee5da29a28587704fd5108f5","modified":1518056510632},{"_id":"themes/next2/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1518056510633},{"_id":"themes/next2/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1518056510633},{"_id":"themes/next2/source/css/_common/components/tags/note-modern.styl","hash":"b7076e58d647265ee0ad2b461fe8ce72c9373bc5","modified":1518056510634},{"_id":"themes/next2/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1518056510634},{"_id":"themes/next2/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1518056510634},{"_id":"themes/next2/source/css/_common/components/tags/tags.styl","hash":"b80604868e4f5cf20fccafd7ee415c20c804f700","modified":1518829509052},{"_id":"themes/next2/source/css/_common/components/third-party/algolia-search.styl","hash":"eef025d510e85eab9112b8f03a186fae6a860b56","modified":1518056510635},{"_id":"themes/next2/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1518056510636},{"_id":"themes/next2/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1518056510636},{"_id":"themes/next2/source/css/_common/components/third-party/gitment.styl","hash":"874278147115601d2abf15987f5f7a84ada1ac6b","modified":1518056510636},{"_id":"themes/next2/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1518056510637},{"_id":"themes/next2/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1518056510637},{"_id":"themes/next2/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1518056510638},{"_id":"themes/next2/source/css/_common/components/third-party/needsharebutton.styl","hash":"28825ae15fa20ae3942cdaa7bcc1f3523ce59acc","modified":1518056510638},{"_id":"themes/next2/source/css/_common/components/third-party/third-party.styl","hash":"b66aa075b48429cf3875fd02f693f378aec424da","modified":1518056510638},{"_id":"themes/next2/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1518056510647},{"_id":"themes/next2/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1518056510648},{"_id":"themes/next2/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1518056510650},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1518242392251},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1518242392252},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1518242392253},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1518242392253},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1518242392254},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1518242392255},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1518242392258},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1518242392256},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1518242392259},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1518242392259},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1518242392260},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1518242392261},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/logs/HEAD","hash":"9e56cd37b8e6bada477d938c9b23419c5744bcc6","modified":1518242395300},{"_id":"themes/next2/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1518056510672},{"_id":"themes/next2/source/lib/pace/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1518242252258},{"_id":"themes/next2/source/lib/pace/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1518242252545},{"_id":"themes/next2/source/lib/pace/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1518242252546},{"_id":"themes/next2/source/lib/pace/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1518242252549},{"_id":"themes/next2/source/lib/pace/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1518242252547},{"_id":"themes/next2/source/lib/pace/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1518242252550},{"_id":"themes/next2/source/lib/pace/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1518242252551},{"_id":"themes/next2/source/lib/pace/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1518242252552},{"_id":"themes/next2/source/lib/pace/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1518242252553},{"_id":"themes/next2/source/lib/pace/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1518242252554},{"_id":"themes/next2/source/lib/pace/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1518242252555},{"_id":"themes/next2/source/lib/pace/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1518242252557},{"_id":"themes/next2/source/lib/pace/.git/logs/HEAD","hash":"a7339a9a715d244afcb2937fb747a54f02e74972","modified":1518242255474},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/0d/49463cf444a6411519b6d7b5bb65fa7e96c4dc","hash":"8baa9ed7c87fbf1a9fdeb378c656471cb98c48e5","modified":1518242394143},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/08/777d50ffb9e517f20d2cbf2ea19130862fb501","hash":"110fcf7830673d2a7715f8347834f7393597ecd0","modified":1518242395103},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/54/7b348ba5c8725ea590087860a352c8ff41cb98","hash":"79281e0d03b3acdbce61914bbfef33ae0c29be6d","modified":1518242393987},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/59/0f6f985f6018c397b2499bb49e599b7109ec06","hash":"650b4b24a81daa3b02646b7ffd5ccdac11ab6be8","modified":1518242394177},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/69/a20d65d83035fdb01734a8eabe3340f740a4cb","hash":"9e95b02d8e43ec92e06bee3f60dffb74e8e7b9fa","modified":1518242394054},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/6d/b4c7bd4b80f34ae7165de7d91291759569d572","hash":"f04a0f8b9dde5d5c36f470634ca8f958a3b6aa15","modified":1518242395199},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/92/1eb7be3c529d19b6c92ce67e4099e8f7d6adf3","hash":"023bef5405aee54ae6b00e1e02eb6984b691ccbf","modified":1518242395165},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/a4/0c9f2635389a60948f0f2235f037277f8acff6","hash":"ec4074d54b477aea533dab38384dd9a52fa58854","modified":1518242394088},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/c9/af6112eed1dab47eba55651562f768bfbc861d","hash":"a3ce783cca46bdcba0a1eda2d034c77221e07e06","modified":1518242393828},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/da/0b2b5f2ab8f750444499f17e4cbf6074aef7f0","hash":"b343b66897d47a95d9a4363eaab8ff61a1c8a683","modified":1518242393925},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/f5/e09255981809338b668b56510e360595fc12fa","hash":"c385e27cf914367d1fde121a2c920b93832cf2ed","modified":1518242394022},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/refs/heads/master","hash":"591d58b48a711af78b2cf38fbf4e5d9e23c22ab8","modified":1518242395299},{"_id":"themes/next2/source/lib/algolia-instant-search/instantsearch.min.js","hash":"90a1b22129efc172e2dfcceeeb76bff58bc3192f","modified":1518242395323},{"_id":"themes/next2/source/lib/pace/.git/objects/00/13175fe71888324d9142744034e8296501174a","hash":"0ad0e50f7fe91fe14491924aa4b1e2e8f060a5cd","modified":1518242254574},{"_id":"themes/next2/source/lib/pace/.git/objects/35/a749d823ad0aae6111a76dc501a1170478f376","hash":"e757129fb6bca3170b62b05f3e850e4b55f3ae88","modified":1518242255217},{"_id":"themes/next2/source/lib/pace/.git/objects/1c/159365320ef5dde63906912f3df067376b40d0","hash":"1dd6b7373c3f9c67e34aa319c9c08fd0f667156a","modified":1518242255263},{"_id":"themes/next2/source/lib/pace/.git/objects/23/4f9b3e93f06a85cb2ec01acc872ccdc2bec7cb","hash":"63f8640eceff35a80175a102fcbd8789e690cfaa","modified":1518242254619},{"_id":"themes/next2/source/lib/pace/.git/objects/3e/dcd352d2a1a60dbb6a43e7e9f00bab8b55791a","hash":"725bf5094855cd943dd1cd351906fb1ebec1d861","modified":1518242254807},{"_id":"themes/next2/source/lib/pace/.git/objects/41/28e69301ad36a283c0fc523f3aef89644d2467","hash":"d8b985cf431fbdc5b4fa3be89e27db7a3437c920","modified":1518242255362},{"_id":"themes/next2/source/lib/pace/.git/objects/49/0db22b657dd64430d003fe2831905a54858b22","hash":"43694656c4c331cfa3667afca630bd486ac0d0fe","modified":1518242255085},{"_id":"themes/next2/source/lib/pace/.git/objects/4d/fbb499a4f7b2f26a535c335cd66c966ff8b261","hash":"14e4cdcc137045c7efed32f796273d40c9fcef87","modified":1518242255131},{"_id":"themes/next2/source/lib/pace/.git/objects/69/a20d65d83035fdb01734a8eabe3340f740a4cb","hash":"9e95b02d8e43ec92e06bee3f60dffb74e8e7b9fa","modified":1518242254512},{"_id":"themes/next2/source/lib/pace/.git/objects/53/3d55db0342c2b011ac05703c3b42e88a25c1ed","hash":"c48454760d2e04602a5499188b33d38839c58aee","modified":1518242255173},{"_id":"themes/next2/source/lib/pace/.git/objects/60/0378418401f2b0e7c58407a7bbc5a5196cfa51","hash":"20489d796247dda758599f40cbfcf14d194ef64a","modified":1518242254451},{"_id":"themes/next2/source/lib/pace/.git/objects/82/8dcba3c8a21de08d1eb38f2eee453b51543188","hash":"629aad2ee2e564790e78cd46e99ad396544960ab","modified":1518242254852},{"_id":"themes/next2/source/lib/pace/.git/objects/84/a17ac7b4fe9cea559de91f00af88f810bff7f1","hash":"b41b6d3cbccd75b711f0523bba1c26bf19b0a862","modified":1518242254378},{"_id":"themes/next2/source/lib/pace/.git/objects/8b/b4535a79cc15127f8906b24c4e0bb4a38a5947","hash":"9c2d65a63f18929b09f3592dda064f24309ff98b","modified":1518242254963},{"_id":"themes/next2/source/lib/pace/.git/objects/97/1e8a1f2ad6d45f693980c106af0aead9d1c215","hash":"e45f0963920a53a57f6b53d178e5b05a8e315189","modified":1518242254708},{"_id":"themes/next2/source/lib/pace/.git/objects/9b/3058068409f2282607ebb91717d7a6a1406230","hash":"651c5857021e11dc397df86dbe0f01e6c7dc7f16","modified":1518242255009},{"_id":"themes/next2/source/lib/pace/.git/objects/a6/dbd9c99e726f621e2bdcd3c6fe2795a5d4272d","hash":"25350dd31f504af7206610ced355d162aabda8dd","modified":1518242255041},{"_id":"themes/next2/source/lib/pace/.git/objects/aa/813c5a6398600e01b740696cd889eb3becad84","hash":"c62a1513ca820dc59fe1cd6d9ec16c92e0e2fbf0","modified":1518242254653},{"_id":"themes/next2/source/lib/pace/.git/objects/c0/05c71f1a000d8187df58083d215c962d7f5505","hash":"dffd212ca2ec705233fabe82a6f483d6be4b151d","modified":1518242254919},{"_id":"themes/next2/source/lib/pace/.git/objects/de/79ab6539ac3702aaac64b879d95e6575f4eefa","hash":"0046fefd52ed4679e0fee757cc91ced94e3ddc12","modified":1518242255307},{"_id":"themes/next2/source/lib/pace/.git/objects/f3/0e0a99bb016267bde55537dd47b3657ae59544","hash":"8bf0bc17a6111b6a82981073133f33cc8e815c41","modified":1518242254763},{"_id":"themes/next2/source/lib/pace/.git/refs/heads/master","hash":"3190f62cf3c4f9eccb1e54c8f7289ed7e6955767","modified":1518242255474},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/objects/2b/d5d590d07a161741477ace2339eb37c07cc40c","hash":"10a1f52729a36d3b9d594e93473fef26fed768e1","modified":1518242394995},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/logs/refs/heads/master","hash":"9e56cd37b8e6bada477d938c9b23419c5744bcc6","modified":1518242395301},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1518242395293},{"_id":"themes/next2/source/lib/pace/.git/logs/refs/heads/master","hash":"a7339a9a715d244afcb2937fb747a54f02e74972","modified":1518242255476},{"_id":"themes/next2/source/lib/pace/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1518242255468},{"_id":"themes/next2/source/lib/algolia-instant-search/.git/logs/refs/remotes/origin/HEAD","hash":"9e56cd37b8e6bada477d938c9b23419c5744bcc6","modified":1518242395293},{"_id":"themes/next2/source/lib/pace/.git/logs/refs/remotes/origin/HEAD","hash":"a7339a9a715d244afcb2937fb747a54f02e74972","modified":1518242255467},{"_id":"themes/next2/.git/objects/pack/pack-4ea007b0aabc1a0b98240e4c471a0e657fde72d9.pack","hash":"b738052cd204f78ec50b5528e5dcfe4eed0a265d","modified":1518056510234},{"_id":"public/baidusitemap.xml","hash":"85b5522ad3d9b48e2748877abb894463bc184a0b","modified":1519634338438},{"_id":"public/search.xml","hash":"567124065a0b6ad9691ff0512cd9db983421b37e","modified":1519634338454},{"_id":"public/sitemap.xml","hash":"fd956820fc30b578571eed17555f87f7cbd0bee0","modified":1519634338454},{"_id":"public/categories/index.html","hash":"eaf78302d118b875c451108520d86c913bc8d193","modified":1519634338461},{"_id":"public/about/index.html","hash":"3e5db1298e598a8acfb96330ad2ee1c0c7aba3ee","modified":1519634338461},{"_id":"public/database/index.html","hash":"999b3e48d4858d8886e170c9e7b3e3f974246b14","modified":1519634338462},{"_id":"public/donate/index.html","hash":"4311972761f4b51260ff810e0cbfba5c7653c9d0","modified":1519634338462},{"_id":"public/donate/donate.html","hash":"7dfceef225685b8c801b60b4497f80e205e22fe3","modified":1519634338462},{"_id":"public/essay/index-1.html","hash":"4c5f9022f81ee2bdbaa9203508533f55c9fcade1","modified":1519634338462},{"_id":"public/linux/index.html","hash":"d4d1e5237e8c66a7ae600578b0a919d3a7a72466","modified":1519634338462},{"_id":"public/essay/index.html","hash":"57201456d34f498ab25d4ea5fbfd1739d9839e75","modified":1519634338463},{"_id":"public/python/index.html","hash":"6b02ee5818998998392a61333ed1ec3f8e352e2d","modified":1519634338463},{"_id":"public/spider/index.html","hash":"45e6e2d44d972b3fa567aba381a4928603d66492","modified":1519634338463},{"_id":"public/topic/index.html","hash":"6f98147a6e470632c8c341b3f9383b70bd258d1e","modified":1519634338463},{"_id":"public/tags/index.html","hash":"107a39abf436e02a61aef052b66125b421ce7ff7","modified":1519634338463},{"_id":"public/2018/02/20/gitlab本地部署/index.html","hash":"5af00abe56b649ea62cbabca398a64bd3f73d01d","modified":1519634338463},{"_id":"public/2018/02/20/gitbucket本地部署/index.html","hash":"db9b88aed7e790012db033894c2d74c164adea48","modified":1519634338464},{"_id":"public/2018/02/18/lamp一键编译安装/index.html","hash":"205b55695d67bf2a3309a9542066674ea21687e1","modified":1519634338464},{"_id":"public/2018/02/18/lamp实战一/index.html","hash":"ad82ac074bc63eceb2117201dbf0c6c974b3de1e","modified":1519634338464},{"_id":"public/2018/02/16/使用七牛云存储提供一个数据分发服务/index.html","hash":"ebc0db85dda2c3eee691d6e50ec2e8596f0c23a1","modified":1519634338464},{"_id":"public/2018/02/13/CA服务器的搭建/index.html","hash":"fb776847edb6a383f5c29be9ab7c9b134e633008","modified":1519634338464},{"_id":"public/2018/02/07/aboutme/index.html","hash":"a92d8839820a9394470a4328f842f0658d659c92","modified":1519634338464},{"_id":"public/2018/02/02/test_database/index.html","hash":"a8be963a69e9e3b19568d0079ef06fc94cd90160","modified":1519634338464},{"_id":"public/2018/02/02/test_essay/index.html","hash":"756cd0e76d500ca4c42acdacb72278a4a9cb7d60","modified":1519634338464},{"_id":"public/2018/02/02/test_linux/index.html","hash":"fe9b5c09ffcb031a19c59972f65df5eaced31f62","modified":1519634338464},{"_id":"public/2018/02/02/test_spider/index.html","hash":"61f7579e36a0155f12ae138246f8b2e2377514db","modified":1519634338464},{"_id":"public/2018/02/02/test_python/index.html","hash":"b13ee69311a17795efdfd63a199d8fd2a798b9b4","modified":1519634338464},{"_id":"public/2018/02/02/test/index.html","hash":"75eb1c95fb48bd189e9f1d64d0e2933aaee46920","modified":1519634338464},{"_id":"public/2018/02/02/mariadb多实例的三种实现/index.html","hash":"b7b71a76a712bd98fe1b06c0379f70c16441c6fd","modified":1519634338464},{"_id":"public/archives/index.html","hash":"debed0042e2502a9b2f74fa4c12a0e4bca3cb6b5","modified":1519634338465},{"_id":"public/archives/page/2/index.html","hash":"3eb1058d253d610de905e6c417698bbbd25feabd","modified":1519634338465},{"_id":"public/archives/2018/index.html","hash":"2cfa2da846c48ab69cab7f52b635a148d1c40a66","modified":1519634338465},{"_id":"public/archives/2018/page/2/index.html","hash":"e8446df6fa02ba9838c235c199df93132800cb67","modified":1519634338465},{"_id":"public/archives/2018/02/index.html","hash":"a7c4d58c0dfccf6bc9419f5a389f408764ecb122","modified":1519634338465},{"_id":"public/archives/2018/02/page/2/index.html","hash":"17988787cf57daf83664034974d4ecd2cf6e105b","modified":1519634338465},{"_id":"public/categories/about/index.html","hash":"eb4eee1f41e41dd738574a21f0e229d4d7438bae","modified":1519634338465},{"_id":"public/categories/linux/index.html","hash":"a9b458e6ef3a1cd23efaf2b64c596a267ba06920","modified":1519634338465},{"_id":"public/categories/database/index.html","hash":"fcc7863745d7c1479d193d0f581f463590871f87","modified":1519634338465},{"_id":"public/categories/essay/index.html","hash":"aeec340d672d47809c9735116399cd0f574c9df3","modified":1519634338465},{"_id":"public/categories/python/index.html","hash":"1fb340c29614534e7971c239db919107ab865f08","modified":1519634338466},{"_id":"public/categories/spider/index.html","hash":"ee85fab18d4b44627abfa8064c6241c76b0d2b83","modified":1519634338466},{"_id":"public/index.html","hash":"6a5aad525854929ddab9229d968312fcd4b30c59","modified":1519634338466},{"_id":"public/page/2/index.html","hash":"04f608210d7f69e9cd1e7bca54fe8a3bd62ac300","modified":1519634338466},{"_id":"public/tags/about/index.html","hash":"7275a1eb6c5548a2d5520a56031a5d2522fd7fc5","modified":1519634338466},{"_id":"public/tags/linux/index.html","hash":"33c5f22b0ae27e9cc16fd37f264fae408d4eadd6","modified":1519634338467},{"_id":"public/tags/ca/index.html","hash":"acebb0e5d7da0d6a7dd2fb3eaea990c144160b06","modified":1519634338467},{"_id":"public/tags/git/index.html","hash":"5b6cb8430e2b4d1f4051ead3224a9c53601b5139","modified":1519634338467},{"_id":"public/tags/gitlab/index.html","hash":"39d560764c4051d35b514703ad009cf995ec8f35","modified":1519634338467},{"_id":"public/tags/gitbucket/index.html","hash":"28305aef8295799aa0c2946b39de6aa8e330dc75","modified":1519634338467},{"_id":"public/tags/mysql/index.html","hash":"330175991ca3ad832c112fcc100653524c8e370c","modified":1519634338467},{"_id":"public/tags/mariadb/index.html","hash":"75fbd0f24a28ecbf0c2bfcdc18944a98c13ccaef","modified":1519634338467},{"_id":"public/tags/database/index.html","hash":"fddc716a2d30aafb5ed4b835033807cb647ee80f","modified":1519634338467},{"_id":"public/tags/essay/index.html","hash":"2cb8f57f8ac5652fa3cb1cf86beffb951b4619b8","modified":1519634338467},{"_id":"public/tags/python/index.html","hash":"d6462521a9c9a30d4ab15eb4ab194f394c401408","modified":1519634338467},{"_id":"public/tags/spider/index.html","hash":"ef94ccde535ec561d806389ca5ba947a2ec60126","modified":1519634338467},{"_id":"public/rebots.txt","hash":"3d65c08b8b60cc53db951696cab8aaec372227da","modified":1519634338540},{"_id":"public/images/zhifubao.png","hash":"045f053993552b70de40937f9ed57baaf74facba","modified":1519634338541},{"_id":"public/images/git/gitbucket主页.png","hash":"818e96538001c45b347cf556ad17ce05c01a1d97","modified":1519634338541},{"_id":"public/images/git/gitbucket效果图.png","hash":"fe6e2b8ea9f5c1c39a38e90a26cb3ae7d50b4333","modified":1519634338542},{"_id":"public/images/git/gitbucket登录.png","hash":"af0c6b5bc919fc8304d78fd4793736813b9928cd","modified":1519634338542},{"_id":"public/images/qiniu/七牛云key.png","hash":"55b37f703e6fb27aedbf25c61ee5b73612831977","modified":1519634338542},{"_id":"public/images/git/gitbucket创建仓库.png","hash":"df4558e160191b5029fb109dc869725390fe6d42","modified":1519634338542},{"_id":"public/images/git/gitlab登陆2.png","hash":"82a5ef90c84561d7f02db1e961a1faadce9164b3","modified":1519634338542},{"_id":"public/images/qiniu/新建存储.png","hash":"7d5b0ffd7b0fb90c18a588913d18d7d0965d274c","modified":1519634338543},{"_id":"public/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1519634338543},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1519634338543},{"_id":"public/images/qiniu/绑定域名.png","hash":"dfb0347feeef66007be244660965eba6848563fe","modified":1519634338543},{"_id":"public/images/web/实战1架构图.png","hash":"6bccbca753588100057521fcbe594d4a579840a8","modified":1519634338544},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1519634338544},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1519634338544},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1519634338544},{"_id":"public/images/avatar.jpg","hash":"0edb0edde16d7001ca01413978681e0db4d40238","modified":1519634338544},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1519634338545},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1519634338545},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1519634338545},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1519634338545},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1519634338545},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1519634338545},{"_id":"public/images/favicon-16x16-next.jpg","hash":"68112d6c148e38f2798ca7bfc3fc15081b04fd50","modified":1519634338546},{"_id":"public/images/favicon-32x32-next.jpg","hash":"8b67a3f1bfa8defee7555f70df39c71404426238","modified":1519634338546},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1519634338546},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1519634338546},{"_id":"public/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1519634338546},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1519634338546},{"_id":"public/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1519634338546},{"_id":"public/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1519634338547},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1519634338547},{"_id":"public/lib/algolia-instant-search/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1519634338547},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1519634338547},{"_id":"public/lib/pace/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1519634338547},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1519634338547},{"_id":"public/assets/algolia/algoliasearchLite.min.js","hash":"6d262a4a57238ae4f673cc4fc5b614775ab1b79a","modified":1519634338547},{"_id":"public/assets/algolia/algoliasearch.min.js","hash":"5d3b971e283f42c3c9ba313b81d35d3a94d9561f","modified":1519634338547},{"_id":"public/live2d/device.min.js","hash":"ad8ffa5cc29d478f718c73eef31052dd4cdae7b6","modified":1519634338547},{"_id":"public/live2d/assets/mtn/idle_01.mtn","hash":"908abce18f6cf7fd4bc1486f048c25a517f4a34a","modified":1519634338547},{"_id":"public/live2d/assets/mtn/idle_02.mtn","hash":"865874c50848fbc9a55011391531e2ec171c9b91","modified":1519634338547},{"_id":"public/live2d/assets/mtn/idle_03.mtn","hash":"84684914ebf5dc5b2df160338bb97dcc0a978476","modified":1519634338548},{"_id":"public/live2d/assets/mtn/idle_04.mtn","hash":"78e22091792abb0600f724a5dfd60371257954e8","modified":1519634338548},{"_id":"public/live2d/assets/mtn/shake_01.mtn","hash":"dffc54733127832f8f5e91aced55a83da58fa215","modified":1519634338548},{"_id":"public/live2d/assets/mtn/shake_02.mtn","hash":"7b6c914f6c33450eda2e53d9b638fd7045c0f683","modified":1519634338548},{"_id":"public/live2d/assets/mtn/touch_02.mtn","hash":"4d1f099fbd18d15c598a644227ed5bf942a2ba71","modified":1519634338548},{"_id":"public/live2d/assets/mtn/touch_01.mtn","hash":"99270ea8fe1f8f5d88eadb94f36bd0810009d1e6","modified":1519634338548},{"_id":"public/live2d/assets/mtn/touch_03.mtn","hash":"9c394975083915f0f3786caff1762381348b041e","modified":1519634338548},{"_id":"public/live2d/assets/mtn/touch_04.mtn","hash":"8d2302cfdaec698e575048797ff4f30ae4d202de","modified":1519634338548},{"_id":"public/live2d/assets/mtn/touch_05.mtn","hash":"9610bb8a937ba9b11445a3894d8cc0733a2b67e5","modified":1519634338548},{"_id":"public/live2d/assets/mtn/touch_06.mtn","hash":"feb9237c73f2045ed1704c01b5362c9a54ee5a18","modified":1519634338548},{"_id":"public/live2d/assets/wanko.model.json","hash":"b98a8ce54fbcf1606a489f1bc5f26b1a18c82d79","modified":1519634338548},{"_id":"public/images/weixin.png","hash":"66f6da43cbc17a5d6f7af4268e76f088d18870c6","modified":1519634339251},{"_id":"public/images/git/gitlab主页.png","hash":"1bb45d546ae1a0711c09b70ac0e2c61fff762f10","modified":1519634339252},{"_id":"public/images/git/gitlab修改密码.png","hash":"1e83c4fb616f2fe5aa050da8e75cad57513d1050","modified":1519634339257},{"_id":"public/images/git/gitlab禁止注册.png","hash":"fbf012d01b9a0eaa4d97aa53de010ce4acecd146","modified":1519634339257},{"_id":"public/images/git/gitlab登陆.png","hash":"b73952f1c20e4561967d260a1346196e9aed9aa4","modified":1519634339257},{"_id":"public/images/qiniu/查看cname.png","hash":"43542b440b42cc5bea645fe6a33f4d68e9fd8c27","modified":1519634339257},{"_id":"public/images/qiniu/添加cname.png","hash":"11021410afa7e3181b312814436e24ccc04d046e","modified":1519634339257},{"_id":"public/images/qiniu/设置默认域名.png","hash":"0c4448ef90efeadc812f065955b9784e999c3dee","modified":1519634339257},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1519634339257},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1519634339257},{"_id":"public/assets/algolia/algoliasearchLite.js","hash":"dd90ab6512a453df642c3846d2af7a514316065e","modified":1519634339258},{"_id":"public/live2d/assets/moc/wanko.1024/texture_00.png","hash":"c405c1eeb82bcced7aa7a20f04a76168f60ad561","modified":1519634339258},{"_id":"public/live2d/assets/moc/wanko.moc","hash":"7b188cd4dcddfe5bdba8ec51a65cb1c21cd2e57a","modified":1519634339258},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1519634339268},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1519634339269},{"_id":"public/js/src/bootstrap.js","hash":"531cdedd7fbe8cb1dab2e4328774a9f6b15b59da","modified":1519634339269},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1519634339269},{"_id":"public/js/src/love.js","hash":"9e8e79d69ad8338761272f86fe5cad0ad5e503cc","modified":1519634339269},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1519634339269},{"_id":"public/js/src/motion.js","hash":"50e57f8acb6924c6999cdcc664ddd3f0730d2061","modified":1519634339269},{"_id":"public/js/src/post-details.js","hash":"d1333fb588d4521b4d1e9c69aef06e0ad1bf0b12","modified":1519634339269},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1519634339269},{"_id":"public/lib/algolia-instant-search/README.html","hash":"ccd715fd355d7ac872813c770a3686a4493fb413","modified":1519634339269},{"_id":"public/js/src/utils.js","hash":"2b020693de2604e5238c1032e4b29cd679a15ac8","modified":1519634339269},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1519634339269},{"_id":"public/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1519634339269},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1519634339269},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1519634339269},{"_id":"public/lib/pace/README.html","hash":"58f2105ada5cc52dff5aabcecb92569ee84493a0","modified":1519634339269},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1519634339270},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1519634339270},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1519634339270},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1519634339270},{"_id":"public/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1519634339271},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1519634339271},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1519634339271},{"_id":"public/css/main.css","hash":"ea1fec82ed164c9cb2ba14a860aaf8c3734fe4e8","modified":1519634339271},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1519634339271},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1519634339271},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1519634339271},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1519634339271},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1519634339271},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1519634339271},{"_id":"public/lib/algolia-instant-search/instantsearch.min.js","hash":"9ccc6f8144f54e86df9a3fd33a18368d81cf3a4f","modified":1519634339272},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1519634339272},{"_id":"public/assets/algolia/algoliasearch.js","hash":"6f47d55b12e627d5d2125a76bfc288bc92983fde","modified":1519634339272},{"_id":"public/live2d/script.js","hash":"6b85d115e5785ab244c8ffa8073be3930868589a","modified":1519634339272}],"Category":[{"name":"about","_id":"cje3z1mn90004ugtmyjuwz84k"},{"name":"linux","_id":"cje3z1mni000bugtmgeha3s61"},{"name":"database","_id":"cje3z1mob0015ugtm80mezpcq"},{"name":"essay","_id":"cje3z1mom001fugtmy7isnq5n"},{"name":"python","_id":"cje3z1moo001kugtmignt82mz"},{"name":"spider","_id":"cje3z1mop001qugtmmamv9i69"}],"Data":[],"Page":[{"title":"categories","date":"2018-02-02T04:54:37.000Z","type":"categories","_content":"\n\n\n\n\n","source":"categories/index.rst","raw":"---\ntitle: categories\ndate: 2018-02-02 12:54:37\ntype: \"categories\"\n---\n\n\n\n\n\n","updated":"2018-02-06T12:10:00.709Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cje3z1mn50001ugtmxznv0j8n","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"about","date":"2018-02-02T10:24:23.000Z","_content":"","source":"about/index.rst","raw":"---\ntitle: about\ndate: 2018-02-02 18:24:23\n---\n","updated":"2018-02-06T12:10:00.708Z","path":"about/index.html","comments":1,"layout":"page","_id":"cje3z1mn80003ugtmnyi6jpex","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"database","date":"2018-02-02T10:10:44.000Z","_content":"","source":"database/index.rst","raw":"---\ntitle: database\ndate: 2018-02-02 18:10:44\n---\n","updated":"2018-02-06T12:10:00.709Z","path":"database/index.html","comments":1,"layout":"page","_id":"cje3z1mnc0007ugtmzr0dtmhv","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"赞助与打赏","date":"2018-02-02T10:30:36.000Z","_content":"\n\n目前支持微信和支付宝两种赞助与打赏方式\n\n微信方式\n-------------------------------------------------------\n\n.. image:: /images/weixin.png\n   :height: 300px\n   :width: 300px\n   :alt: 赵杰迪微信\n   :align: center\n\n\n支付宝\n-------------------------------------------------------\n\n.. image:: /images/zhifubao.png\n   :height: 300px\n   :width: 300px\n   :alt: 赵杰迪支付宝\n   :align: center\n\n打赏者名单\n-------------------------------------------------------\n\n*排名不分先后，按打赏时间,实名的隐藏*\n\n#. 傅*\n#. user2\n#. user3\n\n\n感谢以上朋友，我会继续写出更好的文章。","source":"donate/index.rst","raw":"---\ntitle: 赞助与打赏\ndate: 2018-02-02 18:30:36\n---\n\n\n目前支持微信和支付宝两种赞助与打赏方式\n\n微信方式\n-------------------------------------------------------\n\n.. image:: /images/weixin.png\n   :height: 300px\n   :width: 300px\n   :alt: 赵杰迪微信\n   :align: center\n\n\n支付宝\n-------------------------------------------------------\n\n.. image:: /images/zhifubao.png\n   :height: 300px\n   :width: 300px\n   :alt: 赵杰迪支付宝\n   :align: center\n\n打赏者名单\n-------------------------------------------------------\n\n*排名不分先后，按打赏时间,实名的隐藏*\n\n#. 傅*\n#. user2\n#. user3\n\n\n感谢以上朋友，我会继续写出更好的文章。","updated":"2018-02-07T14:35:48.541Z","path":"donate/index.html","comments":1,"layout":"page","_id":"cje3z1mne0009ugtm3hpgzgi9","content":"<p>目前支持微信和支付宝两种赞助与打赏方式</p>\r\n<h2 id=\"微信方式\">微信方式</h2>\r\n<p><img src=\"/images/weixin.png\" alt=\"赵杰迪微信\" class=\"align-center\" width=\"300\" height=\"300\"></p>\r\n<h2 id=\"支付宝\">支付宝</h2>\r\n<p><img src=\"/images/zhifubao.png\" alt=\"赵杰迪支付宝\" class=\"align-center\" width=\"300\" height=\"300\"></p>\r\n<h2 id=\"打赏者名单\">打赏者名单</h2>\r\n<p><em>排名不分先后，按打赏时间,实名的隐藏</em></p>\r\n<ol>\r\n<li>傅*</li>\r\n<li>user2</li>\r\n<li>user3</li>\r\n</ol>\r\n<p>感谢以上朋友，我会继续写出更好的文章。</p>\r\n","site":{"data":{}},"excerpt":"","more":"<p>目前支持微信和支付宝两种赞助与打赏方式</p>\r\n<h2 id=\"微信方式\">微信方式</h2>\r\n<p><img src=\"/images/weixin.png\" alt=\"赵杰迪微信\" class=\"align-center\" width=\"300\" height=\"300\"></p>\r\n<h2 id=\"支付宝\">支付宝</h2>\r\n<p><img src=\"/images/zhifubao.png\" alt=\"赵杰迪支付宝\" class=\"align-center\" width=\"300\" height=\"300\"></p>\r\n<h2 id=\"打赏者名单\">打赏者名单</h2>\r\n<p><em>排名不分先后，按打赏时间,实名的隐藏</em></p>\r\n<ol>\r\n<li>傅*</li>\r\n<li>user2</li>\r\n<li>user3</li>\r\n</ol>\r\n<p>感谢以上朋友，我会继续写出更好的文章。</p>\r\n"},{"title":"donate","date":"2018-02-02T10:24:10.000Z","type":"donate","_content":"\n如何捐赠我呢。\n","source":"donate/donate.rst","raw":"---\ntitle: donate\ndate: 2018-02-02 18:24:10\ntype: donate\n---\n\n如何捐赠我呢。\n","updated":"2018-02-06T12:10:00.710Z","path":"donate/donate.html","comments":1,"layout":"page","_id":"cje3z1mnl000dugtmsb9ytwt3","content":"<p>如何捐赠我呢。</p>\r\n","site":{"data":{}},"excerpt":"","more":"<p>如何捐赠我呢。</p>\r\n"},{"title":"essay","date":"2018-02-02T11:00:58.000Z","_content":"","source":"essay/index-1.rst","raw":"---\ntitle: essay\ndate: 2018-02-02 19:00:58\n---\n","updated":"2018-02-06T12:10:00.711Z","path":"essay/index-1.html","comments":1,"layout":"page","_id":"cje3z1mnp000gugtmk2tyt4wy","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"linux","date":"2018-02-02T07:40:51.000Z","_content":"","source":"linux/index.rst","raw":"---\ntitle: linux\ndate: 2018-02-02 15:40:51\n---\n","updated":"2018-02-06T12:10:00.717Z","path":"linux/index.html","comments":1,"layout":"page","_id":"cje3z1mns000jugtm9z3tpw94","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"essay","date":"2018-02-02T10:22:15.000Z","_content":"","source":"essay/index.rst","raw":"---\ntitle: essay\ndate: 2018-02-02 18:22:15\n---\n","updated":"2018-02-06T12:10:00.712Z","path":"essay/index.html","comments":1,"layout":"page","_id":"cje3z1mnv000nugtmn0m0wfqy","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"python","date":"2018-02-02T10:59:12.000Z","_content":"","source":"python/index.rst","raw":"---\ntitle: python\ndate: 2018-02-02 18:59:12\n---\n","updated":"2018-02-06T12:10:00.718Z","path":"python/index.html","comments":1,"layout":"page","_id":"cje3z1mo0000qugtmdp6gutcb","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"spider","date":"2018-02-02T10:21:48.000Z","_content":"","source":"spider/index.rst","raw":"---\ntitle: spider\ndate: 2018-02-02 18:21:48\n---\n","updated":"2018-02-06T12:10:00.718Z","path":"spider/index.html","comments":1,"layout":"page","_id":"cje3z1mwd002augtminugwsqy","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"个人专题","copyright":true,"date":"2018-02-08T13:55:38.000Z","top":100,"_content":"\n.. csv-table::\n   :header: \"专题名\",\"描述\",\"地址\",\"备用地址\"\n   :widths: 20,30,30,30\n   \n    \"my-study-linux\",\"linu基础学习\",my-study-linux_,my-study-linux-bak_\n    \"my-study-linux-services\",\"linux服务学习\",my-study-linux-services_,my-study-linux-services-bak_\n    \"my-study-python\",\"python学习\",my-study-python_,my-study-python-bak_\n    \"my-study-gawk\",\"linux awk学习\",my-study-gawk_,my-study-gawk-bak_\n    \"my-study-sed\",\"linux sed学习\",my-study-sed_,my-study-sed-bak_\n    \"my-study-grep\",\"linux grep 学习\",my-study-grep_,my-study-grep-bak_\n    \"my-study-bash-programming\",\"linux baseh 编程学习\",my-study-bash-programming_,my-study-bash-programming-bak_\n    \"my-study-restructuredtext\",\"linux rst 学习\",my-study-restructuredtext_,my-study-restructuredtext-bak_\n    \"my-study-lvm\",\"linux lvm学习\",my-study-lvm_,my-study-lvm-bak_\n\n\n.. _my-study-linux-services: http://my-study-linux-services.linuxpanda.tech\n\t\n.. _my-study-linux-services-bak: http://my-study-linux-services.readthedocs.io\n\n.. _my-study-gawk: http://my-study-gawk.linuxpanda.tech\n\t\n.. _my-study-gawk-bak: http://my-study-gawk.readthedocs.io\n\n\n.. _my-study-linux: http://my-study-linux.linuxpanda.tech\n\t\n.. _my-study-linux-bak: http://my-study-linux.readthedocs.io\n\n\n.. _my-study-lvm: http://my-study-lvm.linuxpanda.tech\n\t\n.. _my-study-lvm-bak: http://my-study-lvm.readthedocs.io\n\n\n.. _my-study-restructuredtext: http://my-study-restructuredtext.linuxpanda.tech\n\t\n.. _my-study-restructuredtext-bak: http://my-study-restructuredtext.readthedocs.io\n\n\n.. _my-study-sed: http://my-study-sed.linuxpanda.tech\n\t\n.. _my-study-sed-bak: http://my-study-sed.readthedocs.io\n\n.. _my-study-bash-programming: http://my-study-bash-programming.linuxpanda.tech\n\t\n.. _my-study-bash-programming-bak: http://my-study-bash-programming.readthedocs.io\n\n\t\t\t\t\n.. _my-study-grep: http://my-study-grep.linuxpanda.tech\n\t\n.. _my-study-grep-bak: http://my-study-grep.readthedocs.io\n\n\t\t\t\t\n.. _my-study-python: http://my-study-python.linuxpanda.tech\n\t\n.. _my-study-python-bak: http://my-study-python.readthedocs.io\n\n上面的主地址是我自己的服务器上配置的虚拟主机，备用地址是托管在 readthedocs_ 网上的。\n\n.. _readthedocs: https://readthedocs.org/\n\n.. note:: 有啥问题，欢迎给我留言。\n","source":"topic/index.rst","raw":"---\ntitle: 个人专题\ncopyright: true\ndate: 2018-02-08 21:55:38\ntop: 100\n---\n\n.. csv-table::\n   :header: \"专题名\",\"描述\",\"地址\",\"备用地址\"\n   :widths: 20,30,30,30\n   \n    \"my-study-linux\",\"linu基础学习\",my-study-linux_,my-study-linux-bak_\n    \"my-study-linux-services\",\"linux服务学习\",my-study-linux-services_,my-study-linux-services-bak_\n    \"my-study-python\",\"python学习\",my-study-python_,my-study-python-bak_\n    \"my-study-gawk\",\"linux awk学习\",my-study-gawk_,my-study-gawk-bak_\n    \"my-study-sed\",\"linux sed学习\",my-study-sed_,my-study-sed-bak_\n    \"my-study-grep\",\"linux grep 学习\",my-study-grep_,my-study-grep-bak_\n    \"my-study-bash-programming\",\"linux baseh 编程学习\",my-study-bash-programming_,my-study-bash-programming-bak_\n    \"my-study-restructuredtext\",\"linux rst 学习\",my-study-restructuredtext_,my-study-restructuredtext-bak_\n    \"my-study-lvm\",\"linux lvm学习\",my-study-lvm_,my-study-lvm-bak_\n\n\n.. _my-study-linux-services: http://my-study-linux-services.linuxpanda.tech\n\t\n.. _my-study-linux-services-bak: http://my-study-linux-services.readthedocs.io\n\n.. _my-study-gawk: http://my-study-gawk.linuxpanda.tech\n\t\n.. _my-study-gawk-bak: http://my-study-gawk.readthedocs.io\n\n\n.. _my-study-linux: http://my-study-linux.linuxpanda.tech\n\t\n.. _my-study-linux-bak: http://my-study-linux.readthedocs.io\n\n\n.. _my-study-lvm: http://my-study-lvm.linuxpanda.tech\n\t\n.. _my-study-lvm-bak: http://my-study-lvm.readthedocs.io\n\n\n.. _my-study-restructuredtext: http://my-study-restructuredtext.linuxpanda.tech\n\t\n.. _my-study-restructuredtext-bak: http://my-study-restructuredtext.readthedocs.io\n\n\n.. _my-study-sed: http://my-study-sed.linuxpanda.tech\n\t\n.. _my-study-sed-bak: http://my-study-sed.readthedocs.io\n\n.. _my-study-bash-programming: http://my-study-bash-programming.linuxpanda.tech\n\t\n.. _my-study-bash-programming-bak: http://my-study-bash-programming.readthedocs.io\n\n\t\t\t\t\n.. _my-study-grep: http://my-study-grep.linuxpanda.tech\n\t\n.. _my-study-grep-bak: http://my-study-grep.readthedocs.io\n\n\t\t\t\t\n.. _my-study-python: http://my-study-python.linuxpanda.tech\n\t\n.. _my-study-python-bak: http://my-study-python.readthedocs.io\n\n上面的主地址是我自己的服务器上配置的虚拟主机，备用地址是托管在 readthedocs_ 网上的。\n\n.. _readthedocs: https://readthedocs.org/\n\n.. note:: 有啥问题，欢迎给我留言。\n","updated":"2018-02-11T09:21:20.909Z","path":"topic/index.html","comments":1,"layout":"page","_id":"cje3z1mwi002bugtm53d2uwcz","content":"<table>\r\n<colgroup>\r\n<col style=\"width: 18%\">\r\n<col style=\"width: 27%\">\r\n<col style=\"width: 27%\">\r\n<col style=\"width: 27%\">\r\n</colgroup>\r\n<thead>\r\n<tr class=\"header\">\r\n<th>专题名</th>\r\n<th>描述</th>\r\n<th>地址</th>\r\n<th>备用地址</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr class=\"odd\">\r\n<td>my-study-linux</td>\r\n<td>linu基础学习</td>\r\n<td><a href=\"http://my-study-linux.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-linux</a></td>\r\n<td><a href=\"http://my-study-linux.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-linux-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-linux-services</td>\r\n<td>linux服务学习</td>\r\n<td><a href=\"http://my-study-linux-services.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-linux-services</a></td>\r\n<td><a href=\"http://my-study-linux-services.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-linux-services-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-python</td>\r\n<td>python学习</td>\r\n<td><a href=\"http://my-study-python.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-python</a></td>\r\n<td><a href=\"http://my-study-python.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-python-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-gawk</td>\r\n<td>linux awk学习</td>\r\n<td><a href=\"http://my-study-gawk.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-gawk</a></td>\r\n<td><a href=\"http://my-study-gawk.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-gawk-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-sed</td>\r\n<td>linux sed学习</td>\r\n<td><a href=\"http://my-study-sed.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-sed</a></td>\r\n<td><a href=\"http://my-study-sed.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-sed-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-grep</td>\r\n<td>linux grep 学习</td>\r\n<td><a href=\"http://my-study-grep.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-grep</a></td>\r\n<td><a href=\"http://my-study-grep.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-grep-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-bash-programming</td>\r\n<td>linux baseh 编程学习</td>\r\n<td><a href=\"http://my-study-bash-programming.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-bash-programming</a></td>\r\n<td><a href=\"http://my-study-bash-programming.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-bash-programming-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-restructuredtext</td>\r\n<td>linux rst 学习</td>\r\n<td><a href=\"http://my-study-restructuredtext.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-restructuredtext</a></td>\r\n<td><a href=\"http://my-study-restructuredtext.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-restructuredtext-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-lvm</td>\r\n<td>linux lvm学习</td>\r\n<td><a href=\"http://my-study-lvm.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-lvm</a></td>\r\n<td><a href=\"http://my-study-lvm.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-lvm-bak</a></td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p>上面的主地址是我自己的服务器上配置的虚拟主机，备用地址是托管在 <a href=\"https://readthedocs.org/\" target=\"_blank\" rel=\"noopener\">readthedocs</a> 网上的。</p>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>有啥问题，欢迎给我留言。</p>\r\n</div>\r\n","site":{"data":{}},"excerpt":"","more":"<table>\r\n<colgroup>\r\n<col style=\"width: 18%\">\r\n<col style=\"width: 27%\">\r\n<col style=\"width: 27%\">\r\n<col style=\"width: 27%\">\r\n</colgroup>\r\n<thead>\r\n<tr class=\"header\">\r\n<th>专题名</th>\r\n<th>描述</th>\r\n<th>地址</th>\r\n<th>备用地址</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr class=\"odd\">\r\n<td>my-study-linux</td>\r\n<td>linu基础学习</td>\r\n<td><a href=\"http://my-study-linux.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-linux</a></td>\r\n<td><a href=\"http://my-study-linux.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-linux-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-linux-services</td>\r\n<td>linux服务学习</td>\r\n<td><a href=\"http://my-study-linux-services.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-linux-services</a></td>\r\n<td><a href=\"http://my-study-linux-services.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-linux-services-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-python</td>\r\n<td>python学习</td>\r\n<td><a href=\"http://my-study-python.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-python</a></td>\r\n<td><a href=\"http://my-study-python.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-python-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-gawk</td>\r\n<td>linux awk学习</td>\r\n<td><a href=\"http://my-study-gawk.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-gawk</a></td>\r\n<td><a href=\"http://my-study-gawk.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-gawk-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-sed</td>\r\n<td>linux sed学习</td>\r\n<td><a href=\"http://my-study-sed.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-sed</a></td>\r\n<td><a href=\"http://my-study-sed.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-sed-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-grep</td>\r\n<td>linux grep 学习</td>\r\n<td><a href=\"http://my-study-grep.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-grep</a></td>\r\n<td><a href=\"http://my-study-grep.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-grep-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-bash-programming</td>\r\n<td>linux baseh 编程学习</td>\r\n<td><a href=\"http://my-study-bash-programming.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-bash-programming</a></td>\r\n<td><a href=\"http://my-study-bash-programming.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-bash-programming-bak</a></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>my-study-restructuredtext</td>\r\n<td>linux rst 学习</td>\r\n<td><a href=\"http://my-study-restructuredtext.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-restructuredtext</a></td>\r\n<td><a href=\"http://my-study-restructuredtext.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-restructuredtext-bak</a></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>my-study-lvm</td>\r\n<td>linux lvm学习</td>\r\n<td><a href=\"http://my-study-lvm.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">my-study-lvm</a></td>\r\n<td><a href=\"http://my-study-lvm.readthedocs.io\" target=\"_blank\" rel=\"noopener\">my-study-lvm-bak</a></td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<p>上面的主地址是我自己的服务器上配置的虚拟主机，备用地址是托管在 <a href=\"https://readthedocs.org/\" target=\"_blank\" rel=\"noopener\">readthedocs</a> 网上的。</p>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>有啥问题，欢迎给我留言。</p>\r\n</div>\r\n"},{"title":"tags","date":"2018-02-02T04:53:54.000Z","type":"tags","_content":"","source":"tags/index.rst","raw":"---\ntitle: tags\ndate: 2018-02-02 12:53:54\ntype: \"tags\"\n---\n","updated":"2018-02-06T12:10:00.719Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cje3z1mwk002cugtmtspjq3dl","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"}],"Post":[{"title":"关于我","copyright":true,"top":10,"date":"2018-02-07T12:48:41.000Z","_content":"\n我的工作经历\n--------------------------------------------------------------------\n\n我的学习经历\n--------------------------------------------------------------------\n\n我的爱好\n--------------------------------------------------------------------\n","source":"_posts/aboutme.rst","raw":"---\ntitle: 关于我\ntags:\n  - about\ncategories: about\ncopyright: true\ntop: 10\ndate: 2018-02-07 20:48:41\n---\n\n我的工作经历\n--------------------------------------------------------------------\n\n我的学习经历\n--------------------------------------------------------------------\n\n我的爱好\n--------------------------------------------------------------------\n","slug":"aboutme","published":1,"updated":"2018-02-22T06:27:30.187Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mmx0000ugtm1v4nze5t","content":"<h2 id=\"我的工作经历\">我的工作经历</h2>\r\n<h2 id=\"我的学习经历\">我的学习经历</h2>\r\n<h2 id=\"我的爱好\">我的爱好</h2>\r\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"我的工作经历\">我的工作经历</h2>\r\n<h2 id=\"我的学习经历\">我的学习经历</h2>\r\n<h2 id=\"我的爱好\">我的爱好</h2>\r\n"},{"title":"CA服务器的搭建","copyright":true,"top":10,"date":"2018-02-13T06:57:13.000Z","_content":"\n另一篇关于ca的文章_\n\n.. _另一篇关于ca的文章: http://www.cnblogs.com/zhaojiedi1992/p/zhaojiedi_linux_011_ca.html\n\nCA服务器的配置\n---------------------------------------------------------\n\n.. code-block:: bash\n   :linenos:\n   \n    [root@localhost CA]# cd /etc/pki/CA/\n\n    [root@localhost CA]# sed -r  -i 's@#?countryName_default.*@countryName_default=cn@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?stateOrProvinceName_default.*@stateOrProvinceName_default=henan@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?localityName_default.*@localityName_default=zhengzhou@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?0.organizationName_default.*@0.organizationName_default=linuxpanda@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?organizationalUnitName_default.*@organizationalUnitName_default=opt@' /etc/pki/tls/openssl.cnf\n\n    # 在CA目录创建一个Makefile\n    [root@localhost CA]# wget http://download.linuxpanda.tech/ca/Makefile\n\n    # 初始化创建文件\n    [root@localhost CA]# make init\n    # 创建ca私钥和对应的自签证书\n    [root@localhost CA]# make ca\n    umask 77 ; \\\n    /usr/bin/openssl genrsa -out private/cakey.pem 2048 ; \\\n    /usr/bin/openssl req -utf8 -new -x509 -key private/cakey.pem -out cacert.pem  -days 3650   ; \n    Generating RSA private key, 2048 bit long modulus\n    ......................................................+++\n    ............+++\n    e is 65537 (0x10001)\n    You are about to be asked to enter information that will be incorporated\n    into your certificate request.\n    What you are about to enter is what is called a Distinguished Name or a DN.\n    There are quite a few fields but you can leave some blank\n    For some fields there will be a default value,\n    If you enter '.', the field will be left blank.\n    -----\n    Country Name (2 letter code) [cn]:\n    State or Province Name (full name) [henan]:\n    Locality Name (eg, city) [zhengzhou]:\n    Organization Name (eg, company) [linuxpanda]:\n    Organizational Unit Name (eg, section) [opt]:\n    Common Name (eg, your name or your server's hostname) []:ca.linuxpanda.tech\n    Email Address []:\n\n客户端的配置\n---------------------------------------------------------\n\n这里使用为http配置为例,同样需要那个Makedown文件\n\n.. code-block:: bash\n\n    [root@localhost CA]# wget http://download.linuxpanda.tech/ca/Makefile\n    \n    # 先获取make的帮助使用\n    [root@localhost CA]# make usage\n    This makefile allows you to create:\n    make init\n    make ca\n    make /etc/httpd/ssl/http.key\n    make /etc/httpd/ssl/httpd.csr\n    make copytoca csr=httpd.csr\n    make copytoclient crt=httpd.crt ip=192.168.46.1\n    make httpd.csr\n    make revoke crt=httpd\n\n    [root@localhost CA]# yum install httpd -y \n    [root@localhost CA]# mkdir /etc/httpd/ssl\n    [root@localhost CA]# make /etc/httpd/ssl/httpd.key\n    umask 77 ; \\\n    /usr/bin/openssl genrsa  2048 > /etc/httpd/ssl/httpd.key\n    Generating RSA private key, 2048 bit long modulus\n    ...........+++\n    ...............+++\n    e is 65537 (0x10001)\n    [root@localhost CA]# make /etc/httpd/ssl/httpd.csr\n    umask 77 ; \\\n    /usr/bin/openssl req -utf8 -new -key /etc/httpd/ssl/httpd.key -out /etc/httpd/ssl/httpd.csr\n    You are about to be asked to enter information that will be incorporated\n    into your certificate request.\n    What you are about to enter is what is called a Distinguished Name or a DN.\n    There are quite a few fields but you can leave some blank\n    For some fields there will be a default value,\n    If you enter '.', the field will be left blank.\n    -----\n    Country Name (2 letter code) [cn]:\n    State or Province Name (full name) [henan]:\n    Locality Name (eg, city) [zhengzhou]:\n    Organization Name (eg, company) [linuxpanda]:\n    Organizational Unit Name (eg, section) [opt]:\n    Common Name (eg, your name or your server's hostname) []:www.linuxpanda.tech\n    Email Address []:\n\n    Please enter the following 'extra' attributes\n    to be sent with your certificate request\n    A challenge password []:\n    An optional company name []:\n\n    [root@localhost CA]# make copytoca crt=/etc/httpd/ssl/httpd.csr\n    scp /etc/httpd/ssl/httpd.csr 192.168.46.129:/etc/pki/CA/csr/\n    root@192.168.46.129's password: \n    httpd.csr                                                           100% 1017   319.1KB/s   00:00 \n\nCA颁发证书\n------------------------------------------------------------------\n\n.. code-block:: bash\n\n    [root@localhost CA]# make httpd.crt\n    /usr/bin/openssl ca -utf8 -days 365 -in csr/httpd.csr -out certs/httpd.crt\n    Using configuration from /etc/pki/tls/openssl.cnf\n    Check that the request matches the signature\n    Signature ok\n    Certificate Details:\n            Serial Number: 1 (0x1)\n            Validity\n                Not Before: Feb 13 04:49:57 2018 GMT\n                Not After : Feb 13 04:49:57 2019 GMT\n            Subject:\n                countryName               = cn\n                stateOrProvinceName       = henan\n                organizationName          = linuxpanda\n                organizationalUnitName    = opt\n                commonName                = www.linuxpanda.tech\n            X509v3 extensions:\n                X509v3 Basic Constraints: \n                    CA:FALSE\n                Netscape Comment: \n                    OpenSSL Generated Certificate\n                X509v3 Subject Key Identifier: \n                    EE:92:FF:A7:15:8F:39:DD:65:AC:B4:F1:59:76:04:32:18:9B:25:8E\n                X509v3 Authority Key Identifier: \n                    keyid:B0:9B:0B:62:50:40:E3:00:C6:4D:4F:3E:76:F9:E0:6F:A6:18:20:1C\n\n    Certificate is to be certified until Feb 13 04:49:57 2019 GMT (365 days)\n    Sign the certificate? [y/n]:y\n\n\n    1 out of 1 certificate requests certified, commit? [y/n]y\n    Write out database with 1 new entries\n    Data Base Updated\n    [root@localhost CA]# make copytoclient crt=htttpd.crt ip=192.168.46.2\n\nCA吊销证书\n------------------------------------------------------------------\n\n.. code-block:: bash\n\n    [root@localhost CA]# make showcrt crt=certs/httpd.crt \n    /usr/bin/openssl x509  -in certs/httpd.crt -noout -serial -subject  \n    serial=01\n    subject= /C=cn/ST=henan/O=linuxpanda/OU=opt/CN=www.linuxpanda.tech\n\n    [root@localhost CA]# make revoke crt=certs/httpd.crt\n    /usr/bin/openssl ca -revoke certs/httpd.crt ; \\\n            /usr/bin/openssl ca -gencrl -out crl/ca.crl \n    Using configuration from /etc/pki/tls/openssl.cnf\n    Revoking Certificate 01.\n    Data Base Updated\n    Using configuration from /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# make showcrl\n    /usr/bin/openssl crl -in crl/ca.crl -noout -text\n    Certificate Revocation List (CRL):\n            Version 2 (0x1)\n        Signature Algorithm: sha256WithRSAEncryption\n            Issuer: /C=cn/ST=henan/L=zhengzhou/O=linuxpanda/OU=opt/CN=ca.linuxpanda.tech\n            Last Update: Feb 13 04:53:35 2018 GMT\n            Next Update: Mar 15 04:53:35 2018 GMT\n            CRL extensions:\n                X509v3 CRL Number: \n                    1\n    Revoked Certificates:\n        Serial Number: 01\n            Revocation Date: Feb 13 04:53:35 2018 GMT\n        Signature Algorithm: sha256WithRSAEncryption\n            48:3e:bb:f4:6c:1a:e3:61:5d:c7:68:db:37:2f:97:e4:18:c7:\n            dc:40:56:7b:60:13:d7:07:9f:5e:e5:7b:0d:f4:33:fc:5a:a9:\n            1d:5f:ee:b9:64:cf:80:bc:a5:0c:fe:e5:ba:9a:f7:cc:1c:54:\n            63:53:d9:44:cc:a5:2c:0b:98:b5:c1:4a:2e:ca:27:3c:c9:4e:\n            f4:af:8b:7a:13:52:78:e1:84:96:1a:e0:64:4b:6b:a4:f2:c0:\n            42:37:f4:23:da:32:04:87:43:aa:97:c7:e9:16:2a:88:df:6a:\n            26:45:74:4e:6b:36:d5:6d:d7:13:82:e4:57:8e:31:5d:71:73:\n            1a:a9:cb:76:c9:48:b1:ca:6a:b9:00:c2:07:4e:35:5b:18:0b:\n            db:e6:0e:df:ef:75:da:ab:58:01:b4:ab:9c:89:85:f5:4c:67:\n            2b:61:3e:e3:f0:bd:7d:39:1a:d3:ce:1d:28:55:a1:cb:92:8f:\n            73:ed:0e:77:7a:ec:56:97:d4:64:05:c8:05:8f:c8:d8:c5:7c:\n            05:24:f8:a4:98:ff:71:48:2d:2d:b3:a5:a2:de:c2:02:62:38:\n            a4:88:96:43:84:e2:9b:a4:a5:09:0f:3c:26:57:6b:f5:53:75:\n            df:08:c1:8a:ab:a7:26:66:b8:1f:21:26:c8:6c:11:27:10:6e:\n            e2:fa:29:7c\n","source":"_posts/CA服务器的搭建.rst","raw":"---\ntitle: CA服务器的搭建\ntags:\n  - linux\n  - ca\ncategories: linux\ncopyright: true\ntop: 10\ndate: 2018-02-13 14:57:13\n---\n\n另一篇关于ca的文章_\n\n.. _另一篇关于ca的文章: http://www.cnblogs.com/zhaojiedi1992/p/zhaojiedi_linux_011_ca.html\n\nCA服务器的配置\n---------------------------------------------------------\n\n.. code-block:: bash\n   :linenos:\n   \n    [root@localhost CA]# cd /etc/pki/CA/\n\n    [root@localhost CA]# sed -r  -i 's@#?countryName_default.*@countryName_default=cn@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?stateOrProvinceName_default.*@stateOrProvinceName_default=henan@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?localityName_default.*@localityName_default=zhengzhou@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?0.organizationName_default.*@0.organizationName_default=linuxpanda@' /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# sed -r  -i 's@#?organizationalUnitName_default.*@organizationalUnitName_default=opt@' /etc/pki/tls/openssl.cnf\n\n    # 在CA目录创建一个Makefile\n    [root@localhost CA]# wget http://download.linuxpanda.tech/ca/Makefile\n\n    # 初始化创建文件\n    [root@localhost CA]# make init\n    # 创建ca私钥和对应的自签证书\n    [root@localhost CA]# make ca\n    umask 77 ; \\\n    /usr/bin/openssl genrsa -out private/cakey.pem 2048 ; \\\n    /usr/bin/openssl req -utf8 -new -x509 -key private/cakey.pem -out cacert.pem  -days 3650   ; \n    Generating RSA private key, 2048 bit long modulus\n    ......................................................+++\n    ............+++\n    e is 65537 (0x10001)\n    You are about to be asked to enter information that will be incorporated\n    into your certificate request.\n    What you are about to enter is what is called a Distinguished Name or a DN.\n    There are quite a few fields but you can leave some blank\n    For some fields there will be a default value,\n    If you enter '.', the field will be left blank.\n    -----\n    Country Name (2 letter code) [cn]:\n    State or Province Name (full name) [henan]:\n    Locality Name (eg, city) [zhengzhou]:\n    Organization Name (eg, company) [linuxpanda]:\n    Organizational Unit Name (eg, section) [opt]:\n    Common Name (eg, your name or your server's hostname) []:ca.linuxpanda.tech\n    Email Address []:\n\n客户端的配置\n---------------------------------------------------------\n\n这里使用为http配置为例,同样需要那个Makedown文件\n\n.. code-block:: bash\n\n    [root@localhost CA]# wget http://download.linuxpanda.tech/ca/Makefile\n    \n    # 先获取make的帮助使用\n    [root@localhost CA]# make usage\n    This makefile allows you to create:\n    make init\n    make ca\n    make /etc/httpd/ssl/http.key\n    make /etc/httpd/ssl/httpd.csr\n    make copytoca csr=httpd.csr\n    make copytoclient crt=httpd.crt ip=192.168.46.1\n    make httpd.csr\n    make revoke crt=httpd\n\n    [root@localhost CA]# yum install httpd -y \n    [root@localhost CA]# mkdir /etc/httpd/ssl\n    [root@localhost CA]# make /etc/httpd/ssl/httpd.key\n    umask 77 ; \\\n    /usr/bin/openssl genrsa  2048 > /etc/httpd/ssl/httpd.key\n    Generating RSA private key, 2048 bit long modulus\n    ...........+++\n    ...............+++\n    e is 65537 (0x10001)\n    [root@localhost CA]# make /etc/httpd/ssl/httpd.csr\n    umask 77 ; \\\n    /usr/bin/openssl req -utf8 -new -key /etc/httpd/ssl/httpd.key -out /etc/httpd/ssl/httpd.csr\n    You are about to be asked to enter information that will be incorporated\n    into your certificate request.\n    What you are about to enter is what is called a Distinguished Name or a DN.\n    There are quite a few fields but you can leave some blank\n    For some fields there will be a default value,\n    If you enter '.', the field will be left blank.\n    -----\n    Country Name (2 letter code) [cn]:\n    State or Province Name (full name) [henan]:\n    Locality Name (eg, city) [zhengzhou]:\n    Organization Name (eg, company) [linuxpanda]:\n    Organizational Unit Name (eg, section) [opt]:\n    Common Name (eg, your name or your server's hostname) []:www.linuxpanda.tech\n    Email Address []:\n\n    Please enter the following 'extra' attributes\n    to be sent with your certificate request\n    A challenge password []:\n    An optional company name []:\n\n    [root@localhost CA]# make copytoca crt=/etc/httpd/ssl/httpd.csr\n    scp /etc/httpd/ssl/httpd.csr 192.168.46.129:/etc/pki/CA/csr/\n    root@192.168.46.129's password: \n    httpd.csr                                                           100% 1017   319.1KB/s   00:00 \n\nCA颁发证书\n------------------------------------------------------------------\n\n.. code-block:: bash\n\n    [root@localhost CA]# make httpd.crt\n    /usr/bin/openssl ca -utf8 -days 365 -in csr/httpd.csr -out certs/httpd.crt\n    Using configuration from /etc/pki/tls/openssl.cnf\n    Check that the request matches the signature\n    Signature ok\n    Certificate Details:\n            Serial Number: 1 (0x1)\n            Validity\n                Not Before: Feb 13 04:49:57 2018 GMT\n                Not After : Feb 13 04:49:57 2019 GMT\n            Subject:\n                countryName               = cn\n                stateOrProvinceName       = henan\n                organizationName          = linuxpanda\n                organizationalUnitName    = opt\n                commonName                = www.linuxpanda.tech\n            X509v3 extensions:\n                X509v3 Basic Constraints: \n                    CA:FALSE\n                Netscape Comment: \n                    OpenSSL Generated Certificate\n                X509v3 Subject Key Identifier: \n                    EE:92:FF:A7:15:8F:39:DD:65:AC:B4:F1:59:76:04:32:18:9B:25:8E\n                X509v3 Authority Key Identifier: \n                    keyid:B0:9B:0B:62:50:40:E3:00:C6:4D:4F:3E:76:F9:E0:6F:A6:18:20:1C\n\n    Certificate is to be certified until Feb 13 04:49:57 2019 GMT (365 days)\n    Sign the certificate? [y/n]:y\n\n\n    1 out of 1 certificate requests certified, commit? [y/n]y\n    Write out database with 1 new entries\n    Data Base Updated\n    [root@localhost CA]# make copytoclient crt=htttpd.crt ip=192.168.46.2\n\nCA吊销证书\n------------------------------------------------------------------\n\n.. code-block:: bash\n\n    [root@localhost CA]# make showcrt crt=certs/httpd.crt \n    /usr/bin/openssl x509  -in certs/httpd.crt -noout -serial -subject  \n    serial=01\n    subject= /C=cn/ST=henan/O=linuxpanda/OU=opt/CN=www.linuxpanda.tech\n\n    [root@localhost CA]# make revoke crt=certs/httpd.crt\n    /usr/bin/openssl ca -revoke certs/httpd.crt ; \\\n            /usr/bin/openssl ca -gencrl -out crl/ca.crl \n    Using configuration from /etc/pki/tls/openssl.cnf\n    Revoking Certificate 01.\n    Data Base Updated\n    Using configuration from /etc/pki/tls/openssl.cnf\n    [root@localhost CA]# make showcrl\n    /usr/bin/openssl crl -in crl/ca.crl -noout -text\n    Certificate Revocation List (CRL):\n            Version 2 (0x1)\n        Signature Algorithm: sha256WithRSAEncryption\n            Issuer: /C=cn/ST=henan/L=zhengzhou/O=linuxpanda/OU=opt/CN=ca.linuxpanda.tech\n            Last Update: Feb 13 04:53:35 2018 GMT\n            Next Update: Mar 15 04:53:35 2018 GMT\n            CRL extensions:\n                X509v3 CRL Number: \n                    1\n    Revoked Certificates:\n        Serial Number: 01\n            Revocation Date: Feb 13 04:53:35 2018 GMT\n        Signature Algorithm: sha256WithRSAEncryption\n            48:3e:bb:f4:6c:1a:e3:61:5d:c7:68:db:37:2f:97:e4:18:c7:\n            dc:40:56:7b:60:13:d7:07:9f:5e:e5:7b:0d:f4:33:fc:5a:a9:\n            1d:5f:ee:b9:64:cf:80:bc:a5:0c:fe:e5:ba:9a:f7:cc:1c:54:\n            63:53:d9:44:cc:a5:2c:0b:98:b5:c1:4a:2e:ca:27:3c:c9:4e:\n            f4:af:8b:7a:13:52:78:e1:84:96:1a:e0:64:4b:6b:a4:f2:c0:\n            42:37:f4:23:da:32:04:87:43:aa:97:c7:e9:16:2a:88:df:6a:\n            26:45:74:4e:6b:36:d5:6d:d7:13:82:e4:57:8e:31:5d:71:73:\n            1a:a9:cb:76:c9:48:b1:ca:6a:b9:00:c2:07:4e:35:5b:18:0b:\n            db:e6:0e:df:ef:75:da:ab:58:01:b4:ab:9c:89:85:f5:4c:67:\n            2b:61:3e:e3:f0:bd:7d:39:1a:d3:ce:1d:28:55:a1:cb:92:8f:\n            73:ed:0e:77:7a:ec:56:97:d4:64:05:c8:05:8f:c8:d8:c5:7c:\n            05:24:f8:a4:98:ff:71:48:2d:2d:b3:a5:a2:de:c2:02:62:38:\n            a4:88:96:43:84:e2:9b:a4:a5:09:0f:3c:26:57:6b:f5:53:75:\n            df:08:c1:8a:ab:a7:26:66:b8:1f:21:26:c8:6c:11:27:10:6e:\n            e2:fa:29:7c\n","slug":"CA服务器的搭建","published":1,"updated":"2018-02-17T01:15:45.340Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mn60002ugtmf9u9b05z","content":"<p><a href=\"http://www.cnblogs.com/zhaojiedi1992/p/zhaojiedi_linux_011_ca.html\" target=\"_blank\" rel=\"noopener\">另一篇关于ca的文章</a></p>\r\n<h2 id=\"ca服务器的配置\">CA服务器的配置</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# cd /etc/pki/CA/</a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\"></a>\r\n<a class=\"sourceLine\" id=\"cb1-3\" data-line-number=\"3\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?countryName_default.*@countryName_default=cn@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-4\" data-line-number=\"4\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?stateOrProvinceName_default.*@stateOrProvinceName_default=henan@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-5\" data-line-number=\"5\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?localityName_default.*@localityName_default=zhengzhou@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-6\" data-line-number=\"6\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?0.organizationName_default.*@0.organizationName_default=linuxpanda@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-7\" data-line-number=\"7\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?organizationalUnitName_default.*@organizationalUnitName_default=opt@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb1-9\" data-line-number=\"9\"><span class=\"co\"># 在CA目录创建一个Makefile</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-10\" data-line-number=\"10\">[<span class=\"ex\">root@localhost</span> CA]# wget http://download.linuxpanda.tech/ca/Makefile</a>\r\n<a class=\"sourceLine\" id=\"cb1-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb1-12\" data-line-number=\"12\"><span class=\"co\"># 初始化创建文件</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-13\" data-line-number=\"13\">[<span class=\"ex\">root@localhost</span> CA]# make init</a>\r\n<a class=\"sourceLine\" id=\"cb1-14\" data-line-number=\"14\"><span class=\"co\"># 创建ca私钥和对应的自签证书</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-15\" data-line-number=\"15\">[<span class=\"ex\">root@localhost</span> CA]# make ca</a>\r\n<a class=\"sourceLine\" id=\"cb1-16\" data-line-number=\"16\"><span class=\"bu\">umask</span> 77 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-17\" data-line-number=\"17\"><span class=\"ex\">/usr/bin/openssl</span> genrsa -out private/cakey.pem 2048 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-18\" data-line-number=\"18\"><span class=\"ex\">/usr/bin/openssl</span> req -utf8 -new -x509 -key private/cakey.pem -out cacert.pem  -days 3650   <span class=\"kw\">;</span> </a>\r\n<a class=\"sourceLine\" id=\"cb1-19\" data-line-number=\"19\"><span class=\"ex\">Generating</span> RSA private key, 2048 bit long modulus</a>\r\n<a class=\"sourceLine\" id=\"cb1-20\" data-line-number=\"20\"><span class=\"ex\">......................................................+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-21\" data-line-number=\"21\"><span class=\"ex\">............+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-22\" data-line-number=\"22\"><span class=\"ex\">e</span> is 65537 (0x10001)</a>\r\n<a class=\"sourceLine\" id=\"cb1-23\" data-line-number=\"23\"><span class=\"ex\">You</span> are about to be asked to enter information that will be incorporated</a>\r\n<a class=\"sourceLine\" id=\"cb1-24\" data-line-number=\"24\"><span class=\"ex\">into</span> your certificate request.</a>\r\n<a class=\"sourceLine\" id=\"cb1-25\" data-line-number=\"25\"><span class=\"ex\">What</span> you are about to enter is what is called a Distinguished Name or a DN.</a>\r\n<a class=\"sourceLine\" id=\"cb1-26\" data-line-number=\"26\"><span class=\"ex\">There</span> are quite a few fields but you can leave some blank</a>\r\n<a class=\"sourceLine\" id=\"cb1-27\" data-line-number=\"27\"><span class=\"ex\">For</span> some fields there will be a default value,</a>\r\n<a class=\"sourceLine\" id=\"cb1-28\" data-line-number=\"28\"><span class=\"ex\">If</span> you enter <span class=\"st\">&#39;.&#39;</span>, the field will be left blank.</a>\r\n<a class=\"sourceLine\" id=\"cb1-29\" data-line-number=\"29\"><span class=\"ex\">-----</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-30\" data-line-number=\"30\"><span class=\"ex\">Country</span> Name (2 letter code) [<span class=\"ex\">cn</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-31\" data-line-number=\"31\"><span class=\"ex\">State</span> or Province Name (full name) [<span class=\"ex\">henan</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-32\" data-line-number=\"32\"><span class=\"ex\">Locality</span> Name (eg, city) [<span class=\"ex\">zhengzhou</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-33\" data-line-number=\"33\"><span class=\"ex\">Organization</span> Name (eg, company) [<span class=\"ex\">linuxpanda</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-34\" data-line-number=\"34\"><span class=\"ex\">Organizational</span> Unit Name (eg, section) [<span class=\"ex\">opt</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-35\" data-line-number=\"35\"><span class=\"ex\">Common</span> Name (eg, your name or your server<span class=\"st\">&#39;s hostname) []:ca.linuxpanda.tech</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-36\" data-line-number=\"36\"><span class=\"st\">Email Address []:</span></a></code></pre></div>\r\n<h2 id=\"客户端的配置\">客户端的配置</h2>\r\n<p>这里使用为http配置为例,同样需要那个Makedown文件</p>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# wget http://download.linuxpanda.tech/ca/Makefile</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-3\" data-line-number=\"3\"><span class=\"co\"># 先获取make的帮助使用</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-4\" data-line-number=\"4\">[<span class=\"ex\">root@localhost</span> CA]# make usage</a>\r\n<a class=\"sourceLine\" id=\"cb2-5\" data-line-number=\"5\"><span class=\"ex\">This</span> makefile allows you to create:</a>\r\n<a class=\"sourceLine\" id=\"cb2-6\" data-line-number=\"6\"><span class=\"fu\">make</span> init</a>\r\n<a class=\"sourceLine\" id=\"cb2-7\" data-line-number=\"7\"><span class=\"fu\">make</span> ca</a>\r\n<a class=\"sourceLine\" id=\"cb2-8\" data-line-number=\"8\"><span class=\"fu\">make</span> /etc/httpd/ssl/http.key</a>\r\n<a class=\"sourceLine\" id=\"cb2-9\" data-line-number=\"9\"><span class=\"fu\">make</span> /etc/httpd/ssl/httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-10\" data-line-number=\"10\"><span class=\"fu\">make</span> copytoca csr=httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-11\" data-line-number=\"11\"><span class=\"fu\">make</span> copytoclient crt=httpd.crt ip=192.168.46.1</a>\r\n<a class=\"sourceLine\" id=\"cb2-12\" data-line-number=\"12\"><span class=\"fu\">make</span> httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-13\" data-line-number=\"13\"><span class=\"fu\">make</span> revoke crt=httpd</a>\r\n<a class=\"sourceLine\" id=\"cb2-14\" data-line-number=\"14\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-15\" data-line-number=\"15\">[<span class=\"ex\">root@localhost</span> CA]# yum install httpd -y </a>\r\n<a class=\"sourceLine\" id=\"cb2-16\" data-line-number=\"16\">[<span class=\"ex\">root@localhost</span> CA]# mkdir /etc/httpd/ssl</a>\r\n<a class=\"sourceLine\" id=\"cb2-17\" data-line-number=\"17\">[<span class=\"ex\">root@localhost</span> CA]# make /etc/httpd/ssl/httpd.key</a>\r\n<a class=\"sourceLine\" id=\"cb2-18\" data-line-number=\"18\"><span class=\"bu\">umask</span> 77 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-19\" data-line-number=\"19\"><span class=\"ex\">/usr/bin/openssl</span> genrsa  2048 <span class=\"op\">&gt;</span> /etc/httpd/ssl/httpd.key</a>\r\n<a class=\"sourceLine\" id=\"cb2-20\" data-line-number=\"20\"><span class=\"ex\">Generating</span> RSA private key, 2048 bit long modulus</a>\r\n<a class=\"sourceLine\" id=\"cb2-21\" data-line-number=\"21\"><span class=\"ex\">...........+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-22\" data-line-number=\"22\"><span class=\"ex\">...............+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-23\" data-line-number=\"23\"><span class=\"ex\">e</span> is 65537 (0x10001)</a>\r\n<a class=\"sourceLine\" id=\"cb2-24\" data-line-number=\"24\">[<span class=\"ex\">root@localhost</span> CA]# make /etc/httpd/ssl/httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-25\" data-line-number=\"25\"><span class=\"bu\">umask</span> 77 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-26\" data-line-number=\"26\"><span class=\"ex\">/usr/bin/openssl</span> req -utf8 -new -key /etc/httpd/ssl/httpd.key -out /etc/httpd/ssl/httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-27\" data-line-number=\"27\"><span class=\"ex\">You</span> are about to be asked to enter information that will be incorporated</a>\r\n<a class=\"sourceLine\" id=\"cb2-28\" data-line-number=\"28\"><span class=\"ex\">into</span> your certificate request.</a>\r\n<a class=\"sourceLine\" id=\"cb2-29\" data-line-number=\"29\"><span class=\"ex\">What</span> you are about to enter is what is called a Distinguished Name or a DN.</a>\r\n<a class=\"sourceLine\" id=\"cb2-30\" data-line-number=\"30\"><span class=\"ex\">There</span> are quite a few fields but you can leave some blank</a>\r\n<a class=\"sourceLine\" id=\"cb2-31\" data-line-number=\"31\"><span class=\"ex\">For</span> some fields there will be a default value,</a>\r\n<a class=\"sourceLine\" id=\"cb2-32\" data-line-number=\"32\"><span class=\"ex\">If</span> you enter <span class=\"st\">&#39;.&#39;</span>, the field will be left blank.</a>\r\n<a class=\"sourceLine\" id=\"cb2-33\" data-line-number=\"33\"><span class=\"ex\">-----</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-34\" data-line-number=\"34\"><span class=\"ex\">Country</span> Name (2 letter code) [<span class=\"ex\">cn</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-35\" data-line-number=\"35\"><span class=\"ex\">State</span> or Province Name (full name) [<span class=\"ex\">henan</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-36\" data-line-number=\"36\"><span class=\"ex\">Locality</span> Name (eg, city) [<span class=\"ex\">zhengzhou</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-37\" data-line-number=\"37\"><span class=\"ex\">Organization</span> Name (eg, company) [<span class=\"ex\">linuxpanda</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-38\" data-line-number=\"38\"><span class=\"ex\">Organizational</span> Unit Name (eg, section) [<span class=\"ex\">opt</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-39\" data-line-number=\"39\"><span class=\"ex\">Common</span> Name (eg, your name or your server<span class=\"st\">&#39;s hostname) []:www.linuxpanda.tech</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-40\" data-line-number=\"40\"><span class=\"st\">Email Address []:</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-41\" data-line-number=\"41\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-42\" data-line-number=\"42\"><span class=\"st\">Please enter the following &#39;</span>extra<span class=\"st\">&#39; attributes</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-43\" data-line-number=\"43\"><span class=\"st\">to be sent with your certificate request</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-44\" data-line-number=\"44\"><span class=\"st\">A challenge password []:</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-45\" data-line-number=\"45\"><span class=\"st\">An optional company name []:</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-46\" data-line-number=\"46\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-47\" data-line-number=\"47\"><span class=\"st\">[root@localhost CA]# make copytoca crt=/etc/httpd/ssl/httpd.csr</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-48\" data-line-number=\"48\"><span class=\"st\">scp /etc/httpd/ssl/httpd.csr 192.168.46.129:/etc/pki/CA/csr/</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-49\" data-line-number=\"49\"><span class=\"st\">root@192.168.46.129&#39;</span>s password: </a>\r\n<a class=\"sourceLine\" id=\"cb2-50\" data-line-number=\"50\"><span class=\"ex\">httpd.csr</span>                                                           100% 1017   319.1KB/s   00:00 </a></code></pre></div>\r\n<h2 id=\"ca颁发证书\">CA颁发证书</h2>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# make httpd.crt</a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\"><span class=\"ex\">/usr/bin/openssl</span> ca -utf8 -days 365 -in csr/httpd.csr -out certs/httpd.crt</a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"><span class=\"ex\">Using</span> configuration from /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"ex\">Check</span> that the request matches the signature</a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"ex\">Signature</span> ok</a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"><span class=\"ex\">Certificate</span> Details:</a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\">        <span class=\"ex\">Serial</span> Number: 1 (0x1)</a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\">        <span class=\"ex\">Validity</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\">            <span class=\"ex\">Not</span> Before: Feb 13 04:49:57 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\">            <span class=\"ex\">Not</span> After : Feb 13 04:49:57 2019 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\">        <span class=\"ex\">Subject</span>:</a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\">            <span class=\"ex\">countryName</span>               = cn</a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\">            <span class=\"ex\">stateOrProvinceName</span>       = henan</a>\r\n<a class=\"sourceLine\" id=\"cb3-14\" data-line-number=\"14\">            <span class=\"ex\">organizationName</span>          = linuxpanda</a>\r\n<a class=\"sourceLine\" id=\"cb3-15\" data-line-number=\"15\">            <span class=\"ex\">organizationalUnitName</span>    = opt</a>\r\n<a class=\"sourceLine\" id=\"cb3-16\" data-line-number=\"16\">            <span class=\"ex\">commonName</span>                = www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb3-17\" data-line-number=\"17\">        <span class=\"ex\">X509v3</span> extensions:</a>\r\n<a class=\"sourceLine\" id=\"cb3-18\" data-line-number=\"18\">            <span class=\"ex\">X509v3</span> Basic Constraints: </a>\r\n<a class=\"sourceLine\" id=\"cb3-19\" data-line-number=\"19\">                <span class=\"ex\">CA</span>:FALSE</a>\r\n<a class=\"sourceLine\" id=\"cb3-20\" data-line-number=\"20\">            <span class=\"ex\">Netscape</span> Comment: </a>\r\n<a class=\"sourceLine\" id=\"cb3-21\" data-line-number=\"21\">                <span class=\"ex\">OpenSSL</span> Generated Certificate</a>\r\n<a class=\"sourceLine\" id=\"cb3-22\" data-line-number=\"22\">            <span class=\"ex\">X509v3</span> Subject Key Identifier: </a>\r\n<a class=\"sourceLine\" id=\"cb3-23\" data-line-number=\"23\">                <span class=\"ex\">EE</span>:92:FF:A7:15:8F:39:DD:65:AC:B4:F1:59:76:04:32:18:9B:25:8E</a>\r\n<a class=\"sourceLine\" id=\"cb3-24\" data-line-number=\"24\">            <span class=\"ex\">X509v3</span> Authority Key Identifier: </a>\r\n<a class=\"sourceLine\" id=\"cb3-25\" data-line-number=\"25\">                <span class=\"ex\">keyid</span>:B0:9B:0B:62:50:40:E3:00:C6:4D:4F:3E:76:F9:E0:6F:A6:18:20:1C</a>\r\n<a class=\"sourceLine\" id=\"cb3-26\" data-line-number=\"26\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-27\" data-line-number=\"27\"><span class=\"ex\">Certificate</span> is to be certified until Feb 13 04:49:57 2019 GMT (365 days)</a>\r\n<a class=\"sourceLine\" id=\"cb3-28\" data-line-number=\"28\"><span class=\"ex\">Sign</span> the certificate? [y/n]:y</a>\r\n<a class=\"sourceLine\" id=\"cb3-29\" data-line-number=\"29\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-30\" data-line-number=\"30\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-31\" data-line-number=\"31\"><span class=\"ex\">1</span> out of 1 certificate requests certified, commit? [y/n]y</a>\r\n<a class=\"sourceLine\" id=\"cb3-32\" data-line-number=\"32\"><span class=\"ex\">Write</span> out database with 1 new entries</a>\r\n<a class=\"sourceLine\" id=\"cb3-33\" data-line-number=\"33\"><span class=\"ex\">Data</span> Base Updated</a>\r\n<a class=\"sourceLine\" id=\"cb3-34\" data-line-number=\"34\">[<span class=\"ex\">root@localhost</span> CA]# make copytoclient crt=htttpd.crt ip=192.168.46.2</a></code></pre></div>\r\n<h2 id=\"ca吊销证书\">CA吊销证书</h2>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# make showcrt crt=certs/httpd.crt </a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\"><span class=\"ex\">/usr/bin/openssl</span> x509  -in certs/httpd.crt -noout -serial -subject  </a>\r\n<a class=\"sourceLine\" id=\"cb4-3\" data-line-number=\"3\"><span class=\"va\">serial=</span>01</a>\r\n<a class=\"sourceLine\" id=\"cb4-4\" data-line-number=\"4\"><span class=\"va\">subject=</span> /<span class=\"va\">C=</span>cn/ST=<span class=\"ex\">henan</span>/<span class=\"va\">O=</span>linuxpanda/OU=<span class=\"ex\">opt</span>/<span class=\"va\">CN=</span>www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb4-5\" data-line-number=\"5\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-6\" data-line-number=\"6\">[<span class=\"ex\">root@localhost</span> CA]# make revoke crt=certs/httpd.crt</a>\r\n<a class=\"sourceLine\" id=\"cb4-7\" data-line-number=\"7\"><span class=\"ex\">/usr/bin/openssl</span> ca -revoke certs/httpd.crt <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-8\" data-line-number=\"8\">        <span class=\"ex\">/usr/bin/openssl</span> ca -gencrl -out crl/ca.crl </a>\r\n<a class=\"sourceLine\" id=\"cb4-9\" data-line-number=\"9\"><span class=\"ex\">Using</span> configuration from /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb4-10\" data-line-number=\"10\"><span class=\"ex\">Revoking</span> Certificate 01.</a>\r\n<a class=\"sourceLine\" id=\"cb4-11\" data-line-number=\"11\"><span class=\"ex\">Data</span> Base Updated</a>\r\n<a class=\"sourceLine\" id=\"cb4-12\" data-line-number=\"12\"><span class=\"ex\">Using</span> configuration from /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb4-13\" data-line-number=\"13\">[<span class=\"ex\">root@localhost</span> CA]# make showcrl</a>\r\n<a class=\"sourceLine\" id=\"cb4-14\" data-line-number=\"14\"><span class=\"ex\">/usr/bin/openssl</span> crl -in crl/ca.crl -noout -text</a>\r\n<a class=\"sourceLine\" id=\"cb4-15\" data-line-number=\"15\"><span class=\"ex\">Certificate</span> Revocation List (CRL)<span class=\"bu\">:</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-16\" data-line-number=\"16\">        <span class=\"ex\">Version</span> 2 (0x1)</a>\r\n<a class=\"sourceLine\" id=\"cb4-17\" data-line-number=\"17\">    <span class=\"ex\">Signature</span> Algorithm: sha256WithRSAEncryption</a>\r\n<a class=\"sourceLine\" id=\"cb4-18\" data-line-number=\"18\">        <span class=\"ex\">Issuer</span>: /C=cn/ST=henan/L=zhengzhou/O=linuxpanda/OU=opt/CN=ca.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb4-19\" data-line-number=\"19\">        <span class=\"ex\">Last</span> Update: Feb 13 04:53:35 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb4-20\" data-line-number=\"20\">        <span class=\"ex\">Next</span> Update: Mar 15 04:53:35 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb4-21\" data-line-number=\"21\">        <span class=\"ex\">CRL</span> extensions:</a>\r\n<a class=\"sourceLine\" id=\"cb4-22\" data-line-number=\"22\">            <span class=\"ex\">X509v3</span> CRL Number: </a>\r\n<a class=\"sourceLine\" id=\"cb4-23\" data-line-number=\"23\">                <span class=\"ex\">1</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-24\" data-line-number=\"24\"><span class=\"ex\">Revoked</span> Certificates:</a>\r\n<a class=\"sourceLine\" id=\"cb4-25\" data-line-number=\"25\">    <span class=\"ex\">Serial</span> Number: 01</a>\r\n<a class=\"sourceLine\" id=\"cb4-26\" data-line-number=\"26\">        <span class=\"ex\">Revocation</span> Date: Feb 13 04:53:35 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb4-27\" data-line-number=\"27\">    <span class=\"ex\">Signature</span> Algorithm: sha256WithRSAEncryption</a>\r\n<a class=\"sourceLine\" id=\"cb4-28\" data-line-number=\"28\">        <span class=\"ex\">48</span>:3e:bb:f4:6c:1a:e3:61:5d:c7:68:db:37:2f:97:e4:18:c7:</a>\r\n<a class=\"sourceLine\" id=\"cb4-29\" data-line-number=\"29\">        <span class=\"ex\">dc</span>:40:56:7b:60:13:d7:07:9f:5e:e5:7b:0d:f4:33:fc:5a:a9:</a>\r\n<a class=\"sourceLine\" id=\"cb4-30\" data-line-number=\"30\">        <span class=\"ex\">1d</span>:5f:ee:b9:64:cf:80:bc:a5:0c:fe:e5:ba:9a:f7:cc:1c:54:</a>\r\n<a class=\"sourceLine\" id=\"cb4-31\" data-line-number=\"31\">        <span class=\"ex\">63</span>:53:d9:44:cc:a5:2c:0b:98:b5:c1:4a:2e:ca:27:3c:c9:4e:</a>\r\n<a class=\"sourceLine\" id=\"cb4-32\" data-line-number=\"32\">        <span class=\"ex\">f4</span>:af:8b:7a:13:52:78:e1:84:96:1a:e0:64:4b:6b:a4:f2:c0:</a>\r\n<a class=\"sourceLine\" id=\"cb4-33\" data-line-number=\"33\">        <span class=\"ex\">42</span>:37:f4:23:da:32:04:87:43:aa:97:c7:e9:16:2a:88:df:6a:</a>\r\n<a class=\"sourceLine\" id=\"cb4-34\" data-line-number=\"34\">        <span class=\"ex\">26</span>:45:74:4e:6b:36:d5:6d:d7:13:82:e4:57:8e:31:5d:71:73:</a>\r\n<a class=\"sourceLine\" id=\"cb4-35\" data-line-number=\"35\">        <span class=\"ex\">1a</span>:a9:cb:76:c9:48:b1:ca:6a:b9:00:c2:07:4e:35:5b:18:0b:</a>\r\n<a class=\"sourceLine\" id=\"cb4-36\" data-line-number=\"36\">        <span class=\"ex\">db</span>:e6:0e:df:ef:75:da:ab:58:01:b4:ab:9c:89:85:f5:4c:67:</a>\r\n<a class=\"sourceLine\" id=\"cb4-37\" data-line-number=\"37\">        <span class=\"ex\">2b</span>:61:3e:e3:f0:bd:7d:39:1a:d3:ce:1d:28:55:a1:cb:92:8f:</a>\r\n<a class=\"sourceLine\" id=\"cb4-38\" data-line-number=\"38\">        <span class=\"ex\">73</span>:ed:0e:77:7a:ec:56:97:d4:64:05:c8:05:8f:c8:d8:c5:7c:</a>\r\n<a class=\"sourceLine\" id=\"cb4-39\" data-line-number=\"39\">        <span class=\"ex\">05</span>:24:f8:a4:98:ff:71:48:2d:2d:b3:a5:a2:de:c2:02:62:38:</a>\r\n<a class=\"sourceLine\" id=\"cb4-40\" data-line-number=\"40\">        <span class=\"ex\">a4</span>:88:96:43:84:e2:9b:a4:a5:09:0f:3c:26:57:6b:f5:53:75:</a>\r\n<a class=\"sourceLine\" id=\"cb4-41\" data-line-number=\"41\">        <span class=\"ex\">df</span>:08:c1:8a:ab:a7:26:66:b8:1f:21:26:c8:6c:11:27:10:6e:</a>\r\n<a class=\"sourceLine\" id=\"cb4-42\" data-line-number=\"42\">        <span class=\"ex\">e2</span>:fa:29:7c</a></code></pre></div>\r\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"http://www.cnblogs.com/zhaojiedi1992/p/zhaojiedi_linux_011_ca.html\" target=\"_blank\" rel=\"noopener\">另一篇关于ca的文章</a></p>\r\n<h2 id=\"ca服务器的配置\">CA服务器的配置</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# cd /etc/pki/CA/</a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\"></a>\r\n<a class=\"sourceLine\" id=\"cb1-3\" data-line-number=\"3\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?countryName_default.*@countryName_default=cn@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-4\" data-line-number=\"4\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?stateOrProvinceName_default.*@stateOrProvinceName_default=henan@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-5\" data-line-number=\"5\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?localityName_default.*@localityName_default=zhengzhou@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-6\" data-line-number=\"6\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?0.organizationName_default.*@0.organizationName_default=linuxpanda@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-7\" data-line-number=\"7\">[<span class=\"ex\">root@localhost</span> CA]# sed -r  -i <span class=\"st\">&#39;s@#?organizationalUnitName_default.*@organizationalUnitName_default=opt@&#39;</span> /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb1-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb1-9\" data-line-number=\"9\"><span class=\"co\"># 在CA目录创建一个Makefile</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-10\" data-line-number=\"10\">[<span class=\"ex\">root@localhost</span> CA]# wget http://download.linuxpanda.tech/ca/Makefile</a>\r\n<a class=\"sourceLine\" id=\"cb1-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb1-12\" data-line-number=\"12\"><span class=\"co\"># 初始化创建文件</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-13\" data-line-number=\"13\">[<span class=\"ex\">root@localhost</span> CA]# make init</a>\r\n<a class=\"sourceLine\" id=\"cb1-14\" data-line-number=\"14\"><span class=\"co\"># 创建ca私钥和对应的自签证书</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-15\" data-line-number=\"15\">[<span class=\"ex\">root@localhost</span> CA]# make ca</a>\r\n<a class=\"sourceLine\" id=\"cb1-16\" data-line-number=\"16\"><span class=\"bu\">umask</span> 77 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-17\" data-line-number=\"17\"><span class=\"ex\">/usr/bin/openssl</span> genrsa -out private/cakey.pem 2048 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-18\" data-line-number=\"18\"><span class=\"ex\">/usr/bin/openssl</span> req -utf8 -new -x509 -key private/cakey.pem -out cacert.pem  -days 3650   <span class=\"kw\">;</span> </a>\r\n<a class=\"sourceLine\" id=\"cb1-19\" data-line-number=\"19\"><span class=\"ex\">Generating</span> RSA private key, 2048 bit long modulus</a>\r\n<a class=\"sourceLine\" id=\"cb1-20\" data-line-number=\"20\"><span class=\"ex\">......................................................+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-21\" data-line-number=\"21\"><span class=\"ex\">............+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-22\" data-line-number=\"22\"><span class=\"ex\">e</span> is 65537 (0x10001)</a>\r\n<a class=\"sourceLine\" id=\"cb1-23\" data-line-number=\"23\"><span class=\"ex\">You</span> are about to be asked to enter information that will be incorporated</a>\r\n<a class=\"sourceLine\" id=\"cb1-24\" data-line-number=\"24\"><span class=\"ex\">into</span> your certificate request.</a>\r\n<a class=\"sourceLine\" id=\"cb1-25\" data-line-number=\"25\"><span class=\"ex\">What</span> you are about to enter is what is called a Distinguished Name or a DN.</a>\r\n<a class=\"sourceLine\" id=\"cb1-26\" data-line-number=\"26\"><span class=\"ex\">There</span> are quite a few fields but you can leave some blank</a>\r\n<a class=\"sourceLine\" id=\"cb1-27\" data-line-number=\"27\"><span class=\"ex\">For</span> some fields there will be a default value,</a>\r\n<a class=\"sourceLine\" id=\"cb1-28\" data-line-number=\"28\"><span class=\"ex\">If</span> you enter <span class=\"st\">&#39;.&#39;</span>, the field will be left blank.</a>\r\n<a class=\"sourceLine\" id=\"cb1-29\" data-line-number=\"29\"><span class=\"ex\">-----</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-30\" data-line-number=\"30\"><span class=\"ex\">Country</span> Name (2 letter code) [<span class=\"ex\">cn</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-31\" data-line-number=\"31\"><span class=\"ex\">State</span> or Province Name (full name) [<span class=\"ex\">henan</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-32\" data-line-number=\"32\"><span class=\"ex\">Locality</span> Name (eg, city) [<span class=\"ex\">zhengzhou</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-33\" data-line-number=\"33\"><span class=\"ex\">Organization</span> Name (eg, company) [<span class=\"ex\">linuxpanda</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-34\" data-line-number=\"34\"><span class=\"ex\">Organizational</span> Unit Name (eg, section) [<span class=\"ex\">opt</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb1-35\" data-line-number=\"35\"><span class=\"ex\">Common</span> Name (eg, your name or your server<span class=\"st\">&#39;s hostname) []:ca.linuxpanda.tech</span></a>\r\n<a class=\"sourceLine\" id=\"cb1-36\" data-line-number=\"36\"><span class=\"st\">Email Address []:</span></a></code></pre></div>\r\n<h2 id=\"客户端的配置\">客户端的配置</h2>\r\n<p>这里使用为http配置为例,同样需要那个Makedown文件</p>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# wget http://download.linuxpanda.tech/ca/Makefile</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-3\" data-line-number=\"3\"><span class=\"co\"># 先获取make的帮助使用</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-4\" data-line-number=\"4\">[<span class=\"ex\">root@localhost</span> CA]# make usage</a>\r\n<a class=\"sourceLine\" id=\"cb2-5\" data-line-number=\"5\"><span class=\"ex\">This</span> makefile allows you to create:</a>\r\n<a class=\"sourceLine\" id=\"cb2-6\" data-line-number=\"6\"><span class=\"fu\">make</span> init</a>\r\n<a class=\"sourceLine\" id=\"cb2-7\" data-line-number=\"7\"><span class=\"fu\">make</span> ca</a>\r\n<a class=\"sourceLine\" id=\"cb2-8\" data-line-number=\"8\"><span class=\"fu\">make</span> /etc/httpd/ssl/http.key</a>\r\n<a class=\"sourceLine\" id=\"cb2-9\" data-line-number=\"9\"><span class=\"fu\">make</span> /etc/httpd/ssl/httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-10\" data-line-number=\"10\"><span class=\"fu\">make</span> copytoca csr=httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-11\" data-line-number=\"11\"><span class=\"fu\">make</span> copytoclient crt=httpd.crt ip=192.168.46.1</a>\r\n<a class=\"sourceLine\" id=\"cb2-12\" data-line-number=\"12\"><span class=\"fu\">make</span> httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-13\" data-line-number=\"13\"><span class=\"fu\">make</span> revoke crt=httpd</a>\r\n<a class=\"sourceLine\" id=\"cb2-14\" data-line-number=\"14\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-15\" data-line-number=\"15\">[<span class=\"ex\">root@localhost</span> CA]# yum install httpd -y </a>\r\n<a class=\"sourceLine\" id=\"cb2-16\" data-line-number=\"16\">[<span class=\"ex\">root@localhost</span> CA]# mkdir /etc/httpd/ssl</a>\r\n<a class=\"sourceLine\" id=\"cb2-17\" data-line-number=\"17\">[<span class=\"ex\">root@localhost</span> CA]# make /etc/httpd/ssl/httpd.key</a>\r\n<a class=\"sourceLine\" id=\"cb2-18\" data-line-number=\"18\"><span class=\"bu\">umask</span> 77 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-19\" data-line-number=\"19\"><span class=\"ex\">/usr/bin/openssl</span> genrsa  2048 <span class=\"op\">&gt;</span> /etc/httpd/ssl/httpd.key</a>\r\n<a class=\"sourceLine\" id=\"cb2-20\" data-line-number=\"20\"><span class=\"ex\">Generating</span> RSA private key, 2048 bit long modulus</a>\r\n<a class=\"sourceLine\" id=\"cb2-21\" data-line-number=\"21\"><span class=\"ex\">...........+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-22\" data-line-number=\"22\"><span class=\"ex\">...............+++</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-23\" data-line-number=\"23\"><span class=\"ex\">e</span> is 65537 (0x10001)</a>\r\n<a class=\"sourceLine\" id=\"cb2-24\" data-line-number=\"24\">[<span class=\"ex\">root@localhost</span> CA]# make /etc/httpd/ssl/httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-25\" data-line-number=\"25\"><span class=\"bu\">umask</span> 77 <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-26\" data-line-number=\"26\"><span class=\"ex\">/usr/bin/openssl</span> req -utf8 -new -key /etc/httpd/ssl/httpd.key -out /etc/httpd/ssl/httpd.csr</a>\r\n<a class=\"sourceLine\" id=\"cb2-27\" data-line-number=\"27\"><span class=\"ex\">You</span> are about to be asked to enter information that will be incorporated</a>\r\n<a class=\"sourceLine\" id=\"cb2-28\" data-line-number=\"28\"><span class=\"ex\">into</span> your certificate request.</a>\r\n<a class=\"sourceLine\" id=\"cb2-29\" data-line-number=\"29\"><span class=\"ex\">What</span> you are about to enter is what is called a Distinguished Name or a DN.</a>\r\n<a class=\"sourceLine\" id=\"cb2-30\" data-line-number=\"30\"><span class=\"ex\">There</span> are quite a few fields but you can leave some blank</a>\r\n<a class=\"sourceLine\" id=\"cb2-31\" data-line-number=\"31\"><span class=\"ex\">For</span> some fields there will be a default value,</a>\r\n<a class=\"sourceLine\" id=\"cb2-32\" data-line-number=\"32\"><span class=\"ex\">If</span> you enter <span class=\"st\">&#39;.&#39;</span>, the field will be left blank.</a>\r\n<a class=\"sourceLine\" id=\"cb2-33\" data-line-number=\"33\"><span class=\"ex\">-----</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-34\" data-line-number=\"34\"><span class=\"ex\">Country</span> Name (2 letter code) [<span class=\"ex\">cn</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-35\" data-line-number=\"35\"><span class=\"ex\">State</span> or Province Name (full name) [<span class=\"ex\">henan</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-36\" data-line-number=\"36\"><span class=\"ex\">Locality</span> Name (eg, city) [<span class=\"ex\">zhengzhou</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-37\" data-line-number=\"37\"><span class=\"ex\">Organization</span> Name (eg, company) [<span class=\"ex\">linuxpanda</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-38\" data-line-number=\"38\"><span class=\"ex\">Organizational</span> Unit Name (eg, section) [<span class=\"ex\">opt</span>]:</a>\r\n<a class=\"sourceLine\" id=\"cb2-39\" data-line-number=\"39\"><span class=\"ex\">Common</span> Name (eg, your name or your server<span class=\"st\">&#39;s hostname) []:www.linuxpanda.tech</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-40\" data-line-number=\"40\"><span class=\"st\">Email Address []:</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-41\" data-line-number=\"41\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-42\" data-line-number=\"42\"><span class=\"st\">Please enter the following &#39;</span>extra<span class=\"st\">&#39; attributes</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-43\" data-line-number=\"43\"><span class=\"st\">to be sent with your certificate request</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-44\" data-line-number=\"44\"><span class=\"st\">A challenge password []:</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-45\" data-line-number=\"45\"><span class=\"st\">An optional company name []:</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-46\" data-line-number=\"46\"></a>\r\n<a class=\"sourceLine\" id=\"cb2-47\" data-line-number=\"47\"><span class=\"st\">[root@localhost CA]# make copytoca crt=/etc/httpd/ssl/httpd.csr</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-48\" data-line-number=\"48\"><span class=\"st\">scp /etc/httpd/ssl/httpd.csr 192.168.46.129:/etc/pki/CA/csr/</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-49\" data-line-number=\"49\"><span class=\"st\">root@192.168.46.129&#39;</span>s password: </a>\r\n<a class=\"sourceLine\" id=\"cb2-50\" data-line-number=\"50\"><span class=\"ex\">httpd.csr</span>                                                           100% 1017   319.1KB/s   00:00 </a></code></pre></div>\r\n<h2 id=\"ca颁发证书\">CA颁发证书</h2>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# make httpd.crt</a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\"><span class=\"ex\">/usr/bin/openssl</span> ca -utf8 -days 365 -in csr/httpd.csr -out certs/httpd.crt</a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"><span class=\"ex\">Using</span> configuration from /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"ex\">Check</span> that the request matches the signature</a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"ex\">Signature</span> ok</a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"><span class=\"ex\">Certificate</span> Details:</a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\">        <span class=\"ex\">Serial</span> Number: 1 (0x1)</a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\">        <span class=\"ex\">Validity</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\">            <span class=\"ex\">Not</span> Before: Feb 13 04:49:57 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\">            <span class=\"ex\">Not</span> After : Feb 13 04:49:57 2019 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\">        <span class=\"ex\">Subject</span>:</a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\">            <span class=\"ex\">countryName</span>               = cn</a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\">            <span class=\"ex\">stateOrProvinceName</span>       = henan</a>\r\n<a class=\"sourceLine\" id=\"cb3-14\" data-line-number=\"14\">            <span class=\"ex\">organizationName</span>          = linuxpanda</a>\r\n<a class=\"sourceLine\" id=\"cb3-15\" data-line-number=\"15\">            <span class=\"ex\">organizationalUnitName</span>    = opt</a>\r\n<a class=\"sourceLine\" id=\"cb3-16\" data-line-number=\"16\">            <span class=\"ex\">commonName</span>                = www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb3-17\" data-line-number=\"17\">        <span class=\"ex\">X509v3</span> extensions:</a>\r\n<a class=\"sourceLine\" id=\"cb3-18\" data-line-number=\"18\">            <span class=\"ex\">X509v3</span> Basic Constraints: </a>\r\n<a class=\"sourceLine\" id=\"cb3-19\" data-line-number=\"19\">                <span class=\"ex\">CA</span>:FALSE</a>\r\n<a class=\"sourceLine\" id=\"cb3-20\" data-line-number=\"20\">            <span class=\"ex\">Netscape</span> Comment: </a>\r\n<a class=\"sourceLine\" id=\"cb3-21\" data-line-number=\"21\">                <span class=\"ex\">OpenSSL</span> Generated Certificate</a>\r\n<a class=\"sourceLine\" id=\"cb3-22\" data-line-number=\"22\">            <span class=\"ex\">X509v3</span> Subject Key Identifier: </a>\r\n<a class=\"sourceLine\" id=\"cb3-23\" data-line-number=\"23\">                <span class=\"ex\">EE</span>:92:FF:A7:15:8F:39:DD:65:AC:B4:F1:59:76:04:32:18:9B:25:8E</a>\r\n<a class=\"sourceLine\" id=\"cb3-24\" data-line-number=\"24\">            <span class=\"ex\">X509v3</span> Authority Key Identifier: </a>\r\n<a class=\"sourceLine\" id=\"cb3-25\" data-line-number=\"25\">                <span class=\"ex\">keyid</span>:B0:9B:0B:62:50:40:E3:00:C6:4D:4F:3E:76:F9:E0:6F:A6:18:20:1C</a>\r\n<a class=\"sourceLine\" id=\"cb3-26\" data-line-number=\"26\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-27\" data-line-number=\"27\"><span class=\"ex\">Certificate</span> is to be certified until Feb 13 04:49:57 2019 GMT (365 days)</a>\r\n<a class=\"sourceLine\" id=\"cb3-28\" data-line-number=\"28\"><span class=\"ex\">Sign</span> the certificate? [y/n]:y</a>\r\n<a class=\"sourceLine\" id=\"cb3-29\" data-line-number=\"29\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-30\" data-line-number=\"30\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-31\" data-line-number=\"31\"><span class=\"ex\">1</span> out of 1 certificate requests certified, commit? [y/n]y</a>\r\n<a class=\"sourceLine\" id=\"cb3-32\" data-line-number=\"32\"><span class=\"ex\">Write</span> out database with 1 new entries</a>\r\n<a class=\"sourceLine\" id=\"cb3-33\" data-line-number=\"33\"><span class=\"ex\">Data</span> Base Updated</a>\r\n<a class=\"sourceLine\" id=\"cb3-34\" data-line-number=\"34\">[<span class=\"ex\">root@localhost</span> CA]# make copytoclient crt=htttpd.crt ip=192.168.46.2</a></code></pre></div>\r\n<h2 id=\"ca吊销证书\">CA吊销证书</h2>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> CA]# make showcrt crt=certs/httpd.crt </a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\"><span class=\"ex\">/usr/bin/openssl</span> x509  -in certs/httpd.crt -noout -serial -subject  </a>\r\n<a class=\"sourceLine\" id=\"cb4-3\" data-line-number=\"3\"><span class=\"va\">serial=</span>01</a>\r\n<a class=\"sourceLine\" id=\"cb4-4\" data-line-number=\"4\"><span class=\"va\">subject=</span> /<span class=\"va\">C=</span>cn/ST=<span class=\"ex\">henan</span>/<span class=\"va\">O=</span>linuxpanda/OU=<span class=\"ex\">opt</span>/<span class=\"va\">CN=</span>www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb4-5\" data-line-number=\"5\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-6\" data-line-number=\"6\">[<span class=\"ex\">root@localhost</span> CA]# make revoke crt=certs/httpd.crt</a>\r\n<a class=\"sourceLine\" id=\"cb4-7\" data-line-number=\"7\"><span class=\"ex\">/usr/bin/openssl</span> ca -revoke certs/httpd.crt <span class=\"kw\">;</span> <span class=\"kw\">\\</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-8\" data-line-number=\"8\">        <span class=\"ex\">/usr/bin/openssl</span> ca -gencrl -out crl/ca.crl </a>\r\n<a class=\"sourceLine\" id=\"cb4-9\" data-line-number=\"9\"><span class=\"ex\">Using</span> configuration from /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb4-10\" data-line-number=\"10\"><span class=\"ex\">Revoking</span> Certificate 01.</a>\r\n<a class=\"sourceLine\" id=\"cb4-11\" data-line-number=\"11\"><span class=\"ex\">Data</span> Base Updated</a>\r\n<a class=\"sourceLine\" id=\"cb4-12\" data-line-number=\"12\"><span class=\"ex\">Using</span> configuration from /etc/pki/tls/openssl.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb4-13\" data-line-number=\"13\">[<span class=\"ex\">root@localhost</span> CA]# make showcrl</a>\r\n<a class=\"sourceLine\" id=\"cb4-14\" data-line-number=\"14\"><span class=\"ex\">/usr/bin/openssl</span> crl -in crl/ca.crl -noout -text</a>\r\n<a class=\"sourceLine\" id=\"cb4-15\" data-line-number=\"15\"><span class=\"ex\">Certificate</span> Revocation List (CRL)<span class=\"bu\">:</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-16\" data-line-number=\"16\">        <span class=\"ex\">Version</span> 2 (0x1)</a>\r\n<a class=\"sourceLine\" id=\"cb4-17\" data-line-number=\"17\">    <span class=\"ex\">Signature</span> Algorithm: sha256WithRSAEncryption</a>\r\n<a class=\"sourceLine\" id=\"cb4-18\" data-line-number=\"18\">        <span class=\"ex\">Issuer</span>: /C=cn/ST=henan/L=zhengzhou/O=linuxpanda/OU=opt/CN=ca.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb4-19\" data-line-number=\"19\">        <span class=\"ex\">Last</span> Update: Feb 13 04:53:35 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb4-20\" data-line-number=\"20\">        <span class=\"ex\">Next</span> Update: Mar 15 04:53:35 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb4-21\" data-line-number=\"21\">        <span class=\"ex\">CRL</span> extensions:</a>\r\n<a class=\"sourceLine\" id=\"cb4-22\" data-line-number=\"22\">            <span class=\"ex\">X509v3</span> CRL Number: </a>\r\n<a class=\"sourceLine\" id=\"cb4-23\" data-line-number=\"23\">                <span class=\"ex\">1</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-24\" data-line-number=\"24\"><span class=\"ex\">Revoked</span> Certificates:</a>\r\n<a class=\"sourceLine\" id=\"cb4-25\" data-line-number=\"25\">    <span class=\"ex\">Serial</span> Number: 01</a>\r\n<a class=\"sourceLine\" id=\"cb4-26\" data-line-number=\"26\">        <span class=\"ex\">Revocation</span> Date: Feb 13 04:53:35 2018 GMT</a>\r\n<a class=\"sourceLine\" id=\"cb4-27\" data-line-number=\"27\">    <span class=\"ex\">Signature</span> Algorithm: sha256WithRSAEncryption</a>\r\n<a class=\"sourceLine\" id=\"cb4-28\" data-line-number=\"28\">        <span class=\"ex\">48</span>:3e:bb:f4:6c:1a:e3:61:5d:c7:68:db:37:2f:97:e4:18:c7:</a>\r\n<a class=\"sourceLine\" id=\"cb4-29\" data-line-number=\"29\">        <span class=\"ex\">dc</span>:40:56:7b:60:13:d7:07:9f:5e:e5:7b:0d:f4:33:fc:5a:a9:</a>\r\n<a class=\"sourceLine\" id=\"cb4-30\" data-line-number=\"30\">        <span class=\"ex\">1d</span>:5f:ee:b9:64:cf:80:bc:a5:0c:fe:e5:ba:9a:f7:cc:1c:54:</a>\r\n<a class=\"sourceLine\" id=\"cb4-31\" data-line-number=\"31\">        <span class=\"ex\">63</span>:53:d9:44:cc:a5:2c:0b:98:b5:c1:4a:2e:ca:27:3c:c9:4e:</a>\r\n<a class=\"sourceLine\" id=\"cb4-32\" data-line-number=\"32\">        <span class=\"ex\">f4</span>:af:8b:7a:13:52:78:e1:84:96:1a:e0:64:4b:6b:a4:f2:c0:</a>\r\n<a class=\"sourceLine\" id=\"cb4-33\" data-line-number=\"33\">        <span class=\"ex\">42</span>:37:f4:23:da:32:04:87:43:aa:97:c7:e9:16:2a:88:df:6a:</a>\r\n<a class=\"sourceLine\" id=\"cb4-34\" data-line-number=\"34\">        <span class=\"ex\">26</span>:45:74:4e:6b:36:d5:6d:d7:13:82:e4:57:8e:31:5d:71:73:</a>\r\n<a class=\"sourceLine\" id=\"cb4-35\" data-line-number=\"35\">        <span class=\"ex\">1a</span>:a9:cb:76:c9:48:b1:ca:6a:b9:00:c2:07:4e:35:5b:18:0b:</a>\r\n<a class=\"sourceLine\" id=\"cb4-36\" data-line-number=\"36\">        <span class=\"ex\">db</span>:e6:0e:df:ef:75:da:ab:58:01:b4:ab:9c:89:85:f5:4c:67:</a>\r\n<a class=\"sourceLine\" id=\"cb4-37\" data-line-number=\"37\">        <span class=\"ex\">2b</span>:61:3e:e3:f0:bd:7d:39:1a:d3:ce:1d:28:55:a1:cb:92:8f:</a>\r\n<a class=\"sourceLine\" id=\"cb4-38\" data-line-number=\"38\">        <span class=\"ex\">73</span>:ed:0e:77:7a:ec:56:97:d4:64:05:c8:05:8f:c8:d8:c5:7c:</a>\r\n<a class=\"sourceLine\" id=\"cb4-39\" data-line-number=\"39\">        <span class=\"ex\">05</span>:24:f8:a4:98:ff:71:48:2d:2d:b3:a5:a2:de:c2:02:62:38:</a>\r\n<a class=\"sourceLine\" id=\"cb4-40\" data-line-number=\"40\">        <span class=\"ex\">a4</span>:88:96:43:84:e2:9b:a4:a5:09:0f:3c:26:57:6b:f5:53:75:</a>\r\n<a class=\"sourceLine\" id=\"cb4-41\" data-line-number=\"41\">        <span class=\"ex\">df</span>:08:c1:8a:ab:a7:26:66:b8:1f:21:26:c8:6c:11:27:10:6e:</a>\r\n<a class=\"sourceLine\" id=\"cb4-42\" data-line-number=\"42\">        <span class=\"ex\">e2</span>:fa:29:7c</a></code></pre></div>\r\n"},{"title":"lamp实战一","copyright":true,"top":60,"date":"2018-02-18T07:49:42.000Z","_content":"\n\n\n这个实战是我在 马哥教育_ 培训中期，给的实战题目，相对比较简单。\n\n.. _马哥教育: http://www.magedu.com/\n\n架构图\n--------------------------------------------------------------\n\n.. image:: /images/web/实战1架构图.png\n\n- dns完成解析web1,web2来实现负载均衡\n- web1,web2使用后台的mysql数据库\n- web1,web2的页面数据全部放在nfs数据上，实现自动挂载\n- nfs服务器为web1,web2提供网页数据\n\n准备工作\n--------------------------------------------------------------\n\n设置ip信息\n\n.. code-block:: bash\n\n    nmcli con add ifname ens33 con-name ens33 type ethernet ipv4.method manual \\\n    ipv4.address 192.158.46.150/24 ipv4.gateway 192.168.46.1\n\n.. note:: 我使用的nmcli修改的ip，当然也是可以手工修改的。\n\n\nansible的配置\n--------------------------------------------------------------\n\n安装ansible\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@localhost ~]# yum install ansible\n\n添加主机\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n需要添加如下内容到/etc/ansible/hosts文件中去。\n\n.. code-block:: ini\n\n    [client]\n    192.168.46.159\n\n    [dns]\n    192.168.46.158\n\n    [web]\n    192.168.46.157\n    192.168.46.156\n    [db]\n    192.168.46.155\n    [nfs]\n    192.168.46.154\n    [self]\n    192.168.46.150\n\n配置免密码登陆\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n这里我之前写有一个脚本自动完成免密码登陆的脚本，参考我的博客_\n\n.. _参考我的博客: http://www.cnblogs.com/zhaojiedi1992/p/zhaojiedi_linux_023_sshgenkey.html\n\n.. code-block:: bash\n\n    [root@localhost ~]# cat hosts.txt \n    192.168.46.150 root oracle\n    192.168.46.151 root oracle\n    192.168.46.152 root oracle\n    192.168.46.153 root oracle\n    192.168.46.154 root oracle\n    192.168.46.155 root oracle\n    192.168.46.156 root oracle\n    192.168.46.157 root oracle\n    192.168.46.158 root oracle\n    192.168.46.159 root oracle\n    192.168.46.160 root oracle\n    [root@localhost ~]# cat mima.sh \n    #!/bin/bash \n    #================================================\n    #FileName   :expect_ssh.sh\n    #Author     :zhaojiedi\n    #Description:\n    #DateTime   :2018-01-05 08:26:06\n    #Version    :V1.0\n    #Other      :\n    #================================================\n    host_username_password_file=hosts.txt\n\n    # install expect \n    rpm -q expect &>/dev/null || yum install -yq expect &>/dev/null\n\n    # create id_rsa.pub file \n    pubkey=~/.ssh/id_rsa.pub\n    if [ ! -e \"$pubkey\" ] ; then\n            ssh-keygen  -P \"\" -t rsa  -f ~/.ssh/id_rsa\n    fi\n    while read host username password ; do\n            con=${username}\"@\"${host}\n            echo $password\n            expect <<EOF\n            set timeout 20 \n            spawn ssh-copy-id $con\n            expect {\n                    \"yes/no\"  { send \"yes\\n\" ; exp_continue }\n                    \"password:\" { send \"${password}\\n\"; exp_continue }\n            }\n    EOF\n    done < $host_username_password_file\n\n    # 执行下脚本，自动完成公钥copy工作了\n    [root@localhost ~]# bash mima.sh \n\n    # 测试下\n    [root@localhost ~]# ssh 192.168.46.151 'ip a show ens33'\n\n设置主机名（可选）\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n我这里的机器全是刚刚克隆出来的虚拟机，为了管理方便设置下主机名，防止误操作。\n\n.. code-block:: bash\n\n    # 创建一个设置主机名的脚本\n    [root@localhost ~]# vim set_hostname.sh \n    [root@localhost ~]# cat set_hostname.sh \n    #!/bin/bash\n    echo \"start\"\n    hostname\n    name=centos-$(ip a show ens33 |grep 'inet.*ens33' | sed -r  -n 's@.*\\.([0-9]{1,3})/.*@\\1@p').linuxpanda.tech\n    echo $name\n    hostnamectl set-hostname $name\n    echo \"end\"\n\n    [root@centos-localhost ~]# ansible all -m script -a '/root/set_hostname.sh'\n\n这个脚本也是设置了ansible主机的ip。\n\n防火墙和selinux关闭\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    # 关闭防火墙\n    [root@centos-150 ~]# ansible all -m service -a 'name=firewalld enabled=no'\n    [root@centos-150 ~]# ansible all -m service -a 'name=firewalld state=stopped'\n\n    [root@centos-150 ~]# ansible all -m shell -a 'sed  -i -r 's@SELINUX=.*@SELINUX=disabled@' /etc/sysconfig/selinux'\n    [root@centos-150 ~]# ansible all -m shell -a  'setenforce 0'\n\n.. note:: 如果原有selinux就是disabled，使用setenforce 0会报错误的，不用管它。\n\ndns主机设置\n-----------------------------------------------------------\n\ndns配置\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# yum install bind bind-utils\n    [root@centos-158 ~]# vim /etc/named.conf\n    # 注释如下5行\n    //      listen-on port 53 { 127.0.0.1; };\n    //      listen-on-v6 port 53 { ::1; };\n    //      allow-query     { localhost; };\n    //      dnssec-enable yes;\n    //      dnssec-validation yes;\n    [root@centos-158 ~]# vim /etc/named.rfc1912.zones \n    # 添加如下内容，注意之后的分号\n    zone \"linuxpanda.tech\" IN {\n            type master;\n            file \"linuxpanda.tech.zone\";\n    };\n    [root@centos-158 ~]# cd /var/named/\n    [root@centos-158 named]# cp -a named.localhost  linuxpanda.tech.zone\n    [root@centos-158 named]# vim linuxpanda.tech.zone \n    [root@centos-158 named]# cat linuxpanda.tech.zone \n    $TTL 1D\n    @\tIN SOA\tns1 admin (\n                        0\t; serial\n                        1D\t; refresh\n                        1H\t; retry\n                        1W\t; expire\n                        3H )\t; minimum\n        NS\tns1\n    ns1     A       192.168.46.158\n    web     A       192.168.46.157\n    web     A       192.168.46.156\n    www     CNAME   web\n\ndns本机测试\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 named]# dig www.linuxpanda.tech @localhost\n\n    ; <<>> DiG 9.9.4-RedHat-9.9.4-51.el7_4.2 <<>> www.linuxpanda.tech @localhost\n    ;; global options: +cmd\n    ;; Got answer:\n    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57957\n    ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 1, ADDITIONAL: 2\n\n    ;; OPT PSEUDOSECTION:\n    ; EDNS: version: 0, flags:; udp: 4096\n    ;; QUESTION SECTION:\n    ;www.linuxpanda.tech.\t\tIN\tA\n\n    ;; ANSWER SECTION:\n    www.linuxpanda.tech.\t86400\tIN\tCNAME\tweb.linuxpanda.tech.\n    web.linuxpanda.tech.\t86400\tIN\tA\t192.168.46.156\n    web.linuxpanda.tech.\t86400\tIN\tA\t192.168.46.157\n\n    ;; AUTHORITY SECTION:\n    linuxpanda.tech.\t86400\tIN\tNS\tns1.linuxpanda.tech.\n\n    ;; ADDITIONAL SECTION:\n    ns1.linuxpanda.tech.\t86400\tIN\tA\t192.168.46.158\n\n    ;; Query time: 0 msec\n    ;; SERVER: 127.0.0.1#53(127.0.0.1)\n    ;; WHEN: Sun Feb 18 21:05:05 CST 2018\n    ;; MSG SIZE  rcvd: 132\n\nclient主机测试\n-----------------------------------------------------------\n\n.. code-block:: bash\n\n    # 修改客户端的dns指向为我们自己的dns主机\n    [root@centos-159 ~]# nmcli con modify  ens33 ipv4.dns 192.168.46.158\n    # 重启网络，或者重新加载\n    [root@centos-159 ~]# service network restart\n\n    # ping下我们的web主机，看是否能解析出来157，156两个ip\n    [root@centos-159 ~]# ping www.linuxpanda.tech\n    PING web.linuxpanda.tech (192.168.46.157) 56(84) bytes of data.\n    64 bytes from 192.168.46.157 (192.168.46.157): icmp_seq=1 ttl=64 time=0.330 ms\n    64 bytes from 192.168.46.157 (192.168.46.157): icmp_seq=2 ttl=64 time=0.255 ms\n    64 bytes from 192.168.46.157 (192.168.46.157): icmp_seq=3 ttl=64 time=0.292 ms\n\n    [root@centos-159 ~]# ping www.linuxpanda.tech\n    PING web.linuxpanda.tech (192.168.46.156) 56(84) bytes of data.\n    64 bytes from 192.168.46.156 (192.168.46.156): icmp_seq=1 ttl=64 time=0.421 ms\n\n.. note:: ping命令去测试有点不专业的，需要多次测试才能2个地址都出现，这里就不安装dig工具了，毕竟客户端。\n\n\nnfs主机配置\n-----------------------------------------------------------\n\n添加用户\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-154 ~]# groupadd -g 48 apache\n    [root@centos-154 ~]# useradd -u 48 -g 48 apache\n    [root@centos-154 ~]# id apache\n    uid=48(apache) gid=48(apache) groups=48(apache)\n\n修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-154 ~]# chown -R apache.apache /data/html\n\n共享出去\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-154 ~]# yum install nfs-utils\n    [root@centos-154 ~]# vim /etc/exports\n    [root@centos-154 ~]# cat /etc/exports\n    /data/html 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)\n    /data/html 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)\n    [root@centos-154 ~]# systemctl restart nfsd\n    [root@centos-154 ~]# exportfs -v \n    /data/html    \t192.168.46.156(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)\n    /data/html    \t192.168.46.157(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)\n\nmysql主机配置\n-----------------------------------------------------------\n\n安装软件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-155 ~]# yum install mariadb-server mariadb\n\n启动服务\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n   \n    [root@centos-155 ~]# systemctl start mariadb\n    [root@centos-155 ~]# netstat -tunlp |grep 3306\n    tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      13680/mysqld \n\n添加应用用户\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: sql\n\n    [root@centos-155 ~]# mysql -u root -p \n    Enter password: \n    Welcome to the MariaDB monitor.  Commands end with ; or \\g.\n    Your MariaDB connection id is 10\n    Server version: 5.5.56-MariaDB MariaDB Server\n\n    Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.\n\n    Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\n    MariaDB [(none)]> create database web ;\n    Query OK, 1 row affected (0.00 sec)\n\n    MariaDB [(none)]> grant all on web.* to web@'192.168.46.%' identified by 'oracle';\n    Query OK, 0 rows affected (0.05 sec)\n\n\n安全初始化\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n    \n    [root@centos-155 ~]# mysql_secure_installation \n\nweb主机配置\n-----------------------------------------------------------\n这里是2个主机。\n\n安装软件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    # 安装\n    [root@centos-150 ~]# ansible web -m yum -a 'name=httpd,php-fpm,php-mysql,mod_fcgid state=installed'\n    # 启动服务\n    [root@centos-150 ~]# ansible web -m service -a 'name=httpd state=started'\n    [root@centos-150 ~]# ansible web -m service -a 'name=php-fpm state=started'\n\n挂载目录\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n\n.. code-block:: bash\n\n    # 安装必要的挂载相关的软件\n    [root@centos-156 httpd]# yum install nfs-utils cifs-utils\n    # 启动rpc服务\n    [root@centos-156 httpd]# systemctl restart rpcbind\n    # 查看远程的导出情况\n    [root@centos-156 httpd]# showmount -e 192.168.46.154\n    Export list for 192.168.46.154:\n    /data/html 192.168.46.157,192.168.46.156\n    # 挂载\n    [root@centos-156 httpd]# mount 192.168.46.154:/data/html /var/www/html\n\n    # 自动挂载\n    [root@centos-156 httpd]# tail -n 1 /etc/mtab\n    192.168.46.154:/data/html /var/www/html nfs4 rw,relatime,vers=4.1,rsize=65536,wsize=65536,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.46.156,local_lock=none,addr=192.168.46.154 0 0\n    [root@centos-156 httpd]# tail -n 1 /etc/mtab >> /etc/fstab\n    # 查看下样例网页\n    [root@centos-156 httpd]# cat /var/www/html/index.html \n    hellow world\n\n配置httpd\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n本部分内容需要在2个机器都要做一遍。\n\n.. code-block:: bash\n\n\n    # 下载一个样例的php页面  \n    [root@centos-156 httpd]# wget download.linuxpanda.tech/lamp/index.php.sample -O /var/www/html/index.php\n    # 编辑下样例php页面的数据库连接用户和密码\n    [root@centos-156 httpd]# vim /var/www/html/index.php\n    [root@centos-156 httpd]# cat /var/www/html/index.php \n    <?php\n    $mysqli=new mysqli(\"192.168.46.155\",\"web\",\"oracle\");\n    if(mysqli_connect_errno()){\n    echo \"失败了\";\n    $mysqli=null;\n    exit;\n    }\n    echo \"成功了\";\n    $mysqli->close();\n    ?>\n\n    # fcgi编辑\n    [root@centos-156 conf.d]# vim fcgid.conf \n    # 添加如下3行\n    DirectoryIndex index.php\n    ProxyRequests Off\n    ProxyPassMatch ^/(.*\\.php)$ fcgi://127.0.0.1:9000/var/www/html/$1\n    # 重启网络服务\n    [root@centos-156 conf.d]# service httpd restart\n\n本机测试\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n本部分内容需要在2个机器都要做一遍。\n\n.. code-block:: bash\n\n    [root@centos-156 conf.d]# curl localhost/index.php\n    成功了\n\n\nclient测试\n-----------------------------------------------------------\n\n.. code-block:: bash\n\n    [root@centos-159 ~]# curl http://www.linuxpanda.tech/index.php\n    成功了\n    # 把156的web停掉\n    [root@centos-159 ~]# curl http://www.linuxpanda.tech/index.php\n    成功了\n    # 再把157的web停掉\n    [root@centos-159 ~]# curl http://www.linuxpanda.tech/index.php\n    curl: (7) Failed connect to www.linuxpanda.tech:80; Connection refused\n\n总结\n-----------------------------------------------------------\n\n这个作业，看起来挺简单的，做起来还是遇到些麻烦的。\n\n需要改进的地方： \n\n#. dns解析太不稳定，如果web1停掉，dns还可能解析到这个停掉的主机，就会导致web没法访问。\n#. mysql实例后面学习了主从可以考虑完善下。\n#. lamp没有使用xcache加速下\n#. 本练习都是使用的yum安装的lamp环境，可以考虑使用编译安装方法。\n#. 数据通过nfs共享，本质还是一个磁盘的数据，可以考虑使用rsync来替代nfs。\n#. 数据文件可以考虑放到raid上，来提供文件的访问性能\n\n\n参考\n-----------------------------------------------------------\n\n我自己在马哥教育笔记1_\n\n我自己在马哥教育笔记2_\n\n.. _我自己在马哥教育笔记1: http://linux.linuxpanda.tech/\n\n.. _我自己在马哥教育笔记2: http://services.linuxpanda.tech/\n","source":"_posts/lamp实战一.rst","raw":"---\ntitle: lamp实战一\ntags:\n  - linux\ncategories: linux\ncopyright: true\ntop: 60\ndate: 2018-02-18 15:49:42\n---\n\n\n\n这个实战是我在 马哥教育_ 培训中期，给的实战题目，相对比较简单。\n\n.. _马哥教育: http://www.magedu.com/\n\n架构图\n--------------------------------------------------------------\n\n.. image:: /images/web/实战1架构图.png\n\n- dns完成解析web1,web2来实现负载均衡\n- web1,web2使用后台的mysql数据库\n- web1,web2的页面数据全部放在nfs数据上，实现自动挂载\n- nfs服务器为web1,web2提供网页数据\n\n准备工作\n--------------------------------------------------------------\n\n设置ip信息\n\n.. code-block:: bash\n\n    nmcli con add ifname ens33 con-name ens33 type ethernet ipv4.method manual \\\n    ipv4.address 192.158.46.150/24 ipv4.gateway 192.168.46.1\n\n.. note:: 我使用的nmcli修改的ip，当然也是可以手工修改的。\n\n\nansible的配置\n--------------------------------------------------------------\n\n安装ansible\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@localhost ~]# yum install ansible\n\n添加主机\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n需要添加如下内容到/etc/ansible/hosts文件中去。\n\n.. code-block:: ini\n\n    [client]\n    192.168.46.159\n\n    [dns]\n    192.168.46.158\n\n    [web]\n    192.168.46.157\n    192.168.46.156\n    [db]\n    192.168.46.155\n    [nfs]\n    192.168.46.154\n    [self]\n    192.168.46.150\n\n配置免密码登陆\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n这里我之前写有一个脚本自动完成免密码登陆的脚本，参考我的博客_\n\n.. _参考我的博客: http://www.cnblogs.com/zhaojiedi1992/p/zhaojiedi_linux_023_sshgenkey.html\n\n.. code-block:: bash\n\n    [root@localhost ~]# cat hosts.txt \n    192.168.46.150 root oracle\n    192.168.46.151 root oracle\n    192.168.46.152 root oracle\n    192.168.46.153 root oracle\n    192.168.46.154 root oracle\n    192.168.46.155 root oracle\n    192.168.46.156 root oracle\n    192.168.46.157 root oracle\n    192.168.46.158 root oracle\n    192.168.46.159 root oracle\n    192.168.46.160 root oracle\n    [root@localhost ~]# cat mima.sh \n    #!/bin/bash \n    #================================================\n    #FileName   :expect_ssh.sh\n    #Author     :zhaojiedi\n    #Description:\n    #DateTime   :2018-01-05 08:26:06\n    #Version    :V1.0\n    #Other      :\n    #================================================\n    host_username_password_file=hosts.txt\n\n    # install expect \n    rpm -q expect &>/dev/null || yum install -yq expect &>/dev/null\n\n    # create id_rsa.pub file \n    pubkey=~/.ssh/id_rsa.pub\n    if [ ! -e \"$pubkey\" ] ; then\n            ssh-keygen  -P \"\" -t rsa  -f ~/.ssh/id_rsa\n    fi\n    while read host username password ; do\n            con=${username}\"@\"${host}\n            echo $password\n            expect <<EOF\n            set timeout 20 \n            spawn ssh-copy-id $con\n            expect {\n                    \"yes/no\"  { send \"yes\\n\" ; exp_continue }\n                    \"password:\" { send \"${password}\\n\"; exp_continue }\n            }\n    EOF\n    done < $host_username_password_file\n\n    # 执行下脚本，自动完成公钥copy工作了\n    [root@localhost ~]# bash mima.sh \n\n    # 测试下\n    [root@localhost ~]# ssh 192.168.46.151 'ip a show ens33'\n\n设置主机名（可选）\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n我这里的机器全是刚刚克隆出来的虚拟机，为了管理方便设置下主机名，防止误操作。\n\n.. code-block:: bash\n\n    # 创建一个设置主机名的脚本\n    [root@localhost ~]# vim set_hostname.sh \n    [root@localhost ~]# cat set_hostname.sh \n    #!/bin/bash\n    echo \"start\"\n    hostname\n    name=centos-$(ip a show ens33 |grep 'inet.*ens33' | sed -r  -n 's@.*\\.([0-9]{1,3})/.*@\\1@p').linuxpanda.tech\n    echo $name\n    hostnamectl set-hostname $name\n    echo \"end\"\n\n    [root@centos-localhost ~]# ansible all -m script -a '/root/set_hostname.sh'\n\n这个脚本也是设置了ansible主机的ip。\n\n防火墙和selinux关闭\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    # 关闭防火墙\n    [root@centos-150 ~]# ansible all -m service -a 'name=firewalld enabled=no'\n    [root@centos-150 ~]# ansible all -m service -a 'name=firewalld state=stopped'\n\n    [root@centos-150 ~]# ansible all -m shell -a 'sed  -i -r 's@SELINUX=.*@SELINUX=disabled@' /etc/sysconfig/selinux'\n    [root@centos-150 ~]# ansible all -m shell -a  'setenforce 0'\n\n.. note:: 如果原有selinux就是disabled，使用setenforce 0会报错误的，不用管它。\n\ndns主机设置\n-----------------------------------------------------------\n\ndns配置\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# yum install bind bind-utils\n    [root@centos-158 ~]# vim /etc/named.conf\n    # 注释如下5行\n    //      listen-on port 53 { 127.0.0.1; };\n    //      listen-on-v6 port 53 { ::1; };\n    //      allow-query     { localhost; };\n    //      dnssec-enable yes;\n    //      dnssec-validation yes;\n    [root@centos-158 ~]# vim /etc/named.rfc1912.zones \n    # 添加如下内容，注意之后的分号\n    zone \"linuxpanda.tech\" IN {\n            type master;\n            file \"linuxpanda.tech.zone\";\n    };\n    [root@centos-158 ~]# cd /var/named/\n    [root@centos-158 named]# cp -a named.localhost  linuxpanda.tech.zone\n    [root@centos-158 named]# vim linuxpanda.tech.zone \n    [root@centos-158 named]# cat linuxpanda.tech.zone \n    $TTL 1D\n    @\tIN SOA\tns1 admin (\n                        0\t; serial\n                        1D\t; refresh\n                        1H\t; retry\n                        1W\t; expire\n                        3H )\t; minimum\n        NS\tns1\n    ns1     A       192.168.46.158\n    web     A       192.168.46.157\n    web     A       192.168.46.156\n    www     CNAME   web\n\ndns本机测试\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 named]# dig www.linuxpanda.tech @localhost\n\n    ; <<>> DiG 9.9.4-RedHat-9.9.4-51.el7_4.2 <<>> www.linuxpanda.tech @localhost\n    ;; global options: +cmd\n    ;; Got answer:\n    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 57957\n    ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 1, ADDITIONAL: 2\n\n    ;; OPT PSEUDOSECTION:\n    ; EDNS: version: 0, flags:; udp: 4096\n    ;; QUESTION SECTION:\n    ;www.linuxpanda.tech.\t\tIN\tA\n\n    ;; ANSWER SECTION:\n    www.linuxpanda.tech.\t86400\tIN\tCNAME\tweb.linuxpanda.tech.\n    web.linuxpanda.tech.\t86400\tIN\tA\t192.168.46.156\n    web.linuxpanda.tech.\t86400\tIN\tA\t192.168.46.157\n\n    ;; AUTHORITY SECTION:\n    linuxpanda.tech.\t86400\tIN\tNS\tns1.linuxpanda.tech.\n\n    ;; ADDITIONAL SECTION:\n    ns1.linuxpanda.tech.\t86400\tIN\tA\t192.168.46.158\n\n    ;; Query time: 0 msec\n    ;; SERVER: 127.0.0.1#53(127.0.0.1)\n    ;; WHEN: Sun Feb 18 21:05:05 CST 2018\n    ;; MSG SIZE  rcvd: 132\n\nclient主机测试\n-----------------------------------------------------------\n\n.. code-block:: bash\n\n    # 修改客户端的dns指向为我们自己的dns主机\n    [root@centos-159 ~]# nmcli con modify  ens33 ipv4.dns 192.168.46.158\n    # 重启网络，或者重新加载\n    [root@centos-159 ~]# service network restart\n\n    # ping下我们的web主机，看是否能解析出来157，156两个ip\n    [root@centos-159 ~]# ping www.linuxpanda.tech\n    PING web.linuxpanda.tech (192.168.46.157) 56(84) bytes of data.\n    64 bytes from 192.168.46.157 (192.168.46.157): icmp_seq=1 ttl=64 time=0.330 ms\n    64 bytes from 192.168.46.157 (192.168.46.157): icmp_seq=2 ttl=64 time=0.255 ms\n    64 bytes from 192.168.46.157 (192.168.46.157): icmp_seq=3 ttl=64 time=0.292 ms\n\n    [root@centos-159 ~]# ping www.linuxpanda.tech\n    PING web.linuxpanda.tech (192.168.46.156) 56(84) bytes of data.\n    64 bytes from 192.168.46.156 (192.168.46.156): icmp_seq=1 ttl=64 time=0.421 ms\n\n.. note:: ping命令去测试有点不专业的，需要多次测试才能2个地址都出现，这里就不安装dig工具了，毕竟客户端。\n\n\nnfs主机配置\n-----------------------------------------------------------\n\n添加用户\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-154 ~]# groupadd -g 48 apache\n    [root@centos-154 ~]# useradd -u 48 -g 48 apache\n    [root@centos-154 ~]# id apache\n    uid=48(apache) gid=48(apache) groups=48(apache)\n\n修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-154 ~]# chown -R apache.apache /data/html\n\n共享出去\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-154 ~]# yum install nfs-utils\n    [root@centos-154 ~]# vim /etc/exports\n    [root@centos-154 ~]# cat /etc/exports\n    /data/html 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)\n    /data/html 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)\n    [root@centos-154 ~]# systemctl restart nfsd\n    [root@centos-154 ~]# exportfs -v \n    /data/html    \t192.168.46.156(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)\n    /data/html    \t192.168.46.157(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)\n\nmysql主机配置\n-----------------------------------------------------------\n\n安装软件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-155 ~]# yum install mariadb-server mariadb\n\n启动服务\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n   \n    [root@centos-155 ~]# systemctl start mariadb\n    [root@centos-155 ~]# netstat -tunlp |grep 3306\n    tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      13680/mysqld \n\n添加应用用户\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: sql\n\n    [root@centos-155 ~]# mysql -u root -p \n    Enter password: \n    Welcome to the MariaDB monitor.  Commands end with ; or \\g.\n    Your MariaDB connection id is 10\n    Server version: 5.5.56-MariaDB MariaDB Server\n\n    Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.\n\n    Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\n    MariaDB [(none)]> create database web ;\n    Query OK, 1 row affected (0.00 sec)\n\n    MariaDB [(none)]> grant all on web.* to web@'192.168.46.%' identified by 'oracle';\n    Query OK, 0 rows affected (0.05 sec)\n\n\n安全初始化\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n    \n    [root@centos-155 ~]# mysql_secure_installation \n\nweb主机配置\n-----------------------------------------------------------\n这里是2个主机。\n\n安装软件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    # 安装\n    [root@centos-150 ~]# ansible web -m yum -a 'name=httpd,php-fpm,php-mysql,mod_fcgid state=installed'\n    # 启动服务\n    [root@centos-150 ~]# ansible web -m service -a 'name=httpd state=started'\n    [root@centos-150 ~]# ansible web -m service -a 'name=php-fpm state=started'\n\n挂载目录\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n\n.. code-block:: bash\n\n    # 安装必要的挂载相关的软件\n    [root@centos-156 httpd]# yum install nfs-utils cifs-utils\n    # 启动rpc服务\n    [root@centos-156 httpd]# systemctl restart rpcbind\n    # 查看远程的导出情况\n    [root@centos-156 httpd]# showmount -e 192.168.46.154\n    Export list for 192.168.46.154:\n    /data/html 192.168.46.157,192.168.46.156\n    # 挂载\n    [root@centos-156 httpd]# mount 192.168.46.154:/data/html /var/www/html\n\n    # 自动挂载\n    [root@centos-156 httpd]# tail -n 1 /etc/mtab\n    192.168.46.154:/data/html /var/www/html nfs4 rw,relatime,vers=4.1,rsize=65536,wsize=65536,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.46.156,local_lock=none,addr=192.168.46.154 0 0\n    [root@centos-156 httpd]# tail -n 1 /etc/mtab >> /etc/fstab\n    # 查看下样例网页\n    [root@centos-156 httpd]# cat /var/www/html/index.html \n    hellow world\n\n配置httpd\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n本部分内容需要在2个机器都要做一遍。\n\n.. code-block:: bash\n\n\n    # 下载一个样例的php页面  \n    [root@centos-156 httpd]# wget download.linuxpanda.tech/lamp/index.php.sample -O /var/www/html/index.php\n    # 编辑下样例php页面的数据库连接用户和密码\n    [root@centos-156 httpd]# vim /var/www/html/index.php\n    [root@centos-156 httpd]# cat /var/www/html/index.php \n    <?php\n    $mysqli=new mysqli(\"192.168.46.155\",\"web\",\"oracle\");\n    if(mysqli_connect_errno()){\n    echo \"失败了\";\n    $mysqli=null;\n    exit;\n    }\n    echo \"成功了\";\n    $mysqli->close();\n    ?>\n\n    # fcgi编辑\n    [root@centos-156 conf.d]# vim fcgid.conf \n    # 添加如下3行\n    DirectoryIndex index.php\n    ProxyRequests Off\n    ProxyPassMatch ^/(.*\\.php)$ fcgi://127.0.0.1:9000/var/www/html/$1\n    # 重启网络服务\n    [root@centos-156 conf.d]# service httpd restart\n\n本机测试\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n本部分内容需要在2个机器都要做一遍。\n\n.. code-block:: bash\n\n    [root@centos-156 conf.d]# curl localhost/index.php\n    成功了\n\n\nclient测试\n-----------------------------------------------------------\n\n.. code-block:: bash\n\n    [root@centos-159 ~]# curl http://www.linuxpanda.tech/index.php\n    成功了\n    # 把156的web停掉\n    [root@centos-159 ~]# curl http://www.linuxpanda.tech/index.php\n    成功了\n    # 再把157的web停掉\n    [root@centos-159 ~]# curl http://www.linuxpanda.tech/index.php\n    curl: (7) Failed connect to www.linuxpanda.tech:80; Connection refused\n\n总结\n-----------------------------------------------------------\n\n这个作业，看起来挺简单的，做起来还是遇到些麻烦的。\n\n需要改进的地方： \n\n#. dns解析太不稳定，如果web1停掉，dns还可能解析到这个停掉的主机，就会导致web没法访问。\n#. mysql实例后面学习了主从可以考虑完善下。\n#. lamp没有使用xcache加速下\n#. 本练习都是使用的yum安装的lamp环境，可以考虑使用编译安装方法。\n#. 数据通过nfs共享，本质还是一个磁盘的数据，可以考虑使用rsync来替代nfs。\n#. 数据文件可以考虑放到raid上，来提供文件的访问性能\n\n\n参考\n-----------------------------------------------------------\n\n我自己在马哥教育笔记1_\n\n我自己在马哥教育笔记2_\n\n.. _我自己在马哥教育笔记1: http://linux.linuxpanda.tech/\n\n.. _我自己在马哥教育笔记2: http://services.linuxpanda.tech/\n","slug":"lamp实战一","published":1,"updated":"2018-02-18T08:10:14.256Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mnb0006ugtmzshf5x1y","content":"<p>这个实战是我在 <a href=\"http://www.magedu.com/\" target=\"_blank\" rel=\"noopener\">马哥教育</a> 培训中期，给的实战题目，相对比较简单。</p>\r\n<h2 id=\"架构图\">架构图</h2>\r\n<p><img src=\"/images/web/实战1架构图.png\" alt=\"image\"></p>\r\n<ul>\r\n<li>dns完成解析web1,web2来实现负载均衡</li>\r\n<li>web1,web2使用后台的mysql数据库</li>\r\n<li>web1,web2的页面数据全部放在nfs数据上，实现自动挂载</li>\r\n<li>nfs服务器为web1,web2提供网页数据</li>\r\n</ul>\r\n<h2 id=\"准备工作\">准备工作</h2>\r\n<p>设置ip信息</p>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\"><span class=\"ex\">nmcli</span> con add ifname ens33 con-name ens33 type ethernet ipv4.method manual \\</a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\">ipv4.address 192.158.46.150/24 ipv4.gateway 192.168.46.1</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>我使用的nmcli修改的ip，当然也是可以手工修改的。</p>\r\n</div>\r\n<h2 id=\"ansible的配置\">ansible的配置</h2>\r\n<h3 id=\"安装ansible\">安装ansible</h3>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> ~]# yum install ansible</a></code></pre></div>\r\n<h3 id=\"添加主机\">添加主机</h3>\r\n<p>需要添加如下内容到/etc/ansible/hosts文件中去。</p>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode ini\"><code class=\"sourceCode ini\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\"><span class=\"kw\">[client]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\"><span class=\"dt\">192.168.46.159</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"kw\">[dns]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"dt\">192.168.46.158</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\"><span class=\"kw\">[web]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\"><span class=\"dt\">192.168.46.157</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\"><span class=\"dt\">192.168.46.156</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\"><span class=\"kw\">[db]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\"><span class=\"dt\">192.168.46.155</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\"><span class=\"kw\">[nfs]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\"><span class=\"dt\">192.168.46.154</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-14\" data-line-number=\"14\"><span class=\"kw\">[self]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-15\" data-line-number=\"15\"><span class=\"dt\">192.168.46.150</span></a></code></pre></div>\r\n<h3 id=\"配置免密码登陆\">配置免密码登陆</h3>\r\n<p>这里我之前写有一个脚本自动完成免密码登陆的脚本，参考我的博客_</p>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> ~]# cat hosts.txt </a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\"><span class=\"ex\">192.168.46.150</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-3\" data-line-number=\"3\"><span class=\"ex\">192.168.46.151</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-4\" data-line-number=\"4\"><span class=\"ex\">192.168.46.152</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-5\" data-line-number=\"5\"><span class=\"ex\">192.168.46.153</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-6\" data-line-number=\"6\"><span class=\"ex\">192.168.46.154</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-7\" data-line-number=\"7\"><span class=\"ex\">192.168.46.155</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-8\" data-line-number=\"8\"><span class=\"ex\">192.168.46.156</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-9\" data-line-number=\"9\"><span class=\"ex\">192.168.46.157</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-10\" data-line-number=\"10\"><span class=\"ex\">192.168.46.158</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-11\" data-line-number=\"11\"><span class=\"ex\">192.168.46.159</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-12\" data-line-number=\"12\"><span class=\"ex\">192.168.46.160</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-13\" data-line-number=\"13\">[<span class=\"ex\">root@localhost</span> ~]# cat mima.sh </a>\r\n<a class=\"sourceLine\" id=\"cb4-14\" data-line-number=\"14\"><span class=\"co\">#!/bin/bash </span></a>\r\n<a class=\"sourceLine\" id=\"cb4-15\" data-line-number=\"15\"><span class=\"co\">#================================================</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-16\" data-line-number=\"16\"><span class=\"co\">#FileName   :expect_ssh.sh</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-17\" data-line-number=\"17\"><span class=\"co\">#Author     :zhaojiedi</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-18\" data-line-number=\"18\"><span class=\"co\">#Description:</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-19\" data-line-number=\"19\"><span class=\"co\">#DateTime   :2018-01-05 08:26:06</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-20\" data-line-number=\"20\"><span class=\"co\">#Version    :V1.0</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-21\" data-line-number=\"21\"><span class=\"co\">#Other      :</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-22\" data-line-number=\"22\"><span class=\"co\">#================================================</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-23\" data-line-number=\"23\"><span class=\"va\">host_username_password_file=</span>hosts.txt</a>\r\n<a class=\"sourceLine\" id=\"cb4-24\" data-line-number=\"24\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-25\" data-line-number=\"25\"><span class=\"co\"># install expect </span></a>\r\n<a class=\"sourceLine\" id=\"cb4-26\" data-line-number=\"26\"><span class=\"ex\">rpm</span> -q expect <span class=\"op\">&amp;&gt;</span>/dev/null <span class=\"kw\">||</span> <span class=\"ex\">yum</span> install -yq expect <span class=\"op\">&amp;&gt;</span>/dev/null</a>\r\n<a class=\"sourceLine\" id=\"cb4-27\" data-line-number=\"27\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-28\" data-line-number=\"28\"><span class=\"co\"># create id_rsa.pub file </span></a>\r\n<a class=\"sourceLine\" id=\"cb4-29\" data-line-number=\"29\"><span class=\"va\">pubkey=</span>~/.ssh/id_rsa.pub</a>\r\n<a class=\"sourceLine\" id=\"cb4-30\" data-line-number=\"30\"><span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$pubkey</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span> ; <span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-31\" data-line-number=\"31\">        <span class=\"fu\">ssh-keygen</span>  -P <span class=\"st\">&quot;&quot;</span> -t rsa  -f ~/.ssh/id_rsa</a>\r\n<a class=\"sourceLine\" id=\"cb4-32\" data-line-number=\"32\"><span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-33\" data-line-number=\"33\"><span class=\"kw\">while</span> <span class=\"bu\">read</span> <span class=\"va\">host</span> <span class=\"va\">username</span> <span class=\"va\">password</span> ; <span class=\"kw\">do</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-34\" data-line-number=\"34\">        <span class=\"va\">con=${username}</span><span class=\"st\">&quot;@&quot;</span><span class=\"va\">${host}</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-35\" data-line-number=\"35\">        <span class=\"bu\">echo</span> <span class=\"va\">$password</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-36\" data-line-number=\"36\">        <span class=\"ex\">expect</span> <span class=\"op\">&lt;&lt;EOF</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-37\" data-line-number=\"37\">        set timeout 20 </a>\r\n<a class=\"sourceLine\" id=\"cb4-38\" data-line-number=\"38\">        spawn ssh-copy-id <span class=\"va\">$con</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-39\" data-line-number=\"39\">        expect {</a>\r\n<a class=\"sourceLine\" id=\"cb4-40\" data-line-number=\"40\">                &quot;yes/no&quot;  { send &quot;yes\\n&quot; ; exp_continue }</a>\r\n<a class=\"sourceLine\" id=\"cb4-41\" data-line-number=\"41\">                &quot;password:&quot; { send &quot;<span class=\"va\">${password}</span>\\n&quot;; exp_continue }</a>\r\n<a class=\"sourceLine\" id=\"cb4-42\" data-line-number=\"42\">        }</a>\r\n<a class=\"sourceLine\" id=\"cb4-43\" data-line-number=\"43\">EOF</a>\r\n<a class=\"sourceLine\" id=\"cb4-44\" data-line-number=\"44\">done &lt; <span class=\"va\">$host_username_password_file</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-45\" data-line-number=\"45\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-46\" data-line-number=\"46\"># 执行下脚本，自动完成公钥copy工作了</a>\r\n<a class=\"sourceLine\" id=\"cb4-47\" data-line-number=\"47\">[root@localhost ~]# bash mima.sh </a>\r\n<a class=\"sourceLine\" id=\"cb4-48\" data-line-number=\"48\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-49\" data-line-number=\"49\"># 测试下</a>\r\n<a class=\"sourceLine\" id=\"cb4-50\" data-line-number=\"50\">[root@localhost ~]# ssh 192.168.46.151 &#39;ip a show ens33&#39;</a></code></pre></div>\r\n<h3 id=\"设置主机名可选\">设置主机名（可选）</h3>\r\n<p>我这里的机器全是刚刚克隆出来的虚拟机，为了管理方便设置下主机名，防止误操作。</p>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\"><span class=\"co\"># 创建一个设置主机名的脚本</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\">[<span class=\"ex\">root@localhost</span> ~]# vim set_hostname.sh </a>\r\n<a class=\"sourceLine\" id=\"cb5-3\" data-line-number=\"3\">[<span class=\"ex\">root@localhost</span> ~]# cat set_hostname.sh </a>\r\n<a class=\"sourceLine\" id=\"cb5-4\" data-line-number=\"4\"><span class=\"co\">#!/bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-5\" data-line-number=\"5\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;start&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-6\" data-line-number=\"6\"><span class=\"fu\">hostname</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-7\" data-line-number=\"7\"><span class=\"va\">name=</span>centos-<span class=\"va\">$(</span><span class=\"ex\">ip</span> a show ens33 <span class=\"kw\">|</span><span class=\"fu\">grep</span> <span class=\"st\">&#39;inet.*ens33&#39;</span> <span class=\"kw\">|</span> <span class=\"fu\">sed</span> -r  -n <span class=\"st\">&#39;s@.*\\.([0-9]{1,3})/.*@\\1@p&#39;</span><span class=\"va\">)</span>.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb5-8\" data-line-number=\"8\"><span class=\"bu\">echo</span> <span class=\"va\">$name</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-9\" data-line-number=\"9\"><span class=\"ex\">hostnamectl</span> set-hostname <span class=\"va\">$name</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-10\" data-line-number=\"10\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;end&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb5-12\" data-line-number=\"12\">[<span class=\"ex\">root@centos-localhost</span> ~]# ansible all -m script -a <span class=\"st\">&#39;/root/set_hostname.sh&#39;</span></a></code></pre></div>\r\n<p>这个脚本也是设置了ansible主机的ip。</p>\r\n<h3 id=\"防火墙和selinux关闭\">防火墙和selinux关闭</h3>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\"><span class=\"co\"># 关闭防火墙</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m service -a <span class=\"st\">&#39;name=firewalld enabled=no&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m service -a <span class=\"st\">&#39;name=firewalld state=stopped&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-4\" data-line-number=\"4\"></a>\r\n<a class=\"sourceLine\" id=\"cb6-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m shell -a <span class=\"st\">&#39;sed  -i -r &#39;</span>s@SELINUX=.*@SELINUX=disabled@<span class=\"st\">&#39; /etc/sysconfig/selinux&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m shell -a  <span class=\"st\">&#39;setenforce 0&#39;</span></a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>如果原有selinux就是disabled，使用setenforce 0会报错误的，不用管它。</p>\r\n</div>\r\n<h2 id=\"dns主机设置\">dns主机设置</h2>\r\n<h3 id=\"dns配置\">dns配置</h3>\r\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb7-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# yum install bind bind-utils</a>\r\n<a class=\"sourceLine\" id=\"cb7-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# vim /etc/named.conf</a>\r\n<a class=\"sourceLine\" id=\"cb7-3\" data-line-number=\"3\"><span class=\"co\"># 注释如下5行</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-4\" data-line-number=\"4\"><span class=\"ex\">//</span>      listen-on port 53 { 127.0.0.1<span class=\"kw\">;</span> };</a>\r\n<a class=\"sourceLine\" id=\"cb7-5\" data-line-number=\"5\"><span class=\"ex\">//</span>      listen-on-v6 port 53 { ::1<span class=\"kw\">;</span> };</a>\r\n<a class=\"sourceLine\" id=\"cb7-6\" data-line-number=\"6\"><span class=\"ex\">//</span>      allow-query     { localhost<span class=\"kw\">;</span> };</a>\r\n<a class=\"sourceLine\" id=\"cb7-7\" data-line-number=\"7\"><span class=\"ex\">//</span>      dnssec-enable yes<span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-8\" data-line-number=\"8\"><span class=\"ex\">//</span>      dnssec-validation yes<span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-9\" data-line-number=\"9\">[<span class=\"ex\">root@centos-158</span> ~]# vim /etc/named.rfc1912.zones </a>\r\n<a class=\"sourceLine\" id=\"cb7-10\" data-line-number=\"10\"><span class=\"co\"># 添加如下内容，注意之后的分号</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-11\" data-line-number=\"11\"><span class=\"ex\">zone</span> <span class=\"st\">&quot;linuxpanda.tech&quot;</span> IN {</a>\r\n<a class=\"sourceLine\" id=\"cb7-12\" data-line-number=\"12\">        <span class=\"bu\">type</span> master<span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-13\" data-line-number=\"13\">        <span class=\"fu\">file</span> <span class=\"st\">&quot;linuxpanda.tech.zone&quot;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-14\" data-line-number=\"14\">};</a>\r\n<a class=\"sourceLine\" id=\"cb7-15\" data-line-number=\"15\">[<span class=\"ex\">root@centos-158</span> ~]# cd /var/named/</a>\r\n<a class=\"sourceLine\" id=\"cb7-16\" data-line-number=\"16\">[<span class=\"ex\">root@centos-158</span> named]# cp -a named.localhost  linuxpanda.tech.zone</a>\r\n<a class=\"sourceLine\" id=\"cb7-17\" data-line-number=\"17\">[<span class=\"ex\">root@centos-158</span> named]# vim linuxpanda.tech.zone </a>\r\n<a class=\"sourceLine\" id=\"cb7-18\" data-line-number=\"18\">[<span class=\"ex\">root@centos-158</span> named]# cat linuxpanda.tech.zone </a>\r\n<a class=\"sourceLine\" id=\"cb7-19\" data-line-number=\"19\"><span class=\"va\">$TTL</span> <span class=\"ex\">1D</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-20\" data-line-number=\"20\"><span class=\"ex\">@</span>   IN SOA  ns1 admin (</a>\r\n<a class=\"sourceLine\" id=\"cb7-21\" data-line-number=\"21\">                    <span class=\"ex\">0</span>   <span class=\"kw\">;</span> <span class=\"ex\">serial</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-22\" data-line-number=\"22\">                    <span class=\"ex\">1D</span>  <span class=\"kw\">;</span> <span class=\"ex\">refresh</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-23\" data-line-number=\"23\">                    <span class=\"ex\">1H</span>  <span class=\"kw\">;</span> <span class=\"ex\">retry</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-24\" data-line-number=\"24\">                    <span class=\"ex\">1W</span>  <span class=\"kw\">;</span> <span class=\"ex\">expire</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-25\" data-line-number=\"25\">                    <span class=\"ex\">3H</span> )    ; <span class=\"ex\">minimum</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-26\" data-line-number=\"26\">    <span class=\"ex\">NS</span>  ns1</a>\r\n<a class=\"sourceLine\" id=\"cb7-27\" data-line-number=\"27\"><span class=\"ex\">ns1</span>     A       192.168.46.158</a>\r\n<a class=\"sourceLine\" id=\"cb7-28\" data-line-number=\"28\"><span class=\"ex\">web</span>     A       192.168.46.157</a>\r\n<a class=\"sourceLine\" id=\"cb7-29\" data-line-number=\"29\"><span class=\"ex\">web</span>     A       192.168.46.156</a>\r\n<a class=\"sourceLine\" id=\"cb7-30\" data-line-number=\"30\"><span class=\"ex\">www</span>     CNAME   web</a></code></pre></div>\r\n<h3 id=\"dns本机测试\">dns本机测试</h3>\r\n<div class=\"sourceCode\" id=\"cb8\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb8-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> named]# dig www.linuxpanda.tech @localhost</a>\r\n<a class=\"sourceLine\" id=\"cb8-2\" data-line-number=\"2\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-3\" data-line-number=\"3\">; <span class=\"op\">&lt;&lt;&gt;&gt;</span> <span class=\"ex\">DiG</span> 9.9.4-RedHat-9.9.4-51.el7_4.2 <span class=\"op\">&lt;&lt;&gt;&gt;</span> www.linuxpanda.tech @localhost</a>\r\n<a class=\"sourceLine\" id=\"cb8-4\" data-line-number=\"4\">;; <span class=\"ex\">global</span> options: +cmd</a>\r\n<a class=\"sourceLine\" id=\"cb8-5\" data-line-number=\"5\">;; <span class=\"ex\">Got</span> answer:</a>\r\n<a class=\"sourceLine\" id=\"cb8-6\" data-line-number=\"6\">;; <span class=\"ex\">-</span><span class=\"op\">&gt;&gt;</span>HEADER<span class=\"op\">&lt;&lt;- opcode:</span> <span class=\"ex\">QUERY</span>, status: NOERROR, id: 57957</a>\r\n<a class=\"sourceLine\" id=\"cb8-7\" data-line-number=\"7\">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 1, ADDITIONAL: 2</a>\r\n<a class=\"sourceLine\" id=\"cb8-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-9\" data-line-number=\"9\">;; OPT PSEUDOSECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-10\" data-line-number=\"10\">; EDNS: version: 0, flags:; udp: 4096</a>\r\n<a class=\"sourceLine\" id=\"cb8-11\" data-line-number=\"11\">;; QUESTION SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-12\" data-line-number=\"12\">;www.linuxpanda.tech.       IN  A</a>\r\n<a class=\"sourceLine\" id=\"cb8-13\" data-line-number=\"13\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-14\" data-line-number=\"14\">;; ANSWER SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-15\" data-line-number=\"15\">www.linuxpanda.tech.    86400   IN  CNAME   web.linuxpanda.tech.</a>\r\n<a class=\"sourceLine\" id=\"cb8-16\" data-line-number=\"16\">web.linuxpanda.tech.    86400   IN  A   192.168.46.156</a>\r\n<a class=\"sourceLine\" id=\"cb8-17\" data-line-number=\"17\">web.linuxpanda.tech.    86400   IN  A   192.168.46.157</a>\r\n<a class=\"sourceLine\" id=\"cb8-18\" data-line-number=\"18\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-19\" data-line-number=\"19\">;; AUTHORITY SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-20\" data-line-number=\"20\">linuxpanda.tech.    86400   IN  NS  ns1.linuxpanda.tech.</a>\r\n<a class=\"sourceLine\" id=\"cb8-21\" data-line-number=\"21\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-22\" data-line-number=\"22\">;; ADDITIONAL SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-23\" data-line-number=\"23\">ns1.linuxpanda.tech.    86400   IN  A   192.168.46.158</a>\r\n<a class=\"sourceLine\" id=\"cb8-24\" data-line-number=\"24\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-25\" data-line-number=\"25\">;; Query time: 0 msec</a>\r\n<a class=\"sourceLine\" id=\"cb8-26\" data-line-number=\"26\">;; SERVER: 127.0.0.1#53(127.0.0.1)</a>\r\n<a class=\"sourceLine\" id=\"cb8-27\" data-line-number=\"27\">;; WHEN: Sun Feb 18 21:05:05 CST 2018</a>\r\n<a class=\"sourceLine\" id=\"cb8-28\" data-line-number=\"28\">;; MSG SIZE  rcvd: 132</a></code></pre></div>\r\n<h2 id=\"client主机测试\">client主机测试</h2>\r\n<div class=\"sourceCode\" id=\"cb9\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb9-1\" data-line-number=\"1\"><span class=\"co\"># 修改客户端的dns指向为我们自己的dns主机</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-159</span> ~]# nmcli con modify  ens33 ipv4.dns 192.168.46.158</a>\r\n<a class=\"sourceLine\" id=\"cb9-3\" data-line-number=\"3\"><span class=\"co\"># 重启网络，或者重新加载</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-159</span> ~]# service network restart</a>\r\n<a class=\"sourceLine\" id=\"cb9-5\" data-line-number=\"5\"></a>\r\n<a class=\"sourceLine\" id=\"cb9-6\" data-line-number=\"6\"><span class=\"co\"># ping下我们的web主机，看是否能解析出来157，156两个ip</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-159</span> ~]# ping www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb9-8\" data-line-number=\"8\"><span class=\"ex\">PING</span> web.linuxpanda.tech (192.168.46.157) <span class=\"ex\">56</span>(84) <span class=\"ex\">bytes</span> of data.</a>\r\n<a class=\"sourceLine\" id=\"cb9-9\" data-line-number=\"9\"><span class=\"ex\">64</span> bytes from 192.168.46.157 (192.168.46.157)<span class=\"bu\">:</span> icmp_seq=1 ttl=64 time=0.330 ms</a>\r\n<a class=\"sourceLine\" id=\"cb9-10\" data-line-number=\"10\"><span class=\"ex\">64</span> bytes from 192.168.46.157 (192.168.46.157)<span class=\"bu\">:</span> icmp_seq=2 ttl=64 time=0.255 ms</a>\r\n<a class=\"sourceLine\" id=\"cb9-11\" data-line-number=\"11\"><span class=\"ex\">64</span> bytes from 192.168.46.157 (192.168.46.157)<span class=\"bu\">:</span> icmp_seq=3 ttl=64 time=0.292 ms</a>\r\n<a class=\"sourceLine\" id=\"cb9-12\" data-line-number=\"12\"></a>\r\n<a class=\"sourceLine\" id=\"cb9-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-159</span> ~]# ping www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb9-14\" data-line-number=\"14\"><span class=\"ex\">PING</span> web.linuxpanda.tech (192.168.46.156) <span class=\"ex\">56</span>(84) <span class=\"ex\">bytes</span> of data.</a>\r\n<a class=\"sourceLine\" id=\"cb9-15\" data-line-number=\"15\"><span class=\"ex\">64</span> bytes from 192.168.46.156 (192.168.46.156)<span class=\"bu\">:</span> icmp_seq=1 ttl=64 time=0.421 ms</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>ping命令去测试有点不专业的，需要多次测试才能2个地址都出现，这里就不安装dig工具了，毕竟客户端。</p>\r\n</div>\r\n<h2 id=\"nfs主机配置\">nfs主机配置</h2>\r\n<h3 id=\"添加用户\">添加用户</h3>\r\n<div class=\"sourceCode\" id=\"cb10\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb10-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-154</span> ~]# groupadd -g 48 apache</a>\r\n<a class=\"sourceLine\" id=\"cb10-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-154</span> ~]# useradd -u 48 -g 48 apache</a>\r\n<a class=\"sourceLine\" id=\"cb10-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-154</span> ~]# id apache</a>\r\n<a class=\"sourceLine\" id=\"cb10-4\" data-line-number=\"4\"><span class=\"va\">uid=</span>48<span class=\"va\">(</span>apache<span class=\"va\">)</span> <span class=\"va\">gid=</span>48<span class=\"va\">(</span>apache<span class=\"va\">)</span> <span class=\"va\">groups=</span>48<span class=\"va\">(</span>apache<span class=\"va\">)</span></a></code></pre></div>\r\n<h3 id=\"修改权限\">修改权限</h3>\r\n<div class=\"sourceCode\" id=\"cb11\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb11-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-154</span> ~]# chown -R apache.apache /data/html</a></code></pre></div>\r\n<h3 id=\"共享出去\">共享出去</h3>\r\n<div class=\"sourceCode\" id=\"cb12\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb12-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-154</span> ~]# yum install nfs-utils</a>\r\n<a class=\"sourceLine\" id=\"cb12-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-154</span> ~]# vim /etc/exports</a>\r\n<a class=\"sourceLine\" id=\"cb12-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-154</span> ~]# cat /etc/exports</a>\r\n<a class=\"sourceLine\" id=\"cb12-4\" data-line-number=\"4\"><span class=\"ex\">/data/html</span> 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)</a>\r\n<a class=\"sourceLine\" id=\"cb12-5\" data-line-number=\"5\"><span class=\"ex\">/data/html</span> 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)</a>\r\n<a class=\"sourceLine\" id=\"cb12-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-154</span> ~]# systemctl restart nfsd</a>\r\n<a class=\"sourceLine\" id=\"cb12-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-154</span> ~]# exportfs -v </a>\r\n<a class=\"sourceLine\" id=\"cb12-8\" data-line-number=\"8\"><span class=\"ex\">/data/html</span>      192.168.46.156(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)</a>\r\n<a class=\"sourceLine\" id=\"cb12-9\" data-line-number=\"9\"><span class=\"ex\">/data/html</span>      192.168.46.157(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)</a></code></pre></div>\r\n<h2 id=\"mysql主机配置\">mysql主机配置</h2>\r\n<h3 id=\"安装软件\">安装软件</h3>\r\n<div class=\"sourceCode\" id=\"cb13\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb13-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-155</span> ~]# yum install mariadb-server mariadb</a></code></pre></div>\r\n<h3 id=\"启动服务\">启动服务</h3>\r\n<div class=\"sourceCode\" id=\"cb14\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb14-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-155</span> ~]# systemctl start mariadb</a>\r\n<a class=\"sourceLine\" id=\"cb14-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-155</span> ~]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 3306</a>\r\n<a class=\"sourceLine\" id=\"cb14-3\" data-line-number=\"3\"><span class=\"ex\">tcp</span>        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      13680/mysqld </a></code></pre></div>\r\n<h3 id=\"添加应用用户\">添加应用用户</h3>\r\n<div class=\"sourceCode\" id=\"cb15\"><pre class=\"sourceCode sql\"><code class=\"sourceCode sql\"><a class=\"sourceLine\" id=\"cb15-1\" data-line-number=\"1\">[root@centos<span class=\"dv\">-155</span> ~]# mysql -u root -p </a>\r\n<a class=\"sourceLine\" id=\"cb15-2\" data-line-number=\"2\">Enter password: </a>\r\n<a class=\"sourceLine\" id=\"cb15-3\" data-line-number=\"3\">Welcome <span class=\"kw\">to</span> <span class=\"kw\">the</span> MariaDB monitor.  Commands <span class=\"kw\">end</span> <span class=\"kw\">with</span> ; <span class=\"kw\">or</span> \\g.</a>\r\n<a class=\"sourceLine\" id=\"cb15-4\" data-line-number=\"4\">Your MariaDB connection <span class=\"kw\">id</span> <span class=\"kw\">is</span> <span class=\"dv\">10</span></a>\r\n<a class=\"sourceLine\" id=\"cb15-5\" data-line-number=\"5\">Server version: <span class=\"dv\">5</span>.<span class=\"fl\">5.56</span>-MariaDB MariaDB Server</a>\r\n<a class=\"sourceLine\" id=\"cb15-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-7\" data-line-number=\"7\">Copyright (c) <span class=\"dv\">2000</span>, <span class=\"dv\">2017</span>, Oracle, MariaDB Corporation Ab <span class=\"kw\">and</span> others.</a>\r\n<a class=\"sourceLine\" id=\"cb15-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-9\" data-line-number=\"9\"><span class=\"kw\">Type</span> <span class=\"st\">&#39;help;&#39;</span> <span class=\"kw\">or</span> <span class=\"st\">&#39;\\h&#39;</span> <span class=\"kw\">for</span> help. <span class=\"kw\">Type</span> <span class=\"st\">&#39;\\c&#39;</span> <span class=\"kw\">to</span> <span class=\"kw\">clear</span> <span class=\"kw\">the</span> <span class=\"kw\">current</span> input statement.</a>\r\n<a class=\"sourceLine\" id=\"cb15-10\" data-line-number=\"10\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-11\" data-line-number=\"11\">MariaDB [(<span class=\"kw\">none</span>)]&gt; <span class=\"kw\">create</span> <span class=\"kw\">database</span> web ;</a>\r\n<a class=\"sourceLine\" id=\"cb15-12\" data-line-number=\"12\"><span class=\"kw\">Query</span> OK, <span class=\"dv\">1</span> <span class=\"kw\">row</span> affected (<span class=\"fl\">0.00</span> sec)</a>\r\n<a class=\"sourceLine\" id=\"cb15-13\" data-line-number=\"13\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-14\" data-line-number=\"14\">MariaDB [(<span class=\"kw\">none</span>)]&gt; <span class=\"kw\">grant</span> <span class=\"kw\">all</span> <span class=\"kw\">on</span> web.* <span class=\"kw\">to</span> web@<span class=\"st\">&#39;192.168.46.%&#39;</span> <span class=\"kw\">identified</span> <span class=\"kw\">by</span> <span class=\"st\">&#39;oracle&#39;</span>;</a>\r\n<a class=\"sourceLine\" id=\"cb15-15\" data-line-number=\"15\"><span class=\"kw\">Query</span> OK, <span class=\"dv\">0</span> <span class=\"kw\">rows</span> affected (<span class=\"fl\">0.05</span> sec)</a></code></pre></div>\r\n<h3 id=\"安全初始化\">安全初始化</h3>\r\n<div class=\"sourceCode\" id=\"cb16\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb16-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-155</span> ~]# mysql_secure_installation </a></code></pre></div>\r\n<h2 id=\"web主机配置\">web主机配置</h2>\r\n<p>这里是2个主机。</p>\r\n<h3 id=\"安装软件-1\">安装软件</h3>\r\n<div class=\"sourceCode\" id=\"cb17\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb17-1\" data-line-number=\"1\"><span class=\"co\"># 安装</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-150</span> ~]# ansible web -m yum -a <span class=\"st\">&#39;name=httpd,php-fpm,php-mysql,mod_fcgid state=installed&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-3\" data-line-number=\"3\"><span class=\"co\"># 启动服务</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-150</span> ~]# ansible web -m service -a <span class=\"st\">&#39;name=httpd state=started&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-150</span> ~]# ansible web -m service -a <span class=\"st\">&#39;name=php-fpm state=started&#39;</span></a></code></pre></div>\r\n<h3 id=\"挂载目录\">挂载目录</h3>\r\n<div class=\"sourceCode\" id=\"cb18\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb18-1\" data-line-number=\"1\"><span class=\"co\"># 安装必要的挂载相关的软件</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-156</span> httpd]# yum install nfs-utils cifs-utils</a>\r\n<a class=\"sourceLine\" id=\"cb18-3\" data-line-number=\"3\"><span class=\"co\"># 启动rpc服务</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-156</span> httpd]# systemctl restart rpcbind</a>\r\n<a class=\"sourceLine\" id=\"cb18-5\" data-line-number=\"5\"><span class=\"co\"># 查看远程的导出情况</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-156</span> httpd]# showmount -e 192.168.46.154</a>\r\n<a class=\"sourceLine\" id=\"cb18-7\" data-line-number=\"7\"><span class=\"ex\">Export</span> list for 192.168.46.154:</a>\r\n<a class=\"sourceLine\" id=\"cb18-8\" data-line-number=\"8\"><span class=\"ex\">/data/html</span> 192.168.46.157,192.168.46.156</a>\r\n<a class=\"sourceLine\" id=\"cb18-9\" data-line-number=\"9\"><span class=\"co\"># 挂载</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-10\" data-line-number=\"10\">[<span class=\"ex\">root@centos-156</span> httpd]# mount 192.168.46.154:/data/html /var/www/html</a>\r\n<a class=\"sourceLine\" id=\"cb18-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb18-12\" data-line-number=\"12\"><span class=\"co\"># 自动挂载</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-156</span> httpd]# tail -n 1 /etc/mtab</a>\r\n<a class=\"sourceLine\" id=\"cb18-14\" data-line-number=\"14\"><span class=\"ex\">192.168.46.154</span>:/data/html /var/www/html nfs4 rw,relatime,vers=4.1,rsize=65536,wsize=65536,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.46.156,local_lock=none,addr=192.168.46.154 0 0</a>\r\n<a class=\"sourceLine\" id=\"cb18-15\" data-line-number=\"15\">[<span class=\"ex\">root@centos-156</span> httpd]# tail -n 1 /etc/mtab <span class=\"op\">&gt;&gt;</span> /etc/fstab</a>\r\n<a class=\"sourceLine\" id=\"cb18-16\" data-line-number=\"16\"><span class=\"co\"># 查看下样例网页</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-17\" data-line-number=\"17\">[<span class=\"ex\">root@centos-156</span> httpd]# cat /var/www/html/index.html </a>\r\n<a class=\"sourceLine\" id=\"cb18-18\" data-line-number=\"18\"><span class=\"ex\">hellow</span> world</a></code></pre></div>\r\n<h3 id=\"配置httpd\">配置httpd</h3>\r\n<p>本部分内容需要在2个机器都要做一遍。</p>\r\n<div class=\"sourceCode\" id=\"cb19\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb19-1\" data-line-number=\"1\"><span class=\"co\"># 下载一个样例的php页面  </span></a>\r\n<a class=\"sourceLine\" id=\"cb19-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-156</span> httpd]# wget download.linuxpanda.tech/lamp/index.php.sample -O /var/www/html/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb19-3\" data-line-number=\"3\"><span class=\"co\"># 编辑下样例php页面的数据库连接用户和密码</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-156</span> httpd]# vim /var/www/html/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb19-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-156</span> httpd]# cat /var/www/html/index.php </a>\r\n<a class=\"sourceLine\" id=\"cb19-6\" data-line-number=\"6\"><span class=\"op\">&lt;</span><span class=\"ex\">?php</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-7\" data-line-number=\"7\"><span class=\"va\">$mysqli</span>=<span class=\"ex\">new</span> mysqli(<span class=\"st\">&quot;192.168.46.155&quot;</span>,<span class=\"st\">&quot;web&quot;</span>,<span class=\"st\">&quot;oracle&quot;</span>);</a>\r\n<a class=\"sourceLine\" id=\"cb19-8\" data-line-number=\"8\"><span class=\"ex\">if</span>(mysqli_connect_errno())<span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-9\" data-line-number=\"9\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;失败了&quot;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-10\" data-line-number=\"10\"><span class=\"va\">$mysqli</span>=<span class=\"ex\">null</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-11\" data-line-number=\"11\"><span class=\"bu\">exit</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-12\" data-line-number=\"12\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-13\" data-line-number=\"13\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;成功了&quot;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-14\" data-line-number=\"14\"><span class=\"va\">$mysqli</span><span class=\"ex\">-</span><span class=\"op\">&gt;</span>close();</a>\r\n<a class=\"sourceLine\" id=\"cb19-15\" data-line-number=\"15\"><span class=\"ex\">?</span><span class=\"op\">&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-16\" data-line-number=\"16\"></a>\r\n<a class=\"sourceLine\" id=\"cb19-17\" data-line-number=\"17\"><span class=\"co\"># fcgi编辑</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-18\" data-line-number=\"18\">[<span class=\"ex\">root@centos-156</span> conf.d]# vim fcgid.conf </a>\r\n<a class=\"sourceLine\" id=\"cb19-19\" data-line-number=\"19\"><span class=\"co\"># 添加如下3行</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-20\" data-line-number=\"20\"><span class=\"ex\">DirectoryIndex</span> index.php</a>\r\n<a class=\"sourceLine\" id=\"cb19-21\" data-line-number=\"21\"><span class=\"ex\">ProxyRequests</span> Off</a>\r\n<a class=\"sourceLine\" id=\"cb19-22\" data-line-number=\"22\"><span class=\"ex\">ProxyPassMatch</span> ^/(.*\\.php)$ <span class=\"ex\">fcgi</span>://127.0.0.1:9000/var/www/html/<span class=\"va\">$1</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-23\" data-line-number=\"23\"><span class=\"co\"># 重启网络服务</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-24\" data-line-number=\"24\">[<span class=\"ex\">root@centos-156</span> conf.d]# service httpd restart</a></code></pre></div>\r\n<h3 id=\"本机测试\">本机测试</h3>\r\n<p>本部分内容需要在2个机器都要做一遍。</p>\r\n<div class=\"sourceCode\" id=\"cb20\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb20-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-156</span> conf.d]# curl localhost/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb20-2\" data-line-number=\"2\">成功了</a></code></pre></div>\r\n<h2 id=\"client测试\">client测试</h2>\r\n<div class=\"sourceCode\" id=\"cb21\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb21-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-159</span> ~]# curl http://www.linuxpanda.tech/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb21-2\" data-line-number=\"2\">成功了</a>\r\n<a class=\"sourceLine\" id=\"cb21-3\" data-line-number=\"3\"><span class=\"co\"># 把156的web停掉</span></a>\r\n<a class=\"sourceLine\" id=\"cb21-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-159</span> ~]# curl http://www.linuxpanda.tech/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb21-5\" data-line-number=\"5\">成功了</a>\r\n<a class=\"sourceLine\" id=\"cb21-6\" data-line-number=\"6\"><span class=\"co\"># 再把157的web停掉</span></a>\r\n<a class=\"sourceLine\" id=\"cb21-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-159</span> ~]# curl http://www.linuxpanda.tech/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb21-8\" data-line-number=\"8\"><span class=\"ex\">curl</span>: (7) <span class=\"ex\">Failed</span> connect to www.linuxpanda.tech:80<span class=\"kw\">;</span> <span class=\"ex\">Connection</span> refused</a></code></pre></div>\r\n<h2 id=\"总结\">总结</h2>\r\n<p>这个作业，看起来挺简单的，做起来还是遇到些麻烦的。</p>\r\n<p>需要改进的地方：</p>\r\n<ol>\r\n<li>dns解析太不稳定，如果web1停掉，dns还可能解析到这个停掉的主机，就会导致web没法访问。</li>\r\n<li>mysql实例后面学习了主从可以考虑完善下。</li>\r\n<li>lamp没有使用xcache加速下</li>\r\n<li>本练习都是使用的yum安装的lamp环境，可以考虑使用编译安装方法。</li>\r\n<li>数据通过nfs共享，本质还是一个磁盘的数据，可以考虑使用rsync来替代nfs。</li>\r\n<li>数据文件可以考虑放到raid上，来提供文件的访问性能</li>\r\n</ol>\r\n<h2 id=\"参考\">参考</h2>\r\n<p><a href=\"http://linux.linuxpanda.tech/\" target=\"_blank\" rel=\"noopener\">我自己在马哥教育笔记1</a></p>\r\n<p><a href=\"http://services.linuxpanda.tech/\" target=\"_blank\" rel=\"noopener\">我自己在马哥教育笔记2</a></p>\r\n","site":{"data":{}},"excerpt":"","more":"<p>这个实战是我在 <a href=\"http://www.magedu.com/\" target=\"_blank\" rel=\"noopener\">马哥教育</a> 培训中期，给的实战题目，相对比较简单。</p>\r\n<h2 id=\"架构图\">架构图</h2>\r\n<p><img src=\"/images/web/实战1架构图.png\" alt=\"image\"></p>\r\n<ul>\r\n<li>dns完成解析web1,web2来实现负载均衡</li>\r\n<li>web1,web2使用后台的mysql数据库</li>\r\n<li>web1,web2的页面数据全部放在nfs数据上，实现自动挂载</li>\r\n<li>nfs服务器为web1,web2提供网页数据</li>\r\n</ul>\r\n<h2 id=\"准备工作\">准备工作</h2>\r\n<p>设置ip信息</p>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\"><span class=\"ex\">nmcli</span> con add ifname ens33 con-name ens33 type ethernet ipv4.method manual \\</a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\">ipv4.address 192.158.46.150/24 ipv4.gateway 192.168.46.1</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>我使用的nmcli修改的ip，当然也是可以手工修改的。</p>\r\n</div>\r\n<h2 id=\"ansible的配置\">ansible的配置</h2>\r\n<h3 id=\"安装ansible\">安装ansible</h3>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> ~]# yum install ansible</a></code></pre></div>\r\n<h3 id=\"添加主机\">添加主机</h3>\r\n<p>需要添加如下内容到/etc/ansible/hosts文件中去。</p>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode ini\"><code class=\"sourceCode ini\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\"><span class=\"kw\">[client]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\"><span class=\"dt\">192.168.46.159</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"kw\">[dns]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"dt\">192.168.46.158</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\"><span class=\"kw\">[web]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\"><span class=\"dt\">192.168.46.157</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\"><span class=\"dt\">192.168.46.156</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\"><span class=\"kw\">[db]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\"><span class=\"dt\">192.168.46.155</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\"><span class=\"kw\">[nfs]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\"><span class=\"dt\">192.168.46.154</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-14\" data-line-number=\"14\"><span class=\"kw\">[self]</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-15\" data-line-number=\"15\"><span class=\"dt\">192.168.46.150</span></a></code></pre></div>\r\n<h3 id=\"配置免密码登陆\">配置免密码登陆</h3>\r\n<p>这里我之前写有一个脚本自动完成免密码登陆的脚本，参考我的博客_</p>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@localhost</span> ~]# cat hosts.txt </a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\"><span class=\"ex\">192.168.46.150</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-3\" data-line-number=\"3\"><span class=\"ex\">192.168.46.151</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-4\" data-line-number=\"4\"><span class=\"ex\">192.168.46.152</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-5\" data-line-number=\"5\"><span class=\"ex\">192.168.46.153</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-6\" data-line-number=\"6\"><span class=\"ex\">192.168.46.154</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-7\" data-line-number=\"7\"><span class=\"ex\">192.168.46.155</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-8\" data-line-number=\"8\"><span class=\"ex\">192.168.46.156</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-9\" data-line-number=\"9\"><span class=\"ex\">192.168.46.157</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-10\" data-line-number=\"10\"><span class=\"ex\">192.168.46.158</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-11\" data-line-number=\"11\"><span class=\"ex\">192.168.46.159</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-12\" data-line-number=\"12\"><span class=\"ex\">192.168.46.160</span> root oracle</a>\r\n<a class=\"sourceLine\" id=\"cb4-13\" data-line-number=\"13\">[<span class=\"ex\">root@localhost</span> ~]# cat mima.sh </a>\r\n<a class=\"sourceLine\" id=\"cb4-14\" data-line-number=\"14\"><span class=\"co\">#!/bin/bash </span></a>\r\n<a class=\"sourceLine\" id=\"cb4-15\" data-line-number=\"15\"><span class=\"co\">#================================================</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-16\" data-line-number=\"16\"><span class=\"co\">#FileName   :expect_ssh.sh</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-17\" data-line-number=\"17\"><span class=\"co\">#Author     :zhaojiedi</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-18\" data-line-number=\"18\"><span class=\"co\">#Description:</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-19\" data-line-number=\"19\"><span class=\"co\">#DateTime   :2018-01-05 08:26:06</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-20\" data-line-number=\"20\"><span class=\"co\">#Version    :V1.0</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-21\" data-line-number=\"21\"><span class=\"co\">#Other      :</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-22\" data-line-number=\"22\"><span class=\"co\">#================================================</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-23\" data-line-number=\"23\"><span class=\"va\">host_username_password_file=</span>hosts.txt</a>\r\n<a class=\"sourceLine\" id=\"cb4-24\" data-line-number=\"24\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-25\" data-line-number=\"25\"><span class=\"co\"># install expect </span></a>\r\n<a class=\"sourceLine\" id=\"cb4-26\" data-line-number=\"26\"><span class=\"ex\">rpm</span> -q expect <span class=\"op\">&amp;&gt;</span>/dev/null <span class=\"kw\">||</span> <span class=\"ex\">yum</span> install -yq expect <span class=\"op\">&amp;&gt;</span>/dev/null</a>\r\n<a class=\"sourceLine\" id=\"cb4-27\" data-line-number=\"27\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-28\" data-line-number=\"28\"><span class=\"co\"># create id_rsa.pub file </span></a>\r\n<a class=\"sourceLine\" id=\"cb4-29\" data-line-number=\"29\"><span class=\"va\">pubkey=</span>~/.ssh/id_rsa.pub</a>\r\n<a class=\"sourceLine\" id=\"cb4-30\" data-line-number=\"30\"><span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$pubkey</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span> ; <span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-31\" data-line-number=\"31\">        <span class=\"fu\">ssh-keygen</span>  -P <span class=\"st\">&quot;&quot;</span> -t rsa  -f ~/.ssh/id_rsa</a>\r\n<a class=\"sourceLine\" id=\"cb4-32\" data-line-number=\"32\"><span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-33\" data-line-number=\"33\"><span class=\"kw\">while</span> <span class=\"bu\">read</span> <span class=\"va\">host</span> <span class=\"va\">username</span> <span class=\"va\">password</span> ; <span class=\"kw\">do</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-34\" data-line-number=\"34\">        <span class=\"va\">con=${username}</span><span class=\"st\">&quot;@&quot;</span><span class=\"va\">${host}</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-35\" data-line-number=\"35\">        <span class=\"bu\">echo</span> <span class=\"va\">$password</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-36\" data-line-number=\"36\">        <span class=\"ex\">expect</span> <span class=\"op\">&lt;&lt;EOF</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-37\" data-line-number=\"37\">        set timeout 20 </a>\r\n<a class=\"sourceLine\" id=\"cb4-38\" data-line-number=\"38\">        spawn ssh-copy-id <span class=\"va\">$con</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-39\" data-line-number=\"39\">        expect {</a>\r\n<a class=\"sourceLine\" id=\"cb4-40\" data-line-number=\"40\">                &quot;yes/no&quot;  { send &quot;yes\\n&quot; ; exp_continue }</a>\r\n<a class=\"sourceLine\" id=\"cb4-41\" data-line-number=\"41\">                &quot;password:&quot; { send &quot;<span class=\"va\">${password}</span>\\n&quot;; exp_continue }</a>\r\n<a class=\"sourceLine\" id=\"cb4-42\" data-line-number=\"42\">        }</a>\r\n<a class=\"sourceLine\" id=\"cb4-43\" data-line-number=\"43\">EOF</a>\r\n<a class=\"sourceLine\" id=\"cb4-44\" data-line-number=\"44\">done &lt; <span class=\"va\">$host_username_password_file</span></a>\r\n<a class=\"sourceLine\" id=\"cb4-45\" data-line-number=\"45\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-46\" data-line-number=\"46\"># 执行下脚本，自动完成公钥copy工作了</a>\r\n<a class=\"sourceLine\" id=\"cb4-47\" data-line-number=\"47\">[root@localhost ~]# bash mima.sh </a>\r\n<a class=\"sourceLine\" id=\"cb4-48\" data-line-number=\"48\"></a>\r\n<a class=\"sourceLine\" id=\"cb4-49\" data-line-number=\"49\"># 测试下</a>\r\n<a class=\"sourceLine\" id=\"cb4-50\" data-line-number=\"50\">[root@localhost ~]# ssh 192.168.46.151 &#39;ip a show ens33&#39;</a></code></pre></div>\r\n<h3 id=\"设置主机名可选\">设置主机名（可选）</h3>\r\n<p>我这里的机器全是刚刚克隆出来的虚拟机，为了管理方便设置下主机名，防止误操作。</p>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\"><span class=\"co\"># 创建一个设置主机名的脚本</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\">[<span class=\"ex\">root@localhost</span> ~]# vim set_hostname.sh </a>\r\n<a class=\"sourceLine\" id=\"cb5-3\" data-line-number=\"3\">[<span class=\"ex\">root@localhost</span> ~]# cat set_hostname.sh </a>\r\n<a class=\"sourceLine\" id=\"cb5-4\" data-line-number=\"4\"><span class=\"co\">#!/bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-5\" data-line-number=\"5\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;start&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-6\" data-line-number=\"6\"><span class=\"fu\">hostname</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-7\" data-line-number=\"7\"><span class=\"va\">name=</span>centos-<span class=\"va\">$(</span><span class=\"ex\">ip</span> a show ens33 <span class=\"kw\">|</span><span class=\"fu\">grep</span> <span class=\"st\">&#39;inet.*ens33&#39;</span> <span class=\"kw\">|</span> <span class=\"fu\">sed</span> -r  -n <span class=\"st\">&#39;s@.*\\.([0-9]{1,3})/.*@\\1@p&#39;</span><span class=\"va\">)</span>.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb5-8\" data-line-number=\"8\"><span class=\"bu\">echo</span> <span class=\"va\">$name</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-9\" data-line-number=\"9\"><span class=\"ex\">hostnamectl</span> set-hostname <span class=\"va\">$name</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-10\" data-line-number=\"10\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;end&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb5-12\" data-line-number=\"12\">[<span class=\"ex\">root@centos-localhost</span> ~]# ansible all -m script -a <span class=\"st\">&#39;/root/set_hostname.sh&#39;</span></a></code></pre></div>\r\n<p>这个脚本也是设置了ansible主机的ip。</p>\r\n<h3 id=\"防火墙和selinux关闭\">防火墙和selinux关闭</h3>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\"><span class=\"co\"># 关闭防火墙</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m service -a <span class=\"st\">&#39;name=firewalld enabled=no&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m service -a <span class=\"st\">&#39;name=firewalld state=stopped&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-4\" data-line-number=\"4\"></a>\r\n<a class=\"sourceLine\" id=\"cb6-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m shell -a <span class=\"st\">&#39;sed  -i -r &#39;</span>s@SELINUX=.*@SELINUX=disabled@<span class=\"st\">&#39; /etc/sysconfig/selinux&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb6-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-150</span> ~]# ansible all -m shell -a  <span class=\"st\">&#39;setenforce 0&#39;</span></a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>如果原有selinux就是disabled，使用setenforce 0会报错误的，不用管它。</p>\r\n</div>\r\n<h2 id=\"dns主机设置\">dns主机设置</h2>\r\n<h3 id=\"dns配置\">dns配置</h3>\r\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb7-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# yum install bind bind-utils</a>\r\n<a class=\"sourceLine\" id=\"cb7-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# vim /etc/named.conf</a>\r\n<a class=\"sourceLine\" id=\"cb7-3\" data-line-number=\"3\"><span class=\"co\"># 注释如下5行</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-4\" data-line-number=\"4\"><span class=\"ex\">//</span>      listen-on port 53 { 127.0.0.1<span class=\"kw\">;</span> };</a>\r\n<a class=\"sourceLine\" id=\"cb7-5\" data-line-number=\"5\"><span class=\"ex\">//</span>      listen-on-v6 port 53 { ::1<span class=\"kw\">;</span> };</a>\r\n<a class=\"sourceLine\" id=\"cb7-6\" data-line-number=\"6\"><span class=\"ex\">//</span>      allow-query     { localhost<span class=\"kw\">;</span> };</a>\r\n<a class=\"sourceLine\" id=\"cb7-7\" data-line-number=\"7\"><span class=\"ex\">//</span>      dnssec-enable yes<span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-8\" data-line-number=\"8\"><span class=\"ex\">//</span>      dnssec-validation yes<span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-9\" data-line-number=\"9\">[<span class=\"ex\">root@centos-158</span> ~]# vim /etc/named.rfc1912.zones </a>\r\n<a class=\"sourceLine\" id=\"cb7-10\" data-line-number=\"10\"><span class=\"co\"># 添加如下内容，注意之后的分号</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-11\" data-line-number=\"11\"><span class=\"ex\">zone</span> <span class=\"st\">&quot;linuxpanda.tech&quot;</span> IN {</a>\r\n<a class=\"sourceLine\" id=\"cb7-12\" data-line-number=\"12\">        <span class=\"bu\">type</span> master<span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-13\" data-line-number=\"13\">        <span class=\"fu\">file</span> <span class=\"st\">&quot;linuxpanda.tech.zone&quot;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-14\" data-line-number=\"14\">};</a>\r\n<a class=\"sourceLine\" id=\"cb7-15\" data-line-number=\"15\">[<span class=\"ex\">root@centos-158</span> ~]# cd /var/named/</a>\r\n<a class=\"sourceLine\" id=\"cb7-16\" data-line-number=\"16\">[<span class=\"ex\">root@centos-158</span> named]# cp -a named.localhost  linuxpanda.tech.zone</a>\r\n<a class=\"sourceLine\" id=\"cb7-17\" data-line-number=\"17\">[<span class=\"ex\">root@centos-158</span> named]# vim linuxpanda.tech.zone </a>\r\n<a class=\"sourceLine\" id=\"cb7-18\" data-line-number=\"18\">[<span class=\"ex\">root@centos-158</span> named]# cat linuxpanda.tech.zone </a>\r\n<a class=\"sourceLine\" id=\"cb7-19\" data-line-number=\"19\"><span class=\"va\">$TTL</span> <span class=\"ex\">1D</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-20\" data-line-number=\"20\"><span class=\"ex\">@</span>   IN SOA  ns1 admin (</a>\r\n<a class=\"sourceLine\" id=\"cb7-21\" data-line-number=\"21\">                    <span class=\"ex\">0</span>   <span class=\"kw\">;</span> <span class=\"ex\">serial</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-22\" data-line-number=\"22\">                    <span class=\"ex\">1D</span>  <span class=\"kw\">;</span> <span class=\"ex\">refresh</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-23\" data-line-number=\"23\">                    <span class=\"ex\">1H</span>  <span class=\"kw\">;</span> <span class=\"ex\">retry</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-24\" data-line-number=\"24\">                    <span class=\"ex\">1W</span>  <span class=\"kw\">;</span> <span class=\"ex\">expire</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-25\" data-line-number=\"25\">                    <span class=\"ex\">3H</span> )    ; <span class=\"ex\">minimum</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-26\" data-line-number=\"26\">    <span class=\"ex\">NS</span>  ns1</a>\r\n<a class=\"sourceLine\" id=\"cb7-27\" data-line-number=\"27\"><span class=\"ex\">ns1</span>     A       192.168.46.158</a>\r\n<a class=\"sourceLine\" id=\"cb7-28\" data-line-number=\"28\"><span class=\"ex\">web</span>     A       192.168.46.157</a>\r\n<a class=\"sourceLine\" id=\"cb7-29\" data-line-number=\"29\"><span class=\"ex\">web</span>     A       192.168.46.156</a>\r\n<a class=\"sourceLine\" id=\"cb7-30\" data-line-number=\"30\"><span class=\"ex\">www</span>     CNAME   web</a></code></pre></div>\r\n<h3 id=\"dns本机测试\">dns本机测试</h3>\r\n<div class=\"sourceCode\" id=\"cb8\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb8-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> named]# dig www.linuxpanda.tech @localhost</a>\r\n<a class=\"sourceLine\" id=\"cb8-2\" data-line-number=\"2\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-3\" data-line-number=\"3\">; <span class=\"op\">&lt;&lt;&gt;&gt;</span> <span class=\"ex\">DiG</span> 9.9.4-RedHat-9.9.4-51.el7_4.2 <span class=\"op\">&lt;&lt;&gt;&gt;</span> www.linuxpanda.tech @localhost</a>\r\n<a class=\"sourceLine\" id=\"cb8-4\" data-line-number=\"4\">;; <span class=\"ex\">global</span> options: +cmd</a>\r\n<a class=\"sourceLine\" id=\"cb8-5\" data-line-number=\"5\">;; <span class=\"ex\">Got</span> answer:</a>\r\n<a class=\"sourceLine\" id=\"cb8-6\" data-line-number=\"6\">;; <span class=\"ex\">-</span><span class=\"op\">&gt;&gt;</span>HEADER<span class=\"op\">&lt;&lt;- opcode:</span> <span class=\"ex\">QUERY</span>, status: NOERROR, id: 57957</a>\r\n<a class=\"sourceLine\" id=\"cb8-7\" data-line-number=\"7\">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 1, ADDITIONAL: 2</a>\r\n<a class=\"sourceLine\" id=\"cb8-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-9\" data-line-number=\"9\">;; OPT PSEUDOSECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-10\" data-line-number=\"10\">; EDNS: version: 0, flags:; udp: 4096</a>\r\n<a class=\"sourceLine\" id=\"cb8-11\" data-line-number=\"11\">;; QUESTION SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-12\" data-line-number=\"12\">;www.linuxpanda.tech.       IN  A</a>\r\n<a class=\"sourceLine\" id=\"cb8-13\" data-line-number=\"13\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-14\" data-line-number=\"14\">;; ANSWER SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-15\" data-line-number=\"15\">www.linuxpanda.tech.    86400   IN  CNAME   web.linuxpanda.tech.</a>\r\n<a class=\"sourceLine\" id=\"cb8-16\" data-line-number=\"16\">web.linuxpanda.tech.    86400   IN  A   192.168.46.156</a>\r\n<a class=\"sourceLine\" id=\"cb8-17\" data-line-number=\"17\">web.linuxpanda.tech.    86400   IN  A   192.168.46.157</a>\r\n<a class=\"sourceLine\" id=\"cb8-18\" data-line-number=\"18\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-19\" data-line-number=\"19\">;; AUTHORITY SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-20\" data-line-number=\"20\">linuxpanda.tech.    86400   IN  NS  ns1.linuxpanda.tech.</a>\r\n<a class=\"sourceLine\" id=\"cb8-21\" data-line-number=\"21\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-22\" data-line-number=\"22\">;; ADDITIONAL SECTION:</a>\r\n<a class=\"sourceLine\" id=\"cb8-23\" data-line-number=\"23\">ns1.linuxpanda.tech.    86400   IN  A   192.168.46.158</a>\r\n<a class=\"sourceLine\" id=\"cb8-24\" data-line-number=\"24\"></a>\r\n<a class=\"sourceLine\" id=\"cb8-25\" data-line-number=\"25\">;; Query time: 0 msec</a>\r\n<a class=\"sourceLine\" id=\"cb8-26\" data-line-number=\"26\">;; SERVER: 127.0.0.1#53(127.0.0.1)</a>\r\n<a class=\"sourceLine\" id=\"cb8-27\" data-line-number=\"27\">;; WHEN: Sun Feb 18 21:05:05 CST 2018</a>\r\n<a class=\"sourceLine\" id=\"cb8-28\" data-line-number=\"28\">;; MSG SIZE  rcvd: 132</a></code></pre></div>\r\n<h2 id=\"client主机测试\">client主机测试</h2>\r\n<div class=\"sourceCode\" id=\"cb9\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb9-1\" data-line-number=\"1\"><span class=\"co\"># 修改客户端的dns指向为我们自己的dns主机</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-159</span> ~]# nmcli con modify  ens33 ipv4.dns 192.168.46.158</a>\r\n<a class=\"sourceLine\" id=\"cb9-3\" data-line-number=\"3\"><span class=\"co\"># 重启网络，或者重新加载</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-159</span> ~]# service network restart</a>\r\n<a class=\"sourceLine\" id=\"cb9-5\" data-line-number=\"5\"></a>\r\n<a class=\"sourceLine\" id=\"cb9-6\" data-line-number=\"6\"><span class=\"co\"># ping下我们的web主机，看是否能解析出来157，156两个ip</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-159</span> ~]# ping www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb9-8\" data-line-number=\"8\"><span class=\"ex\">PING</span> web.linuxpanda.tech (192.168.46.157) <span class=\"ex\">56</span>(84) <span class=\"ex\">bytes</span> of data.</a>\r\n<a class=\"sourceLine\" id=\"cb9-9\" data-line-number=\"9\"><span class=\"ex\">64</span> bytes from 192.168.46.157 (192.168.46.157)<span class=\"bu\">:</span> icmp_seq=1 ttl=64 time=0.330 ms</a>\r\n<a class=\"sourceLine\" id=\"cb9-10\" data-line-number=\"10\"><span class=\"ex\">64</span> bytes from 192.168.46.157 (192.168.46.157)<span class=\"bu\">:</span> icmp_seq=2 ttl=64 time=0.255 ms</a>\r\n<a class=\"sourceLine\" id=\"cb9-11\" data-line-number=\"11\"><span class=\"ex\">64</span> bytes from 192.168.46.157 (192.168.46.157)<span class=\"bu\">:</span> icmp_seq=3 ttl=64 time=0.292 ms</a>\r\n<a class=\"sourceLine\" id=\"cb9-12\" data-line-number=\"12\"></a>\r\n<a class=\"sourceLine\" id=\"cb9-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-159</span> ~]# ping www.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb9-14\" data-line-number=\"14\"><span class=\"ex\">PING</span> web.linuxpanda.tech (192.168.46.156) <span class=\"ex\">56</span>(84) <span class=\"ex\">bytes</span> of data.</a>\r\n<a class=\"sourceLine\" id=\"cb9-15\" data-line-number=\"15\"><span class=\"ex\">64</span> bytes from 192.168.46.156 (192.168.46.156)<span class=\"bu\">:</span> icmp_seq=1 ttl=64 time=0.421 ms</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>ping命令去测试有点不专业的，需要多次测试才能2个地址都出现，这里就不安装dig工具了，毕竟客户端。</p>\r\n</div>\r\n<h2 id=\"nfs主机配置\">nfs主机配置</h2>\r\n<h3 id=\"添加用户\">添加用户</h3>\r\n<div class=\"sourceCode\" id=\"cb10\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb10-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-154</span> ~]# groupadd -g 48 apache</a>\r\n<a class=\"sourceLine\" id=\"cb10-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-154</span> ~]# useradd -u 48 -g 48 apache</a>\r\n<a class=\"sourceLine\" id=\"cb10-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-154</span> ~]# id apache</a>\r\n<a class=\"sourceLine\" id=\"cb10-4\" data-line-number=\"4\"><span class=\"va\">uid=</span>48<span class=\"va\">(</span>apache<span class=\"va\">)</span> <span class=\"va\">gid=</span>48<span class=\"va\">(</span>apache<span class=\"va\">)</span> <span class=\"va\">groups=</span>48<span class=\"va\">(</span>apache<span class=\"va\">)</span></a></code></pre></div>\r\n<h3 id=\"修改权限\">修改权限</h3>\r\n<div class=\"sourceCode\" id=\"cb11\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb11-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-154</span> ~]# chown -R apache.apache /data/html</a></code></pre></div>\r\n<h3 id=\"共享出去\">共享出去</h3>\r\n<div class=\"sourceCode\" id=\"cb12\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb12-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-154</span> ~]# yum install nfs-utils</a>\r\n<a class=\"sourceLine\" id=\"cb12-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-154</span> ~]# vim /etc/exports</a>\r\n<a class=\"sourceLine\" id=\"cb12-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-154</span> ~]# cat /etc/exports</a>\r\n<a class=\"sourceLine\" id=\"cb12-4\" data-line-number=\"4\"><span class=\"ex\">/data/html</span> 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)</a>\r\n<a class=\"sourceLine\" id=\"cb12-5\" data-line-number=\"5\"><span class=\"ex\">/data/html</span> 192.168.46.156(rw,all_squash,anonuid=apache,anongid=apache)</a>\r\n<a class=\"sourceLine\" id=\"cb12-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-154</span> ~]# systemctl restart nfsd</a>\r\n<a class=\"sourceLine\" id=\"cb12-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-154</span> ~]# exportfs -v </a>\r\n<a class=\"sourceLine\" id=\"cb12-8\" data-line-number=\"8\"><span class=\"ex\">/data/html</span>      192.168.46.156(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)</a>\r\n<a class=\"sourceLine\" id=\"cb12-9\" data-line-number=\"9\"><span class=\"ex\">/data/html</span>      192.168.46.157(rw,sync,wdelay,hide,no_subtree_check,anonuid=48,anongid=48,sec=sys,secure,root_squash,all_squash)</a></code></pre></div>\r\n<h2 id=\"mysql主机配置\">mysql主机配置</h2>\r\n<h3 id=\"安装软件\">安装软件</h3>\r\n<div class=\"sourceCode\" id=\"cb13\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb13-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-155</span> ~]# yum install mariadb-server mariadb</a></code></pre></div>\r\n<h3 id=\"启动服务\">启动服务</h3>\r\n<div class=\"sourceCode\" id=\"cb14\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb14-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-155</span> ~]# systemctl start mariadb</a>\r\n<a class=\"sourceLine\" id=\"cb14-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-155</span> ~]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 3306</a>\r\n<a class=\"sourceLine\" id=\"cb14-3\" data-line-number=\"3\"><span class=\"ex\">tcp</span>        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      13680/mysqld </a></code></pre></div>\r\n<h3 id=\"添加应用用户\">添加应用用户</h3>\r\n<div class=\"sourceCode\" id=\"cb15\"><pre class=\"sourceCode sql\"><code class=\"sourceCode sql\"><a class=\"sourceLine\" id=\"cb15-1\" data-line-number=\"1\">[root@centos<span class=\"dv\">-155</span> ~]# mysql -u root -p </a>\r\n<a class=\"sourceLine\" id=\"cb15-2\" data-line-number=\"2\">Enter password: </a>\r\n<a class=\"sourceLine\" id=\"cb15-3\" data-line-number=\"3\">Welcome <span class=\"kw\">to</span> <span class=\"kw\">the</span> MariaDB monitor.  Commands <span class=\"kw\">end</span> <span class=\"kw\">with</span> ; <span class=\"kw\">or</span> \\g.</a>\r\n<a class=\"sourceLine\" id=\"cb15-4\" data-line-number=\"4\">Your MariaDB connection <span class=\"kw\">id</span> <span class=\"kw\">is</span> <span class=\"dv\">10</span></a>\r\n<a class=\"sourceLine\" id=\"cb15-5\" data-line-number=\"5\">Server version: <span class=\"dv\">5</span>.<span class=\"fl\">5.56</span>-MariaDB MariaDB Server</a>\r\n<a class=\"sourceLine\" id=\"cb15-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-7\" data-line-number=\"7\">Copyright (c) <span class=\"dv\">2000</span>, <span class=\"dv\">2017</span>, Oracle, MariaDB Corporation Ab <span class=\"kw\">and</span> others.</a>\r\n<a class=\"sourceLine\" id=\"cb15-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-9\" data-line-number=\"9\"><span class=\"kw\">Type</span> <span class=\"st\">&#39;help;&#39;</span> <span class=\"kw\">or</span> <span class=\"st\">&#39;\\h&#39;</span> <span class=\"kw\">for</span> help. <span class=\"kw\">Type</span> <span class=\"st\">&#39;\\c&#39;</span> <span class=\"kw\">to</span> <span class=\"kw\">clear</span> <span class=\"kw\">the</span> <span class=\"kw\">current</span> input statement.</a>\r\n<a class=\"sourceLine\" id=\"cb15-10\" data-line-number=\"10\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-11\" data-line-number=\"11\">MariaDB [(<span class=\"kw\">none</span>)]&gt; <span class=\"kw\">create</span> <span class=\"kw\">database</span> web ;</a>\r\n<a class=\"sourceLine\" id=\"cb15-12\" data-line-number=\"12\"><span class=\"kw\">Query</span> OK, <span class=\"dv\">1</span> <span class=\"kw\">row</span> affected (<span class=\"fl\">0.00</span> sec)</a>\r\n<a class=\"sourceLine\" id=\"cb15-13\" data-line-number=\"13\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-14\" data-line-number=\"14\">MariaDB [(<span class=\"kw\">none</span>)]&gt; <span class=\"kw\">grant</span> <span class=\"kw\">all</span> <span class=\"kw\">on</span> web.* <span class=\"kw\">to</span> web@<span class=\"st\">&#39;192.168.46.%&#39;</span> <span class=\"kw\">identified</span> <span class=\"kw\">by</span> <span class=\"st\">&#39;oracle&#39;</span>;</a>\r\n<a class=\"sourceLine\" id=\"cb15-15\" data-line-number=\"15\"><span class=\"kw\">Query</span> OK, <span class=\"dv\">0</span> <span class=\"kw\">rows</span> affected (<span class=\"fl\">0.05</span> sec)</a></code></pre></div>\r\n<h3 id=\"安全初始化\">安全初始化</h3>\r\n<div class=\"sourceCode\" id=\"cb16\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb16-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-155</span> ~]# mysql_secure_installation </a></code></pre></div>\r\n<h2 id=\"web主机配置\">web主机配置</h2>\r\n<p>这里是2个主机。</p>\r\n<h3 id=\"安装软件-1\">安装软件</h3>\r\n<div class=\"sourceCode\" id=\"cb17\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb17-1\" data-line-number=\"1\"><span class=\"co\"># 安装</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-150</span> ~]# ansible web -m yum -a <span class=\"st\">&#39;name=httpd,php-fpm,php-mysql,mod_fcgid state=installed&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-3\" data-line-number=\"3\"><span class=\"co\"># 启动服务</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-150</span> ~]# ansible web -m service -a <span class=\"st\">&#39;name=httpd state=started&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb17-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-150</span> ~]# ansible web -m service -a <span class=\"st\">&#39;name=php-fpm state=started&#39;</span></a></code></pre></div>\r\n<h3 id=\"挂载目录\">挂载目录</h3>\r\n<div class=\"sourceCode\" id=\"cb18\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb18-1\" data-line-number=\"1\"><span class=\"co\"># 安装必要的挂载相关的软件</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-156</span> httpd]# yum install nfs-utils cifs-utils</a>\r\n<a class=\"sourceLine\" id=\"cb18-3\" data-line-number=\"3\"><span class=\"co\"># 启动rpc服务</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-156</span> httpd]# systemctl restart rpcbind</a>\r\n<a class=\"sourceLine\" id=\"cb18-5\" data-line-number=\"5\"><span class=\"co\"># 查看远程的导出情况</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-156</span> httpd]# showmount -e 192.168.46.154</a>\r\n<a class=\"sourceLine\" id=\"cb18-7\" data-line-number=\"7\"><span class=\"ex\">Export</span> list for 192.168.46.154:</a>\r\n<a class=\"sourceLine\" id=\"cb18-8\" data-line-number=\"8\"><span class=\"ex\">/data/html</span> 192.168.46.157,192.168.46.156</a>\r\n<a class=\"sourceLine\" id=\"cb18-9\" data-line-number=\"9\"><span class=\"co\"># 挂载</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-10\" data-line-number=\"10\">[<span class=\"ex\">root@centos-156</span> httpd]# mount 192.168.46.154:/data/html /var/www/html</a>\r\n<a class=\"sourceLine\" id=\"cb18-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb18-12\" data-line-number=\"12\"><span class=\"co\"># 自动挂载</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-156</span> httpd]# tail -n 1 /etc/mtab</a>\r\n<a class=\"sourceLine\" id=\"cb18-14\" data-line-number=\"14\"><span class=\"ex\">192.168.46.154</span>:/data/html /var/www/html nfs4 rw,relatime,vers=4.1,rsize=65536,wsize=65536,namlen=255,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.46.156,local_lock=none,addr=192.168.46.154 0 0</a>\r\n<a class=\"sourceLine\" id=\"cb18-15\" data-line-number=\"15\">[<span class=\"ex\">root@centos-156</span> httpd]# tail -n 1 /etc/mtab <span class=\"op\">&gt;&gt;</span> /etc/fstab</a>\r\n<a class=\"sourceLine\" id=\"cb18-16\" data-line-number=\"16\"><span class=\"co\"># 查看下样例网页</span></a>\r\n<a class=\"sourceLine\" id=\"cb18-17\" data-line-number=\"17\">[<span class=\"ex\">root@centos-156</span> httpd]# cat /var/www/html/index.html </a>\r\n<a class=\"sourceLine\" id=\"cb18-18\" data-line-number=\"18\"><span class=\"ex\">hellow</span> world</a></code></pre></div>\r\n<h3 id=\"配置httpd\">配置httpd</h3>\r\n<p>本部分内容需要在2个机器都要做一遍。</p>\r\n<div class=\"sourceCode\" id=\"cb19\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb19-1\" data-line-number=\"1\"><span class=\"co\"># 下载一个样例的php页面  </span></a>\r\n<a class=\"sourceLine\" id=\"cb19-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-156</span> httpd]# wget download.linuxpanda.tech/lamp/index.php.sample -O /var/www/html/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb19-3\" data-line-number=\"3\"><span class=\"co\"># 编辑下样例php页面的数据库连接用户和密码</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-156</span> httpd]# vim /var/www/html/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb19-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-156</span> httpd]# cat /var/www/html/index.php </a>\r\n<a class=\"sourceLine\" id=\"cb19-6\" data-line-number=\"6\"><span class=\"op\">&lt;</span><span class=\"ex\">?php</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-7\" data-line-number=\"7\"><span class=\"va\">$mysqli</span>=<span class=\"ex\">new</span> mysqli(<span class=\"st\">&quot;192.168.46.155&quot;</span>,<span class=\"st\">&quot;web&quot;</span>,<span class=\"st\">&quot;oracle&quot;</span>);</a>\r\n<a class=\"sourceLine\" id=\"cb19-8\" data-line-number=\"8\"><span class=\"ex\">if</span>(mysqli_connect_errno())<span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-9\" data-line-number=\"9\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;失败了&quot;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-10\" data-line-number=\"10\"><span class=\"va\">$mysqli</span>=<span class=\"ex\">null</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-11\" data-line-number=\"11\"><span class=\"bu\">exit</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-12\" data-line-number=\"12\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-13\" data-line-number=\"13\"><span class=\"bu\">echo</span> <span class=\"st\">&quot;成功了&quot;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-14\" data-line-number=\"14\"><span class=\"va\">$mysqli</span><span class=\"ex\">-</span><span class=\"op\">&gt;</span>close();</a>\r\n<a class=\"sourceLine\" id=\"cb19-15\" data-line-number=\"15\"><span class=\"ex\">?</span><span class=\"op\">&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-16\" data-line-number=\"16\"></a>\r\n<a class=\"sourceLine\" id=\"cb19-17\" data-line-number=\"17\"><span class=\"co\"># fcgi编辑</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-18\" data-line-number=\"18\">[<span class=\"ex\">root@centos-156</span> conf.d]# vim fcgid.conf </a>\r\n<a class=\"sourceLine\" id=\"cb19-19\" data-line-number=\"19\"><span class=\"co\"># 添加如下3行</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-20\" data-line-number=\"20\"><span class=\"ex\">DirectoryIndex</span> index.php</a>\r\n<a class=\"sourceLine\" id=\"cb19-21\" data-line-number=\"21\"><span class=\"ex\">ProxyRequests</span> Off</a>\r\n<a class=\"sourceLine\" id=\"cb19-22\" data-line-number=\"22\"><span class=\"ex\">ProxyPassMatch</span> ^/(.*\\.php)$ <span class=\"ex\">fcgi</span>://127.0.0.1:9000/var/www/html/<span class=\"va\">$1</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-23\" data-line-number=\"23\"><span class=\"co\"># 重启网络服务</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-24\" data-line-number=\"24\">[<span class=\"ex\">root@centos-156</span> conf.d]# service httpd restart</a></code></pre></div>\r\n<h3 id=\"本机测试\">本机测试</h3>\r\n<p>本部分内容需要在2个机器都要做一遍。</p>\r\n<div class=\"sourceCode\" id=\"cb20\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb20-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-156</span> conf.d]# curl localhost/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb20-2\" data-line-number=\"2\">成功了</a></code></pre></div>\r\n<h2 id=\"client测试\">client测试</h2>\r\n<div class=\"sourceCode\" id=\"cb21\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb21-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-159</span> ~]# curl http://www.linuxpanda.tech/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb21-2\" data-line-number=\"2\">成功了</a>\r\n<a class=\"sourceLine\" id=\"cb21-3\" data-line-number=\"3\"><span class=\"co\"># 把156的web停掉</span></a>\r\n<a class=\"sourceLine\" id=\"cb21-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-159</span> ~]# curl http://www.linuxpanda.tech/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb21-5\" data-line-number=\"5\">成功了</a>\r\n<a class=\"sourceLine\" id=\"cb21-6\" data-line-number=\"6\"><span class=\"co\"># 再把157的web停掉</span></a>\r\n<a class=\"sourceLine\" id=\"cb21-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-159</span> ~]# curl http://www.linuxpanda.tech/index.php</a>\r\n<a class=\"sourceLine\" id=\"cb21-8\" data-line-number=\"8\"><span class=\"ex\">curl</span>: (7) <span class=\"ex\">Failed</span> connect to www.linuxpanda.tech:80<span class=\"kw\">;</span> <span class=\"ex\">Connection</span> refused</a></code></pre></div>\r\n<h2 id=\"总结\">总结</h2>\r\n<p>这个作业，看起来挺简单的，做起来还是遇到些麻烦的。</p>\r\n<p>需要改进的地方：</p>\r\n<ol>\r\n<li>dns解析太不稳定，如果web1停掉，dns还可能解析到这个停掉的主机，就会导致web没法访问。</li>\r\n<li>mysql实例后面学习了主从可以考虑完善下。</li>\r\n<li>lamp没有使用xcache加速下</li>\r\n<li>本练习都是使用的yum安装的lamp环境，可以考虑使用编译安装方法。</li>\r\n<li>数据通过nfs共享，本质还是一个磁盘的数据，可以考虑使用rsync来替代nfs。</li>\r\n<li>数据文件可以考虑放到raid上，来提供文件的访问性能</li>\r\n</ol>\r\n<h2 id=\"参考\">参考</h2>\r\n<p><a href=\"http://linux.linuxpanda.tech/\" target=\"_blank\" rel=\"noopener\">我自己在马哥教育笔记1</a></p>\r\n<p><a href=\"http://services.linuxpanda.tech/\" target=\"_blank\" rel=\"noopener\">我自己在马哥教育笔记2</a></p>\r\n"},{"title":"gitlab本地部署","copyright":true,"top":10,"date":"2018-02-20T07:17:01.000Z","_content":"\n安装和配置必要的依赖\n-----------------------------------------------\n\n.. code-block:: bash\n\n    [root@centos-7 ~]# yum install postfix \n    [root@centos-7 ~]# systemctl start postfix\n    [root@centos-7 ~]# systemctl enable postfix\n\n如果postfix启动不起来，提示no local interface found for ::1。可以修改下\n/etc/postfix/main.cf中inet_interfaces = all。\n\n添加gitlab的仓库并安装包\n------------------------------------------------------\n\n执行脚本添加\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash \n\n    [root@centos-7 ~]# curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n    [root@centos-7 ~]# yum -y install gitlab-ce\n\n.. note:: 这个包大概440M大小，需要一定的等待时间。\n\n手工添加\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash \n\n    [root@centos-7 yum.repos.d]# vim gitlab-ce.repo\n    [gitlab-ce]\n    name=Gitlab CE Repository\n    baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/\n    gpgcheck=0\n    enabled=1\n\n这个使用清华的镜像，没有使用国外的，下载可能会快点。\n\n修改配置文件的url\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash \n\n    [root@centos-7 src]# vim /etc/gitlab/gitlab.rb \n    external_url 'http://localhost'\n\n启动下gitlab\n---------------------------------------------------------\n\n启动gitlab\n\n.. code-block:: bash\n\n    [root@centos-7 src]# systemctl enable gitlab-runsvdir.service\n    [root@centos-7 src]# gitlab-ctl  reconfigure\n\n这个配置大概需要10多分钟，耐心等待，我是centos7的系统，安装一直有问题。\n\n错误修复\n\n.. code-block:: bash \n\n    [root@www ~]# yum install gem \n    [root@www ~]# gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/\n    [root@centos-7 src]# gitlab-ctl  reconfigure\n\n测试\n------------------------------------------------------\n\n.. image:: /images/git/gitlab登陆.png\n\n登陆账号root,密码：5iveL!fe\n\n.. image:: /images/git/gitlab修改密码.png\n\n.. image:: /images/git/gitlab登陆2.png\n\n.. image:: /images/git/gitlab主页.png\n\n禁止注册\n---------------------------------------------\n\n公司内部是禁止注册的，需要的话练习管理员给开账号。\n\n.. image:: /images/git/gitlab禁止注册.png\n\n参考\n---------------------------------------------\n\n官方参考_\n\n.. _官方参考:  https://about.gitlab.com/installation/\n\n","source":"_posts/gitlab本地部署.rst","raw":"---\ntitle: gitlab本地部署\ntags:\n  - linux\n  - git \n  - gitlab\ncategories: linux\ncopyright: true\ntop: 10\ndate: 2018-02-20 15:17:01\n---\n\n安装和配置必要的依赖\n-----------------------------------------------\n\n.. code-block:: bash\n\n    [root@centos-7 ~]# yum install postfix \n    [root@centos-7 ~]# systemctl start postfix\n    [root@centos-7 ~]# systemctl enable postfix\n\n如果postfix启动不起来，提示no local interface found for ::1。可以修改下\n/etc/postfix/main.cf中inet_interfaces = all。\n\n添加gitlab的仓库并安装包\n------------------------------------------------------\n\n执行脚本添加\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash \n\n    [root@centos-7 ~]# curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash\n    [root@centos-7 ~]# yum -y install gitlab-ce\n\n.. note:: 这个包大概440M大小，需要一定的等待时间。\n\n手工添加\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash \n\n    [root@centos-7 yum.repos.d]# vim gitlab-ce.repo\n    [gitlab-ce]\n    name=Gitlab CE Repository\n    baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/\n    gpgcheck=0\n    enabled=1\n\n这个使用清华的镜像，没有使用国外的，下载可能会快点。\n\n修改配置文件的url\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash \n\n    [root@centos-7 src]# vim /etc/gitlab/gitlab.rb \n    external_url 'http://localhost'\n\n启动下gitlab\n---------------------------------------------------------\n\n启动gitlab\n\n.. code-block:: bash\n\n    [root@centos-7 src]# systemctl enable gitlab-runsvdir.service\n    [root@centos-7 src]# gitlab-ctl  reconfigure\n\n这个配置大概需要10多分钟，耐心等待，我是centos7的系统，安装一直有问题。\n\n错误修复\n\n.. code-block:: bash \n\n    [root@www ~]# yum install gem \n    [root@www ~]# gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/\n    [root@centos-7 src]# gitlab-ctl  reconfigure\n\n测试\n------------------------------------------------------\n\n.. image:: /images/git/gitlab登陆.png\n\n登陆账号root,密码：5iveL!fe\n\n.. image:: /images/git/gitlab修改密码.png\n\n.. image:: /images/git/gitlab登陆2.png\n\n.. image:: /images/git/gitlab主页.png\n\n禁止注册\n---------------------------------------------\n\n公司内部是禁止注册的，需要的话练习管理员给开账号。\n\n.. image:: /images/git/gitlab禁止注册.png\n\n参考\n---------------------------------------------\n\n官方参考_\n\n.. _官方参考:  https://about.gitlab.com/installation/\n\n","slug":"gitlab本地部署","published":1,"updated":"2018-02-20T07:18:41.588Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mnd0008ugtmt153n4qx","content":"<h2 id=\"安装和配置必要的依赖\">安装和配置必要的依赖</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> ~]# yum install postfix </a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-7</span> ~]# systemctl start postfix</a>\r\n<a class=\"sourceLine\" id=\"cb1-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-7</span> ~]# systemctl enable postfix</a></code></pre></div>\r\n<p>如果postfix启动不起来，提示no local interface found for ::1。可以修改下 /etc/postfix/main.cf中inet_interfaces = all。</p>\r\n<h2 id=\"添加gitlab的仓库并安装包\">添加gitlab的仓库并安装包</h2>\r\n<h3 id=\"执行脚本添加\">执行脚本添加</h3>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> ~]# curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh <span class=\"kw\">|</span> <span class=\"fu\">sudo</span> bash</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-7</span> ~]# yum -y install gitlab-ce</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>这个包大概440M大小，需要一定的等待时间。</p>\r\n</div>\r\n<h3 id=\"手工添加\">手工添加</h3>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> yum.repos.d]# vim gitlab-ce.repo</a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\">[<span class=\"ex\">gitlab-ce</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"><span class=\"va\">name=</span>Gitlab <span class=\"ex\">CE</span> Repository</a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"va\">baseurl=</span>https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"va\">gpgcheck=</span>0</a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"><span class=\"va\">enabled=</span>1</a></code></pre></div>\r\n<p>这个使用清华的镜像，没有使用国外的，下载可能会快点。</p>\r\n<h3 id=\"修改配置文件的url\">修改配置文件的url</h3>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> src]# vim /etc/gitlab/gitlab.rb </a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\"><span class=\"ex\">external_url</span> <span class=\"st\">&#39;http://localhost&#39;</span></a></code></pre></div>\r\n<h2 id=\"启动下gitlab\">启动下gitlab</h2>\r\n<p>启动gitlab</p>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> src]# systemctl enable gitlab-runsvdir.service</a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-7</span> src]# gitlab-ctl  reconfigure</a></code></pre></div>\r\n<p>这个配置大概需要10多分钟，耐心等待，我是centos7的系统，安装一直有问题。</p>\r\n<p>错误修复</p>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> ~]# yum install gem </a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">[<span class=\"ex\">root@www</span> ~]# gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/</a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-7</span> src]# gitlab-ctl  reconfigure</a></code></pre></div>\r\n<h2 id=\"测试\">测试</h2>\r\n<p><img src=\"/images/git/gitlab登陆.png\" alt=\"image\"></p>\r\n<p>登陆账号root,密码：5iveL!fe</p>\r\n<p><img src=\"/images/git/gitlab修改密码.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitlab登陆2.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitlab主页.png\" alt=\"image\"></p>\r\n<h2 id=\"禁止注册\">禁止注册</h2>\r\n<p>公司内部是禁止注册的，需要的话练习管理员给开账号。</p>\r\n<p><img src=\"/images/git/gitlab禁止注册.png\" alt=\"image\"></p>\r\n<h2 id=\"参考\">参考</h2>\r\n<p><a href=\"https://about.gitlab.com/installation/\" target=\"_blank\" rel=\"noopener\">官方参考</a></p>\r\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装和配置必要的依赖\">安装和配置必要的依赖</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> ~]# yum install postfix </a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-7</span> ~]# systemctl start postfix</a>\r\n<a class=\"sourceLine\" id=\"cb1-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-7</span> ~]# systemctl enable postfix</a></code></pre></div>\r\n<p>如果postfix启动不起来，提示no local interface found for ::1。可以修改下 /etc/postfix/main.cf中inet_interfaces = all。</p>\r\n<h2 id=\"添加gitlab的仓库并安装包\">添加gitlab的仓库并安装包</h2>\r\n<h3 id=\"执行脚本添加\">执行脚本添加</h3>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> ~]# curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh <span class=\"kw\">|</span> <span class=\"fu\">sudo</span> bash</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-7</span> ~]# yum -y install gitlab-ce</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>这个包大概440M大小，需要一定的等待时间。</p>\r\n</div>\r\n<h3 id=\"手工添加\">手工添加</h3>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> yum.repos.d]# vim gitlab-ce.repo</a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\">[<span class=\"ex\">gitlab-ce</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"><span class=\"va\">name=</span>Gitlab <span class=\"ex\">CE</span> Repository</a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"va\">baseurl=</span>https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"va\">gpgcheck=</span>0</a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"><span class=\"va\">enabled=</span>1</a></code></pre></div>\r\n<p>这个使用清华的镜像，没有使用国外的，下载可能会快点。</p>\r\n<h3 id=\"修改配置文件的url\">修改配置文件的url</h3>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> src]# vim /etc/gitlab/gitlab.rb </a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\"><span class=\"ex\">external_url</span> <span class=\"st\">&#39;http://localhost&#39;</span></a></code></pre></div>\r\n<h2 id=\"启动下gitlab\">启动下gitlab</h2>\r\n<p>启动gitlab</p>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> src]# systemctl enable gitlab-runsvdir.service</a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-7</span> src]# gitlab-ctl  reconfigure</a></code></pre></div>\r\n<p>这个配置大概需要10多分钟，耐心等待，我是centos7的系统，安装一直有问题。</p>\r\n<p>错误修复</p>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> ~]# yum install gem </a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">[<span class=\"ex\">root@www</span> ~]# gem sources --add https://gems.ruby-china.org/ --remove https://rubygems.org/</a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-7</span> src]# gitlab-ctl  reconfigure</a></code></pre></div>\r\n<h2 id=\"测试\">测试</h2>\r\n<p><img src=\"/images/git/gitlab登陆.png\" alt=\"image\"></p>\r\n<p>登陆账号root,密码：5iveL!fe</p>\r\n<p><img src=\"/images/git/gitlab修改密码.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitlab登陆2.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitlab主页.png\" alt=\"image\"></p>\r\n<h2 id=\"禁止注册\">禁止注册</h2>\r\n<p>公司内部是禁止注册的，需要的话练习管理员给开账号。</p>\r\n<p><img src=\"/images/git/gitlab禁止注册.png\" alt=\"image\"></p>\r\n<h2 id=\"参考\">参考</h2>\r\n<p><a href=\"https://about.gitlab.com/installation/\" target=\"_blank\" rel=\"noopener\">官方参考</a></p>\r\n"},{"title":"lamp一键编译安装","copyright":true,"top":10,"date":"2018-02-18T07:50:36.000Z","_content":"\n安装\n----------------------------------------------------------\n\n.. code-block:: bash\n\n  curl https://raw.githubusercontent.com/zhaojiedi1992/lamp/master/install.sh  | bash \n\n代码托管在github上。 地址_\n\n.. _地址: https://github.com/zhaojiedi1992/lamp","source":"_posts/lamp一键编译安装.rst","raw":"---\ntitle: lamp一键编译安装\ntags:\n  - linux\ncategories: linux\ncopyright: true\ntop: 10\ndate: 2018-02-18 15:50:36\n---\n\n安装\n----------------------------------------------------------\n\n.. code-block:: bash\n\n  curl https://raw.githubusercontent.com/zhaojiedi1992/lamp/master/install.sh  | bash \n\n代码托管在github上。 地址_\n\n.. _地址: https://github.com/zhaojiedi1992/lamp","slug":"lamp一键编译安装","published":1,"updated":"2018-02-18T08:09:58.956Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mne000augtmpwf5xm50","content":"<h2 id=\"安装\">安装</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\"><span class=\"ex\">curl</span> https://raw.githubusercontent.com/zhaojiedi1992/lamp/master/install.sh  <span class=\"kw\">|</span> <span class=\"fu\">bash</span> </a></code></pre></div>\r\n<p>代码托管在github上。 <a href=\"https://github.com/zhaojiedi1992/lamp\" target=\"_blank\" rel=\"noopener\">地址</a></p>\r\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"安装\">安装</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\"><span class=\"ex\">curl</span> https://raw.githubusercontent.com/zhaojiedi1992/lamp/master/install.sh  <span class=\"kw\">|</span> <span class=\"fu\">bash</span> </a></code></pre></div>\r\n<p>代码托管在github上。 <a href=\"https://github.com/zhaojiedi1992/lamp\" target=\"_blank\" rel=\"noopener\">地址</a></p>\r\n"},{"title":"gitbucket本地部署","copyright":true,"top":70,"date":"2018-02-20T07:16:03.000Z","_content":"\n下载软件包\n-----------------------------------------\n\n.. code-block:: bash \n\n    [root@centos-7 src]# wget https://github.com/gitbucket/gitbucket/archive/4.21.2.tar.gz\n\n运行服务\n---------------------------------------------------\n\n.. code-block:: bash \n\n    [root@centos-150 src]# java -jar gitbucket.war\n\n测试\n---------------------------------------------------\n\n.. image:: /images/git/gitbucket主页.png\n\n.. image:: /images/git/gitbucket登录.png\n\n.. image:: /images/git/gitbucket创建仓库.png\n\n.. image:: /images/git/gitbucket效果图.png\n\n\n参考\n--------------------------------------------\n\n官方安装指南_\n\n.. _官方安装指南: https://github.com/gitbucket/gitbucket#installation","source":"_posts/gitbucket本地部署.rst","raw":"---\ntitle: gitbucket本地部署\ntags:\n  - linux\n  - git\n  - gitbucket\ncategories: linux\ncopyright: true\ntop: 70\ndate: 2018-02-20 15:16:03\n---\n\n下载软件包\n-----------------------------------------\n\n.. code-block:: bash \n\n    [root@centos-7 src]# wget https://github.com/gitbucket/gitbucket/archive/4.21.2.tar.gz\n\n运行服务\n---------------------------------------------------\n\n.. code-block:: bash \n\n    [root@centos-150 src]# java -jar gitbucket.war\n\n测试\n---------------------------------------------------\n\n.. image:: /images/git/gitbucket主页.png\n\n.. image:: /images/git/gitbucket登录.png\n\n.. image:: /images/git/gitbucket创建仓库.png\n\n.. image:: /images/git/gitbucket效果图.png\n\n\n参考\n--------------------------------------------\n\n官方安装指南_\n\n.. _官方安装指南: https://github.com/gitbucket/gitbucket#installation","slug":"gitbucket本地部署","published":1,"updated":"2018-02-20T07:18:05.874Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mno000fugtmhlvcnalx","content":"<h2 id=\"下载软件包\">下载软件包</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> src]# wget https://github.com/gitbucket/gitbucket/archive/4.21.2.tar.gz</a></code></pre></div>\r\n<h2 id=\"运行服务\">运行服务</h2>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-150</span> src]# java -jar gitbucket.war</a></code></pre></div>\r\n<h2 id=\"测试\">测试</h2>\r\n<p><img src=\"/images/git/gitbucket主页.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitbucket登录.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitbucket创建仓库.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitbucket效果图.png\" alt=\"image\"></p>\r\n<h2 id=\"参考\">参考</h2>\r\n<p><a href=\"https://github.com/gitbucket/gitbucket#installation\" target=\"_blank\" rel=\"noopener\">官方安装指南</a></p>\r\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"下载软件包\">下载软件包</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-7</span> src]# wget https://github.com/gitbucket/gitbucket/archive/4.21.2.tar.gz</a></code></pre></div>\r\n<h2 id=\"运行服务\">运行服务</h2>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-150</span> src]# java -jar gitbucket.war</a></code></pre></div>\r\n<h2 id=\"测试\">测试</h2>\r\n<p><img src=\"/images/git/gitbucket主页.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitbucket登录.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitbucket创建仓库.png\" alt=\"image\"></p>\r\n<p><img src=\"/images/git/gitbucket效果图.png\" alt=\"image\"></p>\r\n<h2 id=\"参考\">参考</h2>\r\n<p><a href=\"https://github.com/gitbucket/gitbucket#installation\" target=\"_blank\" rel=\"noopener\">官方安装指南</a></p>\r\n"},{"layout":"database","title":"mariadb多实例的三种实现","date":"2018-02-02T07:42:13.000Z","copyright":true,"top":90,"_content":"\nmariadb多实例实现方式: \n\nmysqld_multi\n    这个是使用单独的配置文件来配置多个实例，不过管理实例还是很方便的。\n多个sysv配置\n    这个方式相当于每个mairadb实例为一个不同的服务而已，每个实例一套sysv脚本。\n    配置起来比较简单，如果实例过多管理起来比较麻烦。\nsystemd\n    这个是systemd管理的特有的。\n\n配置前规划\n---------------------------------------------------------\n\n上面mairadb的多实例有多种配置方法， 我们先规划如下：\n\n.. csv-table:: \n   :header: \"方案\", \"主目录\", \"端口规划\",\"其他\"\n   :widths: 30, 30, 30,30\n\n   \"方案1\", \"/data/scheme1/mysql/\", \"3307,3308\",\"\"\n   \"方案2\", \"/data/scheme2/mysql/\", \"4307,4308\",\"\"\n   \"方案3\", \"/data/scheme3/mysql/\", \"5307,5308\",\"\"\n\n配置前的环境设置\n---------------------------------------------------------\n\n关闭selinux\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# setenforce 0\n    [root@centos-158 ~]# sed -i 's@SELINUX=.*@SELINUX=disabled@' /etc/sysconfig/selinux\n\n关闭防火墙\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# systemctl stop firewalld\n    [root@centos-158 ~]# systemctl disable firewalld\n\n安装mariadb\n---------------------------------------------------------\n\n这里我不使用centos默认的版本，使用最新稳定版本10.2。\n\n上面的基础规划完毕，需要配置下 mariadb的yum源_。\n\n.. _mariadb的yum源: https://downloads.mariadb.org/mariadb/repositories/#mirror=neusoft&distro=CentOS&distro_release=centos7-amd64--centos7&version=10.2\n\n.. code-block:: bash\n\n    [root@centos-158 yum.repos.d]# vim mariadb.repo                             # 添加/etc/yum.repos.d/mariadb.repo文件\n    [root@centos-158 yum.repos.d]# cat mariadb.repo                             # 检查这个文件\n    [root@centos-158 yum.repos.d]# cat mariadb.repo \n    # MariaDB 10.2 CentOS repository list - created 2018-01-27 14:09 UTC\n    # http://downloads.mariadb.org/mariadb/repositories/\n    [mariadb]\n    name = MariaDB\n    #这个地方的配置是国外的，下载太慢了。 我给改成清华镜像站点的了，这样下载会快点。\n    baseurl =https://mirrors.tuna.tsinghua.edu.cn/mariadb//mariadb-10.2.12/yum/centos/7Server/x86_64/\n    gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\n    gpgcheck=1\n\n    [root@centos-158 yum.repos.d]# yum install MariaDB-server MariaDB-client -y # 安装server和client\n\n.. note:: 这个包名是区分大小写的，使用rpm查询包提供文件的时候注意大小写。\n\n方案1-mysqld_multi\n----------------------------------------------------------\n\n创建目录并修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mkdir -pv /data/scheme1/mysql/{3307,3308}/data         # 创建目录\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme1/mysql/330{7,8} -R      # 修改权限\n\n安装数据库\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录\n\n配置文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mv /etc/my.conf /etc/my.conf.yumbak                # 重命名文件，别影响接下来的实验，其实不必要的\n    [root@centos-158 ~]# vim /etc/my.conf                                   # 编辑\n    [root@centos-158 ~]# cat /etc/my.conf                                   # 查看\n    [mysqld_multi]\n    mysqld     = /usr/bin/mysqld_safe\n    mysqladmin = /usr/bin/mysqladmin\n    user       = multi_admin\n    password   = zhaojiedi\n\n    [mysqld3307]\n    socket     = /data/scheme1/mysql/3307/mariadb.sock\n    port       = 3307\n    pid-file   = /data/scheme1/mysql/3307/mariadb.pid \n    datadir    = /data/scheme1/mysql/3307/data \n    user       = mysql\n\n    [mysqld3308]\n    socket     = /data/scheme1/mysql/3308/mariadb.sock\n    port       = 3308\n    pid-file   = /data/scheme1/mysql/3308/mariadb.pid \n    datadir    = /data/scheme1/mysql/3308/data \n    user       = mysql\n\n.. note:: 更多的参数官方文档。\n\n启动实例\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysqld_multi start 3307                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307\n    [root@centos-158 ~]# mysqld_multi start 3308                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307\n\n    [root@centos-158 ~]# netstat -tunlp |grep 330*                      # 查看服务\n    tcp6       0      0 :::3307                 :::*                    LISTEN      2631/mysqld         \n    tcp6       0      0 :::3308                 :::*                    LISTEN      2746/mysqld \n\n.. note:: mysqld_multi start 3307-3308来批量启动，多个矢量还可以逗号分割。\n\n安全初始化脚本运行\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_secure_installation -S /data/scheme1/mysql/3307/mariadb.sock  # 使用socket连接3307实例\n    # 下面内容只跳出重要的输入项列出\n    Enter current password for root (enter for none):              # 默认密码空，直接回车即可\n    Set root password? [Y/n] y                                     # 输入y\n    New password:                                                  # 输入root用户密码，注意不是系统密码，是数据库密码\n    Re-enter new password:                                         # 再次确认\n    Remove anonymous users? [Y/n] y                                # 移除匿名用户\n    Disallow root login remotely? [Y/n] y                          # 禁止root用户远程登陆，这个看你具体情况设置\n    Remove test database and access to it? [Y/n] y                 # 移除test数据库\n    Reload privilege tables now? [Y/n] y                           # 刷新权限表\n    [root@centos-158 ~]# mysql_secure_installation -S /data/scheme1/mysql/3308/mariadb.sock  # 使用socket连接3308实例\n\n添加多实例管理用户\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# vim create_user.sql                        # 添加用户脚本\n    [root@centos-158 ~]# cat create_user.sql                        # 检查\n    CREATE USER 'multi_admin'@'localhost' IDENTIFIED BY 'multi_admin';\n    GRANT SHUTDOWN ON *.* TO 'multi_admin'@'localhost';\n    flush privileges; \n\n    [root@centos-158 ~]# cat create_user.sql | mysql -u root -S /data/scheme1/mysql/3307/mariadb.sock -p #执行脚本\n    Enter password: \n    [root@centos-158 ~]# cat create_user.sql | mysql -u root -S /data/scheme1/mysql/3308/mariadb.sock -p # 执行脚本\n    Enter password: \n\n更多 mysqld-multi_ 使用帮助。\n\n.. _mysqld-multi: https://dev.mysql.com/doc/refman/5.7/en/mysqld-multi.html\n\n查看和关闭实例\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysqld_multi report                        # 查看服务状态\n    Reporting MariaDB servers\n    MariaDB server from group: mysqld3307 is running\n    MariaDB server from group: mysqld3308 is running\n    [root@centos-158 ~]# mysqld_multi stop 3307                     # 关闭一个实例\n    [root@centos-158 ~]# mysqld_multi report                        # 查看服务状态\n    Reporting MariaDB servers\n    MariaDB server from group: mysqld3307 is not running\n    MariaDB server from group: mysqld3308 is running\n\n开机启动\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n直接加入到rc.local中\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# echo `which mysqld_multi` start 3307-3308  >> /etc/rc.local        # 开机执行\n    [root@centos-158 ~]# tail -n 1 /etc/rc.local \n    /usr/bin/mysqld_multi start 3307-3308\n\n上面的加入rc.local方式管理上容易混乱，还是写个sysv脚本好些。\n\n.. code-block:: bash\n\n    [root@centos-158 init.d]# cd /etc/rc.d/init.d/\n    [root@centos-158 init.d]# vim mysqld_multi \n    [root@centos-158 init.d]# cat mysqld_multi \n    #! /bin/bash\n    # chkconfig: 2345 90 10\n    # description: mysqld_multi\n\n    # See how we were called.\n    mysqld_multi=/usr/local/mysql/bin/mysqld_multi\n    # 实例列表\n    instance_list=\"3307-3308\"\n    #instance_list=\"3307,3308,3309-3310\"\n    start(){\n        $mysqld_multi start $instance_list\t\n    }\n    stop(){\n        $mysqld_multi stop $instance_list\n    }\n    status(){\n        $mysqld_multi report\n    }\n    case \"$1\" in\n    start)\n        start\n            ;;\n    stop)\n        stop\n            ;;\n    status)\n        status\n            ;;\n    restart)\n        start\n        stop\n            ;;\n    *)\n        echo $\"Usage: $0 {start|stop|status}\"\n        exit 2\n    esac\n\n    [root@centos-158 init.d]# chkconfig --add mysqld_multi                  # 添加sysv\n    [root@centos-158 init.d]# chkconfig mysqld_multi on                     # 启用mysqld_multi\n\n\n方案2-多sysv脚本\n------------------------------------------------------------------------------\n\n创建目录并修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下\n\n.. code-block:: bash\n\n    [root@centos-158 ~]#  mkdir -pv /data/scheme2/mysql/{4307,4308}/{data,etc,log,socket,pid,service}       # 创建目录\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme2/mysql/4307 -R                                      # 修改所有者\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme2/mysql/4308 -R                                      # 修改所有者\n\n\n安装数据库\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4307/data --basedir=/usr --user=mysql  # 安装数据库\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4308/data --basedir=/usr --user=mysql  # 安装数据库\n\n配置配置文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# cd /data/scheme2/mysql/4307/etc/                           # 进入配置目录\n    [root@centos-158 etc]# vim my.cnf                                               # 编辑单独的配置文件              \n    [root@centos-158 etc]# cat my.cnf                                               # 检查\n    [mysqld]\n    port=4307\n    datadir=/data/scheme2/mysql/4307/data\n    socket=/data/scheme2/mysql/4307/socket/mariadb.sock\n    [mysqld-safe]\n    log-error=/data/scheme2/mysql/4307/log/mariadb.log\n    pid-file=/data/scheme2/mysql/4308/pid/mariadb.pid\n\n    [root@centos-158 etc]# cp my.cnf ../../4308/etc/my.cnf                          # 复制到另一个实例中去\n    [root@centos-158 etc]# sed -i 's@4307@4308@' ../../4308/etc/my.cnf              # 修改配置的端口\n    [root@centos-158 etc]# cat ../../4308/etc/my.cnf                                # 检查\n    [mysqld]\n    port=4308\n    datadir=/data/scheme2/mysql/4308/data\n    socket=/data/scheme2/mysql/4308/socket/mariadb.sock\n    [mysqld-safe]\n    log-error=/data/scheme2/mysql/4308/log/mariadb.log\n    pid-file=/data/scheme2/mysql/4308/pid/mariadb.pid\n\n配置服务文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# vim service/mysqld.sh                                   # 编辑sysv脚本\n    [root@centos-158 4307]# cat service/mysqld.sh                                   # 检查\n    #!/bin/bash\n    # chkconfig: 2345 91 19\n    # description: manage mariadb \n\n    port=4307\n    mysql_user=\"root\"\n    mysql_pwd=\"\"\n    mysql_basedir=\"/data/scheme2/mysql\"\n    #cmd_path=\"${mysql_basedir}/${port}/bin\"\n    cmd_path=\"/usr/bin\"\n    mysql_sock=\"${mysql_basedir}/${port}/socket/mariadb.sock\"\n\n    function_start_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"Starting MySQL...\\n\"\n        cmd=\"${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf\"\n        printf \"$cmd\\n\"\n        ${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf  &> /dev/null  &\n        else\n        printf \"MySQL is running...\\n\"\n        exit\n        fi\n    }\n    function_status_mysql(){\n            if [ -e \"$mysql_sock\" ] ; then\n                    printf \"MySql is running...\\n\"\n            else\n                    printf \"MySql is stopped...\\n\"\n            fi\n    }\n\n    function_stop_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"MySQL is stopped...\\n\"\n        exit\n        else\n        printf \"Stoping MySQL...\\n\"\n        ${cmd_path}/mysqladmin -u ${mysql_user} -p${mysql_pwd} -S ${mysql_sock} shutdown\n    fi\n    }\n\n\n    function_restart_mysql()\n    {\n        printf \"Restarting MySQL...\\n\"\n        function_stop_mysql\n        sleep 2\n        function_start_mysql\n    }\n\n    case $1 in\n    start)\n            function_start_mysql\n            ;;\n    stop)\n            function_stop_mysql\n            ;;\n    restart)\n            function_restart_mysql\n            ;;\n    status)\n            function_status_mysql\n            ;;\n    *)\n        printf \"Usage: ${cmd_path}/mysqld {start|stop|restart|status}\\n\"\n    esac\n\n\n    [root@centos-158 4307]# cp service/mysqld.sh  ../4308/service/mysqld.sh     # 复制一份\n    [root@centos-158 4307]# sed -i 's@4307@4308@' ../4308/service/mysqld.sh     # 修改端口\n    [root@centos-158 4307]# cat ../4308/service/mysqld.sh                       # 检查\n    #!/bin/bash\n    # chkconfig: 2345 91 19\n    # description: manage mariadb \n\n    port=4308\n    mysql_user=\"root\"\n    mysql_pwd=\"\"\n    mysql_basedir=\"/data/scheme2/mysql\"\n    #cmd_path=\"${mysql_basedir}/${port}/bin\"\n    cmd_path=\"/usr/bin\"\n    mysql_sock=\"${mysql_basedir}/${port}/socket/mariadb.sock\"\n\n    function_start_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"Starting MySQL...\\n\"\n        cmd=\"${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf\"\n        printf \"$cmd\\n\"\n        ${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf  &> /dev/null  &\n        else\n        printf \"MySQL is running...\\n\"\n        exit\n        fi\n    }\n    function_status_mysql(){\n            if [ -e \"$mysql_sock\" ] ; then\n                    printf \"MySql is running...\\n\"\n            else\n                    printf \"MySql is stopped...\\n\"\n            fi\n    }\n\n    function_stop_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"MySQL is stopped...\\n\"\n        exit\n        else\n        printf \"Stoping MySQL...\\n\"\n        ${cmd_path}/mysqladmin -u ${mysql_user} -p${mysql_pwd} -S ${mysql_sock} shutdown\n    fi\n    }\n\n\n    function_restart_mysql()\n    {\n        printf \"Restarting MySQL...\\n\"\n        function_stop_mysql\n        sleep 2\n        function_start_mysql\n    }\n\n    case $1 in\n    start)\n            function_start_mysql\n            ;;\n    stop)\n            function_stop_mysql\n            ;;\n    restart)\n            function_restart_mysql\n            ;;\n    status)\n            function_status_mysql\n            ;;\n    *)\n        printf \"Usage: ${cmd_path}/mysqld {start|stop|restart|status}\\n\"\n    esac\n\n    # 添加执行权限\n    [root@centos-158 4307]# chmod a+x /data/scheme2/mysql/4307/service/mysqld.sh \n    [root@centos-158 4307]# chmod a+x /data/scheme2/mysql/4308/service/mysqld.sh\n\n开机启动\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# ln -s /data/scheme2/mysql/4307/service/mysqld.sh /etc/rc.d/init.d/mysql4307     # 添加到init.d目录\n    [root@centos-158 4307]# chkconfig --add mysql4307                                                       # 添加到sysv\n    [root@centos-158 4307]# chkconfig mysql4307 on                                                          # 开机启动\n\n    [root@centos-158 4307]# cd ../4308\n\n    [root@centos-158 4308]# ln -s /data/scheme2/mysql/4308/service/mysqld.sh /etc/rc.d/init.d/mysql4308     # 添加到init.d目录\n    [root@centos-158 4308]# chkconfig --add mysql4308                                                       # 添加到sysv\n    [root@centos-158 4308]# chkconfig mysql4308 on                                                          # 开机启动\n\n启动服务和查看状态\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# service mysql4307 start                     # 启动实例\n    [root@centos-158 4307]# service mysql4308 start                     # 启动实例      \n    [root@centos-158 4307]# netstat -tunlp |grep 430                    # 查看状态\n    tcp6       0      0 :::4307                 :::*                    LISTEN      8221/mysqld         \n    tcp6       0      0 :::4308                 :::*                    LISTEN      8369/mysqld \n\n安全初始化\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4307/socket/mariadb.sock # 安全初始化，参考方案1\n    [root@centos-158 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4308/socket/mariadb.sock # 安全初始化，参考方案1\n\n服务文件修改密码\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码\n    mysql_pwd=\"xxxxx\"\n    [root@centos-158 4307]# chmod 750 service/mysqld.sh         # 带有密码设置下权限\n    [root@centos-158 4307]# cd ../4308                          \n    [root@centos-158 4308]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码\n    mysql_pwd=\"xxxxx\"\n    [root@centos-158 4308]# chmod 750 service/mysqld.sh         # 带有密码设置下权限\n\n方案3-systemd\n---------------------------------------------------------------------\n\n创建目录并修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mkdir -pv /data/scheme3/mysql/{5307,5308}/{data,log,socket,pid}        # 创建目录\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme3/mysql/5307 -R                          # 所有者修改\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme3/mysql/5308 -R                          # 所有者修改\n\n安装数据库\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5307/data --basedir=/usr --user=mysql  # 安装数据库\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5308/data --basedir=/usr --user=mysql  # 安装数据库\n\n配置配置文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mv /etc/my.cnf /etc/my.cnf.multi                       # 原有配置文件重名\n    [root@centos-158 system]# cd /etc/my.cnf.d/                                 # 进入conf.d目录\n                \n    [root@centos-158 my.cnf.d]# vim my5307.cnf                                  # 编辑这个文件，名字为my<instance_nam>.cnf\n    [root@centos-158 my.cnf.d]# cat my5307.cnf                                  # 检查\n    [mysqld]\n    datadir=/data/scheme3/mysql/5307/data\n    socket=/data/scheme3/mysql/5307/socket/mariadb.sock\n    port=5307\n    log-error=/data/scheme3/mysql/5307/log/mariadb.log\n    pid-file=/data/scheme3/mysql/5307/pid/mariadb.pid\n    [root@centos-158 my.cnf.d]# vim my5308.cnf                                  # 编辑这个文件\n    [root@centos-158 my.cnf.d]# cat my5308.cnf                                  # 检查\n    [mysql]\n    datadir=/data/scheme3/mysql/5308/data\n    socket=/data/scheme3/mysql/5308/socket/mariadb.sock\n    port=5308\n    log-error=/data/scheme3/mysql/5308/log/mariadb.log\n    pid-file=/data/scheme3/mysql/5308/pid/mariadb.pid\n\n配置systemd\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 my.cnf.d]# vim /usr/lib/systemd/system/mariadb@.service        # 修改mariadb@service文件默认项\n    # 修改如下内容\n    ConditionPathExists=/etc/my.cnf.d/my%I.cnf\n\n    ExecStartPre=/bin/sh -c \"[ ! -e /usr/bin/galera_recovery ] && VAR= || \\\n    VAR=`/usr/bin/galera_recovery --defaults-file=/etc/my.cnf.d/my%I.cnf`; [ $? -eq 0 ] \\\n    && systemctl set-environment _WSREP_START_POSITION%I=$VAR || exit 1\"\n\n    ExecStart=/usr/sbin/mysqld --defaults-file=/etc/my.cnf.d/my%I.cnf \\\n    $_WSREP_NEW_CLUSTER $_WSREP_START_POSITION%I $MYSQLD_OPTS\n\n上面的简单的说就是说明下mysqld命令的路径，指定你的实例所在的路径%I代表实例名字。后续启动的 \"systemctl start mariadb\\@5307\" 这个命令中，5307就是实例名字。\n\n这个文件有点多， 提供一个下载参考吧。\n\n:download:`/files/mariadb@.service` \n\n启动服务和查看状态\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 my.cnf.d]# systemctl daemon-reload                 # 重载systemd\n    [root@centos-158 my.cnf.d]# systemctl start mariadb@5307            # 启动实例\n    [root@centos-158 my.cnf.d]# systemctl start mariadb@5308            # 启动实例\n    [root@centos-158 my.cnf.d]# netstat -tunlp |grep 530                # 查看服务状态\n    tcp6       0      0 :::5307                 :::*                    LISTEN      10267/mysqld        \n    tcp6       0      0 :::5308                 :::*                    LISTEN      10595/mysqld  \n\n开机启动\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 my.cnf.d]# systemctl enable  mariadb@5307           # 开机启动这个实例\n    Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5307.service to /usr/lib/systemd/system/mariadb@.service.\n    [root@centos-158 my.cnf.d]# systemctl enable  mariadb@5308           # 开机启动这个实例\n    Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5308.service to /usr/lib/systemd/system/mariadb@.service.\n\n安全初始化\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5307/socket/mariadb.sock    # 安全设置\n    [root@centos-158 ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5308/socket/mariadb.sock    # 安全设置\n","source":"_posts/mariadb多实例的三种实现.rst","raw":"---\nlayout: database\ntitle: mariadb多实例的三种实现\ndate: 2018-02-02 15:42:13\ntags: [\"mysql\", \"mariadb\", \"linux\"] \ncategories: database\ncopyright: true\ntop: 90\n---\n\nmariadb多实例实现方式: \n\nmysqld_multi\n    这个是使用单独的配置文件来配置多个实例，不过管理实例还是很方便的。\n多个sysv配置\n    这个方式相当于每个mairadb实例为一个不同的服务而已，每个实例一套sysv脚本。\n    配置起来比较简单，如果实例过多管理起来比较麻烦。\nsystemd\n    这个是systemd管理的特有的。\n\n配置前规划\n---------------------------------------------------------\n\n上面mairadb的多实例有多种配置方法， 我们先规划如下：\n\n.. csv-table:: \n   :header: \"方案\", \"主目录\", \"端口规划\",\"其他\"\n   :widths: 30, 30, 30,30\n\n   \"方案1\", \"/data/scheme1/mysql/\", \"3307,3308\",\"\"\n   \"方案2\", \"/data/scheme2/mysql/\", \"4307,4308\",\"\"\n   \"方案3\", \"/data/scheme3/mysql/\", \"5307,5308\",\"\"\n\n配置前的环境设置\n---------------------------------------------------------\n\n关闭selinux\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# setenforce 0\n    [root@centos-158 ~]# sed -i 's@SELINUX=.*@SELINUX=disabled@' /etc/sysconfig/selinux\n\n关闭防火墙\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# systemctl stop firewalld\n    [root@centos-158 ~]# systemctl disable firewalld\n\n安装mariadb\n---------------------------------------------------------\n\n这里我不使用centos默认的版本，使用最新稳定版本10.2。\n\n上面的基础规划完毕，需要配置下 mariadb的yum源_。\n\n.. _mariadb的yum源: https://downloads.mariadb.org/mariadb/repositories/#mirror=neusoft&distro=CentOS&distro_release=centos7-amd64--centos7&version=10.2\n\n.. code-block:: bash\n\n    [root@centos-158 yum.repos.d]# vim mariadb.repo                             # 添加/etc/yum.repos.d/mariadb.repo文件\n    [root@centos-158 yum.repos.d]# cat mariadb.repo                             # 检查这个文件\n    [root@centos-158 yum.repos.d]# cat mariadb.repo \n    # MariaDB 10.2 CentOS repository list - created 2018-01-27 14:09 UTC\n    # http://downloads.mariadb.org/mariadb/repositories/\n    [mariadb]\n    name = MariaDB\n    #这个地方的配置是国外的，下载太慢了。 我给改成清华镜像站点的了，这样下载会快点。\n    baseurl =https://mirrors.tuna.tsinghua.edu.cn/mariadb//mariadb-10.2.12/yum/centos/7Server/x86_64/\n    gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\n    gpgcheck=1\n\n    [root@centos-158 yum.repos.d]# yum install MariaDB-server MariaDB-client -y # 安装server和client\n\n.. note:: 这个包名是区分大小写的，使用rpm查询包提供文件的时候注意大小写。\n\n方案1-mysqld_multi\n----------------------------------------------------------\n\n创建目录并修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mkdir -pv /data/scheme1/mysql/{3307,3308}/data         # 创建目录\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme1/mysql/330{7,8} -R      # 修改权限\n\n安装数据库\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录\n\n配置文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mv /etc/my.conf /etc/my.conf.yumbak                # 重命名文件，别影响接下来的实验，其实不必要的\n    [root@centos-158 ~]# vim /etc/my.conf                                   # 编辑\n    [root@centos-158 ~]# cat /etc/my.conf                                   # 查看\n    [mysqld_multi]\n    mysqld     = /usr/bin/mysqld_safe\n    mysqladmin = /usr/bin/mysqladmin\n    user       = multi_admin\n    password   = zhaojiedi\n\n    [mysqld3307]\n    socket     = /data/scheme1/mysql/3307/mariadb.sock\n    port       = 3307\n    pid-file   = /data/scheme1/mysql/3307/mariadb.pid \n    datadir    = /data/scheme1/mysql/3307/data \n    user       = mysql\n\n    [mysqld3308]\n    socket     = /data/scheme1/mysql/3308/mariadb.sock\n    port       = 3308\n    pid-file   = /data/scheme1/mysql/3308/mariadb.pid \n    datadir    = /data/scheme1/mysql/3308/data \n    user       = mysql\n\n.. note:: 更多的参数官方文档。\n\n启动实例\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysqld_multi start 3307                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307\n    [root@centos-158 ~]# mysqld_multi start 3308                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307\n\n    [root@centos-158 ~]# netstat -tunlp |grep 330*                      # 查看服务\n    tcp6       0      0 :::3307                 :::*                    LISTEN      2631/mysqld         \n    tcp6       0      0 :::3308                 :::*                    LISTEN      2746/mysqld \n\n.. note:: mysqld_multi start 3307-3308来批量启动，多个矢量还可以逗号分割。\n\n安全初始化脚本运行\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_secure_installation -S /data/scheme1/mysql/3307/mariadb.sock  # 使用socket连接3307实例\n    # 下面内容只跳出重要的输入项列出\n    Enter current password for root (enter for none):              # 默认密码空，直接回车即可\n    Set root password? [Y/n] y                                     # 输入y\n    New password:                                                  # 输入root用户密码，注意不是系统密码，是数据库密码\n    Re-enter new password:                                         # 再次确认\n    Remove anonymous users? [Y/n] y                                # 移除匿名用户\n    Disallow root login remotely? [Y/n] y                          # 禁止root用户远程登陆，这个看你具体情况设置\n    Remove test database and access to it? [Y/n] y                 # 移除test数据库\n    Reload privilege tables now? [Y/n] y                           # 刷新权限表\n    [root@centos-158 ~]# mysql_secure_installation -S /data/scheme1/mysql/3308/mariadb.sock  # 使用socket连接3308实例\n\n添加多实例管理用户\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# vim create_user.sql                        # 添加用户脚本\n    [root@centos-158 ~]# cat create_user.sql                        # 检查\n    CREATE USER 'multi_admin'@'localhost' IDENTIFIED BY 'multi_admin';\n    GRANT SHUTDOWN ON *.* TO 'multi_admin'@'localhost';\n    flush privileges; \n\n    [root@centos-158 ~]# cat create_user.sql | mysql -u root -S /data/scheme1/mysql/3307/mariadb.sock -p #执行脚本\n    Enter password: \n    [root@centos-158 ~]# cat create_user.sql | mysql -u root -S /data/scheme1/mysql/3308/mariadb.sock -p # 执行脚本\n    Enter password: \n\n更多 mysqld-multi_ 使用帮助。\n\n.. _mysqld-multi: https://dev.mysql.com/doc/refman/5.7/en/mysqld-multi.html\n\n查看和关闭实例\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysqld_multi report                        # 查看服务状态\n    Reporting MariaDB servers\n    MariaDB server from group: mysqld3307 is running\n    MariaDB server from group: mysqld3308 is running\n    [root@centos-158 ~]# mysqld_multi stop 3307                     # 关闭一个实例\n    [root@centos-158 ~]# mysqld_multi report                        # 查看服务状态\n    Reporting MariaDB servers\n    MariaDB server from group: mysqld3307 is not running\n    MariaDB server from group: mysqld3308 is running\n\n开机启动\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n直接加入到rc.local中\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# echo `which mysqld_multi` start 3307-3308  >> /etc/rc.local        # 开机执行\n    [root@centos-158 ~]# tail -n 1 /etc/rc.local \n    /usr/bin/mysqld_multi start 3307-3308\n\n上面的加入rc.local方式管理上容易混乱，还是写个sysv脚本好些。\n\n.. code-block:: bash\n\n    [root@centos-158 init.d]# cd /etc/rc.d/init.d/\n    [root@centos-158 init.d]# vim mysqld_multi \n    [root@centos-158 init.d]# cat mysqld_multi \n    #! /bin/bash\n    # chkconfig: 2345 90 10\n    # description: mysqld_multi\n\n    # See how we were called.\n    mysqld_multi=/usr/local/mysql/bin/mysqld_multi\n    # 实例列表\n    instance_list=\"3307-3308\"\n    #instance_list=\"3307,3308,3309-3310\"\n    start(){\n        $mysqld_multi start $instance_list\t\n    }\n    stop(){\n        $mysqld_multi stop $instance_list\n    }\n    status(){\n        $mysqld_multi report\n    }\n    case \"$1\" in\n    start)\n        start\n            ;;\n    stop)\n        stop\n            ;;\n    status)\n        status\n            ;;\n    restart)\n        start\n        stop\n            ;;\n    *)\n        echo $\"Usage: $0 {start|stop|status}\"\n        exit 2\n    esac\n\n    [root@centos-158 init.d]# chkconfig --add mysqld_multi                  # 添加sysv\n    [root@centos-158 init.d]# chkconfig mysqld_multi on                     # 启用mysqld_multi\n\n\n方案2-多sysv脚本\n------------------------------------------------------------------------------\n\n创建目录并修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下\n\n.. code-block:: bash\n\n    [root@centos-158 ~]#  mkdir -pv /data/scheme2/mysql/{4307,4308}/{data,etc,log,socket,pid,service}       # 创建目录\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme2/mysql/4307 -R                                      # 修改所有者\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme2/mysql/4308 -R                                      # 修改所有者\n\n\n安装数据库\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4307/data --basedir=/usr --user=mysql  # 安装数据库\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4308/data --basedir=/usr --user=mysql  # 安装数据库\n\n配置配置文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# cd /data/scheme2/mysql/4307/etc/                           # 进入配置目录\n    [root@centos-158 etc]# vim my.cnf                                               # 编辑单独的配置文件              \n    [root@centos-158 etc]# cat my.cnf                                               # 检查\n    [mysqld]\n    port=4307\n    datadir=/data/scheme2/mysql/4307/data\n    socket=/data/scheme2/mysql/4307/socket/mariadb.sock\n    [mysqld-safe]\n    log-error=/data/scheme2/mysql/4307/log/mariadb.log\n    pid-file=/data/scheme2/mysql/4308/pid/mariadb.pid\n\n    [root@centos-158 etc]# cp my.cnf ../../4308/etc/my.cnf                          # 复制到另一个实例中去\n    [root@centos-158 etc]# sed -i 's@4307@4308@' ../../4308/etc/my.cnf              # 修改配置的端口\n    [root@centos-158 etc]# cat ../../4308/etc/my.cnf                                # 检查\n    [mysqld]\n    port=4308\n    datadir=/data/scheme2/mysql/4308/data\n    socket=/data/scheme2/mysql/4308/socket/mariadb.sock\n    [mysqld-safe]\n    log-error=/data/scheme2/mysql/4308/log/mariadb.log\n    pid-file=/data/scheme2/mysql/4308/pid/mariadb.pid\n\n配置服务文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# vim service/mysqld.sh                                   # 编辑sysv脚本\n    [root@centos-158 4307]# cat service/mysqld.sh                                   # 检查\n    #!/bin/bash\n    # chkconfig: 2345 91 19\n    # description: manage mariadb \n\n    port=4307\n    mysql_user=\"root\"\n    mysql_pwd=\"\"\n    mysql_basedir=\"/data/scheme2/mysql\"\n    #cmd_path=\"${mysql_basedir}/${port}/bin\"\n    cmd_path=\"/usr/bin\"\n    mysql_sock=\"${mysql_basedir}/${port}/socket/mariadb.sock\"\n\n    function_start_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"Starting MySQL...\\n\"\n        cmd=\"${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf\"\n        printf \"$cmd\\n\"\n        ${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf  &> /dev/null  &\n        else\n        printf \"MySQL is running...\\n\"\n        exit\n        fi\n    }\n    function_status_mysql(){\n            if [ -e \"$mysql_sock\" ] ; then\n                    printf \"MySql is running...\\n\"\n            else\n                    printf \"MySql is stopped...\\n\"\n            fi\n    }\n\n    function_stop_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"MySQL is stopped...\\n\"\n        exit\n        else\n        printf \"Stoping MySQL...\\n\"\n        ${cmd_path}/mysqladmin -u ${mysql_user} -p${mysql_pwd} -S ${mysql_sock} shutdown\n    fi\n    }\n\n\n    function_restart_mysql()\n    {\n        printf \"Restarting MySQL...\\n\"\n        function_stop_mysql\n        sleep 2\n        function_start_mysql\n    }\n\n    case $1 in\n    start)\n            function_start_mysql\n            ;;\n    stop)\n            function_stop_mysql\n            ;;\n    restart)\n            function_restart_mysql\n            ;;\n    status)\n            function_status_mysql\n            ;;\n    *)\n        printf \"Usage: ${cmd_path}/mysqld {start|stop|restart|status}\\n\"\n    esac\n\n\n    [root@centos-158 4307]# cp service/mysqld.sh  ../4308/service/mysqld.sh     # 复制一份\n    [root@centos-158 4307]# sed -i 's@4307@4308@' ../4308/service/mysqld.sh     # 修改端口\n    [root@centos-158 4307]# cat ../4308/service/mysqld.sh                       # 检查\n    #!/bin/bash\n    # chkconfig: 2345 91 19\n    # description: manage mariadb \n\n    port=4308\n    mysql_user=\"root\"\n    mysql_pwd=\"\"\n    mysql_basedir=\"/data/scheme2/mysql\"\n    #cmd_path=\"${mysql_basedir}/${port}/bin\"\n    cmd_path=\"/usr/bin\"\n    mysql_sock=\"${mysql_basedir}/${port}/socket/mariadb.sock\"\n\n    function_start_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"Starting MySQL...\\n\"\n        cmd=\"${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf\"\n        printf \"$cmd\\n\"\n        ${cmd_path}/mysqld_safe --defaults-file=${mysql_basedir}/${port}/etc/my.cnf  &> /dev/null  &\n        else\n        printf \"MySQL is running...\\n\"\n        exit\n        fi\n    }\n    function_status_mysql(){\n            if [ -e \"$mysql_sock\" ] ; then\n                    printf \"MySql is running...\\n\"\n            else\n                    printf \"MySql is stopped...\\n\"\n            fi\n    }\n\n    function_stop_mysql()\n    {\n        if [ ! -e \"$mysql_sock\" ];then\n        printf \"MySQL is stopped...\\n\"\n        exit\n        else\n        printf \"Stoping MySQL...\\n\"\n        ${cmd_path}/mysqladmin -u ${mysql_user} -p${mysql_pwd} -S ${mysql_sock} shutdown\n    fi\n    }\n\n\n    function_restart_mysql()\n    {\n        printf \"Restarting MySQL...\\n\"\n        function_stop_mysql\n        sleep 2\n        function_start_mysql\n    }\n\n    case $1 in\n    start)\n            function_start_mysql\n            ;;\n    stop)\n            function_stop_mysql\n            ;;\n    restart)\n            function_restart_mysql\n            ;;\n    status)\n            function_status_mysql\n            ;;\n    *)\n        printf \"Usage: ${cmd_path}/mysqld {start|stop|restart|status}\\n\"\n    esac\n\n    # 添加执行权限\n    [root@centos-158 4307]# chmod a+x /data/scheme2/mysql/4307/service/mysqld.sh \n    [root@centos-158 4307]# chmod a+x /data/scheme2/mysql/4308/service/mysqld.sh\n\n开机启动\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# ln -s /data/scheme2/mysql/4307/service/mysqld.sh /etc/rc.d/init.d/mysql4307     # 添加到init.d目录\n    [root@centos-158 4307]# chkconfig --add mysql4307                                                       # 添加到sysv\n    [root@centos-158 4307]# chkconfig mysql4307 on                                                          # 开机启动\n\n    [root@centos-158 4307]# cd ../4308\n\n    [root@centos-158 4308]# ln -s /data/scheme2/mysql/4308/service/mysqld.sh /etc/rc.d/init.d/mysql4308     # 添加到init.d目录\n    [root@centos-158 4308]# chkconfig --add mysql4308                                                       # 添加到sysv\n    [root@centos-158 4308]# chkconfig mysql4308 on                                                          # 开机启动\n\n启动服务和查看状态\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# service mysql4307 start                     # 启动实例\n    [root@centos-158 4307]# service mysql4308 start                     # 启动实例      \n    [root@centos-158 4307]# netstat -tunlp |grep 430                    # 查看状态\n    tcp6       0      0 :::4307                 :::*                    LISTEN      8221/mysqld         \n    tcp6       0      0 :::4308                 :::*                    LISTEN      8369/mysqld \n\n安全初始化\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4307/socket/mariadb.sock # 安全初始化，参考方案1\n    [root@centos-158 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4308/socket/mariadb.sock # 安全初始化，参考方案1\n\n服务文件修改密码\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 4307]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码\n    mysql_pwd=\"xxxxx\"\n    [root@centos-158 4307]# chmod 750 service/mysqld.sh         # 带有密码设置下权限\n    [root@centos-158 4307]# cd ../4308                          \n    [root@centos-158 4308]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码\n    mysql_pwd=\"xxxxx\"\n    [root@centos-158 4308]# chmod 750 service/mysqld.sh         # 带有密码设置下权限\n\n方案3-systemd\n---------------------------------------------------------------------\n\n创建目录并修改权限\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mkdir -pv /data/scheme3/mysql/{5307,5308}/{data,log,socket,pid}        # 创建目录\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme3/mysql/5307 -R                          # 所有者修改\n    [root@centos-158 ~]# chown mysql.mysql /data/scheme3/mysql/5308 -R                          # 所有者修改\n\n安装数据库\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5307/data --basedir=/usr --user=mysql  # 安装数据库\n    [root@centos-158 ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5308/data --basedir=/usr --user=mysql  # 安装数据库\n\n配置配置文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mv /etc/my.cnf /etc/my.cnf.multi                       # 原有配置文件重名\n    [root@centos-158 system]# cd /etc/my.cnf.d/                                 # 进入conf.d目录\n                \n    [root@centos-158 my.cnf.d]# vim my5307.cnf                                  # 编辑这个文件，名字为my<instance_nam>.cnf\n    [root@centos-158 my.cnf.d]# cat my5307.cnf                                  # 检查\n    [mysqld]\n    datadir=/data/scheme3/mysql/5307/data\n    socket=/data/scheme3/mysql/5307/socket/mariadb.sock\n    port=5307\n    log-error=/data/scheme3/mysql/5307/log/mariadb.log\n    pid-file=/data/scheme3/mysql/5307/pid/mariadb.pid\n    [root@centos-158 my.cnf.d]# vim my5308.cnf                                  # 编辑这个文件\n    [root@centos-158 my.cnf.d]# cat my5308.cnf                                  # 检查\n    [mysql]\n    datadir=/data/scheme3/mysql/5308/data\n    socket=/data/scheme3/mysql/5308/socket/mariadb.sock\n    port=5308\n    log-error=/data/scheme3/mysql/5308/log/mariadb.log\n    pid-file=/data/scheme3/mysql/5308/pid/mariadb.pid\n\n配置systemd\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 my.cnf.d]# vim /usr/lib/systemd/system/mariadb@.service        # 修改mariadb@service文件默认项\n    # 修改如下内容\n    ConditionPathExists=/etc/my.cnf.d/my%I.cnf\n\n    ExecStartPre=/bin/sh -c \"[ ! -e /usr/bin/galera_recovery ] && VAR= || \\\n    VAR=`/usr/bin/galera_recovery --defaults-file=/etc/my.cnf.d/my%I.cnf`; [ $? -eq 0 ] \\\n    && systemctl set-environment _WSREP_START_POSITION%I=$VAR || exit 1\"\n\n    ExecStart=/usr/sbin/mysqld --defaults-file=/etc/my.cnf.d/my%I.cnf \\\n    $_WSREP_NEW_CLUSTER $_WSREP_START_POSITION%I $MYSQLD_OPTS\n\n上面的简单的说就是说明下mysqld命令的路径，指定你的实例所在的路径%I代表实例名字。后续启动的 \"systemctl start mariadb\\@5307\" 这个命令中，5307就是实例名字。\n\n这个文件有点多， 提供一个下载参考吧。\n\n:download:`/files/mariadb@.service` \n\n启动服务和查看状态\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 my.cnf.d]# systemctl daemon-reload                 # 重载systemd\n    [root@centos-158 my.cnf.d]# systemctl start mariadb@5307            # 启动实例\n    [root@centos-158 my.cnf.d]# systemctl start mariadb@5308            # 启动实例\n    [root@centos-158 my.cnf.d]# netstat -tunlp |grep 530                # 查看服务状态\n    tcp6       0      0 :::5307                 :::*                    LISTEN      10267/mysqld        \n    tcp6       0      0 :::5308                 :::*                    LISTEN      10595/mysqld  \n\n开机启动\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 my.cnf.d]# systemctl enable  mariadb@5307           # 开机启动这个实例\n    Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5307.service to /usr/lib/systemd/system/mariadb@.service.\n    [root@centos-158 my.cnf.d]# systemctl enable  mariadb@5308           # 开机启动这个实例\n    Created symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5308.service to /usr/lib/systemd/system/mariadb@.service.\n\n安全初始化\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n    [root@centos-158 ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5307/socket/mariadb.sock    # 安全设置\n    [root@centos-158 ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5308/socket/mariadb.sock    # 安全设置\n","slug":"mariadb多实例的三种实现","published":1,"updated":"2018-02-26T05:57:44.678Z","comments":1,"photos":[],"link":"","_id":"cje3z1mnq000hugtmow17js3q","content":"<p>mariadb多实例实现方式:</p>\r\n<dl>\r\n<dt>mysqld_multi</dt>\r\n<dd><p>这个是使用单独的配置文件来配置多个实例，不过管理实例还是很方便的。</p>\r\n</dd>\r\n<dt>多个sysv配置</dt>\r\n<dd><p>这个方式相当于每个mairadb实例为一个不同的服务而已，每个实例一套sysv脚本。 配置起来比较简单，如果实例过多管理起来比较麻烦。</p>\r\n</dd>\r\n<dt>systemd</dt>\r\n<dd><p>这个是systemd管理的特有的。</p>\r\n</dd>\r\n</dl>\r\n<h2 id=\"配置前规划\">配置前规划</h2>\r\n<p>上面mairadb的多实例有多种配置方法， 我们先规划如下：</p>\r\n<table>\r\n<colgroup>\r\n<col style=\"width: 25%\">\r\n<col style=\"width: 25%\">\r\n<col style=\"width: 25%\">\r\n<col style=\"width: 25%\">\r\n</colgroup>\r\n<thead>\r\n<tr class=\"header\">\r\n<th>方案</th>\r\n<th>主目录</th>\r\n<th>端口规划</th>\r\n<th>其他</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr class=\"odd\">\r\n<td>方案1</td>\r\n<td>/data/scheme1/mysql/</td>\r\n<td>3307,3308</td>\r\n<td></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>方案2</td>\r\n<td>/data/scheme2/mysql/</td>\r\n<td>4307,4308</td>\r\n<td></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>方案3</td>\r\n<td>/data/scheme3/mysql/</td>\r\n<td>5307,5308</td>\r\n<td></td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<h2 id=\"配置前的环境设置\">配置前的环境设置</h2>\r\n<p>关闭selinux</p>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# setenforce 0</a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# sed -i <span class=\"st\">&#39;s@SELINUX=.*@SELINUX=disabled@&#39;</span> /etc/sysconfig/selinux</a></code></pre></div>\r\n<p>关闭防火墙</p>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# systemctl stop firewalld</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# systemctl disable firewalld</a></code></pre></div>\r\n<h2 id=\"安装mariadb\">安装mariadb</h2>\r\n<p>这里我不使用centos默认的版本，使用最新稳定版本10.2。</p>\r\n<p>上面的基础规划完毕，需要配置下 <a href=\"https://downloads.mariadb.org/mariadb/repositories/#mirror=neusoft&amp;distro=CentOS&amp;distro_release=centos7-amd64--centos7&amp;version=10.2\" target=\"_blank\" rel=\"noopener\">mariadb的yum源</a>。</p>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# vim mariadb.repo                             # 添加/etc/yum.repos.d/mariadb.repo文件</a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# cat mariadb.repo                             # 检查这个文件</a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# cat mariadb.repo </a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"co\"># MariaDB 10.2 CentOS repository list - created 2018-01-27 14:09 UTC</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"co\"># http://downloads.mariadb.org/mariadb/repositories/</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\">[<span class=\"ex\">mariadb</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\"><span class=\"ex\">name</span> = MariaDB</a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\"><span class=\"co\">#这个地方的配置是国外的，下载太慢了。 我给改成清华镜像站点的了，这样下载会快点。</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\"><span class=\"ex\">baseurl</span> =https://mirrors.tuna.tsinghua.edu.cn/mariadb//mariadb-10.2.12/yum/centos/7Server/x86_64/</a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\"><span class=\"va\">gpgkey=</span>https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\"><span class=\"va\">gpgcheck=</span>1</a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# yum install MariaDB-server MariaDB-client -y <span class=\"co\"># 安装server和client</span></a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>这个包名是区分大小写的，使用rpm查询包提供文件的时候注意大小写。</p>\r\n</div>\r\n<h2 id=\"方案1-mysqld_multi\">方案1-mysqld_multi</h2>\r\n<h3 id=\"创建目录并修改权限\">创建目录并修改权限</h3>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mkdir -pv /data/scheme1/mysql/<span class=\"dt\">{3307,3308}</span>/data         # 创建目录</a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme1/mysql/330<span class=\"dt\">{7,8}</span> -R      # 修改权限</a></code></pre></div>\r\n<h3 id=\"安装数据库\">安装数据库</h3>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录</a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录</a></code></pre></div>\r\n<h3 id=\"配置文件\">配置文件</h3>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mv /etc/my.conf /etc/my.conf.yumbak                # 重命名文件，别影响接下来的实验，其实不必要的</a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# vim /etc/my.conf                                   # 编辑</a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> ~]# cat /etc/my.conf                                   # 查看</a>\r\n<a class=\"sourceLine\" id=\"cb6-4\" data-line-number=\"4\">[<span class=\"ex\">mysqld_multi</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb6-5\" data-line-number=\"5\"><span class=\"ex\">mysqld</span>     = /usr/bin/mysqld_safe</a>\r\n<a class=\"sourceLine\" id=\"cb6-6\" data-line-number=\"6\"><span class=\"ex\">mysqladmin</span> = /usr/bin/mysqladmin</a>\r\n<a class=\"sourceLine\" id=\"cb6-7\" data-line-number=\"7\"><span class=\"ex\">user</span>       = multi_admin</a>\r\n<a class=\"sourceLine\" id=\"cb6-8\" data-line-number=\"8\"><span class=\"ex\">password</span>   = zhaojiedi</a>\r\n<a class=\"sourceLine\" id=\"cb6-9\" data-line-number=\"9\"></a>\r\n<a class=\"sourceLine\" id=\"cb6-10\" data-line-number=\"10\">[<span class=\"ex\">mysqld3307</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb6-11\" data-line-number=\"11\"><span class=\"ex\">socket</span>     = /data/scheme1/mysql/3307/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb6-12\" data-line-number=\"12\"><span class=\"ex\">port</span>       = 3307</a>\r\n<a class=\"sourceLine\" id=\"cb6-13\" data-line-number=\"13\"><span class=\"ex\">pid-file</span>   = /data/scheme1/mysql/3307/mariadb.pid </a>\r\n<a class=\"sourceLine\" id=\"cb6-14\" data-line-number=\"14\"><span class=\"ex\">datadir</span>    = /data/scheme1/mysql/3307/data </a>\r\n<a class=\"sourceLine\" id=\"cb6-15\" data-line-number=\"15\"><span class=\"ex\">user</span>       = mysql</a>\r\n<a class=\"sourceLine\" id=\"cb6-16\" data-line-number=\"16\"></a>\r\n<a class=\"sourceLine\" id=\"cb6-17\" data-line-number=\"17\">[<span class=\"ex\">mysqld3308</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb6-18\" data-line-number=\"18\"><span class=\"ex\">socket</span>     = /data/scheme1/mysql/3308/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb6-19\" data-line-number=\"19\"><span class=\"ex\">port</span>       = 3308</a>\r\n<a class=\"sourceLine\" id=\"cb6-20\" data-line-number=\"20\"><span class=\"ex\">pid-file</span>   = /data/scheme1/mysql/3308/mariadb.pid </a>\r\n<a class=\"sourceLine\" id=\"cb6-21\" data-line-number=\"21\"><span class=\"ex\">datadir</span>    = /data/scheme1/mysql/3308/data </a>\r\n<a class=\"sourceLine\" id=\"cb6-22\" data-line-number=\"22\"><span class=\"ex\">user</span>       = mysql</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>更多的参数官方文档。</p>\r\n</div>\r\n<h3 id=\"启动实例\">启动实例</h3>\r\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb7-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi start 3307                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307</a>\r\n<a class=\"sourceLine\" id=\"cb7-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi start 3308                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307</a>\r\n<a class=\"sourceLine\" id=\"cb7-3\" data-line-number=\"3\"></a>\r\n<a class=\"sourceLine\" id=\"cb7-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> ~]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 330*                      # 查看服务</a>\r\n<a class=\"sourceLine\" id=\"cb7-5\" data-line-number=\"5\"><span class=\"ex\">tcp6</span>       0      0 :::3307                 :::*                    LISTEN      2631/mysqld         </a>\r\n<a class=\"sourceLine\" id=\"cb7-6\" data-line-number=\"6\"><span class=\"ex\">tcp6</span>       0      0 :::3308                 :::*                    LISTEN      2746/mysqld </a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>mysqld_multi start 3307-3308来批量启动，多个矢量还可以逗号分割。</p>\r\n</div>\r\n<h3 id=\"安全初始化脚本运行\">安全初始化脚本运行</h3>\r\n<div class=\"sourceCode\" id=\"cb8\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb8-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation -S /data/scheme1/mysql/3307/mariadb.sock  # 使用socket连接3307实例</a>\r\n<a class=\"sourceLine\" id=\"cb8-2\" data-line-number=\"2\"><span class=\"co\"># 下面内容只跳出重要的输入项列出</span></a>\r\n<a class=\"sourceLine\" id=\"cb8-3\" data-line-number=\"3\"><span class=\"ex\">Enter</span> current password for root (enter for none)<span class=\"bu\">:</span>              # 默认密码空，直接回车即可</a>\r\n<a class=\"sourceLine\" id=\"cb8-4\" data-line-number=\"4\"><span class=\"ex\">Set</span> root password? [Y/n] y                                     # 输入y</a>\r\n<a class=\"sourceLine\" id=\"cb8-5\" data-line-number=\"5\"><span class=\"ex\">New</span> password:                                                  # 输入root用户密码，注意不是系统密码，是数据库密码</a>\r\n<a class=\"sourceLine\" id=\"cb8-6\" data-line-number=\"6\"><span class=\"ex\">Re-enter</span> new password:                                         # 再次确认</a>\r\n<a class=\"sourceLine\" id=\"cb8-7\" data-line-number=\"7\"><span class=\"ex\">Remove</span> anonymous users? [Y/n] y                                # 移除匿名用户</a>\r\n<a class=\"sourceLine\" id=\"cb8-8\" data-line-number=\"8\"><span class=\"ex\">Disallow</span> root login remotely? [Y/n] y                          # 禁止root用户远程登陆，这个看你具体情况设置</a>\r\n<a class=\"sourceLine\" id=\"cb8-9\" data-line-number=\"9\"><span class=\"ex\">Remove</span> test database and access to it? [Y/n] y                 # 移除test数据库</a>\r\n<a class=\"sourceLine\" id=\"cb8-10\" data-line-number=\"10\"><span class=\"ex\">Reload</span> privilege tables now? [Y/n] y                           # 刷新权限表</a>\r\n<a class=\"sourceLine\" id=\"cb8-11\" data-line-number=\"11\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation -S /data/scheme1/mysql/3308/mariadb.sock  # 使用socket连接3308实例</a></code></pre></div>\r\n<h3 id=\"添加多实例管理用户\">添加多实例管理用户</h3>\r\n<div class=\"sourceCode\" id=\"cb9\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb9-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# vim create_user.sql                        # 添加用户脚本</a>\r\n<a class=\"sourceLine\" id=\"cb9-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# cat create_user.sql                        # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb9-3\" data-line-number=\"3\"><span class=\"ex\">CREATE</span> USER <span class=\"st\">&#39;multi_admin&#39;</span>@<span class=\"st\">&#39;localhost&#39;</span> IDENTIFIED BY <span class=\"st\">&#39;multi_admin&#39;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-4\" data-line-number=\"4\"><span class=\"ex\">GRANT</span> SHUTDOWN ON *.* TO <span class=\"st\">&#39;multi_admin&#39;</span>@<span class=\"st\">&#39;localhost&#39;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-5\" data-line-number=\"5\"><span class=\"ex\">flush</span> privileges<span class=\"kw\">;</span> </a>\r\n<a class=\"sourceLine\" id=\"cb9-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb9-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-158</span> ~]# cat create_user.sql <span class=\"kw\">|</span> <span class=\"ex\">mysql</span> -u root -S /data/scheme1/mysql/3307/mariadb.sock -p <span class=\"co\">#执行脚本</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-8\" data-line-number=\"8\"><span class=\"ex\">Enter</span> password: </a>\r\n<a class=\"sourceLine\" id=\"cb9-9\" data-line-number=\"9\">[<span class=\"ex\">root@centos-158</span> ~]# cat create_user.sql <span class=\"kw\">|</span> <span class=\"ex\">mysql</span> -u root -S /data/scheme1/mysql/3308/mariadb.sock -p <span class=\"co\"># 执行脚本</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-10\" data-line-number=\"10\"><span class=\"ex\">Enter</span> password: </a></code></pre></div>\r\n<p>更多 <a href=\"https://dev.mysql.com/doc/refman/5.7/en/mysqld-multi.html\" target=\"_blank\" rel=\"noopener\">mysqld-multi</a> 使用帮助。</p>\r\n<h3 id=\"查看和关闭实例\">查看和关闭实例</h3>\r\n<div class=\"sourceCode\" id=\"cb10\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb10-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi report                        # 查看服务状态</a>\r\n<a class=\"sourceLine\" id=\"cb10-2\" data-line-number=\"2\"><span class=\"ex\">Reporting</span> MariaDB servers</a>\r\n<a class=\"sourceLine\" id=\"cb10-3\" data-line-number=\"3\"><span class=\"ex\">MariaDB</span> server from group: mysqld3307 is running</a>\r\n<a class=\"sourceLine\" id=\"cb10-4\" data-line-number=\"4\"><span class=\"ex\">MariaDB</span> server from group: mysqld3308 is running</a>\r\n<a class=\"sourceLine\" id=\"cb10-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi stop 3307                     # 关闭一个实例</a>\r\n<a class=\"sourceLine\" id=\"cb10-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi report                        # 查看服务状态</a>\r\n<a class=\"sourceLine\" id=\"cb10-7\" data-line-number=\"7\"><span class=\"ex\">Reporting</span> MariaDB servers</a>\r\n<a class=\"sourceLine\" id=\"cb10-8\" data-line-number=\"8\"><span class=\"ex\">MariaDB</span> server from group: mysqld3307 is not running</a>\r\n<a class=\"sourceLine\" id=\"cb10-9\" data-line-number=\"9\"><span class=\"ex\">MariaDB</span> server from group: mysqld3308 is running</a></code></pre></div>\r\n<h3 id=\"开机启动\">开机启动</h3>\r\n<p>直接加入到rc.local中</p>\r\n<div class=\"sourceCode\" id=\"cb11\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb11-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# echo <span class=\"kw\">`</span><span class=\"fu\">which</span> mysqld_multi<span class=\"kw\">`</span> start 3307-3308  <span class=\"op\">&gt;&gt;</span> /etc/rc.local        # 开机执行</a>\r\n<a class=\"sourceLine\" id=\"cb11-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# tail -n 1 /etc/rc.local </a>\r\n<a class=\"sourceLine\" id=\"cb11-3\" data-line-number=\"3\"><span class=\"ex\">/usr/bin/mysqld_multi</span> start 3307-3308</a></code></pre></div>\r\n<p>上面的加入rc.local方式管理上容易混乱，还是写个sysv脚本好些。</p>\r\n<div class=\"sourceCode\" id=\"cb12\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb12-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> init.d]# cd /etc/rc.d/init.d/</a>\r\n<a class=\"sourceLine\" id=\"cb12-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> init.d]# vim mysqld_multi </a>\r\n<a class=\"sourceLine\" id=\"cb12-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> init.d]# cat mysqld_multi </a>\r\n<a class=\"sourceLine\" id=\"cb12-4\" data-line-number=\"4\"><span class=\"co\">#! /bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-5\" data-line-number=\"5\"><span class=\"co\"># chkconfig: 2345 90 10</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-6\" data-line-number=\"6\"><span class=\"co\"># description: mysqld_multi</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-7\" data-line-number=\"7\"></a>\r\n<a class=\"sourceLine\" id=\"cb12-8\" data-line-number=\"8\"><span class=\"co\"># See how we were called.</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-9\" data-line-number=\"9\"><span class=\"va\">mysqld_multi=</span>/usr/local/mysql/bin/mysqld_multi</a>\r\n<a class=\"sourceLine\" id=\"cb12-10\" data-line-number=\"10\"><span class=\"co\"># 实例列表</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-11\" data-line-number=\"11\"><span class=\"va\">instance_list=</span><span class=\"st\">&quot;3307-3308&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-12\" data-line-number=\"12\"><span class=\"co\">#instance_list=&quot;3307,3308,3309-3310&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-13\" data-line-number=\"13\"><span class=\"fu\">start()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-14\" data-line-number=\"14\">    <span class=\"va\">$mysqld_multi</span> <span class=\"ex\">start</span> <span class=\"va\">$instance_list</span>  </a>\r\n<a class=\"sourceLine\" id=\"cb12-15\" data-line-number=\"15\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-16\" data-line-number=\"16\"><span class=\"fu\">stop()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-17\" data-line-number=\"17\">    <span class=\"va\">$mysqld_multi</span> <span class=\"ex\">stop</span> <span class=\"va\">$instance_list</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-18\" data-line-number=\"18\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-19\" data-line-number=\"19\"><span class=\"fu\">status()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-20\" data-line-number=\"20\">    <span class=\"va\">$mysqld_multi</span> <span class=\"ex\">report</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-21\" data-line-number=\"21\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-22\" data-line-number=\"22\"><span class=\"kw\">case</span> <span class=\"st\">&quot;</span><span class=\"va\">$1</span><span class=\"st\">&quot;</span><span class=\"kw\"> in</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-23\" data-line-number=\"23\">start<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-24\" data-line-number=\"24\">    <span class=\"ex\">start</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-25\" data-line-number=\"25\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-26\" data-line-number=\"26\">stop<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-27\" data-line-number=\"27\">    <span class=\"ex\">stop</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-28\" data-line-number=\"28\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-29\" data-line-number=\"29\">status<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-30\" data-line-number=\"30\">    <span class=\"ex\">status</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-31\" data-line-number=\"31\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-32\" data-line-number=\"32\">restart<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-33\" data-line-number=\"33\">    <span class=\"ex\">start</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-34\" data-line-number=\"34\">    <span class=\"ex\">stop</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-35\" data-line-number=\"35\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-36\" data-line-number=\"36\">*<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-37\" data-line-number=\"37\">    <span class=\"bu\">echo</span> <span class=\"st\">$&quot;Usage: </span><span class=\"va\">$0</span><span class=\"st\"> {start|stop|status}&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-38\" data-line-number=\"38\">    <span class=\"bu\">exit</span> 2</a>\r\n<a class=\"sourceLine\" id=\"cb12-39\" data-line-number=\"39\"><span class=\"kw\">esac</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-40\" data-line-number=\"40\"></a>\r\n<a class=\"sourceLine\" id=\"cb12-41\" data-line-number=\"41\">[<span class=\"ex\">root@centos-158</span> init.d]# chkconfig --add mysqld_multi                  # 添加sysv</a>\r\n<a class=\"sourceLine\" id=\"cb12-42\" data-line-number=\"42\">[<span class=\"ex\">root@centos-158</span> init.d]# chkconfig mysqld_multi on                     # 启用mysqld_multi</a></code></pre></div>\r\n<h2 id=\"方案2-多sysv脚本\">方案2-多sysv脚本</h2>\r\n<h3 id=\"创建目录并修改权限-1\">创建目录并修改权限</h3>\r\n<p>这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下</p>\r\n<div class=\"sourceCode\" id=\"cb13\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb13-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]#  mkdir -pv /data/scheme2/mysql/<span class=\"dt\">{4307,4308}/{data,etc,log,socket,pid,service}</span>       # 创建目录</a>\r\n<a class=\"sourceLine\" id=\"cb13-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme2/mysql/4307 -R                                      # 修改所有者</a>\r\n<a class=\"sourceLine\" id=\"cb13-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme2/mysql/4308 -R                                      # 修改所有者</a></code></pre></div>\r\n<h3 id=\"安装数据库-1\">安装数据库</h3>\r\n<div class=\"sourceCode\" id=\"cb14\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb14-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4307/data --basedir=/usr --user=mysql  # 安装数据库</a>\r\n<a class=\"sourceLine\" id=\"cb14-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4308/data --basedir=/usr --user=mysql  # 安装数据库</a></code></pre></div>\r\n<h3 id=\"配置配置文件\">配置配置文件</h3>\r\n<div class=\"sourceCode\" id=\"cb15\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb15-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# cd /data/scheme2/mysql/4307/etc/                           # 进入配置目录</a>\r\n<a class=\"sourceLine\" id=\"cb15-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> etc]# vim my.cnf                                               # 编辑单独的配置文件              </a>\r\n<a class=\"sourceLine\" id=\"cb15-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> etc]# cat my.cnf                                               # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb15-4\" data-line-number=\"4\">[<span class=\"ex\">mysqld</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-5\" data-line-number=\"5\"><span class=\"va\">port=</span>4307</a>\r\n<a class=\"sourceLine\" id=\"cb15-6\" data-line-number=\"6\"><span class=\"va\">datadir=</span>/data/scheme2/mysql/4307/data</a>\r\n<a class=\"sourceLine\" id=\"cb15-7\" data-line-number=\"7\"><span class=\"va\">socket=</span>/data/scheme2/mysql/4307/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb15-8\" data-line-number=\"8\">[<span class=\"ex\">mysqld-safe</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-9\" data-line-number=\"9\"><span class=\"ex\">log-error</span>=/data/scheme2/mysql/4307/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb15-10\" data-line-number=\"10\"><span class=\"ex\">pid-file</span>=/data/scheme2/mysql/4308/pid/mariadb.pid</a>\r\n<a class=\"sourceLine\" id=\"cb15-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-12\" data-line-number=\"12\">[<span class=\"ex\">root@centos-158</span> etc]# cp my.cnf ../../4308/etc/my.cnf                          # 复制到另一个实例中去</a>\r\n<a class=\"sourceLine\" id=\"cb15-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-158</span> etc]# sed -i <span class=\"st\">&#39;s@4307@4308@&#39;</span> ../../4308/etc/my.cnf              # 修改配置的端口</a>\r\n<a class=\"sourceLine\" id=\"cb15-14\" data-line-number=\"14\">[<span class=\"ex\">root@centos-158</span> etc]# cat ../../4308/etc/my.cnf                                # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb15-15\" data-line-number=\"15\">[<span class=\"ex\">mysqld</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-16\" data-line-number=\"16\"><span class=\"va\">port=</span>4308</a>\r\n<a class=\"sourceLine\" id=\"cb15-17\" data-line-number=\"17\"><span class=\"va\">datadir=</span>/data/scheme2/mysql/4308/data</a>\r\n<a class=\"sourceLine\" id=\"cb15-18\" data-line-number=\"18\"><span class=\"va\">socket=</span>/data/scheme2/mysql/4308/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb15-19\" data-line-number=\"19\">[<span class=\"ex\">mysqld-safe</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-20\" data-line-number=\"20\"><span class=\"ex\">log-error</span>=/data/scheme2/mysql/4308/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb15-21\" data-line-number=\"21\"><span class=\"ex\">pid-file</span>=/data/scheme2/mysql/4308/pid/mariadb.pid</a></code></pre></div>\r\n<h3 id=\"配置服务文件\">配置服务文件</h3>\r\n<div class=\"sourceCode\" id=\"cb16\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb16-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# vim service/mysqld.sh                                   # 编辑sysv脚本</a>\r\n<a class=\"sourceLine\" id=\"cb16-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# cat service/mysqld.sh                                   # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb16-3\" data-line-number=\"3\"><span class=\"co\">#!/bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-4\" data-line-number=\"4\"><span class=\"co\"># chkconfig: 2345 91 19</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-5\" data-line-number=\"5\"><span class=\"co\"># description: manage mariadb </span></a>\r\n<a class=\"sourceLine\" id=\"cb16-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-7\" data-line-number=\"7\"><span class=\"va\">port=</span>4307</a>\r\n<a class=\"sourceLine\" id=\"cb16-8\" data-line-number=\"8\"><span class=\"va\">mysql_user=</span><span class=\"st\">&quot;root&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-9\" data-line-number=\"9\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-10\" data-line-number=\"10\"><span class=\"va\">mysql_basedir=</span><span class=\"st\">&quot;/data/scheme2/mysql&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-11\" data-line-number=\"11\"><span class=\"co\">#cmd_path=&quot;${mysql_basedir}/${port}/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-12\" data-line-number=\"12\"><span class=\"va\">cmd_path=</span><span class=\"st\">&quot;/usr/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-13\" data-line-number=\"13\"><span class=\"va\">mysql_sock=</span><span class=\"st\">&quot;</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/socket/mariadb.sock&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-14\" data-line-number=\"14\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-15\" data-line-number=\"15\"><span class=\"fu\">function_start_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-16\" data-line-number=\"16\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-17\" data-line-number=\"17\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-18\" data-line-number=\"18\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Starting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-19\" data-line-number=\"19\">    <span class=\"va\">cmd=</span><span class=\"st\">&quot;</span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld_safe --defaults-file=</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/etc/my.cnf&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-20\" data-line-number=\"20\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;</span><span class=\"va\">$cmd</span><span class=\"st\">\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-21\" data-line-number=\"21\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqld_safe</span> --defaults-file=<span class=\"va\">${mysql_basedir}</span>/<span class=\"va\">${port}</span>/etc/my.cnf  <span class=\"op\">&amp;&gt;</span> /dev/null  <span class=\"kw\">&amp;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-22\" data-line-number=\"22\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-23\" data-line-number=\"23\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-24\" data-line-number=\"24\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-25\" data-line-number=\"25\">    <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-26\" data-line-number=\"26\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-27\" data-line-number=\"27\"><span class=\"fu\">function_status_mysql()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-28\" data-line-number=\"28\">        <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span> ; <span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-29\" data-line-number=\"29\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-30\" data-line-number=\"30\">        <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-31\" data-line-number=\"31\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-32\" data-line-number=\"32\">        <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-33\" data-line-number=\"33\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-34\" data-line-number=\"34\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-35\" data-line-number=\"35\"><span class=\"fu\">function_stop_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-36\" data-line-number=\"36\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-37\" data-line-number=\"37\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-38\" data-line-number=\"38\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-39\" data-line-number=\"39\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-40\" data-line-number=\"40\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-41\" data-line-number=\"41\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Stoping MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-42\" data-line-number=\"42\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqladmin</span> -u <span class=\"va\">${mysql_user}</span> -p<span class=\"va\">${mysql_pwd}</span> -S <span class=\"va\">${mysql_sock}</span> shutdown</a>\r\n<a class=\"sourceLine\" id=\"cb16-43\" data-line-number=\"43\"><span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-44\" data-line-number=\"44\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-45\" data-line-number=\"45\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-46\" data-line-number=\"46\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-47\" data-line-number=\"47\"><span class=\"fu\">function_restart_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-48\" data-line-number=\"48\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-49\" data-line-number=\"49\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Restarting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-50\" data-line-number=\"50\">    <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-51\" data-line-number=\"51\">    <span class=\"fu\">sleep</span> 2</a>\r\n<a class=\"sourceLine\" id=\"cb16-52\" data-line-number=\"52\">    <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-53\" data-line-number=\"53\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-54\" data-line-number=\"54\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-55\" data-line-number=\"55\"><span class=\"kw\">case</span> <span class=\"va\">$1</span><span class=\"kw\"> in</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-56\" data-line-number=\"56\">start<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-57\" data-line-number=\"57\">        <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-58\" data-line-number=\"58\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-59\" data-line-number=\"59\">stop<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-60\" data-line-number=\"60\">        <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-61\" data-line-number=\"61\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-62\" data-line-number=\"62\">restart<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-63\" data-line-number=\"63\">        <span class=\"ex\">function_restart_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-64\" data-line-number=\"64\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-65\" data-line-number=\"65\">status<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-66\" data-line-number=\"66\">        <span class=\"ex\">function_status_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-67\" data-line-number=\"67\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-68\" data-line-number=\"68\">*<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-69\" data-line-number=\"69\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Usage: </span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld {start|stop|restart|status}\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-70\" data-line-number=\"70\"><span class=\"kw\">esac</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-71\" data-line-number=\"71\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-72\" data-line-number=\"72\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-73\" data-line-number=\"73\">[<span class=\"ex\">root@centos-158</span> 4307]# cp service/mysqld.sh  ../4308/service/mysqld.sh     # 复制一份</a>\r\n<a class=\"sourceLine\" id=\"cb16-74\" data-line-number=\"74\">[<span class=\"ex\">root@centos-158</span> 4307]# sed -i <span class=\"st\">&#39;s@4307@4308@&#39;</span> ../4308/service/mysqld.sh     # 修改端口</a>\r\n<a class=\"sourceLine\" id=\"cb16-75\" data-line-number=\"75\">[<span class=\"ex\">root@centos-158</span> 4307]# cat ../4308/service/mysqld.sh                       # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb16-76\" data-line-number=\"76\"><span class=\"co\">#!/bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-77\" data-line-number=\"77\"><span class=\"co\"># chkconfig: 2345 91 19</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-78\" data-line-number=\"78\"><span class=\"co\"># description: manage mariadb </span></a>\r\n<a class=\"sourceLine\" id=\"cb16-79\" data-line-number=\"79\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-80\" data-line-number=\"80\"><span class=\"va\">port=</span>4308</a>\r\n<a class=\"sourceLine\" id=\"cb16-81\" data-line-number=\"81\"><span class=\"va\">mysql_user=</span><span class=\"st\">&quot;root&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-82\" data-line-number=\"82\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-83\" data-line-number=\"83\"><span class=\"va\">mysql_basedir=</span><span class=\"st\">&quot;/data/scheme2/mysql&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-84\" data-line-number=\"84\"><span class=\"co\">#cmd_path=&quot;${mysql_basedir}/${port}/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-85\" data-line-number=\"85\"><span class=\"va\">cmd_path=</span><span class=\"st\">&quot;/usr/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-86\" data-line-number=\"86\"><span class=\"va\">mysql_sock=</span><span class=\"st\">&quot;</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/socket/mariadb.sock&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-87\" data-line-number=\"87\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-88\" data-line-number=\"88\"><span class=\"fu\">function_start_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-89\" data-line-number=\"89\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-90\" data-line-number=\"90\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-91\" data-line-number=\"91\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Starting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-92\" data-line-number=\"92\">    <span class=\"va\">cmd=</span><span class=\"st\">&quot;</span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld_safe --defaults-file=</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/etc/my.cnf&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-93\" data-line-number=\"93\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;</span><span class=\"va\">$cmd</span><span class=\"st\">\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-94\" data-line-number=\"94\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqld_safe</span> --defaults-file=<span class=\"va\">${mysql_basedir}</span>/<span class=\"va\">${port}</span>/etc/my.cnf  <span class=\"op\">&amp;&gt;</span> /dev/null  <span class=\"kw\">&amp;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-95\" data-line-number=\"95\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-96\" data-line-number=\"96\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-97\" data-line-number=\"97\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-98\" data-line-number=\"98\">    <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-99\" data-line-number=\"99\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-100\" data-line-number=\"100\"><span class=\"fu\">function_status_mysql()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-101\" data-line-number=\"101\">        <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span> ; <span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-102\" data-line-number=\"102\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-103\" data-line-number=\"103\">        <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-104\" data-line-number=\"104\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-105\" data-line-number=\"105\">        <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-106\" data-line-number=\"106\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-107\" data-line-number=\"107\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-108\" data-line-number=\"108\"><span class=\"fu\">function_stop_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-109\" data-line-number=\"109\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-110\" data-line-number=\"110\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-111\" data-line-number=\"111\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-112\" data-line-number=\"112\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-113\" data-line-number=\"113\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-114\" data-line-number=\"114\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Stoping MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-115\" data-line-number=\"115\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqladmin</span> -u <span class=\"va\">${mysql_user}</span> -p<span class=\"va\">${mysql_pwd}</span> -S <span class=\"va\">${mysql_sock}</span> shutdown</a>\r\n<a class=\"sourceLine\" id=\"cb16-116\" data-line-number=\"116\"><span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-117\" data-line-number=\"117\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-118\" data-line-number=\"118\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-119\" data-line-number=\"119\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-120\" data-line-number=\"120\"><span class=\"fu\">function_restart_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-121\" data-line-number=\"121\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-122\" data-line-number=\"122\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Restarting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-123\" data-line-number=\"123\">    <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-124\" data-line-number=\"124\">    <span class=\"fu\">sleep</span> 2</a>\r\n<a class=\"sourceLine\" id=\"cb16-125\" data-line-number=\"125\">    <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-126\" data-line-number=\"126\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-127\" data-line-number=\"127\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-128\" data-line-number=\"128\"><span class=\"kw\">case</span> <span class=\"va\">$1</span><span class=\"kw\"> in</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-129\" data-line-number=\"129\">start<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-130\" data-line-number=\"130\">        <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-131\" data-line-number=\"131\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-132\" data-line-number=\"132\">stop<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-133\" data-line-number=\"133\">        <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-134\" data-line-number=\"134\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-135\" data-line-number=\"135\">restart<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-136\" data-line-number=\"136\">        <span class=\"ex\">function_restart_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-137\" data-line-number=\"137\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-138\" data-line-number=\"138\">status<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-139\" data-line-number=\"139\">        <span class=\"ex\">function_status_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-140\" data-line-number=\"140\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-141\" data-line-number=\"141\">*<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-142\" data-line-number=\"142\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Usage: </span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld {start|stop|restart|status}\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-143\" data-line-number=\"143\"><span class=\"kw\">esac</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-144\" data-line-number=\"144\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-145\" data-line-number=\"145\"><span class=\"co\"># 添加执行权限</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-146\" data-line-number=\"146\">[<span class=\"ex\">root@centos-158</span> 4307]# chmod a+x /data/scheme2/mysql/4307/service/mysqld.sh </a>\r\n<a class=\"sourceLine\" id=\"cb16-147\" data-line-number=\"147\">[<span class=\"ex\">root@centos-158</span> 4307]# chmod a+x /data/scheme2/mysql/4308/service/mysqld.sh</a></code></pre></div>\r\n<h3 id=\"开机启动-1\">开机启动</h3>\r\n<div class=\"sourceCode\" id=\"cb17\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb17-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# ln -s /data/scheme2/mysql/4307/service/mysqld.sh /etc/rc.d/init.d/mysql4307     # 添加到init.d目录</a>\r\n<a class=\"sourceLine\" id=\"cb17-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# chkconfig --add mysql4307                                                       # 添加到sysv</a>\r\n<a class=\"sourceLine\" id=\"cb17-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> 4307]# chkconfig mysql4307 on                                                          # 开机启动</a>\r\n<a class=\"sourceLine\" id=\"cb17-4\" data-line-number=\"4\"></a>\r\n<a class=\"sourceLine\" id=\"cb17-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> 4307]# cd ../4308</a>\r\n<a class=\"sourceLine\" id=\"cb17-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb17-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-158</span> 4308]# ln -s /data/scheme2/mysql/4308/service/mysqld.sh /etc/rc.d/init.d/mysql4308     # 添加到init.d目录</a>\r\n<a class=\"sourceLine\" id=\"cb17-8\" data-line-number=\"8\">[<span class=\"ex\">root@centos-158</span> 4308]# chkconfig --add mysql4308                                                       # 添加到sysv</a>\r\n<a class=\"sourceLine\" id=\"cb17-9\" data-line-number=\"9\">[<span class=\"ex\">root@centos-158</span> 4308]# chkconfig mysql4308 on                                                          # 开机启动</a></code></pre></div>\r\n<h3 id=\"启动服务和查看状态\">启动服务和查看状态</h3>\r\n<div class=\"sourceCode\" id=\"cb18\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb18-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# service mysql4307 start                     # 启动实例</a>\r\n<a class=\"sourceLine\" id=\"cb18-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# service mysql4308 start                     # 启动实例      </a>\r\n<a class=\"sourceLine\" id=\"cb18-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> 4307]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 430                    # 查看状态</a>\r\n<a class=\"sourceLine\" id=\"cb18-4\" data-line-number=\"4\"><span class=\"ex\">tcp6</span>       0      0 :::4307                 :::*                    LISTEN      8221/mysqld         </a>\r\n<a class=\"sourceLine\" id=\"cb18-5\" data-line-number=\"5\"><span class=\"ex\">tcp6</span>       0      0 :::4308                 :::*                    LISTEN      8369/mysqld </a></code></pre></div>\r\n<h3 id=\"安全初始化\">安全初始化</h3>\r\n<div class=\"sourceCode\" id=\"cb19\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb19-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4307/socket/mariadb.sock <span class=\"co\"># 安全初始化，参考方案1</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4308/socket/mariadb.sock <span class=\"co\"># 安全初始化，参考方案1</span></a></code></pre></div>\r\n<h3 id=\"服务文件修改密码\">服务文件修改密码</h3>\r\n<div class=\"sourceCode\" id=\"cb20\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb20-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码</a>\r\n<a class=\"sourceLine\" id=\"cb20-2\" data-line-number=\"2\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;xxxxx&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb20-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> 4307]# chmod 750 service/mysqld.sh         # 带有密码设置下权限</a>\r\n<a class=\"sourceLine\" id=\"cb20-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> 4307]# cd ../4308                          </a>\r\n<a class=\"sourceLine\" id=\"cb20-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> 4308]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码</a>\r\n<a class=\"sourceLine\" id=\"cb20-6\" data-line-number=\"6\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;xxxxx&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb20-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-158</span> 4308]# chmod 750 service/mysqld.sh         # 带有密码设置下权限</a></code></pre></div>\r\n<h2 id=\"方案3-systemd\">方案3-systemd</h2>\r\n<h3 id=\"创建目录并修改权限-2\">创建目录并修改权限</h3>\r\n<p>这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下</p>\r\n<div class=\"sourceCode\" id=\"cb21\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb21-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mkdir -pv /data/scheme3/mysql/<span class=\"dt\">{5307,5308}/{data,log,socket,pid}</span>        # 创建目录</a>\r\n<a class=\"sourceLine\" id=\"cb21-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme3/mysql/5307 -R                          # 所有者修改</a>\r\n<a class=\"sourceLine\" id=\"cb21-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme3/mysql/5308 -R                          # 所有者修改</a></code></pre></div>\r\n<h3 id=\"安装数据库-2\">安装数据库</h3>\r\n<div class=\"sourceCode\" id=\"cb22\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb22-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5307/data --basedir=/usr --user=mysql  # 安装数据库</a>\r\n<a class=\"sourceLine\" id=\"cb22-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5308/data --basedir=/usr --user=mysql  # 安装数据库</a></code></pre></div>\r\n<h3 id=\"配置配置文件-1\">配置配置文件</h3>\r\n<div class=\"sourceCode\" id=\"cb23\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb23-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mv /etc/my.cnf /etc/my.cnf.multi                       # 原有配置文件重名</a>\r\n<a class=\"sourceLine\" id=\"cb23-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> system]# cd /etc/my.cnf.d/                                 # 进入conf.d目录</a>\r\n<a class=\"sourceLine\" id=\"cb23-3\" data-line-number=\"3\"></a>\r\n<a class=\"sourceLine\" id=\"cb23-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# vim my5307.cnf                                  # 编辑这个文件，名字为my<span class=\"op\">&lt;</span>instance_nam<span class=\"op\">&gt;</span>.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb23-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# cat my5307.cnf                                  # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb23-6\" data-line-number=\"6\">[<span class=\"ex\">mysqld</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb23-7\" data-line-number=\"7\"><span class=\"va\">datadir=</span>/data/scheme3/mysql/5307/data</a>\r\n<a class=\"sourceLine\" id=\"cb23-8\" data-line-number=\"8\"><span class=\"va\">socket=</span>/data/scheme3/mysql/5307/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb23-9\" data-line-number=\"9\"><span class=\"va\">port=</span>5307</a>\r\n<a class=\"sourceLine\" id=\"cb23-10\" data-line-number=\"10\"><span class=\"ex\">log-error</span>=/data/scheme3/mysql/5307/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb23-11\" data-line-number=\"11\"><span class=\"ex\">pid-file</span>=/data/scheme3/mysql/5307/pid/mariadb.pid</a>\r\n<a class=\"sourceLine\" id=\"cb23-12\" data-line-number=\"12\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# vim my5308.cnf                                  # 编辑这个文件</a>\r\n<a class=\"sourceLine\" id=\"cb23-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# cat my5308.cnf                                  # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb23-14\" data-line-number=\"14\">[<span class=\"ex\">mysql</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb23-15\" data-line-number=\"15\"><span class=\"va\">datadir=</span>/data/scheme3/mysql/5308/data</a>\r\n<a class=\"sourceLine\" id=\"cb23-16\" data-line-number=\"16\"><span class=\"va\">socket=</span>/data/scheme3/mysql/5308/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb23-17\" data-line-number=\"17\"><span class=\"va\">port=</span>5308</a>\r\n<a class=\"sourceLine\" id=\"cb23-18\" data-line-number=\"18\"><span class=\"ex\">log-error</span>=/data/scheme3/mysql/5308/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb23-19\" data-line-number=\"19\"><span class=\"ex\">pid-file</span>=/data/scheme3/mysql/5308/pid/mariadb.pid</a></code></pre></div>\r\n<h3 id=\"配置systemd\">配置systemd</h3>\r\n<div class=\"sourceCode\" id=\"cb24\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb24-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# vim /usr/lib/systemd/system/mariadb@.service        # 修改mariadb@service文件默认项</a>\r\n<a class=\"sourceLine\" id=\"cb24-2\" data-line-number=\"2\"><span class=\"co\"># 修改如下内容</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-3\" data-line-number=\"3\"><span class=\"va\">ConditionPathExists=</span>/etc/my.cnf.d/my%I.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb24-4\" data-line-number=\"4\"></a>\r\n<a class=\"sourceLine\" id=\"cb24-5\" data-line-number=\"5\"><span class=\"va\">ExecStartPre=</span>/bin/sh <span class=\"ex\">-c</span> <span class=\"st\">&quot;[ ! -e /usr/bin/galera_recovery ] &amp;&amp; VAR= || \\</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-6\" data-line-number=\"6\"><span class=\"st\">VAR=</span><span class=\"kw\">`</span><span class=\"ex\">/usr/bin/galera_recovery</span> --defaults-file=/etc/my.cnf.d/my%I.cnf<span class=\"kw\">`</span><span class=\"st\">; [ </span><span class=\"va\">$?</span><span class=\"st\"> -eq 0 ] \\</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-7\" data-line-number=\"7\"><span class=\"st\">&amp;&amp; systemctl set-environment _WSREP_START_POSITION%I=</span><span class=\"va\">$VAR</span><span class=\"st\"> || exit 1&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb24-9\" data-line-number=\"9\"><span class=\"va\">ExecStart=</span>/usr/sbin/mysqld <span class=\"ex\">--defaults-file</span>=/etc/my.cnf.d/my%I.cnf \\</a>\r\n<a class=\"sourceLine\" id=\"cb24-10\" data-line-number=\"10\"><span class=\"va\">$_WSREP_NEW_CLUSTER</span> <span class=\"va\">$_WSREP_START_POSITION</span>%I <span class=\"va\">$MYSQLD_OPTS</span></a></code></pre></div>\r\n<p>上面的简单的说就是说明下mysqld命令的路径，指定你的实例所在的路径%I代表实例名字。后续启动的 &quot;systemctl start mariadb@5307&quot; 这个命令中，5307就是实例名字。</p>\r\n<p>这个文件有点多， 提供一个下载参考吧。</p>\r\n<p><span data-role=\"download\">/files/mariadb@.service</span></p>\r\n<h3 id=\"启动服务和查看状态-1\">启动服务和查看状态</h3>\r\n<div class=\"sourceCode\" id=\"cb25\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb25-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl daemon-reload                 # 重载systemd</a>\r\n<a class=\"sourceLine\" id=\"cb25-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl start mariadb@5307            # 启动实例</a>\r\n<a class=\"sourceLine\" id=\"cb25-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl start mariadb@5308            # 启动实例</a>\r\n<a class=\"sourceLine\" id=\"cb25-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 530                # 查看服务状态</a>\r\n<a class=\"sourceLine\" id=\"cb25-5\" data-line-number=\"5\"><span class=\"ex\">tcp6</span>       0      0 :::5307                 :::*                    LISTEN      10267/mysqld        </a>\r\n<a class=\"sourceLine\" id=\"cb25-6\" data-line-number=\"6\"><span class=\"ex\">tcp6</span>       0      0 :::5308                 :::*                    LISTEN      10595/mysqld  </a></code></pre></div>\r\n<h3 id=\"开机启动-2\">开机启动</h3>\r\n<div class=\"sourceCode\" id=\"cb26\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb26-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl enable  mariadb@5307           # 开机启动这个实例</a>\r\n<a class=\"sourceLine\" id=\"cb26-2\" data-line-number=\"2\"><span class=\"ex\">Created</span> symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5307.service to /usr/lib/systemd/system/mariadb@.service.</a>\r\n<a class=\"sourceLine\" id=\"cb26-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl enable  mariadb@5308           # 开机启动这个实例</a>\r\n<a class=\"sourceLine\" id=\"cb26-4\" data-line-number=\"4\"><span class=\"ex\">Created</span> symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5308.service to /usr/lib/systemd/system/mariadb@.service.</a></code></pre></div>\r\n<h3 id=\"安全初始化-1\">安全初始化</h3>\r\n<div class=\"sourceCode\" id=\"cb27\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb27-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5307/socket/mariadb.sock    # 安全设置</a>\r\n<a class=\"sourceLine\" id=\"cb27-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5308/socket/mariadb.sock    # 安全设置</a></code></pre></div>\r\n","site":{"data":{}},"excerpt":"","more":"<p>mariadb多实例实现方式:</p>\r\n<dl>\r\n<dt>mysqld_multi</dt>\r\n<dd><p>这个是使用单独的配置文件来配置多个实例，不过管理实例还是很方便的。</p>\r\n</dd>\r\n<dt>多个sysv配置</dt>\r\n<dd><p>这个方式相当于每个mairadb实例为一个不同的服务而已，每个实例一套sysv脚本。 配置起来比较简单，如果实例过多管理起来比较麻烦。</p>\r\n</dd>\r\n<dt>systemd</dt>\r\n<dd><p>这个是systemd管理的特有的。</p>\r\n</dd>\r\n</dl>\r\n<h2 id=\"配置前规划\">配置前规划</h2>\r\n<p>上面mairadb的多实例有多种配置方法， 我们先规划如下：</p>\r\n<table>\r\n<colgroup>\r\n<col style=\"width: 25%\">\r\n<col style=\"width: 25%\">\r\n<col style=\"width: 25%\">\r\n<col style=\"width: 25%\">\r\n</colgroup>\r\n<thead>\r\n<tr class=\"header\">\r\n<th>方案</th>\r\n<th>主目录</th>\r\n<th>端口规划</th>\r\n<th>其他</th>\r\n</tr>\r\n</thead>\r\n<tbody>\r\n<tr class=\"odd\">\r\n<td>方案1</td>\r\n<td>/data/scheme1/mysql/</td>\r\n<td>3307,3308</td>\r\n<td></td>\r\n</tr>\r\n<tr class=\"even\">\r\n<td>方案2</td>\r\n<td>/data/scheme2/mysql/</td>\r\n<td>4307,4308</td>\r\n<td></td>\r\n</tr>\r\n<tr class=\"odd\">\r\n<td>方案3</td>\r\n<td>/data/scheme3/mysql/</td>\r\n<td>5307,5308</td>\r\n<td></td>\r\n</tr>\r\n</tbody>\r\n</table>\r\n<h2 id=\"配置前的环境设置\">配置前的环境设置</h2>\r\n<p>关闭selinux</p>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# setenforce 0</a>\r\n<a class=\"sourceLine\" id=\"cb1-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# sed -i <span class=\"st\">&#39;s@SELINUX=.*@SELINUX=disabled@&#39;</span> /etc/sysconfig/selinux</a></code></pre></div>\r\n<p>关闭防火墙</p>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# systemctl stop firewalld</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# systemctl disable firewalld</a></code></pre></div>\r\n<h2 id=\"安装mariadb\">安装mariadb</h2>\r\n<p>这里我不使用centos默认的版本，使用最新稳定版本10.2。</p>\r\n<p>上面的基础规划完毕，需要配置下 <a href=\"https://downloads.mariadb.org/mariadb/repositories/#mirror=neusoft&amp;distro=CentOS&amp;distro_release=centos7-amd64--centos7&amp;version=10.2\" target=\"_blank\" rel=\"noopener\">mariadb的yum源</a>。</p>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# vim mariadb.repo                             # 添加/etc/yum.repos.d/mariadb.repo文件</a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# cat mariadb.repo                             # 检查这个文件</a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# cat mariadb.repo </a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"co\"># MariaDB 10.2 CentOS repository list - created 2018-01-27 14:09 UTC</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"co\"># http://downloads.mariadb.org/mariadb/repositories/</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\">[<span class=\"ex\">mariadb</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\"><span class=\"ex\">name</span> = MariaDB</a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\"><span class=\"co\">#这个地方的配置是国外的，下载太慢了。 我给改成清华镜像站点的了，这样下载会快点。</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\"><span class=\"ex\">baseurl</span> =https://mirrors.tuna.tsinghua.edu.cn/mariadb//mariadb-10.2.12/yum/centos/7Server/x86_64/</a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\"><span class=\"va\">gpgkey=</span>https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\"><span class=\"va\">gpgcheck=</span>1</a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-158</span> yum.repos.d]# yum install MariaDB-server MariaDB-client -y <span class=\"co\"># 安装server和client</span></a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>这个包名是区分大小写的，使用rpm查询包提供文件的时候注意大小写。</p>\r\n</div>\r\n<h2 id=\"方案1-mysqld_multi\">方案1-mysqld_multi</h2>\r\n<h3 id=\"创建目录并修改权限\">创建目录并修改权限</h3>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mkdir -pv /data/scheme1/mysql/<span class=\"dt\">{3307,3308}</span>/data         # 创建目录</a>\r\n<a class=\"sourceLine\" id=\"cb4-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme1/mysql/330<span class=\"dt\">{7,8}</span> -R      # 修改权限</a></code></pre></div>\r\n<h3 id=\"安装数据库\">安装数据库</h3>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录</a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme1/mysql/3308/data --basedir=/usr --user=mysql  # 安装到数据目录</a></code></pre></div>\r\n<h3 id=\"配置文件\">配置文件</h3>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mv /etc/my.conf /etc/my.conf.yumbak                # 重命名文件，别影响接下来的实验，其实不必要的</a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# vim /etc/my.conf                                   # 编辑</a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> ~]# cat /etc/my.conf                                   # 查看</a>\r\n<a class=\"sourceLine\" id=\"cb6-4\" data-line-number=\"4\">[<span class=\"ex\">mysqld_multi</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb6-5\" data-line-number=\"5\"><span class=\"ex\">mysqld</span>     = /usr/bin/mysqld_safe</a>\r\n<a class=\"sourceLine\" id=\"cb6-6\" data-line-number=\"6\"><span class=\"ex\">mysqladmin</span> = /usr/bin/mysqladmin</a>\r\n<a class=\"sourceLine\" id=\"cb6-7\" data-line-number=\"7\"><span class=\"ex\">user</span>       = multi_admin</a>\r\n<a class=\"sourceLine\" id=\"cb6-8\" data-line-number=\"8\"><span class=\"ex\">password</span>   = zhaojiedi</a>\r\n<a class=\"sourceLine\" id=\"cb6-9\" data-line-number=\"9\"></a>\r\n<a class=\"sourceLine\" id=\"cb6-10\" data-line-number=\"10\">[<span class=\"ex\">mysqld3307</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb6-11\" data-line-number=\"11\"><span class=\"ex\">socket</span>     = /data/scheme1/mysql/3307/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb6-12\" data-line-number=\"12\"><span class=\"ex\">port</span>       = 3307</a>\r\n<a class=\"sourceLine\" id=\"cb6-13\" data-line-number=\"13\"><span class=\"ex\">pid-file</span>   = /data/scheme1/mysql/3307/mariadb.pid </a>\r\n<a class=\"sourceLine\" id=\"cb6-14\" data-line-number=\"14\"><span class=\"ex\">datadir</span>    = /data/scheme1/mysql/3307/data </a>\r\n<a class=\"sourceLine\" id=\"cb6-15\" data-line-number=\"15\"><span class=\"ex\">user</span>       = mysql</a>\r\n<a class=\"sourceLine\" id=\"cb6-16\" data-line-number=\"16\"></a>\r\n<a class=\"sourceLine\" id=\"cb6-17\" data-line-number=\"17\">[<span class=\"ex\">mysqld3308</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb6-18\" data-line-number=\"18\"><span class=\"ex\">socket</span>     = /data/scheme1/mysql/3308/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb6-19\" data-line-number=\"19\"><span class=\"ex\">port</span>       = 3308</a>\r\n<a class=\"sourceLine\" id=\"cb6-20\" data-line-number=\"20\"><span class=\"ex\">pid-file</span>   = /data/scheme1/mysql/3308/mariadb.pid </a>\r\n<a class=\"sourceLine\" id=\"cb6-21\" data-line-number=\"21\"><span class=\"ex\">datadir</span>    = /data/scheme1/mysql/3308/data </a>\r\n<a class=\"sourceLine\" id=\"cb6-22\" data-line-number=\"22\"><span class=\"ex\">user</span>       = mysql</a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>更多的参数官方文档。</p>\r\n</div>\r\n<h3 id=\"启动实例\">启动实例</h3>\r\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb7-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi start 3307                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307</a>\r\n<a class=\"sourceLine\" id=\"cb7-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi start 3308                        # 启动指定的实例，这个是在配置mysqld3307片段，实例名字就是3307</a>\r\n<a class=\"sourceLine\" id=\"cb7-3\" data-line-number=\"3\"></a>\r\n<a class=\"sourceLine\" id=\"cb7-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> ~]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 330*                      # 查看服务</a>\r\n<a class=\"sourceLine\" id=\"cb7-5\" data-line-number=\"5\"><span class=\"ex\">tcp6</span>       0      0 :::3307                 :::*                    LISTEN      2631/mysqld         </a>\r\n<a class=\"sourceLine\" id=\"cb7-6\" data-line-number=\"6\"><span class=\"ex\">tcp6</span>       0      0 :::3308                 :::*                    LISTEN      2746/mysqld </a></code></pre></div>\r\n<div class=\"note\">\r\n<div class=\"admonition-title\">\r\n<p>Note</p>\r\n</div>\r\n<p>mysqld_multi start 3307-3308来批量启动，多个矢量还可以逗号分割。</p>\r\n</div>\r\n<h3 id=\"安全初始化脚本运行\">安全初始化脚本运行</h3>\r\n<div class=\"sourceCode\" id=\"cb8\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb8-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation -S /data/scheme1/mysql/3307/mariadb.sock  # 使用socket连接3307实例</a>\r\n<a class=\"sourceLine\" id=\"cb8-2\" data-line-number=\"2\"><span class=\"co\"># 下面内容只跳出重要的输入项列出</span></a>\r\n<a class=\"sourceLine\" id=\"cb8-3\" data-line-number=\"3\"><span class=\"ex\">Enter</span> current password for root (enter for none)<span class=\"bu\">:</span>              # 默认密码空，直接回车即可</a>\r\n<a class=\"sourceLine\" id=\"cb8-4\" data-line-number=\"4\"><span class=\"ex\">Set</span> root password? [Y/n] y                                     # 输入y</a>\r\n<a class=\"sourceLine\" id=\"cb8-5\" data-line-number=\"5\"><span class=\"ex\">New</span> password:                                                  # 输入root用户密码，注意不是系统密码，是数据库密码</a>\r\n<a class=\"sourceLine\" id=\"cb8-6\" data-line-number=\"6\"><span class=\"ex\">Re-enter</span> new password:                                         # 再次确认</a>\r\n<a class=\"sourceLine\" id=\"cb8-7\" data-line-number=\"7\"><span class=\"ex\">Remove</span> anonymous users? [Y/n] y                                # 移除匿名用户</a>\r\n<a class=\"sourceLine\" id=\"cb8-8\" data-line-number=\"8\"><span class=\"ex\">Disallow</span> root login remotely? [Y/n] y                          # 禁止root用户远程登陆，这个看你具体情况设置</a>\r\n<a class=\"sourceLine\" id=\"cb8-9\" data-line-number=\"9\"><span class=\"ex\">Remove</span> test database and access to it? [Y/n] y                 # 移除test数据库</a>\r\n<a class=\"sourceLine\" id=\"cb8-10\" data-line-number=\"10\"><span class=\"ex\">Reload</span> privilege tables now? [Y/n] y                           # 刷新权限表</a>\r\n<a class=\"sourceLine\" id=\"cb8-11\" data-line-number=\"11\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation -S /data/scheme1/mysql/3308/mariadb.sock  # 使用socket连接3308实例</a></code></pre></div>\r\n<h3 id=\"添加多实例管理用户\">添加多实例管理用户</h3>\r\n<div class=\"sourceCode\" id=\"cb9\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb9-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# vim create_user.sql                        # 添加用户脚本</a>\r\n<a class=\"sourceLine\" id=\"cb9-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# cat create_user.sql                        # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb9-3\" data-line-number=\"3\"><span class=\"ex\">CREATE</span> USER <span class=\"st\">&#39;multi_admin&#39;</span>@<span class=\"st\">&#39;localhost&#39;</span> IDENTIFIED BY <span class=\"st\">&#39;multi_admin&#39;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-4\" data-line-number=\"4\"><span class=\"ex\">GRANT</span> SHUTDOWN ON *.* TO <span class=\"st\">&#39;multi_admin&#39;</span>@<span class=\"st\">&#39;localhost&#39;</span><span class=\"kw\">;</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-5\" data-line-number=\"5\"><span class=\"ex\">flush</span> privileges<span class=\"kw\">;</span> </a>\r\n<a class=\"sourceLine\" id=\"cb9-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb9-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-158</span> ~]# cat create_user.sql <span class=\"kw\">|</span> <span class=\"ex\">mysql</span> -u root -S /data/scheme1/mysql/3307/mariadb.sock -p <span class=\"co\">#执行脚本</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-8\" data-line-number=\"8\"><span class=\"ex\">Enter</span> password: </a>\r\n<a class=\"sourceLine\" id=\"cb9-9\" data-line-number=\"9\">[<span class=\"ex\">root@centos-158</span> ~]# cat create_user.sql <span class=\"kw\">|</span> <span class=\"ex\">mysql</span> -u root -S /data/scheme1/mysql/3308/mariadb.sock -p <span class=\"co\"># 执行脚本</span></a>\r\n<a class=\"sourceLine\" id=\"cb9-10\" data-line-number=\"10\"><span class=\"ex\">Enter</span> password: </a></code></pre></div>\r\n<p>更多 <a href=\"https://dev.mysql.com/doc/refman/5.7/en/mysqld-multi.html\" target=\"_blank\" rel=\"noopener\">mysqld-multi</a> 使用帮助。</p>\r\n<h3 id=\"查看和关闭实例\">查看和关闭实例</h3>\r\n<div class=\"sourceCode\" id=\"cb10\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb10-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi report                        # 查看服务状态</a>\r\n<a class=\"sourceLine\" id=\"cb10-2\" data-line-number=\"2\"><span class=\"ex\">Reporting</span> MariaDB servers</a>\r\n<a class=\"sourceLine\" id=\"cb10-3\" data-line-number=\"3\"><span class=\"ex\">MariaDB</span> server from group: mysqld3307 is running</a>\r\n<a class=\"sourceLine\" id=\"cb10-4\" data-line-number=\"4\"><span class=\"ex\">MariaDB</span> server from group: mysqld3308 is running</a>\r\n<a class=\"sourceLine\" id=\"cb10-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi stop 3307                     # 关闭一个实例</a>\r\n<a class=\"sourceLine\" id=\"cb10-6\" data-line-number=\"6\">[<span class=\"ex\">root@centos-158</span> ~]# mysqld_multi report                        # 查看服务状态</a>\r\n<a class=\"sourceLine\" id=\"cb10-7\" data-line-number=\"7\"><span class=\"ex\">Reporting</span> MariaDB servers</a>\r\n<a class=\"sourceLine\" id=\"cb10-8\" data-line-number=\"8\"><span class=\"ex\">MariaDB</span> server from group: mysqld3307 is not running</a>\r\n<a class=\"sourceLine\" id=\"cb10-9\" data-line-number=\"9\"><span class=\"ex\">MariaDB</span> server from group: mysqld3308 is running</a></code></pre></div>\r\n<h3 id=\"开机启动\">开机启动</h3>\r\n<p>直接加入到rc.local中</p>\r\n<div class=\"sourceCode\" id=\"cb11\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb11-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# echo <span class=\"kw\">`</span><span class=\"fu\">which</span> mysqld_multi<span class=\"kw\">`</span> start 3307-3308  <span class=\"op\">&gt;&gt;</span> /etc/rc.local        # 开机执行</a>\r\n<a class=\"sourceLine\" id=\"cb11-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# tail -n 1 /etc/rc.local </a>\r\n<a class=\"sourceLine\" id=\"cb11-3\" data-line-number=\"3\"><span class=\"ex\">/usr/bin/mysqld_multi</span> start 3307-3308</a></code></pre></div>\r\n<p>上面的加入rc.local方式管理上容易混乱，还是写个sysv脚本好些。</p>\r\n<div class=\"sourceCode\" id=\"cb12\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb12-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> init.d]# cd /etc/rc.d/init.d/</a>\r\n<a class=\"sourceLine\" id=\"cb12-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> init.d]# vim mysqld_multi </a>\r\n<a class=\"sourceLine\" id=\"cb12-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> init.d]# cat mysqld_multi </a>\r\n<a class=\"sourceLine\" id=\"cb12-4\" data-line-number=\"4\"><span class=\"co\">#! /bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-5\" data-line-number=\"5\"><span class=\"co\"># chkconfig: 2345 90 10</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-6\" data-line-number=\"6\"><span class=\"co\"># description: mysqld_multi</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-7\" data-line-number=\"7\"></a>\r\n<a class=\"sourceLine\" id=\"cb12-8\" data-line-number=\"8\"><span class=\"co\"># See how we were called.</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-9\" data-line-number=\"9\"><span class=\"va\">mysqld_multi=</span>/usr/local/mysql/bin/mysqld_multi</a>\r\n<a class=\"sourceLine\" id=\"cb12-10\" data-line-number=\"10\"><span class=\"co\"># 实例列表</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-11\" data-line-number=\"11\"><span class=\"va\">instance_list=</span><span class=\"st\">&quot;3307-3308&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-12\" data-line-number=\"12\"><span class=\"co\">#instance_list=&quot;3307,3308,3309-3310&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-13\" data-line-number=\"13\"><span class=\"fu\">start()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-14\" data-line-number=\"14\">    <span class=\"va\">$mysqld_multi</span> <span class=\"ex\">start</span> <span class=\"va\">$instance_list</span>  </a>\r\n<a class=\"sourceLine\" id=\"cb12-15\" data-line-number=\"15\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-16\" data-line-number=\"16\"><span class=\"fu\">stop()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-17\" data-line-number=\"17\">    <span class=\"va\">$mysqld_multi</span> <span class=\"ex\">stop</span> <span class=\"va\">$instance_list</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-18\" data-line-number=\"18\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-19\" data-line-number=\"19\"><span class=\"fu\">status()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-20\" data-line-number=\"20\">    <span class=\"va\">$mysqld_multi</span> <span class=\"ex\">report</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-21\" data-line-number=\"21\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-22\" data-line-number=\"22\"><span class=\"kw\">case</span> <span class=\"st\">&quot;</span><span class=\"va\">$1</span><span class=\"st\">&quot;</span><span class=\"kw\"> in</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-23\" data-line-number=\"23\">start<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-24\" data-line-number=\"24\">    <span class=\"ex\">start</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-25\" data-line-number=\"25\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-26\" data-line-number=\"26\">stop<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-27\" data-line-number=\"27\">    <span class=\"ex\">stop</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-28\" data-line-number=\"28\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-29\" data-line-number=\"29\">status<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-30\" data-line-number=\"30\">    <span class=\"ex\">status</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-31\" data-line-number=\"31\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-32\" data-line-number=\"32\">restart<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-33\" data-line-number=\"33\">    <span class=\"ex\">start</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-34\" data-line-number=\"34\">    <span class=\"ex\">stop</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-35\" data-line-number=\"35\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-36\" data-line-number=\"36\">*<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-37\" data-line-number=\"37\">    <span class=\"bu\">echo</span> <span class=\"st\">$&quot;Usage: </span><span class=\"va\">$0</span><span class=\"st\"> {start|stop|status}&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-38\" data-line-number=\"38\">    <span class=\"bu\">exit</span> 2</a>\r\n<a class=\"sourceLine\" id=\"cb12-39\" data-line-number=\"39\"><span class=\"kw\">esac</span></a>\r\n<a class=\"sourceLine\" id=\"cb12-40\" data-line-number=\"40\"></a>\r\n<a class=\"sourceLine\" id=\"cb12-41\" data-line-number=\"41\">[<span class=\"ex\">root@centos-158</span> init.d]# chkconfig --add mysqld_multi                  # 添加sysv</a>\r\n<a class=\"sourceLine\" id=\"cb12-42\" data-line-number=\"42\">[<span class=\"ex\">root@centos-158</span> init.d]# chkconfig mysqld_multi on                     # 启用mysqld_multi</a></code></pre></div>\r\n<h2 id=\"方案2-多sysv脚本\">方案2-多sysv脚本</h2>\r\n<h3 id=\"创建目录并修改权限-1\">创建目录并修改权限</h3>\r\n<p>这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下</p>\r\n<div class=\"sourceCode\" id=\"cb13\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb13-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]#  mkdir -pv /data/scheme2/mysql/<span class=\"dt\">{4307,4308}/{data,etc,log,socket,pid,service}</span>       # 创建目录</a>\r\n<a class=\"sourceLine\" id=\"cb13-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme2/mysql/4307 -R                                      # 修改所有者</a>\r\n<a class=\"sourceLine\" id=\"cb13-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme2/mysql/4308 -R                                      # 修改所有者</a></code></pre></div>\r\n<h3 id=\"安装数据库-1\">安装数据库</h3>\r\n<div class=\"sourceCode\" id=\"cb14\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb14-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4307/data --basedir=/usr --user=mysql  # 安装数据库</a>\r\n<a class=\"sourceLine\" id=\"cb14-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme2/mysql/4308/data --basedir=/usr --user=mysql  # 安装数据库</a></code></pre></div>\r\n<h3 id=\"配置配置文件\">配置配置文件</h3>\r\n<div class=\"sourceCode\" id=\"cb15\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb15-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# cd /data/scheme2/mysql/4307/etc/                           # 进入配置目录</a>\r\n<a class=\"sourceLine\" id=\"cb15-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> etc]# vim my.cnf                                               # 编辑单独的配置文件              </a>\r\n<a class=\"sourceLine\" id=\"cb15-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> etc]# cat my.cnf                                               # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb15-4\" data-line-number=\"4\">[<span class=\"ex\">mysqld</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-5\" data-line-number=\"5\"><span class=\"va\">port=</span>4307</a>\r\n<a class=\"sourceLine\" id=\"cb15-6\" data-line-number=\"6\"><span class=\"va\">datadir=</span>/data/scheme2/mysql/4307/data</a>\r\n<a class=\"sourceLine\" id=\"cb15-7\" data-line-number=\"7\"><span class=\"va\">socket=</span>/data/scheme2/mysql/4307/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb15-8\" data-line-number=\"8\">[<span class=\"ex\">mysqld-safe</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-9\" data-line-number=\"9\"><span class=\"ex\">log-error</span>=/data/scheme2/mysql/4307/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb15-10\" data-line-number=\"10\"><span class=\"ex\">pid-file</span>=/data/scheme2/mysql/4308/pid/mariadb.pid</a>\r\n<a class=\"sourceLine\" id=\"cb15-11\" data-line-number=\"11\"></a>\r\n<a class=\"sourceLine\" id=\"cb15-12\" data-line-number=\"12\">[<span class=\"ex\">root@centos-158</span> etc]# cp my.cnf ../../4308/etc/my.cnf                          # 复制到另一个实例中去</a>\r\n<a class=\"sourceLine\" id=\"cb15-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-158</span> etc]# sed -i <span class=\"st\">&#39;s@4307@4308@&#39;</span> ../../4308/etc/my.cnf              # 修改配置的端口</a>\r\n<a class=\"sourceLine\" id=\"cb15-14\" data-line-number=\"14\">[<span class=\"ex\">root@centos-158</span> etc]# cat ../../4308/etc/my.cnf                                # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb15-15\" data-line-number=\"15\">[<span class=\"ex\">mysqld</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-16\" data-line-number=\"16\"><span class=\"va\">port=</span>4308</a>\r\n<a class=\"sourceLine\" id=\"cb15-17\" data-line-number=\"17\"><span class=\"va\">datadir=</span>/data/scheme2/mysql/4308/data</a>\r\n<a class=\"sourceLine\" id=\"cb15-18\" data-line-number=\"18\"><span class=\"va\">socket=</span>/data/scheme2/mysql/4308/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb15-19\" data-line-number=\"19\">[<span class=\"ex\">mysqld-safe</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb15-20\" data-line-number=\"20\"><span class=\"ex\">log-error</span>=/data/scheme2/mysql/4308/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb15-21\" data-line-number=\"21\"><span class=\"ex\">pid-file</span>=/data/scheme2/mysql/4308/pid/mariadb.pid</a></code></pre></div>\r\n<h3 id=\"配置服务文件\">配置服务文件</h3>\r\n<div class=\"sourceCode\" id=\"cb16\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb16-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# vim service/mysqld.sh                                   # 编辑sysv脚本</a>\r\n<a class=\"sourceLine\" id=\"cb16-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# cat service/mysqld.sh                                   # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb16-3\" data-line-number=\"3\"><span class=\"co\">#!/bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-4\" data-line-number=\"4\"><span class=\"co\"># chkconfig: 2345 91 19</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-5\" data-line-number=\"5\"><span class=\"co\"># description: manage mariadb </span></a>\r\n<a class=\"sourceLine\" id=\"cb16-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-7\" data-line-number=\"7\"><span class=\"va\">port=</span>4307</a>\r\n<a class=\"sourceLine\" id=\"cb16-8\" data-line-number=\"8\"><span class=\"va\">mysql_user=</span><span class=\"st\">&quot;root&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-9\" data-line-number=\"9\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-10\" data-line-number=\"10\"><span class=\"va\">mysql_basedir=</span><span class=\"st\">&quot;/data/scheme2/mysql&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-11\" data-line-number=\"11\"><span class=\"co\">#cmd_path=&quot;${mysql_basedir}/${port}/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-12\" data-line-number=\"12\"><span class=\"va\">cmd_path=</span><span class=\"st\">&quot;/usr/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-13\" data-line-number=\"13\"><span class=\"va\">mysql_sock=</span><span class=\"st\">&quot;</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/socket/mariadb.sock&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-14\" data-line-number=\"14\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-15\" data-line-number=\"15\"><span class=\"fu\">function_start_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-16\" data-line-number=\"16\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-17\" data-line-number=\"17\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-18\" data-line-number=\"18\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Starting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-19\" data-line-number=\"19\">    <span class=\"va\">cmd=</span><span class=\"st\">&quot;</span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld_safe --defaults-file=</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/etc/my.cnf&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-20\" data-line-number=\"20\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;</span><span class=\"va\">$cmd</span><span class=\"st\">\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-21\" data-line-number=\"21\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqld_safe</span> --defaults-file=<span class=\"va\">${mysql_basedir}</span>/<span class=\"va\">${port}</span>/etc/my.cnf  <span class=\"op\">&amp;&gt;</span> /dev/null  <span class=\"kw\">&amp;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-22\" data-line-number=\"22\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-23\" data-line-number=\"23\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-24\" data-line-number=\"24\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-25\" data-line-number=\"25\">    <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-26\" data-line-number=\"26\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-27\" data-line-number=\"27\"><span class=\"fu\">function_status_mysql()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-28\" data-line-number=\"28\">        <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span> ; <span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-29\" data-line-number=\"29\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-30\" data-line-number=\"30\">        <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-31\" data-line-number=\"31\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-32\" data-line-number=\"32\">        <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-33\" data-line-number=\"33\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-34\" data-line-number=\"34\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-35\" data-line-number=\"35\"><span class=\"fu\">function_stop_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-36\" data-line-number=\"36\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-37\" data-line-number=\"37\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-38\" data-line-number=\"38\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-39\" data-line-number=\"39\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-40\" data-line-number=\"40\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-41\" data-line-number=\"41\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Stoping MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-42\" data-line-number=\"42\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqladmin</span> -u <span class=\"va\">${mysql_user}</span> -p<span class=\"va\">${mysql_pwd}</span> -S <span class=\"va\">${mysql_sock}</span> shutdown</a>\r\n<a class=\"sourceLine\" id=\"cb16-43\" data-line-number=\"43\"><span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-44\" data-line-number=\"44\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-45\" data-line-number=\"45\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-46\" data-line-number=\"46\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-47\" data-line-number=\"47\"><span class=\"fu\">function_restart_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-48\" data-line-number=\"48\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-49\" data-line-number=\"49\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Restarting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-50\" data-line-number=\"50\">    <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-51\" data-line-number=\"51\">    <span class=\"fu\">sleep</span> 2</a>\r\n<a class=\"sourceLine\" id=\"cb16-52\" data-line-number=\"52\">    <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-53\" data-line-number=\"53\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-54\" data-line-number=\"54\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-55\" data-line-number=\"55\"><span class=\"kw\">case</span> <span class=\"va\">$1</span><span class=\"kw\"> in</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-56\" data-line-number=\"56\">start<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-57\" data-line-number=\"57\">        <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-58\" data-line-number=\"58\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-59\" data-line-number=\"59\">stop<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-60\" data-line-number=\"60\">        <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-61\" data-line-number=\"61\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-62\" data-line-number=\"62\">restart<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-63\" data-line-number=\"63\">        <span class=\"ex\">function_restart_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-64\" data-line-number=\"64\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-65\" data-line-number=\"65\">status<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-66\" data-line-number=\"66\">        <span class=\"ex\">function_status_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-67\" data-line-number=\"67\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-68\" data-line-number=\"68\">*<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-69\" data-line-number=\"69\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Usage: </span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld {start|stop|restart|status}\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-70\" data-line-number=\"70\"><span class=\"kw\">esac</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-71\" data-line-number=\"71\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-72\" data-line-number=\"72\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-73\" data-line-number=\"73\">[<span class=\"ex\">root@centos-158</span> 4307]# cp service/mysqld.sh  ../4308/service/mysqld.sh     # 复制一份</a>\r\n<a class=\"sourceLine\" id=\"cb16-74\" data-line-number=\"74\">[<span class=\"ex\">root@centos-158</span> 4307]# sed -i <span class=\"st\">&#39;s@4307@4308@&#39;</span> ../4308/service/mysqld.sh     # 修改端口</a>\r\n<a class=\"sourceLine\" id=\"cb16-75\" data-line-number=\"75\">[<span class=\"ex\">root@centos-158</span> 4307]# cat ../4308/service/mysqld.sh                       # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb16-76\" data-line-number=\"76\"><span class=\"co\">#!/bin/bash</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-77\" data-line-number=\"77\"><span class=\"co\"># chkconfig: 2345 91 19</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-78\" data-line-number=\"78\"><span class=\"co\"># description: manage mariadb </span></a>\r\n<a class=\"sourceLine\" id=\"cb16-79\" data-line-number=\"79\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-80\" data-line-number=\"80\"><span class=\"va\">port=</span>4308</a>\r\n<a class=\"sourceLine\" id=\"cb16-81\" data-line-number=\"81\"><span class=\"va\">mysql_user=</span><span class=\"st\">&quot;root&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-82\" data-line-number=\"82\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-83\" data-line-number=\"83\"><span class=\"va\">mysql_basedir=</span><span class=\"st\">&quot;/data/scheme2/mysql&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-84\" data-line-number=\"84\"><span class=\"co\">#cmd_path=&quot;${mysql_basedir}/${port}/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-85\" data-line-number=\"85\"><span class=\"va\">cmd_path=</span><span class=\"st\">&quot;/usr/bin&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-86\" data-line-number=\"86\"><span class=\"va\">mysql_sock=</span><span class=\"st\">&quot;</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/socket/mariadb.sock&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-87\" data-line-number=\"87\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-88\" data-line-number=\"88\"><span class=\"fu\">function_start_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-89\" data-line-number=\"89\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-90\" data-line-number=\"90\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-91\" data-line-number=\"91\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Starting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-92\" data-line-number=\"92\">    <span class=\"va\">cmd=</span><span class=\"st\">&quot;</span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld_safe --defaults-file=</span><span class=\"va\">${mysql_basedir}</span><span class=\"st\">/</span><span class=\"va\">${port}</span><span class=\"st\">/etc/my.cnf&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-93\" data-line-number=\"93\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;</span><span class=\"va\">$cmd</span><span class=\"st\">\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-94\" data-line-number=\"94\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqld_safe</span> --defaults-file=<span class=\"va\">${mysql_basedir}</span>/<span class=\"va\">${port}</span>/etc/my.cnf  <span class=\"op\">&amp;&gt;</span> /dev/null  <span class=\"kw\">&amp;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-95\" data-line-number=\"95\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-96\" data-line-number=\"96\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-97\" data-line-number=\"97\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-98\" data-line-number=\"98\">    <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-99\" data-line-number=\"99\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-100\" data-line-number=\"100\"><span class=\"fu\">function_status_mysql()</span><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-101\" data-line-number=\"101\">        <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span> ; <span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-102\" data-line-number=\"102\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is running...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-103\" data-line-number=\"103\">        <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-104\" data-line-number=\"104\">                <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySql is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-105\" data-line-number=\"105\">        <span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-106\" data-line-number=\"106\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-107\" data-line-number=\"107\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-108\" data-line-number=\"108\"><span class=\"fu\">function_stop_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-109\" data-line-number=\"109\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-110\" data-line-number=\"110\">    <span class=\"kw\">if</span><span class=\"bu\"> [</span> <span class=\"ot\">!</span> <span class=\"ot\">-e</span> <span class=\"st\">&quot;</span><span class=\"va\">$mysql_sock</span><span class=\"st\">&quot;</span><span class=\"bu\"> ]</span>;<span class=\"kw\">then</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-111\" data-line-number=\"111\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;MySQL is stopped...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-112\" data-line-number=\"112\">    <span class=\"bu\">exit</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-113\" data-line-number=\"113\">    <span class=\"kw\">else</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-114\" data-line-number=\"114\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Stoping MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-115\" data-line-number=\"115\">    <span class=\"va\">${cmd_path}</span><span class=\"ex\">/mysqladmin</span> -u <span class=\"va\">${mysql_user}</span> -p<span class=\"va\">${mysql_pwd}</span> -S <span class=\"va\">${mysql_sock}</span> shutdown</a>\r\n<a class=\"sourceLine\" id=\"cb16-116\" data-line-number=\"116\"><span class=\"kw\">fi</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-117\" data-line-number=\"117\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-118\" data-line-number=\"118\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-119\" data-line-number=\"119\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-120\" data-line-number=\"120\"><span class=\"fu\">function_restart_mysql()</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-121\" data-line-number=\"121\"><span class=\"kw\">{</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-122\" data-line-number=\"122\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Restarting MySQL...\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-123\" data-line-number=\"123\">    <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-124\" data-line-number=\"124\">    <span class=\"fu\">sleep</span> 2</a>\r\n<a class=\"sourceLine\" id=\"cb16-125\" data-line-number=\"125\">    <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-126\" data-line-number=\"126\"><span class=\"kw\">}</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-127\" data-line-number=\"127\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-128\" data-line-number=\"128\"><span class=\"kw\">case</span> <span class=\"va\">$1</span><span class=\"kw\"> in</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-129\" data-line-number=\"129\">start<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-130\" data-line-number=\"130\">        <span class=\"ex\">function_start_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-131\" data-line-number=\"131\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-132\" data-line-number=\"132\">stop<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-133\" data-line-number=\"133\">        <span class=\"ex\">function_stop_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-134\" data-line-number=\"134\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-135\" data-line-number=\"135\">restart<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-136\" data-line-number=\"136\">        <span class=\"ex\">function_restart_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-137\" data-line-number=\"137\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-138\" data-line-number=\"138\">status<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-139\" data-line-number=\"139\">        <span class=\"ex\">function_status_mysql</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-140\" data-line-number=\"140\">        <span class=\"kw\">;;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-141\" data-line-number=\"141\">*<span class=\"kw\">)</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-142\" data-line-number=\"142\">    <span class=\"bu\">printf</span> <span class=\"st\">&quot;Usage: </span><span class=\"va\">${cmd_path}</span><span class=\"st\">/mysqld {start|stop|restart|status}\\n&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-143\" data-line-number=\"143\"><span class=\"kw\">esac</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-144\" data-line-number=\"144\"></a>\r\n<a class=\"sourceLine\" id=\"cb16-145\" data-line-number=\"145\"><span class=\"co\"># 添加执行权限</span></a>\r\n<a class=\"sourceLine\" id=\"cb16-146\" data-line-number=\"146\">[<span class=\"ex\">root@centos-158</span> 4307]# chmod a+x /data/scheme2/mysql/4307/service/mysqld.sh </a>\r\n<a class=\"sourceLine\" id=\"cb16-147\" data-line-number=\"147\">[<span class=\"ex\">root@centos-158</span> 4307]# chmod a+x /data/scheme2/mysql/4308/service/mysqld.sh</a></code></pre></div>\r\n<h3 id=\"开机启动-1\">开机启动</h3>\r\n<div class=\"sourceCode\" id=\"cb17\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb17-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# ln -s /data/scheme2/mysql/4307/service/mysqld.sh /etc/rc.d/init.d/mysql4307     # 添加到init.d目录</a>\r\n<a class=\"sourceLine\" id=\"cb17-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# chkconfig --add mysql4307                                                       # 添加到sysv</a>\r\n<a class=\"sourceLine\" id=\"cb17-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> 4307]# chkconfig mysql4307 on                                                          # 开机启动</a>\r\n<a class=\"sourceLine\" id=\"cb17-4\" data-line-number=\"4\"></a>\r\n<a class=\"sourceLine\" id=\"cb17-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> 4307]# cd ../4308</a>\r\n<a class=\"sourceLine\" id=\"cb17-6\" data-line-number=\"6\"></a>\r\n<a class=\"sourceLine\" id=\"cb17-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-158</span> 4308]# ln -s /data/scheme2/mysql/4308/service/mysqld.sh /etc/rc.d/init.d/mysql4308     # 添加到init.d目录</a>\r\n<a class=\"sourceLine\" id=\"cb17-8\" data-line-number=\"8\">[<span class=\"ex\">root@centos-158</span> 4308]# chkconfig --add mysql4308                                                       # 添加到sysv</a>\r\n<a class=\"sourceLine\" id=\"cb17-9\" data-line-number=\"9\">[<span class=\"ex\">root@centos-158</span> 4308]# chkconfig mysql4308 on                                                          # 开机启动</a></code></pre></div>\r\n<h3 id=\"启动服务和查看状态\">启动服务和查看状态</h3>\r\n<div class=\"sourceCode\" id=\"cb18\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb18-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# service mysql4307 start                     # 启动实例</a>\r\n<a class=\"sourceLine\" id=\"cb18-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# service mysql4308 start                     # 启动实例      </a>\r\n<a class=\"sourceLine\" id=\"cb18-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> 4307]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 430                    # 查看状态</a>\r\n<a class=\"sourceLine\" id=\"cb18-4\" data-line-number=\"4\"><span class=\"ex\">tcp6</span>       0      0 :::4307                 :::*                    LISTEN      8221/mysqld         </a>\r\n<a class=\"sourceLine\" id=\"cb18-5\" data-line-number=\"5\"><span class=\"ex\">tcp6</span>       0      0 :::4308                 :::*                    LISTEN      8369/mysqld </a></code></pre></div>\r\n<h3 id=\"安全初始化\">安全初始化</h3>\r\n<div class=\"sourceCode\" id=\"cb19\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb19-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4307/socket/mariadb.sock <span class=\"co\"># 安全初始化，参考方案1</span></a>\r\n<a class=\"sourceLine\" id=\"cb19-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> 4307]# mysql_secure_installation  -u root  -S /data/scheme2/mysql/4308/socket/mariadb.sock <span class=\"co\"># 安全初始化，参考方案1</span></a></code></pre></div>\r\n<h3 id=\"服务文件修改密码\">服务文件修改密码</h3>\r\n<div class=\"sourceCode\" id=\"cb20\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb20-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> 4307]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码</a>\r\n<a class=\"sourceLine\" id=\"cb20-2\" data-line-number=\"2\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;xxxxx&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb20-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> 4307]# chmod 750 service/mysqld.sh         # 带有密码设置下权限</a>\r\n<a class=\"sourceLine\" id=\"cb20-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> 4307]# cd ../4308                          </a>\r\n<a class=\"sourceLine\" id=\"cb20-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> 4308]# vim service/mysqld.sh               # 修改文件的密码项为上面的安装初始化指定的密码</a>\r\n<a class=\"sourceLine\" id=\"cb20-6\" data-line-number=\"6\"><span class=\"va\">mysql_pwd=</span><span class=\"st\">&quot;xxxxx&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb20-7\" data-line-number=\"7\">[<span class=\"ex\">root@centos-158</span> 4308]# chmod 750 service/mysqld.sh         # 带有密码设置下权限</a></code></pre></div>\r\n<h2 id=\"方案3-systemd\">方案3-systemd</h2>\r\n<h3 id=\"创建目录并修改权限-2\">创建目录并修改权限</h3>\r\n<p>这种方式，需要每个配置文件都要单独存放，可以给目录更详细的规划下</p>\r\n<div class=\"sourceCode\" id=\"cb21\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb21-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mkdir -pv /data/scheme3/mysql/<span class=\"dt\">{5307,5308}/{data,log,socket,pid}</span>        # 创建目录</a>\r\n<a class=\"sourceLine\" id=\"cb21-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme3/mysql/5307 -R                          # 所有者修改</a>\r\n<a class=\"sourceLine\" id=\"cb21-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> ~]# chown mysql.mysql /data/scheme3/mysql/5308 -R                          # 所有者修改</a></code></pre></div>\r\n<h3 id=\"安装数据库-2\">安装数据库</h3>\r\n<div class=\"sourceCode\" id=\"cb22\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb22-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5307/data --basedir=/usr --user=mysql  # 安装数据库</a>\r\n<a class=\"sourceLine\" id=\"cb22-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_install_db  --datadir=/data/scheme3/mysql/5308/data --basedir=/usr --user=mysql  # 安装数据库</a></code></pre></div>\r\n<h3 id=\"配置配置文件-1\">配置配置文件</h3>\r\n<div class=\"sourceCode\" id=\"cb23\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb23-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mv /etc/my.cnf /etc/my.cnf.multi                       # 原有配置文件重名</a>\r\n<a class=\"sourceLine\" id=\"cb23-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> system]# cd /etc/my.cnf.d/                                 # 进入conf.d目录</a>\r\n<a class=\"sourceLine\" id=\"cb23-3\" data-line-number=\"3\"></a>\r\n<a class=\"sourceLine\" id=\"cb23-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# vim my5307.cnf                                  # 编辑这个文件，名字为my<span class=\"op\">&lt;</span>instance_nam<span class=\"op\">&gt;</span>.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb23-5\" data-line-number=\"5\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# cat my5307.cnf                                  # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb23-6\" data-line-number=\"6\">[<span class=\"ex\">mysqld</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb23-7\" data-line-number=\"7\"><span class=\"va\">datadir=</span>/data/scheme3/mysql/5307/data</a>\r\n<a class=\"sourceLine\" id=\"cb23-8\" data-line-number=\"8\"><span class=\"va\">socket=</span>/data/scheme3/mysql/5307/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb23-9\" data-line-number=\"9\"><span class=\"va\">port=</span>5307</a>\r\n<a class=\"sourceLine\" id=\"cb23-10\" data-line-number=\"10\"><span class=\"ex\">log-error</span>=/data/scheme3/mysql/5307/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb23-11\" data-line-number=\"11\"><span class=\"ex\">pid-file</span>=/data/scheme3/mysql/5307/pid/mariadb.pid</a>\r\n<a class=\"sourceLine\" id=\"cb23-12\" data-line-number=\"12\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# vim my5308.cnf                                  # 编辑这个文件</a>\r\n<a class=\"sourceLine\" id=\"cb23-13\" data-line-number=\"13\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# cat my5308.cnf                                  # 检查</a>\r\n<a class=\"sourceLine\" id=\"cb23-14\" data-line-number=\"14\">[<span class=\"ex\">mysql</span>]</a>\r\n<a class=\"sourceLine\" id=\"cb23-15\" data-line-number=\"15\"><span class=\"va\">datadir=</span>/data/scheme3/mysql/5308/data</a>\r\n<a class=\"sourceLine\" id=\"cb23-16\" data-line-number=\"16\"><span class=\"va\">socket=</span>/data/scheme3/mysql/5308/socket/mariadb.sock</a>\r\n<a class=\"sourceLine\" id=\"cb23-17\" data-line-number=\"17\"><span class=\"va\">port=</span>5308</a>\r\n<a class=\"sourceLine\" id=\"cb23-18\" data-line-number=\"18\"><span class=\"ex\">log-error</span>=/data/scheme3/mysql/5308/log/mariadb.log</a>\r\n<a class=\"sourceLine\" id=\"cb23-19\" data-line-number=\"19\"><span class=\"ex\">pid-file</span>=/data/scheme3/mysql/5308/pid/mariadb.pid</a></code></pre></div>\r\n<h3 id=\"配置systemd\">配置systemd</h3>\r\n<div class=\"sourceCode\" id=\"cb24\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb24-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# vim /usr/lib/systemd/system/mariadb@.service        # 修改mariadb@service文件默认项</a>\r\n<a class=\"sourceLine\" id=\"cb24-2\" data-line-number=\"2\"><span class=\"co\"># 修改如下内容</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-3\" data-line-number=\"3\"><span class=\"va\">ConditionPathExists=</span>/etc/my.cnf.d/my%I.cnf</a>\r\n<a class=\"sourceLine\" id=\"cb24-4\" data-line-number=\"4\"></a>\r\n<a class=\"sourceLine\" id=\"cb24-5\" data-line-number=\"5\"><span class=\"va\">ExecStartPre=</span>/bin/sh <span class=\"ex\">-c</span> <span class=\"st\">&quot;[ ! -e /usr/bin/galera_recovery ] &amp;&amp; VAR= || \\</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-6\" data-line-number=\"6\"><span class=\"st\">VAR=</span><span class=\"kw\">`</span><span class=\"ex\">/usr/bin/galera_recovery</span> --defaults-file=/etc/my.cnf.d/my%I.cnf<span class=\"kw\">`</span><span class=\"st\">; [ </span><span class=\"va\">$?</span><span class=\"st\"> -eq 0 ] \\</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-7\" data-line-number=\"7\"><span class=\"st\">&amp;&amp; systemctl set-environment _WSREP_START_POSITION%I=</span><span class=\"va\">$VAR</span><span class=\"st\"> || exit 1&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb24-8\" data-line-number=\"8\"></a>\r\n<a class=\"sourceLine\" id=\"cb24-9\" data-line-number=\"9\"><span class=\"va\">ExecStart=</span>/usr/sbin/mysqld <span class=\"ex\">--defaults-file</span>=/etc/my.cnf.d/my%I.cnf \\</a>\r\n<a class=\"sourceLine\" id=\"cb24-10\" data-line-number=\"10\"><span class=\"va\">$_WSREP_NEW_CLUSTER</span> <span class=\"va\">$_WSREP_START_POSITION</span>%I <span class=\"va\">$MYSQLD_OPTS</span></a></code></pre></div>\r\n<p>上面的简单的说就是说明下mysqld命令的路径，指定你的实例所在的路径%I代表实例名字。后续启动的 &quot;systemctl start mariadb@5307&quot; 这个命令中，5307就是实例名字。</p>\r\n<p>这个文件有点多， 提供一个下载参考吧。</p>\r\n<p><span data-role=\"download\">/files/mariadb@.service</span></p>\r\n<h3 id=\"启动服务和查看状态-1\">启动服务和查看状态</h3>\r\n<div class=\"sourceCode\" id=\"cb25\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb25-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl daemon-reload                 # 重载systemd</a>\r\n<a class=\"sourceLine\" id=\"cb25-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl start mariadb@5307            # 启动实例</a>\r\n<a class=\"sourceLine\" id=\"cb25-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl start mariadb@5308            # 启动实例</a>\r\n<a class=\"sourceLine\" id=\"cb25-4\" data-line-number=\"4\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# netstat -tunlp <span class=\"kw\">|</span><span class=\"fu\">grep</span> 530                # 查看服务状态</a>\r\n<a class=\"sourceLine\" id=\"cb25-5\" data-line-number=\"5\"><span class=\"ex\">tcp6</span>       0      0 :::5307                 :::*                    LISTEN      10267/mysqld        </a>\r\n<a class=\"sourceLine\" id=\"cb25-6\" data-line-number=\"6\"><span class=\"ex\">tcp6</span>       0      0 :::5308                 :::*                    LISTEN      10595/mysqld  </a></code></pre></div>\r\n<h3 id=\"开机启动-2\">开机启动</h3>\r\n<div class=\"sourceCode\" id=\"cb26\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb26-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl enable  mariadb@5307           # 开机启动这个实例</a>\r\n<a class=\"sourceLine\" id=\"cb26-2\" data-line-number=\"2\"><span class=\"ex\">Created</span> symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5307.service to /usr/lib/systemd/system/mariadb@.service.</a>\r\n<a class=\"sourceLine\" id=\"cb26-3\" data-line-number=\"3\">[<span class=\"ex\">root@centos-158</span> my.cnf.d]# systemctl enable  mariadb@5308           # 开机启动这个实例</a>\r\n<a class=\"sourceLine\" id=\"cb26-4\" data-line-number=\"4\"><span class=\"ex\">Created</span> symlink from /etc/systemd/system/multi-user.target.wants/mariadb@5308.service to /usr/lib/systemd/system/mariadb@.service.</a></code></pre></div>\r\n<h3 id=\"安全初始化-1\">安全初始化</h3>\r\n<div class=\"sourceCode\" id=\"cb27\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb27-1\" data-line-number=\"1\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5307/socket/mariadb.sock    # 安全设置</a>\r\n<a class=\"sourceLine\" id=\"cb27-2\" data-line-number=\"2\">[<span class=\"ex\">root@centos-158</span> ~]# mysql_secure_installation  -u root  -S /data/scheme3/mysql/5308/socket/mariadb.sock    # 安全设置</a></code></pre></div>\r\n"},{"title":"test_database","date":"2018-02-02T11:09:03.000Z","_content":"\n\n\ntest1\n-------------------------------\n\ntest2\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest3\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest4\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest5\n-------------------------------\n\ntest6\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest7\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\ntest8\n-------------------------------\n\ntest9\n","source":"_posts/test_database.rst","raw":"---\ntitle: test_database\ntags:\n  - database\ncategories: \"database\"\ndate: 2018-02-02 19:09:03\n---\n\n\n\ntest1\n-------------------------------\n\ntest2\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest3\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest4\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest5\n-------------------------------\n\ntest6\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntest7\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\ntest8\n-------------------------------\n\ntest9\n","slug":"test_database","published":1,"updated":"2018-02-06T12:10:00.705Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mnu000mugtmqia5s1oe","content":"<h2 id=\"test1\">test1</h2>\r\n<h3 id=\"test2\">test2</h3>\r\n<h3 id=\"test3\">test3</h3>\r\n<h3 id=\"test4\">test4</h3>\r\n<h2 id=\"test5\">test5</h2>\r\n<h3 id=\"test6\">test6</h3>\r\n<h4 id=\"test7\">test7</h4>\r\n<h2 id=\"test8\">test8</h2>\r\n<p>test9</p>\r\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"test1\">test1</h2>\r\n<h3 id=\"test2\">test2</h3>\r\n<h3 id=\"test3\">test3</h3>\r\n<h3 id=\"test4\">test4</h3>\r\n<h2 id=\"test5\">test5</h2>\r\n<h3 id=\"test6\">test6</h3>\r\n<h4 id=\"test7\">test7</h4>\r\n<h2 id=\"test8\">test8</h2>\r\n<p>test9</p>\r\n"},{"layout":"essay","title":"test","date":"2018-02-02T11:03:53.000Z","_content":"","source":"_posts/test.rst","raw":"---\nlayout: essay\ntitle: test\ndate: 2018-02-02 19:03:53\ntags:\n\n---\n","slug":"test","published":1,"updated":"2018-02-06T12:10:00.705Z","comments":1,"photos":[],"link":"","_id":"cje3z1mnw000ougtm4ddc5k85","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"test_linux","date":"2018-02-02T11:08:49.000Z","_content":"","source":"_posts/test_linux.rst","raw":"---\ntitle: test_linux\ntags: \n  - linux\ncategories: \"linux\"\ndate: 2018-02-02 19:08:49\n---\n","slug":"test_linux","published":1,"updated":"2018-02-06T12:10:00.706Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mo5000tugtmcqiw825c","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"test_essay","date":"2018-02-02T11:08:56.000Z","_content":"","source":"_posts/test_essay.rst","raw":"---\ntitle: test_essay\ntags: \n  - essay\ncategories: \"essay\"\ndate: 2018-02-02 19:08:56\n---\n","slug":"test_essay","published":1,"updated":"2018-02-06T12:10:00.706Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mo6000wugtmainrhexk","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"test_python","date":"2018-02-02T11:08:30.000Z","_content":"","source":"_posts/test_python.rst","raw":"---\ntitle: test_python\ntags:\n  - python\ncategories: python\ndate: 2018-02-02 19:08:30\n---\n","slug":"test_python","published":1,"updated":"2018-02-06T12:10:00.706Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1mo90011ugtmg9c3m2n2","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"test_spider","date":"2018-02-02T11:08:49.000Z","_content":"","source":"_posts/test_spider.rst","raw":"---\ntitle: test_spider\ntags: \n  - spider\ncategories: \"spider\"\ndate: 2018-02-02 19:08:49\n---\n","slug":"test_spider","published":1,"updated":"2018-02-06T12:10:00.707Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1moa0013ugtmn8ku0t3x","content":"\r\n","site":{"data":{}},"excerpt":"","more":"\r\n"},{"title":"使用七牛云存储提供一个数据分发服务","copyright":true,"top":60,"date":"2018-02-16T13:55:24.000Z","_content":"\n\n背景描述\n----------------------------------------------------\n我个人在阿里云注册一个域名和购买了一个主机，平时整理写脚本和一些压缩包，放在自己的download目录，然后使用apache配合虚拟主机\n共享出来，但是遇到问题了， 我自己的阿里云主机的带宽是1M的，下载速度真的慢，想想可以使用七牛云存储来改进下我的下载速度问题，\n把我的改进过程给大家分享下。\n\n七牛云简介\n---------------------------------------------------------\n（七牛云）隶属于上海七牛信息技术有限公司，七牛云是国内领先的企业级云服务商，专注于以数据管理为中心的云计算业务研发和运营，围绕富媒体\n场景推出了对象存储、融合 CDN 加速、容器计算云、大数据平台、人工智能平台等产品，并提供一站式视频云解决方案。公司目前已位列国内云计算\n行业第一阵营，为 70 多万家企业提供服务。\n\n七牛云相关\n-----------------------------------------------------------\n\n账号注册\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n注册地址_\n\n.. _注册地址: https://portal.qiniu.com/signup/choice\n\n账号实名认证\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n注册完毕需要下实名认证，很快的，大概1-2天就实名认证完毕了。\n\n新建存储空间\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/新建存储.png\n\n绑定域名\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/绑定域名.png\n\n设置默认域名连接\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/设置默认域名.png\n\n查看cname\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/查看cname.png\n\n设置cname\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/添加cname.png\n\n这个需要在自己的域名解析里面添加下这个cname的记录项。\n\nkey的获取\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/七牛云key.png\n\npython3的安装(可选)\n-----------------------------------------------------------\n\npython的安装_\n\n.. _python的安装: https://repo.continuum.io/archive/Anaconda3-5.1.0-Linux-x86_64.sh\n\n这是一个bash脚本，下载下载下来运行就可以，注意设置下安装路径，我设置的是/usr/loca/python3\n\n安装七牛云的python包\n-----------------------------------------------------------\n\n.. code-block:: bash\n\n  [root@www qiniu]# /usr/local/python3/bin/pip install qiniu\n\n安装完毕之后，我们就可以使用七牛云提供的pythonapi了。\n\n上传文件\n-----------------------------------------------------------\n\n编辑config文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  [root@www qiniu]# vim /usr/local/python3/lib/python3.6/site-packages/qiniu/config.py\n  # 修改超时时间\n  'connection_timeout': 300000,        # 链接超时为时间为30s\n\n因为我们自己上传的文件，可能很大，就会导致因链接时间过短而导致的上传失败，需要调整下timeout就可以了。\n\n编写脚本\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n官方api_\n\n.. _官方api: https://developer.qiniu.com/kodo/sdk/1242/python#upload-flow\n\n结合官方的api，我自己修改了下，如下。\n\n.. code-block:: python \n   :linenos:\n   \n  # -*- coding: utf-8 -*-\n  # flake8: noqa\n  from qiniu import Auth, put_file, etag, urlsafe_base64_encode\n  import qiniu.config\n  import os\n  import glob\n  import json\n  import jmespath\n  hash_json_file = \"/root/bin/hash_file.json\"\n  hash_json = []\n  hash_value = []\n  need_add = []\n  if os.path.exists(hash_json_file):\n          with open(hash_json_file) as f:\n                  hash_json=json.load(f)\n                  hash_value=jmespath.search('[*].hash',hash_json)\n  #print(hash_json)\n  #需要填写你的 Access Key 和 Secret Key\n  access_key = '6VGRI141Y1IHzO0WyIu9NKuKCPAMZsECmV80-sK0'\n  secret_key = '1GQwv1f8qcIQn3o9Bq3_1xXP_JR_-GQPlZDfK7pu'\n  #构建鉴权对象\n  q = Auth(access_key, secret_key)\n  #要上传的空间\n  bucket_name = 'download'\n  tmpfiles=glob.glob(\"/git/download/**/*\" ,recursive=True)\n  files=[x for x in tmpfiles if os.path.isfile(x)]\n  for file_item in files:\n          print(\"=================>start upload\" + file_item)\n          #要上传文件的本地路径\n          localfile = file_item\n          tmp_hash = etag(localfile)\n          if len(hash_value) > 0 and  tmp_hash in hash_value:\n                  print(\"========>sikp\" + localfile)\n                  continue\n          #上传到七牛后保存的文件名\n          key = file_item.replace(\"/git/download/\",\"\")\n          #生成上传 Token，可以指定过期时间等\n          token = q.upload_token(bucket_name, key, 3600)\n          ret, info = put_file(token, key, localfile)\n          print(ret)\n          #print(info)\n          need_add.append(ret)\n          #assert ret['key'] == key\n          #assert ret['hash'] == etag(localfile)\n\n  hash_json+=need_add\n  print(\"=\"*20)\n  print(json.dumps(need_add, indent=4))\n  print(\"=\"*20)\n  with open(hash_json_file,'w',encoding='utf-8') as f:\n          json.dump(hash_json,f,indent=4)\n\n\n代码也是比较简单，就是利用了一个hash文件来控制不去上传重复的文件。\n\n\n测试上传\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  [root@www bin]# /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py \n\n配置计划任务\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  [root@www bin]# crontab -e\n  # 添加如下行\n  1 1 * * * /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py\n\n\n测试下载速度\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  C:\\Users\\Administrator>curl http://download.linuxpanda.tech/lamp/mariadb-10.2.12.tar.gz?attname= -O\n    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                  Dload  Upload   Total   Spent    Left  Speed\n  100 69.4M  100 69.4M    0     0  3555k      0  0:00:20  0:00:20 --:--:-- 5151k\n\n一个近60M的文件20秒就下载完毕了，平均1s就3M,下载速度杠杠滴，要是使用我自己的那个1M的带宽，那个下载速度最大也就125k。\n\n\n配置自己的下载地址\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n上面使用了七牛云的下载地址，但是没有列表展示界面，很不爽啊， 我还是希望我可以\n能看到我自己的列表信息，可以在apache上配置一个虚拟主机。\n\n.. code-block:: xml\n\n  <VirtualHost *:80>\n    ServerName download2.linuxpanda.tech\n    ServerAlias down2.linuxpanda.tech ftp2.linuxpanda.tech\n    DocumentRoot /git/download\n    <Directory /git/download>\n          Options  +FollowSymLinks\n          AllowOverride All\n          Require all granted\n    </Directory>\n  </VirtualHost>\n\n访问的自己的输入对应的地址： download2.linuxpanda.tech_\n\n.. _download2.linuxpanda.tech: http://download2.linuxpanda.tech\n","source":"_posts/使用七牛云存储提供一个数据分发服务.rst","raw":"---\ntitle: 使用七牛云存储提供一个数据分发服务\ntags:\n  - linux\ncategories: linux\ncopyright: true\ntop: 60\ndate: 2018-02-16 21:55:24\n---\n\n\n背景描述\n----------------------------------------------------\n我个人在阿里云注册一个域名和购买了一个主机，平时整理写脚本和一些压缩包，放在自己的download目录，然后使用apache配合虚拟主机\n共享出来，但是遇到问题了， 我自己的阿里云主机的带宽是1M的，下载速度真的慢，想想可以使用七牛云存储来改进下我的下载速度问题，\n把我的改进过程给大家分享下。\n\n七牛云简介\n---------------------------------------------------------\n（七牛云）隶属于上海七牛信息技术有限公司，七牛云是国内领先的企业级云服务商，专注于以数据管理为中心的云计算业务研发和运营，围绕富媒体\n场景推出了对象存储、融合 CDN 加速、容器计算云、大数据平台、人工智能平台等产品，并提供一站式视频云解决方案。公司目前已位列国内云计算\n行业第一阵营，为 70 多万家企业提供服务。\n\n七牛云相关\n-----------------------------------------------------------\n\n账号注册\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n注册地址_\n\n.. _注册地址: https://portal.qiniu.com/signup/choice\n\n账号实名认证\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n注册完毕需要下实名认证，很快的，大概1-2天就实名认证完毕了。\n\n新建存储空间\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/新建存储.png\n\n绑定域名\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/绑定域名.png\n\n设置默认域名连接\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/设置默认域名.png\n\n查看cname\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/查看cname.png\n\n设置cname\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/添加cname.png\n\n这个需要在自己的域名解析里面添加下这个cname的记录项。\n\nkey的获取\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. image:: /images/qiniu/七牛云key.png\n\npython3的安装(可选)\n-----------------------------------------------------------\n\npython的安装_\n\n.. _python的安装: https://repo.continuum.io/archive/Anaconda3-5.1.0-Linux-x86_64.sh\n\n这是一个bash脚本，下载下载下来运行就可以，注意设置下安装路径，我设置的是/usr/loca/python3\n\n安装七牛云的python包\n-----------------------------------------------------------\n\n.. code-block:: bash\n\n  [root@www qiniu]# /usr/local/python3/bin/pip install qiniu\n\n安装完毕之后，我们就可以使用七牛云提供的pythonapi了。\n\n上传文件\n-----------------------------------------------------------\n\n编辑config文件\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  [root@www qiniu]# vim /usr/local/python3/lib/python3.6/site-packages/qiniu/config.py\n  # 修改超时时间\n  'connection_timeout': 300000,        # 链接超时为时间为30s\n\n因为我们自己上传的文件，可能很大，就会导致因链接时间过短而导致的上传失败，需要调整下timeout就可以了。\n\n编写脚本\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n官方api_\n\n.. _官方api: https://developer.qiniu.com/kodo/sdk/1242/python#upload-flow\n\n结合官方的api，我自己修改了下，如下。\n\n.. code-block:: python \n   :linenos:\n   \n  # -*- coding: utf-8 -*-\n  # flake8: noqa\n  from qiniu import Auth, put_file, etag, urlsafe_base64_encode\n  import qiniu.config\n  import os\n  import glob\n  import json\n  import jmespath\n  hash_json_file = \"/root/bin/hash_file.json\"\n  hash_json = []\n  hash_value = []\n  need_add = []\n  if os.path.exists(hash_json_file):\n          with open(hash_json_file) as f:\n                  hash_json=json.load(f)\n                  hash_value=jmespath.search('[*].hash',hash_json)\n  #print(hash_json)\n  #需要填写你的 Access Key 和 Secret Key\n  access_key = '6VGRI141Y1IHzO0WyIu9NKuKCPAMZsECmV80-sK0'\n  secret_key = '1GQwv1f8qcIQn3o9Bq3_1xXP_JR_-GQPlZDfK7pu'\n  #构建鉴权对象\n  q = Auth(access_key, secret_key)\n  #要上传的空间\n  bucket_name = 'download'\n  tmpfiles=glob.glob(\"/git/download/**/*\" ,recursive=True)\n  files=[x for x in tmpfiles if os.path.isfile(x)]\n  for file_item in files:\n          print(\"=================>start upload\" + file_item)\n          #要上传文件的本地路径\n          localfile = file_item\n          tmp_hash = etag(localfile)\n          if len(hash_value) > 0 and  tmp_hash in hash_value:\n                  print(\"========>sikp\" + localfile)\n                  continue\n          #上传到七牛后保存的文件名\n          key = file_item.replace(\"/git/download/\",\"\")\n          #生成上传 Token，可以指定过期时间等\n          token = q.upload_token(bucket_name, key, 3600)\n          ret, info = put_file(token, key, localfile)\n          print(ret)\n          #print(info)\n          need_add.append(ret)\n          #assert ret['key'] == key\n          #assert ret['hash'] == etag(localfile)\n\n  hash_json+=need_add\n  print(\"=\"*20)\n  print(json.dumps(need_add, indent=4))\n  print(\"=\"*20)\n  with open(hash_json_file,'w',encoding='utf-8') as f:\n          json.dump(hash_json,f,indent=4)\n\n\n代码也是比较简单，就是利用了一个hash文件来控制不去上传重复的文件。\n\n\n测试上传\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  [root@www bin]# /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py \n\n配置计划任务\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  [root@www bin]# crontab -e\n  # 添加如下行\n  1 1 * * * /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py\n\n\n测试下载速度\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n.. code-block:: bash\n\n  C:\\Users\\Administrator>curl http://download.linuxpanda.tech/lamp/mariadb-10.2.12.tar.gz?attname= -O\n    % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                  Dload  Upload   Total   Spent    Left  Speed\n  100 69.4M  100 69.4M    0     0  3555k      0  0:00:20  0:00:20 --:--:-- 5151k\n\n一个近60M的文件20秒就下载完毕了，平均1s就3M,下载速度杠杠滴，要是使用我自己的那个1M的带宽，那个下载速度最大也就125k。\n\n\n配置自己的下载地址\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n上面使用了七牛云的下载地址，但是没有列表展示界面，很不爽啊， 我还是希望我可以\n能看到我自己的列表信息，可以在apache上配置一个虚拟主机。\n\n.. code-block:: xml\n\n  <VirtualHost *:80>\n    ServerName download2.linuxpanda.tech\n    ServerAlias down2.linuxpanda.tech ftp2.linuxpanda.tech\n    DocumentRoot /git/download\n    <Directory /git/download>\n          Options  +FollowSymLinks\n          AllowOverride All\n          Require all granted\n    </Directory>\n  </VirtualHost>\n\n访问的自己的输入对应的地址： download2.linuxpanda.tech_\n\n.. _download2.linuxpanda.tech: http://download2.linuxpanda.tech\n","slug":"使用七牛云存储提供一个数据分发服务","published":1,"updated":"2018-02-18T07:50:06.246Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje3z1moc0018ugtmfs62s5jg","content":"<h2 id=\"背景描述\">背景描述</h2>\r\n<p>我个人在阿里云注册一个域名和购买了一个主机，平时整理写脚本和一些压缩包，放在自己的download目录，然后使用apache配合虚拟主机 共享出来，但是遇到问题了， 我自己的阿里云主机的带宽是1M的，下载速度真的慢，想想可以使用七牛云存储来改进下我的下载速度问题， 把我的改进过程给大家分享下。</p>\r\n<h2 id=\"七牛云简介\">七牛云简介</h2>\r\n<p>（七牛云）隶属于上海七牛信息技术有限公司，七牛云是国内领先的企业级云服务商，专注于以数据管理为中心的云计算业务研发和运营，围绕富媒体 场景推出了对象存储、融合 CDN 加速、容器计算云、大数据平台、人工智能平台等产品，并提供一站式视频云解决方案。公司目前已位列国内云计算 行业第一阵营，为 70 多万家企业提供服务。</p>\r\n<h2 id=\"七牛云相关\">七牛云相关</h2>\r\n<h3 id=\"账号注册\">账号注册</h3>\r\n<p><a href=\"https://portal.qiniu.com/signup/choice\" target=\"_blank\" rel=\"noopener\">注册地址</a></p>\r\n<h3 id=\"账号实名认证\">账号实名认证</h3>\r\n<p>注册完毕需要下实名认证，很快的，大概1-2天就实名认证完毕了。</p>\r\n<h3 id=\"新建存储空间\">新建存储空间</h3>\r\n<p><img src=\"/images/qiniu/新建存储.png\" alt=\"image\"></p>\r\n<h3 id=\"绑定域名\">绑定域名</h3>\r\n<p><img src=\"/images/qiniu/绑定域名.png\" alt=\"image\"></p>\r\n<h3 id=\"设置默认域名连接\">设置默认域名连接</h3>\r\n<p><img src=\"/images/qiniu/设置默认域名.png\" alt=\"image\"></p>\r\n<h3 id=\"查看cname\">查看cname</h3>\r\n<p><img src=\"/images/qiniu/查看cname.png\" alt=\"image\"></p>\r\n<h3 id=\"设置cname\">设置cname</h3>\r\n<p><img src=\"/images/qiniu/添加cname.png\" alt=\"image\"></p>\r\n<p>这个需要在自己的域名解析里面添加下这个cname的记录项。</p>\r\n<h3 id=\"key的获取\">key的获取</h3>\r\n<p><img src=\"/images/qiniu/七牛云key.png\" alt=\"image\"></p>\r\n<h2 id=\"python3的安装可选\">python3的安装(可选)</h2>\r\n<p><a href=\"https://repo.continuum.io/archive/Anaconda3-5.1.0-Linux-x86_64.sh\" target=\"_blank\" rel=\"noopener\">python的安装</a></p>\r\n<p>这是一个bash脚本，下载下载下来运行就可以，注意设置下安装路径，我设置的是/usr/loca/python3</p>\r\n<h2 id=\"安装七牛云的python包\">安装七牛云的python包</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> qiniu]# /usr/local/python3/bin/pip install qiniu</a></code></pre></div>\r\n<p>安装完毕之后，我们就可以使用七牛云提供的pythonapi了。</p>\r\n<h2 id=\"上传文件\">上传文件</h2>\r\n<h3 id=\"编辑config文件\">编辑config文件</h3>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> qiniu]# vim /usr/local/python3/lib/python3.6/site-packages/qiniu/config.py</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\"><span class=\"co\"># 修改超时时间</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-3\" data-line-number=\"3\"><span class=\"st\">&#39;connection_timeout&#39;</span>: <span class=\"ex\">300000</span>,        # 链接超时为时间为30s</a></code></pre></div>\r\n<p>因为我们自己上传的文件，可能很大，就会导致因链接时间过短而导致的上传失败，需要调整下timeout就可以了。</p>\r\n<h3 id=\"编写脚本\">编写脚本</h3>\r\n<p><a href=\"https://developer.qiniu.com/kodo/sdk/1242/python#upload-flow\" target=\"_blank\" rel=\"noopener\">官方api</a></p>\r\n<p>结合官方的api，我自己修改了下，如下。</p>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\"><span class=\"co\"># -*- coding: utf-8 -*-</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\"><span class=\"co\"># flake8: noqa</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"><span class=\"im\">from</span> qiniu <span class=\"im\">import</span> Auth, put_file, etag, urlsafe_base64_encode</a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"im\">import</span> qiniu.config</a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"im\">import</span> os</a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"><span class=\"im\">import</span> glob</a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\"><span class=\"im\">import</span> json</a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\"><span class=\"im\">import</span> jmespath</a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\">hash_json_file <span class=\"op\">=</span> <span class=\"st\">&quot;/root/bin/hash_file.json&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\">hash_json <span class=\"op\">=</span> []</a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\">hash_value <span class=\"op\">=</span> []</a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\">need_add <span class=\"op\">=</span> []</a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\"><span class=\"cf\">if</span> os.path.exists(hash_json_file):</a>\r\n<a class=\"sourceLine\" id=\"cb3-14\" data-line-number=\"14\">        <span class=\"cf\">with</span> <span class=\"bu\">open</span>(hash_json_file) <span class=\"im\">as</span> f:</a>\r\n<a class=\"sourceLine\" id=\"cb3-15\" data-line-number=\"15\">                hash_json<span class=\"op\">=</span>json.load(f)</a>\r\n<a class=\"sourceLine\" id=\"cb3-16\" data-line-number=\"16\">                hash_value<span class=\"op\">=</span>jmespath.search(<span class=\"st\">&#39;[*].hash&#39;</span>,hash_json)</a>\r\n<a class=\"sourceLine\" id=\"cb3-17\" data-line-number=\"17\"><span class=\"co\">#print(hash_json)</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-18\" data-line-number=\"18\"><span class=\"co\">#需要填写你的 Access Key 和 Secret Key</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-19\" data-line-number=\"19\">access_key <span class=\"op\">=</span> <span class=\"st\">&#39;6VGRI141Y1IHzO0WyIu9NKuKCPAMZsECmV80-sK0&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-20\" data-line-number=\"20\">secret_key <span class=\"op\">=</span> <span class=\"st\">&#39;1GQwv1f8qcIQn3o9Bq3_1xXP_JR_-GQPlZDfK7pu&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-21\" data-line-number=\"21\"><span class=\"co\">#构建鉴权对象</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-22\" data-line-number=\"22\">q <span class=\"op\">=</span> Auth(access_key, secret_key)</a>\r\n<a class=\"sourceLine\" id=\"cb3-23\" data-line-number=\"23\"><span class=\"co\">#要上传的空间</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-24\" data-line-number=\"24\">bucket_name <span class=\"op\">=</span> <span class=\"st\">&#39;download&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-25\" data-line-number=\"25\">tmpfiles<span class=\"op\">=</span>glob.glob(<span class=\"st\">&quot;/git/download/**/*&quot;</span> ,recursive<span class=\"op\">=</span><span class=\"va\">True</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-26\" data-line-number=\"26\">files<span class=\"op\">=</span>[x <span class=\"cf\">for</span> x <span class=\"kw\">in</span> tmpfiles <span class=\"cf\">if</span> os.path.isfile(x)]</a>\r\n<a class=\"sourceLine\" id=\"cb3-27\" data-line-number=\"27\"><span class=\"cf\">for</span> file_item <span class=\"kw\">in</span> files:</a>\r\n<a class=\"sourceLine\" id=\"cb3-28\" data-line-number=\"28\">        <span class=\"bu\">print</span>(<span class=\"st\">&quot;=================&gt;start upload&quot;</span> <span class=\"op\">+</span> file_item)</a>\r\n<a class=\"sourceLine\" id=\"cb3-29\" data-line-number=\"29\">        <span class=\"co\">#要上传文件的本地路径</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-30\" data-line-number=\"30\">        localfile <span class=\"op\">=</span> file_item</a>\r\n<a class=\"sourceLine\" id=\"cb3-31\" data-line-number=\"31\">        tmp_hash <span class=\"op\">=</span> etag(localfile)</a>\r\n<a class=\"sourceLine\" id=\"cb3-32\" data-line-number=\"32\">        <span class=\"cf\">if</span> <span class=\"bu\">len</span>(hash_value) <span class=\"op\">&gt;</span> <span class=\"dv\">0</span> <span class=\"kw\">and</span>  tmp_hash <span class=\"kw\">in</span> hash_value:</a>\r\n<a class=\"sourceLine\" id=\"cb3-33\" data-line-number=\"33\">                <span class=\"bu\">print</span>(<span class=\"st\">&quot;========&gt;sikp&quot;</span> <span class=\"op\">+</span> localfile)</a>\r\n<a class=\"sourceLine\" id=\"cb3-34\" data-line-number=\"34\">                <span class=\"cf\">continue</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-35\" data-line-number=\"35\">        <span class=\"co\">#上传到七牛后保存的文件名</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-36\" data-line-number=\"36\">        key <span class=\"op\">=</span> file_item.replace(<span class=\"st\">&quot;/git/download/&quot;</span>,<span class=\"st\">&quot;&quot;</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-37\" data-line-number=\"37\">        <span class=\"co\">#生成上传 Token，可以指定过期时间等</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-38\" data-line-number=\"38\">        token <span class=\"op\">=</span> q.upload_token(bucket_name, key, <span class=\"dv\">3600</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-39\" data-line-number=\"39\">        ret, info <span class=\"op\">=</span> put_file(token, key, localfile)</a>\r\n<a class=\"sourceLine\" id=\"cb3-40\" data-line-number=\"40\">        <span class=\"bu\">print</span>(ret)</a>\r\n<a class=\"sourceLine\" id=\"cb3-41\" data-line-number=\"41\">        <span class=\"co\">#print(info)</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-42\" data-line-number=\"42\">        need_add.append(ret)</a>\r\n<a class=\"sourceLine\" id=\"cb3-43\" data-line-number=\"43\">        <span class=\"co\">#assert ret[&#39;key&#39;] == key</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-44\" data-line-number=\"44\">        <span class=\"co\">#assert ret[&#39;hash&#39;] == etag(localfile)</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-45\" data-line-number=\"45\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-46\" data-line-number=\"46\">hash_json<span class=\"op\">+=</span>need_add</a>\r\n<a class=\"sourceLine\" id=\"cb3-47\" data-line-number=\"47\"><span class=\"bu\">print</span>(<span class=\"st\">&quot;=&quot;</span><span class=\"op\">*</span><span class=\"dv\">20</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-48\" data-line-number=\"48\"><span class=\"bu\">print</span>(json.dumps(need_add, indent<span class=\"op\">=</span><span class=\"dv\">4</span>))</a>\r\n<a class=\"sourceLine\" id=\"cb3-49\" data-line-number=\"49\"><span class=\"bu\">print</span>(<span class=\"st\">&quot;=&quot;</span><span class=\"op\">*</span><span class=\"dv\">20</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-50\" data-line-number=\"50\"><span class=\"cf\">with</span> <span class=\"bu\">open</span>(hash_json_file,<span class=\"st\">&#39;w&#39;</span>,encoding<span class=\"op\">=</span><span class=\"st\">&#39;utf-8&#39;</span>) <span class=\"im\">as</span> f:</a>\r\n<a class=\"sourceLine\" id=\"cb3-51\" data-line-number=\"51\">        json.dump(hash_json,f,indent<span class=\"op\">=</span><span class=\"dv\">4</span>)</a></code></pre></div>\r\n<p>代码也是比较简单，就是利用了一个hash文件来控制不去上传重复的文件。</p>\r\n<h3 id=\"测试上传\">测试上传</h3>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> bin]# /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py </a></code></pre></div>\r\n<h3 id=\"配置计划任务\">配置计划任务</h3>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> bin]# crontab -e</a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\"><span class=\"co\"># 添加如下行</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-3\" data-line-number=\"3\"><span class=\"ex\">1</span> 1 * * * /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py</a></code></pre></div>\r\n<h3 id=\"测试下载速度\">测试下载速度</h3>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\"><span class=\"ex\">C</span>:\\Users\\Administrator<span class=\"op\">&gt;</span>curl http://download.linuxpanda.tech/lamp/mariadb-10.2.12.tar.gz?attname= -O</a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">  <span class=\"ex\">%</span> Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">                                <span class=\"ex\">Dload</span>  Upload   Total   Spent    Left  Speed</a>\r\n<a class=\"sourceLine\" id=\"cb6-4\" data-line-number=\"4\"><span class=\"ex\">100</span> 69.4M  100 69.4M    0     0  3555k      0  0:00:20  0:00:20 --:--:-- 5151k</a></code></pre></div>\r\n<p>一个近60M的文件20秒就下载完毕了，平均1s就3M,下载速度杠杠滴，要是使用我自己的那个1M的带宽，那个下载速度最大也就125k。</p>\r\n<h3 id=\"配置自己的下载地址\">配置自己的下载地址</h3>\r\n<p>上面使用了七牛云的下载地址，但是没有列表展示界面，很不爽啊， 我还是希望我可以 能看到我自己的列表信息，可以在apache上配置一个虚拟主机。</p>\r\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode xml\"><code class=\"sourceCode xml\"><a class=\"sourceLine\" id=\"cb7-1\" data-line-number=\"1\"><span class=\"kw\">&lt;VirtualHost</span> <span class=\"er\">*:80</span><span class=\"kw\">&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-2\" data-line-number=\"2\">  ServerName download2.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb7-3\" data-line-number=\"3\">  ServerAlias down2.linuxpanda.tech ftp2.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb7-4\" data-line-number=\"4\">  DocumentRoot /git/download</a>\r\n<a class=\"sourceLine\" id=\"cb7-5\" data-line-number=\"5\">  <span class=\"kw\">&lt;Directory</span> <span class=\"er\">/git/download</span><span class=\"kw\">&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-6\" data-line-number=\"6\">        Options  +FollowSymLinks</a>\r\n<a class=\"sourceLine\" id=\"cb7-7\" data-line-number=\"7\">        AllowOverride All</a>\r\n<a class=\"sourceLine\" id=\"cb7-8\" data-line-number=\"8\">        Require all granted</a>\r\n<a class=\"sourceLine\" id=\"cb7-9\" data-line-number=\"9\">  <span class=\"kw\">&lt;/Directory&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-10\" data-line-number=\"10\"><span class=\"kw\">&lt;/VirtualHost&gt;</span></a></code></pre></div>\r\n<p>访问的自己的输入对应的地址： <a href=\"http://download2.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">download2.linuxpanda.tech</a></p>\r\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景描述\">背景描述</h2>\r\n<p>我个人在阿里云注册一个域名和购买了一个主机，平时整理写脚本和一些压缩包，放在自己的download目录，然后使用apache配合虚拟主机 共享出来，但是遇到问题了， 我自己的阿里云主机的带宽是1M的，下载速度真的慢，想想可以使用七牛云存储来改进下我的下载速度问题， 把我的改进过程给大家分享下。</p>\r\n<h2 id=\"七牛云简介\">七牛云简介</h2>\r\n<p>（七牛云）隶属于上海七牛信息技术有限公司，七牛云是国内领先的企业级云服务商，专注于以数据管理为中心的云计算业务研发和运营，围绕富媒体 场景推出了对象存储、融合 CDN 加速、容器计算云、大数据平台、人工智能平台等产品，并提供一站式视频云解决方案。公司目前已位列国内云计算 行业第一阵营，为 70 多万家企业提供服务。</p>\r\n<h2 id=\"七牛云相关\">七牛云相关</h2>\r\n<h3 id=\"账号注册\">账号注册</h3>\r\n<p><a href=\"https://portal.qiniu.com/signup/choice\" target=\"_blank\" rel=\"noopener\">注册地址</a></p>\r\n<h3 id=\"账号实名认证\">账号实名认证</h3>\r\n<p>注册完毕需要下实名认证，很快的，大概1-2天就实名认证完毕了。</p>\r\n<h3 id=\"新建存储空间\">新建存储空间</h3>\r\n<p><img src=\"/images/qiniu/新建存储.png\" alt=\"image\"></p>\r\n<h3 id=\"绑定域名\">绑定域名</h3>\r\n<p><img src=\"/images/qiniu/绑定域名.png\" alt=\"image\"></p>\r\n<h3 id=\"设置默认域名连接\">设置默认域名连接</h3>\r\n<p><img src=\"/images/qiniu/设置默认域名.png\" alt=\"image\"></p>\r\n<h3 id=\"查看cname\">查看cname</h3>\r\n<p><img src=\"/images/qiniu/查看cname.png\" alt=\"image\"></p>\r\n<h3 id=\"设置cname\">设置cname</h3>\r\n<p><img src=\"/images/qiniu/添加cname.png\" alt=\"image\"></p>\r\n<p>这个需要在自己的域名解析里面添加下这个cname的记录项。</p>\r\n<h3 id=\"key的获取\">key的获取</h3>\r\n<p><img src=\"/images/qiniu/七牛云key.png\" alt=\"image\"></p>\r\n<h2 id=\"python3的安装可选\">python3的安装(可选)</h2>\r\n<p><a href=\"https://repo.continuum.io/archive/Anaconda3-5.1.0-Linux-x86_64.sh\" target=\"_blank\" rel=\"noopener\">python的安装</a></p>\r\n<p>这是一个bash脚本，下载下载下来运行就可以，注意设置下安装路径，我设置的是/usr/loca/python3</p>\r\n<h2 id=\"安装七牛云的python包\">安装七牛云的python包</h2>\r\n<div class=\"sourceCode\" id=\"cb1\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb1-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> qiniu]# /usr/local/python3/bin/pip install qiniu</a></code></pre></div>\r\n<p>安装完毕之后，我们就可以使用七牛云提供的pythonapi了。</p>\r\n<h2 id=\"上传文件\">上传文件</h2>\r\n<h3 id=\"编辑config文件\">编辑config文件</h3>\r\n<div class=\"sourceCode\" id=\"cb2\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb2-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> qiniu]# vim /usr/local/python3/lib/python3.6/site-packages/qiniu/config.py</a>\r\n<a class=\"sourceLine\" id=\"cb2-2\" data-line-number=\"2\"><span class=\"co\"># 修改超时时间</span></a>\r\n<a class=\"sourceLine\" id=\"cb2-3\" data-line-number=\"3\"><span class=\"st\">&#39;connection_timeout&#39;</span>: <span class=\"ex\">300000</span>,        # 链接超时为时间为30s</a></code></pre></div>\r\n<p>因为我们自己上传的文件，可能很大，就会导致因链接时间过短而导致的上传失败，需要调整下timeout就可以了。</p>\r\n<h3 id=\"编写脚本\">编写脚本</h3>\r\n<p><a href=\"https://developer.qiniu.com/kodo/sdk/1242/python#upload-flow\" target=\"_blank\" rel=\"noopener\">官方api</a></p>\r\n<p>结合官方的api，我自己修改了下，如下。</p>\r\n<div class=\"sourceCode\" id=\"cb3\"><pre class=\"sourceCode python\"><code class=\"sourceCode python\"><a class=\"sourceLine\" id=\"cb3-1\" data-line-number=\"1\"><span class=\"co\"># -*- coding: utf-8 -*-</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-2\" data-line-number=\"2\"><span class=\"co\"># flake8: noqa</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-3\" data-line-number=\"3\"><span class=\"im\">from</span> qiniu <span class=\"im\">import</span> Auth, put_file, etag, urlsafe_base64_encode</a>\r\n<a class=\"sourceLine\" id=\"cb3-4\" data-line-number=\"4\"><span class=\"im\">import</span> qiniu.config</a>\r\n<a class=\"sourceLine\" id=\"cb3-5\" data-line-number=\"5\"><span class=\"im\">import</span> os</a>\r\n<a class=\"sourceLine\" id=\"cb3-6\" data-line-number=\"6\"><span class=\"im\">import</span> glob</a>\r\n<a class=\"sourceLine\" id=\"cb3-7\" data-line-number=\"7\"><span class=\"im\">import</span> json</a>\r\n<a class=\"sourceLine\" id=\"cb3-8\" data-line-number=\"8\"><span class=\"im\">import</span> jmespath</a>\r\n<a class=\"sourceLine\" id=\"cb3-9\" data-line-number=\"9\">hash_json_file <span class=\"op\">=</span> <span class=\"st\">&quot;/root/bin/hash_file.json&quot;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-10\" data-line-number=\"10\">hash_json <span class=\"op\">=</span> []</a>\r\n<a class=\"sourceLine\" id=\"cb3-11\" data-line-number=\"11\">hash_value <span class=\"op\">=</span> []</a>\r\n<a class=\"sourceLine\" id=\"cb3-12\" data-line-number=\"12\">need_add <span class=\"op\">=</span> []</a>\r\n<a class=\"sourceLine\" id=\"cb3-13\" data-line-number=\"13\"><span class=\"cf\">if</span> os.path.exists(hash_json_file):</a>\r\n<a class=\"sourceLine\" id=\"cb3-14\" data-line-number=\"14\">        <span class=\"cf\">with</span> <span class=\"bu\">open</span>(hash_json_file) <span class=\"im\">as</span> f:</a>\r\n<a class=\"sourceLine\" id=\"cb3-15\" data-line-number=\"15\">                hash_json<span class=\"op\">=</span>json.load(f)</a>\r\n<a class=\"sourceLine\" id=\"cb3-16\" data-line-number=\"16\">                hash_value<span class=\"op\">=</span>jmespath.search(<span class=\"st\">&#39;[*].hash&#39;</span>,hash_json)</a>\r\n<a class=\"sourceLine\" id=\"cb3-17\" data-line-number=\"17\"><span class=\"co\">#print(hash_json)</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-18\" data-line-number=\"18\"><span class=\"co\">#需要填写你的 Access Key 和 Secret Key</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-19\" data-line-number=\"19\">access_key <span class=\"op\">=</span> <span class=\"st\">&#39;6VGRI141Y1IHzO0WyIu9NKuKCPAMZsECmV80-sK0&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-20\" data-line-number=\"20\">secret_key <span class=\"op\">=</span> <span class=\"st\">&#39;1GQwv1f8qcIQn3o9Bq3_1xXP_JR_-GQPlZDfK7pu&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-21\" data-line-number=\"21\"><span class=\"co\">#构建鉴权对象</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-22\" data-line-number=\"22\">q <span class=\"op\">=</span> Auth(access_key, secret_key)</a>\r\n<a class=\"sourceLine\" id=\"cb3-23\" data-line-number=\"23\"><span class=\"co\">#要上传的空间</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-24\" data-line-number=\"24\">bucket_name <span class=\"op\">=</span> <span class=\"st\">&#39;download&#39;</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-25\" data-line-number=\"25\">tmpfiles<span class=\"op\">=</span>glob.glob(<span class=\"st\">&quot;/git/download/**/*&quot;</span> ,recursive<span class=\"op\">=</span><span class=\"va\">True</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-26\" data-line-number=\"26\">files<span class=\"op\">=</span>[x <span class=\"cf\">for</span> x <span class=\"kw\">in</span> tmpfiles <span class=\"cf\">if</span> os.path.isfile(x)]</a>\r\n<a class=\"sourceLine\" id=\"cb3-27\" data-line-number=\"27\"><span class=\"cf\">for</span> file_item <span class=\"kw\">in</span> files:</a>\r\n<a class=\"sourceLine\" id=\"cb3-28\" data-line-number=\"28\">        <span class=\"bu\">print</span>(<span class=\"st\">&quot;=================&gt;start upload&quot;</span> <span class=\"op\">+</span> file_item)</a>\r\n<a class=\"sourceLine\" id=\"cb3-29\" data-line-number=\"29\">        <span class=\"co\">#要上传文件的本地路径</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-30\" data-line-number=\"30\">        localfile <span class=\"op\">=</span> file_item</a>\r\n<a class=\"sourceLine\" id=\"cb3-31\" data-line-number=\"31\">        tmp_hash <span class=\"op\">=</span> etag(localfile)</a>\r\n<a class=\"sourceLine\" id=\"cb3-32\" data-line-number=\"32\">        <span class=\"cf\">if</span> <span class=\"bu\">len</span>(hash_value) <span class=\"op\">&gt;</span> <span class=\"dv\">0</span> <span class=\"kw\">and</span>  tmp_hash <span class=\"kw\">in</span> hash_value:</a>\r\n<a class=\"sourceLine\" id=\"cb3-33\" data-line-number=\"33\">                <span class=\"bu\">print</span>(<span class=\"st\">&quot;========&gt;sikp&quot;</span> <span class=\"op\">+</span> localfile)</a>\r\n<a class=\"sourceLine\" id=\"cb3-34\" data-line-number=\"34\">                <span class=\"cf\">continue</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-35\" data-line-number=\"35\">        <span class=\"co\">#上传到七牛后保存的文件名</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-36\" data-line-number=\"36\">        key <span class=\"op\">=</span> file_item.replace(<span class=\"st\">&quot;/git/download/&quot;</span>,<span class=\"st\">&quot;&quot;</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-37\" data-line-number=\"37\">        <span class=\"co\">#生成上传 Token，可以指定过期时间等</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-38\" data-line-number=\"38\">        token <span class=\"op\">=</span> q.upload_token(bucket_name, key, <span class=\"dv\">3600</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-39\" data-line-number=\"39\">        ret, info <span class=\"op\">=</span> put_file(token, key, localfile)</a>\r\n<a class=\"sourceLine\" id=\"cb3-40\" data-line-number=\"40\">        <span class=\"bu\">print</span>(ret)</a>\r\n<a class=\"sourceLine\" id=\"cb3-41\" data-line-number=\"41\">        <span class=\"co\">#print(info)</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-42\" data-line-number=\"42\">        need_add.append(ret)</a>\r\n<a class=\"sourceLine\" id=\"cb3-43\" data-line-number=\"43\">        <span class=\"co\">#assert ret[&#39;key&#39;] == key</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-44\" data-line-number=\"44\">        <span class=\"co\">#assert ret[&#39;hash&#39;] == etag(localfile)</span></a>\r\n<a class=\"sourceLine\" id=\"cb3-45\" data-line-number=\"45\"></a>\r\n<a class=\"sourceLine\" id=\"cb3-46\" data-line-number=\"46\">hash_json<span class=\"op\">+=</span>need_add</a>\r\n<a class=\"sourceLine\" id=\"cb3-47\" data-line-number=\"47\"><span class=\"bu\">print</span>(<span class=\"st\">&quot;=&quot;</span><span class=\"op\">*</span><span class=\"dv\">20</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-48\" data-line-number=\"48\"><span class=\"bu\">print</span>(json.dumps(need_add, indent<span class=\"op\">=</span><span class=\"dv\">4</span>))</a>\r\n<a class=\"sourceLine\" id=\"cb3-49\" data-line-number=\"49\"><span class=\"bu\">print</span>(<span class=\"st\">&quot;=&quot;</span><span class=\"op\">*</span><span class=\"dv\">20</span>)</a>\r\n<a class=\"sourceLine\" id=\"cb3-50\" data-line-number=\"50\"><span class=\"cf\">with</span> <span class=\"bu\">open</span>(hash_json_file,<span class=\"st\">&#39;w&#39;</span>,encoding<span class=\"op\">=</span><span class=\"st\">&#39;utf-8&#39;</span>) <span class=\"im\">as</span> f:</a>\r\n<a class=\"sourceLine\" id=\"cb3-51\" data-line-number=\"51\">        json.dump(hash_json,f,indent<span class=\"op\">=</span><span class=\"dv\">4</span>)</a></code></pre></div>\r\n<p>代码也是比较简单，就是利用了一个hash文件来控制不去上传重复的文件。</p>\r\n<h3 id=\"测试上传\">测试上传</h3>\r\n<div class=\"sourceCode\" id=\"cb4\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb4-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> bin]# /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py </a></code></pre></div>\r\n<h3 id=\"配置计划任务\">配置计划任务</h3>\r\n<div class=\"sourceCode\" id=\"cb5\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb5-1\" data-line-number=\"1\">[<span class=\"ex\">root@www</span> bin]# crontab -e</a>\r\n<a class=\"sourceLine\" id=\"cb5-2\" data-line-number=\"2\"><span class=\"co\"># 添加如下行</span></a>\r\n<a class=\"sourceLine\" id=\"cb5-3\" data-line-number=\"3\"><span class=\"ex\">1</span> 1 * * * /usr/local/python3/bin/python /root/bin/push_download_to_qiniu.py</a></code></pre></div>\r\n<h3 id=\"测试下载速度\">测试下载速度</h3>\r\n<div class=\"sourceCode\" id=\"cb6\"><pre class=\"sourceCode bash\"><code class=\"sourceCode bash\"><a class=\"sourceLine\" id=\"cb6-1\" data-line-number=\"1\"><span class=\"ex\">C</span>:\\Users\\Administrator<span class=\"op\">&gt;</span>curl http://download.linuxpanda.tech/lamp/mariadb-10.2.12.tar.gz?attname= -O</a>\r\n<a class=\"sourceLine\" id=\"cb6-2\" data-line-number=\"2\">  <span class=\"ex\">%</span> Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</a>\r\n<a class=\"sourceLine\" id=\"cb6-3\" data-line-number=\"3\">                                <span class=\"ex\">Dload</span>  Upload   Total   Spent    Left  Speed</a>\r\n<a class=\"sourceLine\" id=\"cb6-4\" data-line-number=\"4\"><span class=\"ex\">100</span> 69.4M  100 69.4M    0     0  3555k      0  0:00:20  0:00:20 --:--:-- 5151k</a></code></pre></div>\r\n<p>一个近60M的文件20秒就下载完毕了，平均1s就3M,下载速度杠杠滴，要是使用我自己的那个1M的带宽，那个下载速度最大也就125k。</p>\r\n<h3 id=\"配置自己的下载地址\">配置自己的下载地址</h3>\r\n<p>上面使用了七牛云的下载地址，但是没有列表展示界面，很不爽啊， 我还是希望我可以 能看到我自己的列表信息，可以在apache上配置一个虚拟主机。</p>\r\n<div class=\"sourceCode\" id=\"cb7\"><pre class=\"sourceCode xml\"><code class=\"sourceCode xml\"><a class=\"sourceLine\" id=\"cb7-1\" data-line-number=\"1\"><span class=\"kw\">&lt;VirtualHost</span> <span class=\"er\">*:80</span><span class=\"kw\">&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-2\" data-line-number=\"2\">  ServerName download2.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb7-3\" data-line-number=\"3\">  ServerAlias down2.linuxpanda.tech ftp2.linuxpanda.tech</a>\r\n<a class=\"sourceLine\" id=\"cb7-4\" data-line-number=\"4\">  DocumentRoot /git/download</a>\r\n<a class=\"sourceLine\" id=\"cb7-5\" data-line-number=\"5\">  <span class=\"kw\">&lt;Directory</span> <span class=\"er\">/git/download</span><span class=\"kw\">&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-6\" data-line-number=\"6\">        Options  +FollowSymLinks</a>\r\n<a class=\"sourceLine\" id=\"cb7-7\" data-line-number=\"7\">        AllowOverride All</a>\r\n<a class=\"sourceLine\" id=\"cb7-8\" data-line-number=\"8\">        Require all granted</a>\r\n<a class=\"sourceLine\" id=\"cb7-9\" data-line-number=\"9\">  <span class=\"kw\">&lt;/Directory&gt;</span></a>\r\n<a class=\"sourceLine\" id=\"cb7-10\" data-line-number=\"10\"><span class=\"kw\">&lt;/VirtualHost&gt;</span></a></code></pre></div>\r\n<p>访问的自己的输入对应的地址： <a href=\"http://download2.linuxpanda.tech\" target=\"_blank\" rel=\"noopener\">download2.linuxpanda.tech</a></p>\r\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cje3z1mmx0000ugtm1v4nze5t","category_id":"cje3z1mn90004ugtmyjuwz84k","_id":"cje3z1mnr000iugtmzfypv66h"},{"post_id":"cje3z1mno000fugtmhlvcnalx","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1mny000pugtmtc1h7at7"},{"post_id":"cje3z1mn60002ugtmf9u9b05z","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1mo5000uugtm4e8lunqt"},{"post_id":"cje3z1mnb0006ugtmzshf5x1y","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1mo8000yugtm6tqx5s2a"},{"post_id":"cje3z1mo5000tugtmcqiw825c","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1mob0014ugtm9pr4neep"},{"post_id":"cje3z1mnd0008ugtmt153n4qx","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1moe0019ugtmcqfe9ai7"},{"post_id":"cje3z1mne000augtmpwf5xm50","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1moj001augtmt3daq7wt"},{"post_id":"cje3z1moc0018ugtmfs62s5jg","category_id":"cje3z1mni000bugtmgeha3s61","_id":"cje3z1mom001eugtmjgezdd19"},{"post_id":"cje3z1mnq000hugtmow17js3q","category_id":"cje3z1mob0015ugtm80mezpcq","_id":"cje3z1mom001gugtmo6756fqz"},{"post_id":"cje3z1mnu000mugtmqia5s1oe","category_id":"cje3z1mob0015ugtm80mezpcq","_id":"cje3z1mon001jugtm5nq6mcni"},{"post_id":"cje3z1mo6000wugtmainrhexk","category_id":"cje3z1mom001fugtmy7isnq5n","_id":"cje3z1mop001ougtmsfx07u3c"},{"post_id":"cje3z1mo90011ugtmg9c3m2n2","category_id":"cje3z1moo001kugtmignt82mz","_id":"cje3z1moq001sugtmug3ka8eh"},{"post_id":"cje3z1moa0013ugtmn8ku0t3x","category_id":"cje3z1mop001qugtmmamv9i69","_id":"cje3z1mor001wugtmktkhggx6"}],"PostTag":[{"post_id":"cje3z1mmx0000ugtm1v4nze5t","tag_id":"cje3z1mna0005ugtmzrwogrg9","_id":"cje3z1mno000eugtmckv1dq4y"},{"post_id":"cje3z1mn60002ugtmf9u9b05z","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1mo6000vugtm0qn5q4cu"},{"post_id":"cje3z1mn60002ugtmf9u9b05z","tag_id":"cje3z1mnt000lugtmh3bsbq6d","_id":"cje3z1mo8000zugtmpauiznrz"},{"post_id":"cje3z1mo5000tugtmcqiw825c","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1moa0012ugtm885oeuzu"},{"post_id":"cje3z1mnb0006ugtmzshf5x1y","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1mob0016ugtm5b0e400f"},{"post_id":"cje3z1moc0018ugtmfs62s5jg","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1mol001cugtmvpsth8ny"},{"post_id":"cje3z1mnd0008ugtmt153n4qx","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1mon001iugtms9vx6tld"},{"post_id":"cje3z1mnd0008ugtmt153n4qx","tag_id":"cje3z1moc0017ugtmi9a7r1n6","_id":"cje3z1moo001lugtmp1zoi3sw"},{"post_id":"cje3z1mnd0008ugtmt153n4qx","tag_id":"cje3z1mol001dugtmbczh9rb7","_id":"cje3z1mop001nugtm1jslk6xr"},{"post_id":"cje3z1mne000augtmpwf5xm50","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1mop001pugtm0xu4sppi"},{"post_id":"cje3z1mno000fugtmhlvcnalx","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1moq001uugtmylq0lh74"},{"post_id":"cje3z1mno000fugtmhlvcnalx","tag_id":"cje3z1moc0017ugtmi9a7r1n6","_id":"cje3z1mor001vugtmw0weveh0"},{"post_id":"cje3z1mno000fugtmhlvcnalx","tag_id":"cje3z1mop001rugtm35gj6x37","_id":"cje3z1mor001yugtmd32dmwgp"},{"post_id":"cje3z1mnq000hugtmow17js3q","tag_id":"cje3z1moq001tugtmyox2iip2","_id":"cje3z1mos0020ugtmu0ezlsnw"},{"post_id":"cje3z1mnq000hugtmow17js3q","tag_id":"cje3z1mor001xugtm7jtp6a4t","_id":"cje3z1mos0021ugtmywf3j5n8"},{"post_id":"cje3z1mnq000hugtmow17js3q","tag_id":"cje3z1mnj000cugtmipm14ku2","_id":"cje3z1mos0023ugtm0rc0nwjq"},{"post_id":"cje3z1mnu000mugtmqia5s1oe","tag_id":"cje3z1mor001zugtmhlupcsj7","_id":"cje3z1mot0024ugtm6yoff10q"},{"post_id":"cje3z1mo6000wugtmainrhexk","tag_id":"cje3z1mos0022ugtmnf512zim","_id":"cje3z1mot0026ugtmaj5f1ktn"},{"post_id":"cje3z1mo90011ugtmg9c3m2n2","tag_id":"cje3z1mot0025ugtmamqnz7i4","_id":"cje3z1mou0028ugtmgoskj9jd"},{"post_id":"cje3z1moa0013ugtmn8ku0t3x","tag_id":"cje3z1mot0027ugtmvep3rmlc","_id":"cje3z1mow0029ugtm7jkw6uhz"}],"Tag":[{"name":"about","_id":"cje3z1mna0005ugtmzrwogrg9"},{"name":"linux","_id":"cje3z1mnj000cugtmipm14ku2"},{"name":"ca","_id":"cje3z1mnt000lugtmh3bsbq6d"},{"name":"git","_id":"cje3z1moc0017ugtmi9a7r1n6"},{"name":"gitlab","_id":"cje3z1mol001dugtmbczh9rb7"},{"name":"gitbucket","_id":"cje3z1mop001rugtm35gj6x37"},{"name":"mysql","_id":"cje3z1moq001tugtmyox2iip2"},{"name":"mariadb","_id":"cje3z1mor001xugtm7jtp6a4t"},{"name":"database","_id":"cje3z1mor001zugtmhlupcsj7"},{"name":"essay","_id":"cje3z1mos0022ugtmnf512zim"},{"name":"python","_id":"cje3z1mot0025ugtmamqnz7i4"},{"name":"spider","_id":"cje3z1mot0027ugtmvep3rmlc"}]}}